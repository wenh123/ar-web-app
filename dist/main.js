(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t={683:()=>{},345:()=>{}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};(()=>{r.d(a,{A:()=>Jb,G:()=>tv});var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},e.apply(this,arguments)};function t(e,t,n,r){return new(n||(n=Promise))((function(a,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function i(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}u((r=r.apply(e,t||[])).next())}))}function n(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function s(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var o=function(){function e(e,t,n){this.NB_BUFFERS=5,this._videoFrames=[],this._nbFramesDelay=0,this._videoElement=e,this._videoCanvas=document.createElement("canvas"),this._videoCanvas.style.display="none",this._videoCanvasContext=this._videoCanvas.getContext("2d"),null!=t&&(this._videoCanvas.width=t),null!=n&&(this._videoCanvas.height=n)}return e.prototype.getNbFramesDelay=function(){return this._nbFramesDelay},e.prototype.setNbFramesDelay=function(e){e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)},e.prototype.getVideoCanvas=function(){return this._videoCanvas},e.prototype.compare=function(e,t,n,r){var a=!0;return[1,50,100,1e3,2e3,3e3,5e3,9e3].forEach((function(s){s<n*r*3&&e.data[s]!=t.data[s]&&(a=!1)})),a},e.prototype.preProcessWithBuffer=function(e){for(var t=0;t<this._videoFrames.length;t++)if(this.compare(this._videoFrames[t],e,this._videoCanvas.width,this._videoCanvas.height))return!1;return this._videoFrames.length===this.NB_BUFFERS&&(this._videoFrames=this._videoFrames.slice(0,-1)),this._videoFrames=s([e],this._videoFrames,!0),!0},e.prototype.preProcess=function(){if(null==this._videoElement||0===this._videoElement.videoWidth||0===this._videoElement.videoHeight)return!1;this._videoCanvas.width===this._videoElement.videoWidth&&this._videoCanvas.height===this._videoElement.videoHeight||(this._videoFrames=[],this._videoCanvas.width=this._videoElement.videoWidth,this._videoCanvas.height=this._videoElement.videoHeight),this._videoCanvasContext.drawImage(this._videoElement,0,0,this._videoCanvas.width,this._videoCanvas.height);for(var e=this._videoCanvasContext.getImageData(0,0,this._videoCanvas.width,this._videoCanvas.height),t=0;t<this._videoFrames.length;t++)if(this.compare(this._videoFrames[t],e,this._videoCanvas.width,this._videoCanvas.height))return!1;return this._videoFrames.length===this.NB_BUFFERS&&(this._videoFrames=this._videoFrames.slice(0,-1)),this._videoFrames=s([e],this._videoFrames,!0),!0},e.prototype.postProcess=function(){if(this._nbFramesDelay>0&&this._videoFrames.length>0){var e=this._nbFramesDelay<this._videoFrames.length?this._videoFrames[this._nbFramesDelay]:this._videoFrames[this._videoFrames.length-1];this._videoCanvasContext.putImageData(e,0,0)}},e.prototype.getCameraFrame=function(){if(this._nbFramesDelay>0&&this._videoFrames.length>0)return this._nbFramesDelay<this._videoFrames.length?this._videoFrames[this._nbFramesDelay]:this._videoFrames[this._videoFrames.length-1]},e.prototype.updateDelay=function(e){e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)},e.prototype.getLastBuffer=function(){return this._videoFrames.length>0?this._videoFrames[0]:null},e.prototype.setOverlapingImage=function(e){this._videoCanvasContext.putImageData(e,10,10)},e}(),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i(e,t)};function u(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e){return"function"==typeof e}var c=!1,h={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,c=e},get useDeprecatedSynchronousErrorHandling(){return c}};function p(e){setTimeout((function(){throw e}),0)}var f={closed:!0,next:function(e){},error:function(e){if(h.useDeprecatedSynchronousErrorHandling)throw e;p(e)},complete:function(){}},d=Array.isArray||function(e){return e&&"number"==typeof e.length};function m(e){return null!==e&&"object"==typeof e}var g=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),y=g,b=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,a=n._ctorUnsubscribe,s=n._unsubscribe,o=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var i=0;i<r.length;++i)r[i].remove(this);if(l(s)){a&&(this._unsubscribe=void 0);try{s.call(this)}catch(e){t=e instanceof y?v(e.errors):[e]}}if(d(o)){i=-1;for(var u=o.length;++i<u;){var c=o[i];if(m(c))try{c.unsubscribe()}catch(e){t=t||[],e instanceof y?t=t.concat(v(e.errors)):t.push(e)}}}if(t)throw new y(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function v(e){return e.reduce((function(e,t){return e.concat(t instanceof y?t.errors:t)}),[])}var x="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),_=function(e){function t(n,r,a){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=f;break;case 1:if(!n){s.destination=f;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new w(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new w(s,n,r,a)}return s}return u(t,e),t.prototype[x]=function(){return this},t.create=function(e,n,r){var a=new t(e,n,r);return a.syncErrorThrowable=!1,a},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(b),w=function(e){function t(t,n,r,a){var s,o=e.call(this)||this;o._parentSubscriber=t;var i=o;return l(n)?s=n:n&&(s=n.next,r=n.error,a=n.complete,n!==f&&(l((i=Object.create(n)).unsubscribe)&&o.add(i.unsubscribe.bind(i)),i.unsubscribe=o.unsubscribe.bind(o))),o._context=i,o._next=s,o._error=r,o._complete=a,o}return u(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;h.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=h.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):p(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;p(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};h.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),h.useDeprecatedSynchronousErrorHandling)throw e;p(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!h.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return h.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(p(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(_),T="function"==typeof Symbol&&Symbol.observable||"@@observable";function E(e){return e}function S(e){return 0===e.length?E:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var I=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof _)return e;if(e[x])return e[x]()}return e||t||n?new _(e,t,n):new _(f)}(e,t,n);if(r?a.add(r.call(a,this.source)):a.add(this.source||h.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),h.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){h.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof _?r:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=k(t))((function(t,r){var a;a=n.subscribe((function(t){try{e(t)}catch(e){r(e),a&&a.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[T]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:S(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=k(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function k(e){if(e||(e=h.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var C=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},N="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",A=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function $(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var R=function(e){if(e&&"function"==typeof e[T])return r=e,function(e){var t=r[T]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(A(e))return C(e);if($(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,p),e};if(e&&"function"==typeof e[N])return t=e,function(e){for(var n=t[N]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,a=m(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+a+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},F=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return u(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(_),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(_);function D(e){return e&&"function"==typeof e.schedule}var M=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parent=t,a.outerValue=n,a.outerIndex=r,a.index=0,a}return u(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(_);function L(e,t,n,r,a){if(void 0===a&&(a=new M(e,n,r)),!a.closed)return t instanceof I?t.subscribe(a):R(t)(a)}var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.notifyNext=function(e,t,n,r,a){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(_);function B(e,t){return new I((function(n){var r=new b,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function U(e,t){return t?B(e,t):new I(C(e))}var z={};function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return D(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&d(e[0])&&(e=e[0]),U(e,r).lift(new W(n))}var W=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new j(e,this.resultSelector))},e}(),j=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return u(t,e),t.prototype._next=function(e){this.values.push(z),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(L(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,a=r[n],s=this.toRespond?a===z?--this.toRespond:this.toRespond:0;r[n]=t,0===s&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(P);function G(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[T]}(e))return function(e,t){return new I((function(n){var r=new b;return r.add(t.schedule((function(){var a=e[T]();r.add(a.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if($(e))return function(e,t){return new I((function(n){var r=new b;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(A(e))return B(e,t);if(function(e){return e&&"function"==typeof e[N]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new I((function(n){var r,a=new b;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[N](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof I?e:new I(R(e))}function H(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return D(n)?(e.pop(),B(e,n)):U(e)}function K(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new q(e,t))}}var q=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new X(e,this.project,this.thisArg))},e}(),X=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.project=n,a.count=0,a.thisArg=r||a,a}return u(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(_),Y=new I((function(e){return e.complete()}));function Q(e,t){return new I(t?function(n){return t.schedule(J,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function J(e){var t=e.error;e.subscriber.error(t)}function Z(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.callback))},e}(),te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new b(n)),r}return u(t,e),t}(_),ne=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),re=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return u(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(b),ae=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return u(t,e),t}(_),se=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return u(t,e),t.prototype[x]=function(){return new ae(this)},t.prototype.lift=function(e){var t=new oe(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new ne;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)},t.prototype.error=function(e){if(this.closed)throw new ne;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new ne;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new ne;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new ne;return this.hasError?(e.error(this.thrownError),b.EMPTY):this.isStopped?(e.complete(),b.EMPTY):(this.observers.push(e),new re(this,e))},t.prototype.asObservable=function(){var e=new I;return e.source=this,e},t.create=function(e,t){return new oe(e,t)},t}(I),oe=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return u(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):b.EMPTY},t}(se),ie=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return u(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ne;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(se);function ue(e){return void 0===e&&(e=-1),function(t){return t.lift(new le(e,t))}}var le=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.count,this.source))},e}(),ce=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.count=n,a.source=r,a}return u(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(_);function he(e,t){return"function"==typeof t?function(n){return n.pipe(he((function(n,r){return G(e(n,r)).pipe(K((function(e,a){return t(n,e,r,a)})))})))}:function(t){return t.lift(new pe(e))}}var pe=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new fe(e,this.project))},e}(),fe=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return u(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new F(this),r=this.destination;r.add(n),this.innerSubscription=function(e,t){if(!t.closed){if(e instanceof I)return e.subscribe(t);var n;try{n=R(e)(t)}catch(e){t.error(e)}return n}}(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(O);function de(){}function me(e,t,n){return function(r){return r.lift(new ge(e,t,n))}}var ge=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new ye(e,this.nextOrObserver,this.error,this.complete))},e}(),ye=function(e){function t(t,n,r,a){var s=e.call(this,t)||this;return s._tapNext=de,s._tapError=de,s._tapComplete=de,s._tapError=r||de,s._tapComplete=a||de,l(n)?(s._context=s,s._tapNext=n):n&&(s._context=n,s._tapNext=n.next||de,s._tapError=n.error||de,s._tapComplete=n.complete||de),s}return u(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(_);function be(e){return new I((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?G(n):Y).subscribe(t)}))}var ve=void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function xe(){throw new Error("setTimeout has not been defined")}function _e(){throw new Error("clearTimeout has not been defined")}var we=xe,Te=_e;function Ee(e){if(we===setTimeout)return setTimeout(e,0);if((we===xe||!we)&&setTimeout)return we=setTimeout,setTimeout(e,0);try{return we(e,0)}catch(t){try{return we.call(null,e,0)}catch(t){return we.call(this,e,0)}}}"function"==typeof ve.setTimeout&&(we=setTimeout),"function"==typeof ve.clearTimeout&&(Te=clearTimeout);var Se,Ie=[],ke=!1,Ce=-1;function Ne(){ke&&Se&&(ke=!1,Se.length?Ie=Se.concat(Ie):Ce=-1,Ie.length&&Ae())}function Ae(){if(!ke){var e=Ee(Ne);ke=!0;for(var t=Ie.length;t;){for(Se=Ie,Ie=[];++Ce<t;)Se&&Se[Ce].run();Ce=-1,t=Ie.length}Se=null,ke=!1,function(e){if(Te===clearTimeout)return clearTimeout(e);if((Te===_e||!Te)&&clearTimeout)return Te=clearTimeout,clearTimeout(e);try{Te(e)}catch(t){try{return Te.call(null,e)}catch(t){return Te.call(this,e)}}}(e)}}function $e(e,t){this.fun=e,this.array=t}function Re(){}$e.prototype.run=function(){this.fun.apply(null,this.array)};var Fe=Re,Oe=Re,De=Re,Me=Re,Le=Re,Pe=Re,Be=Re,Ue=ve.performance||{},ze=Ue.now||Ue.mozNow||Ue.msNow||Ue.oNow||Ue.webkitNow||function(){return(new Date).getTime()},Ve=new Date,We={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Ie.push(new $e(e,t)),1!==Ie.length||ke||Ee(Ae)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Fe,addListener:Oe,once:De,off:Me,removeListener:Le,removeAllListeners:Pe,emit:Be,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*ze.call(Ue),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Ve)/1e3}},je=We;class Ge{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class He{refCount(e){return Ke("refCount")}incRef(e){return Ke("incRef")}timerAvailable(){return!0}time(e){return Ke("time")}read(e){return Ke("read")}readSync(e){return Ke("readSync")}readToGPU(e,t){return Ke("readToGPU")}numDataIds(){return Ke("numDataIds")}disposeData(e,t){return Ke("disposeData")}write(e,t,n){return Ke("write")}move(e,t,n,r,a){return Ke("move")}memory(){return Ke("memory")}floatPrecision(){return Ke("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return Ke("dispose")}}function Ke(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function qe(e,t,n){return Math.max(e,Math.min(t,n))}function Xe(e){return e%2==0?e:e+1}function Ye(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Qe(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Je(e,t,n=""){Qe(nt(e,t),(()=>n+` Shapes ${e} and ${t} must match`))}function Ze(e){Qe(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function et(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||ft(e)&&!n)for(let r=0;r<e.length;++r)et(e[r],t,n);else t.push(e);return t}function tt(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function nt(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function rt(e){return e%1==0}function at(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function st(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ot(e,t=(e=>0),n){return new Promise(((r,a)=>{let s=0;const o=()=>{if(e())return void r();s++;const i=t(s);null!=n&&s>=n?a():setTimeout(o,i)};o()}))}function it(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const a=e.slice();return a[r]=t/n,a}function ut(e,t){const n=t.length;return Qe((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`)),Qe(e.every((e=>rt(e))),(()=>`All values in axis param must be integers but got axis ${e}`)),e.map((e=>e<0?n+e:e))}function lt(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,s=null==t||a?null:ut(t,e).sort();let o=0;for(let t=0;t<e.length;++t){if(null!=s){if(s[o]===t&&1!==e[t])throw new Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==s[o]||s[o]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),s[o]<=t&&o++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function ct(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error(`Unknown data type ${e}`);n=new Uint8Array(t)}return n}function ht(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function pt(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function ft(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function dt(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function mt(e){return"string"==typeof e||e instanceof String}function gt(e){return Array.isArray(e)?gt(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":"number"==typeof e?"float32":mt(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function yt(e){return!!(e&&e.constructor&&e.call&&e.apply)}function bt(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function vt(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function xt(e,t,n,r=!1){const a=new Array;if(1===t.length){const s=t[0]*(r?2:1);for(let t=0;t<s;t++)a[t]=n[e+t]}else{const s=t[0],o=t.slice(1),i=o.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<s;t++)a[t]=xt(e+t*i,o,n,r)}return a}function _t(e,t,n=!1){if(0===e.length)return t[0];const r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return xt(0,e,t,n)}function wt(e,t){const n=Tt(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}function Tt(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Et(e){e.forEach((t=>{Qe(Number.isInteger(t)&&t>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`))}))}function St(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let t=0;t<e.length-1;++t)r+=n[t]*e[t];return r}function It(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let t=0;t<r.length-1;++t)r[t]=Math.floor(e/n[t]),e-=r[t]*n[t];return r[r.length-1]=e,r}function kt(e){return e&&e.then&&"function"==typeof e.then}class Ct{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Nt,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(At().getBool("IS_TEST")||At().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];At().getBool("IS_TEST")||At().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(kt(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)}))}}function Nt(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")))),t}function At(){return Rt}let $t,Rt=null;function Ft(){if(null==$t){let e;if("undefined"!=typeof window)e=window;else if(void 0!==ve)e=ve;else if(void 0!==je)e=je;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}$t=e}return $t}function Ot(e,t){const n=function(){const e=Ft();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}function Dt(...e){At().getBool("IS_TEST")||At().getBool("PROD")||console.warn(...e)}const Mt=Ot("kernelRegistry",(()=>new Map)),Lt=Ot("gradRegistry",(()=>new Map));function Pt(e,t){const n=Vt(e,t);return Mt.get(n)}function Bt(e){return Lt.get(e)}function Ut(e){const t=Mt.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[s,o]=a,[i]=s.split("_");i===e&&n.push(o)}return n}function zt(e){const{kernelName:t,backendName:n}=e,r=Vt(t,n);Mt.has(r)&&Dt(`The kernel '${t}' for backend '${n}' is already registered`),Mt.set(r,e)}function Vt(e,t){return`${t}_${e}`}var Wt=Gt,jt=null;try{jt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Qn){}function Gt(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function Ht(e){return!0===(e&&e.__isLong__)}Gt.prototype.__isLong__,Object.defineProperty(Gt.prototype,"__isLong__",{value:!0}),Gt.isLong=Ht;var Kt={},qt={};function Xt(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=qt[e])?r:(n=Qt(e,(0|e)<0?-1:0,!0),a&&(qt[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=Kt[e])?r:(n=Qt(e,e<0?-1:0,!1),a&&(Kt[e]=n),n)}function Yt(e,t){if(isNaN(e))return t?on:sn;if(t){if(e<0)return on;if(e>=nn)return pn}else{if(e<=-rn)return fn;if(e+1>=rn)return hn}return e<0?Yt(-e,t).neg():Qt(e%tn|0,e/tn|0,t)}function Qt(e,t,n){return new Gt(e,t,n)}Gt.fromInt=Xt,Gt.fromNumber=Yt,Gt.fromBits=Qt;var Jt=Math.pow;function Zt(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return sn;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Zt(e.substring(1),t,n).neg();for(var a=Yt(Jt(n,8)),s=sn,o=0;o<e.length;o+=8){var i=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+i),n);if(i<8){var l=Yt(Jt(n,i));s=s.mul(l).add(Yt(u))}else s=(s=s.mul(a)).add(Yt(u))}return s.unsigned=t,s}function en(e,t){return"number"==typeof e?Yt(e,t):"string"==typeof e?Zt(e,t):Qt(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Gt.fromString=Zt,Gt.fromValue=en;var tn=4294967296,nn=tn*tn,rn=nn/2,an=Xt(1<<24),sn=Xt(0);Gt.ZERO=sn;var on=Xt(0,!0);Gt.UZERO=on;var un=Xt(1);Gt.ONE=un;var ln=Xt(1,!0);Gt.UONE=ln;var cn=Xt(-1);Gt.NEG_ONE=cn;var hn=Qt(-1,2147483647,!1);Gt.MAX_VALUE=hn;var pn=Qt(-1,-1,!0);Gt.MAX_UNSIGNED_VALUE=pn;var fn=Qt(0,-2147483648,!1);Gt.MIN_VALUE=fn;var dn=Gt.prototype;dn.toInt=function(){return this.unsigned?this.low>>>0:this.low},dn.toNumber=function(){return this.unsigned?(this.high>>>0)*tn+(this.low>>>0):this.high*tn+(this.low>>>0)},dn.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(fn)){var t=Yt(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=Yt(Jt(e,6),this.unsigned),s=this,o="";;){var i=s.div(a),u=(s.sub(i.mul(a)).toInt()>>>0).toString(e);if((s=i).isZero())return u+o;for(;u.length<6;)u="0"+u;o=""+u+o}},dn.getHighBits=function(){return this.high},dn.getHighBitsUnsigned=function(){return this.high>>>0},dn.getLowBits=function(){return this.low},dn.getLowBitsUnsigned=function(){return this.low>>>0},dn.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fn)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},dn.isZero=function(){return 0===this.high&&0===this.low},dn.eqz=dn.isZero,dn.isNegative=function(){return!this.unsigned&&this.high<0},dn.isPositive=function(){return this.unsigned||this.high>=0},dn.isOdd=function(){return 1==(1&this.low)},dn.isEven=function(){return 0==(1&this.low)},dn.equals=function(e){return Ht(e)||(e=en(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},dn.eq=dn.equals,dn.notEquals=function(e){return!this.eq(e)},dn.neq=dn.notEquals,dn.ne=dn.notEquals,dn.lessThan=function(e){return this.comp(e)<0},dn.lt=dn.lessThan,dn.lessThanOrEqual=function(e){return this.comp(e)<=0},dn.lte=dn.lessThanOrEqual,dn.le=dn.lessThanOrEqual,dn.greaterThan=function(e){return this.comp(e)>0},dn.gt=dn.greaterThan,dn.greaterThanOrEqual=function(e){return this.comp(e)>=0},dn.gte=dn.greaterThanOrEqual,dn.ge=dn.greaterThanOrEqual,dn.compare=function(e){if(Ht(e)||(e=en(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},dn.comp=dn.compare,dn.negate=function(){return!this.unsigned&&this.eq(fn)?fn:this.not().add(un)},dn.neg=dn.negate,dn.add=function(e){Ht(e)||(e=en(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,s=e.high>>>16,o=65535&e.high,i=e.low>>>16,u=0,l=0,c=0,h=0;return c+=(h+=a+(65535&e.low))>>>16,l+=(c+=r+i)>>>16,u+=(l+=n+o)>>>16,u+=t+s,Qt((c&=65535)<<16|(h&=65535),(u&=65535)<<16|(l&=65535),this.unsigned)},dn.subtract=function(e){return Ht(e)||(e=en(e)),this.add(e.neg())},dn.sub=dn.subtract,dn.multiply=function(e){if(this.isZero())return sn;if(Ht(e)||(e=en(e)),jt)return Qt(jt.mul(this.low,this.high,e.low,e.high),jt.get_high(),this.unsigned);if(e.isZero())return sn;if(this.eq(fn))return e.isOdd()?fn:sn;if(e.eq(fn))return this.isOdd()?fn:sn;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(an)&&e.lt(an))return Yt(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,s=e.high>>>16,o=65535&e.high,i=e.low>>>16,u=65535&e.low,l=0,c=0,h=0,p=0;return h+=(p+=a*u)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=a*i)>>>16,l+=(c+=n*u)>>>16,c&=65535,l+=(c+=r*i)>>>16,c&=65535,l+=(c+=a*o)>>>16,l+=t*u+n*i+r*o+a*s,Qt((h&=65535)<<16|(p&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},dn.mul=dn.multiply,dn.divide=function(e){if(Ht(e)||(e=en(e)),e.isZero())throw Error("division by zero");var t,n,r;if(jt)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Qt((this.unsigned?jt.div_u:jt.div_s)(this.low,this.high,e.low,e.high),jt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?on:sn;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return on;if(e.gt(this.shru(1)))return ln;r=on}else{if(this.eq(fn))return e.eq(un)||e.eq(cn)?fn:e.eq(fn)?un:(t=this.shr(1).div(e).shl(1)).eq(sn)?e.isNegative()?un:cn:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(fn))return this.unsigned?on:sn;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=sn}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),s=a<=48?1:Jt(2,a-48),o=Yt(t),i=o.mul(e);i.isNegative()||i.gt(n);)i=(o=Yt(t-=s,this.unsigned)).mul(e);o.isZero()&&(o=un),r=r.add(o),n=n.sub(i)}return r},dn.div=dn.divide,dn.modulo=function(e){return Ht(e)||(e=en(e)),jt?Qt((this.unsigned?jt.rem_u:jt.rem_s)(this.low,this.high,e.low,e.high),jt.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},dn.mod=dn.modulo,dn.rem=dn.modulo,dn.not=function(){return Qt(~this.low,~this.high,this.unsigned)},dn.and=function(e){return Ht(e)||(e=en(e)),Qt(this.low&e.low,this.high&e.high,this.unsigned)},dn.or=function(e){return Ht(e)||(e=en(e)),Qt(this.low|e.low,this.high|e.high,this.unsigned)},dn.xor=function(e){return Ht(e)||(e=en(e)),Qt(this.low^e.low,this.high^e.high,this.unsigned)},dn.shiftLeft=function(e){return Ht(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Qt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Qt(0,this.low<<e-32,this.unsigned)},dn.shl=dn.shiftLeft,dn.shiftRight=function(e){return Ht(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Qt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Qt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},dn.shr=dn.shiftRight,dn.shiftRightUnsigned=function(e){if(Ht(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?Qt(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Qt(32===e?t:t>>>e-32,0,this.unsigned)},dn.shru=dn.shiftRightUnsigned,dn.shr_u=dn.shiftRightUnsigned,dn.toSigned=function(){return this.unsigned?Qt(this.low,this.high,!1):this},dn.toUnsigned=function(){return this.unsigned?this:Qt(this.low,this.high,!0)},dn.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},dn.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},dn.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Gt.fromBytes=function(e,t,n){return n?Gt.fromBytesLE(e,t):Gt.fromBytesBE(e,t)},Gt.fromBytesLE=function(e,t){return new Gt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Gt.fromBytesBE=function(e,t){return new Gt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const mn=Wt||function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:Wt},[Wt]);function gn(e){return mn.fromString(e,!0,16)}const yn=gn("c3a5c85c97cb3127"),bn=gn("b492b66fbe98f273"),vn=gn("9ae16a3b2f90404f");function xn(e){return e.xor(e.shru(47))}function _n(e,t,n){const r=e.slice(t,t+n);return mn.fromBytes(Array.from(r),!0,!0)}function wn(e,t){return _n(e,t,8)}function Tn(e,t){return _n(e,t,4)}function En(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Sn(e,t,n=gn("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function In(e,t,n,r){return function(e,t,n,r,a,s){a=a.add(e),s=En(s.add(a).add(r),21);const o=a;return a=(a=a.add(t)).add(n),s=s.add(En(a,44)),[a.add(r),s.add(o)]}(wn(e,t),wn(e,t+8),wn(e,t+16),wn(e,t+24),n,r)}function kn(e,t=e.length){const n=mn.fromNumber(81,!0);if(t<=32)return t<=16?function(e,t=e.length){if(t>=8){const n=vn.add(2*t),r=wn(e,0).add(vn),a=wn(e,t-8);return Sn(En(a,37).mul(n).add(r),En(r,25).add(a).mul(n),n)}if(t>=4){const n=vn.add(2*t);return Sn(Tn(e,0).shl(3).add(t),Tn(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return xn(vn.mul(n).xor(yn.mul(r))).mul(vn)}return vn}(e,t):function(e,t=e.length){const n=vn.add(2*t),r=wn(e,0).mul(bn),a=wn(e,8),s=wn(e,t-8).mul(n),o=wn(e,t-16).mul(vn);return Sn(En(r.add(a),43).add(En(s,30)).add(o),r.add(En(a.add(vn),18)).add(s),n)}(e,t);if(t<=64)return function(e,t=e.length){const n=vn.add(2*t),r=wn(e,0).mul(vn),a=wn(e,8),s=wn(e,t-8).mul(n),o=wn(e,t-16).mul(vn),i=En(r.add(a),43).add(En(s,30)).add(o),u=Sn(i,r.add(En(a.add(vn),18)).add(s),n),l=wn(e,16).mul(n),c=wn(e,24),h=i.add(wn(e,t-32)).mul(n),p=u.add(wn(e,t-24)).mul(n);return Sn(En(l.add(c),43).add(En(h,30)).add(p),l.add(En(c.add(r),18)).add(h),n)}(e,t);let r=n,a=n.mul(bn).add(113),s=xn(a.mul(vn).add(113)).mul(vn),o=[mn.UZERO,mn.UZERO],i=[mn.UZERO,mn.UZERO];r=r.mul(vn).add(wn(e,0));let u=0;const l=64*(t-1>>6),c=l+(t-1&63)-63;do{r=En(r.add(a).add(o[0]).add(wn(e,u+8)),37).mul(bn),a=En(a.add(o[1]).add(wn(e,u+48)),42).mul(bn),r=r.xor(i[1]),a=a.add(o[0]).add(wn(e,u+40)),s=En(s.add(i[0]),33).mul(bn),o=In(e,u,o[1].mul(bn),r.add(i[0])),i=In(e,u+32,s.add(i[1]),a.add(wn(e,u+16))),[s,r]=[r,s],u+=64}while(u!==l);const h=bn.add(s.and(255).shl(1));return u=c,i[0]=i[0].add(t-1&63),o[0]=o[0].add(i[0]),i[0]=i[0].add(o[0]),r=En(r.add(a).add(o[0]).add(wn(e,u+8)),37).mul(h),a=En(a.add(o[1]).add(wn(e,u+48)),42).mul(h),r=r.xor(i[1].mul(9)),a=a.add(o[0].mul(9).add(wn(e,u+40))),s=En(s.add(i[0]),33).mul(h),o=In(e,u,o[1].mul(h),r.add(i[0])),i=In(e,u+32,s.add(i[1]),a.add(wn(e,u+16))),[s,r]=[r,s],Sn(Sn(o[0],i[0],h).add(xn(a).mul(yn)).add(s),Sn(o[1],i[1],h).add(r),h)}function Cn(e,t){return"string"===t?$n(e):Nn([e],t)}function Nn(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=et(e)),At().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function An(){return At().platform.now()}function $n(e,t="utf-8"){return t=t||"utf-8",At().platform.encode(e,t)}function Rn(e,t="utf-8"){return t=t||"utf-8",At().platform.decode(e,t)}class Fn{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Dn)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let s;const o=An();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();s=Promise.resolve({kernelMs:An()-o})}if(At().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let t=0;t<r.length;t++){const n=r[t];n.data().then((t=>{On(t,n.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then((e=>e.kernelMs)),extraInfo:s.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:s}=e;n.forEach((e=>{Promise.all([e.data(),r,s]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])}))}))}}function On(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Dn{logKernelProfile(e,t,n,r,a,s){const o="number"==typeof r?st(`${r}ms`,9):r.error,i=st(e,25),u=t.rank,l=t.size,c=st(t.shape.toString(),14);let h="";for(const e in a){const n=a[e];if(null!=n){const r=n.shape||t.shape,a=r.length;h+=`${e}: ${a}D ${a>0?r:""} `}}console.log(`%c${i}\t%c${o}\t%c${u}D ${c}\t%c${l}\t%c${h}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function Mn(e,t,n,r){const a=vt(t),s=function(e,t,n,r){const a=tt(t),s=r[r.length-1],o=new Array(s).fill(0),i=t.length,u="complex64"===n?Un(e):e;if(i>1)for(let e=0;e<a/s;e++){const t=e*s;for(let e=0;e<s;e++)o[e]=Math.max(o[e],Ln(u[t+e],0,n).length)}return o}(e,t,n,a),o=t.length,i=Bn(e,t,n,a,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(i.map((e=>"    "+e)).join("\n")),u.join("\n")}function Ln(e,t,n){let r;return r=Array.isArray(e)?`${parseFloat(e[0].toFixed(7))} + ${parseFloat(e[1].toFixed(7))}j`:mt(e)?`'${e}'`:"bool"===n?Pn(e):parseFloat(e.toFixed(7)).toString(),st(r,t)}function Pn(e){return 0===e?"false":"true"}function Bn(e,t,n,r,a,s=!0){const o="complex64"===n?2:1,i=t[0],u=t.length;if(0===u)return"complex64"===n?[Ln(Un(e)[0],0,n)]:"bool"===n?[Pn(e[0])]:[e[0].toString()];if(1===u){if(i>20){const t=3*o;let r=Array.from(e.slice(0,t)),s=Array.from(e.slice((i-3)*o,i*o));return"complex64"===n&&(r=Un(r),s=Un(s)),["["+r.map(((e,t)=>Ln(e,a[t],n))).join(", ")+", ..., "+s.map(((e,t)=>Ln(e,a[i-3+t],n))).join(", ")+"]"]}return["["+("complex64"===n?Un(e):Array.from(e)).map(((e,t)=>Ln(e,a[t],n))).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),h=r[0]*o,p=[];if(i>20){for(let t=0;t<3;t++){const r=t*h,s=r+h;p.push(...Bn(e.slice(r,s),l,n,c,a,!1))}p.push("...");for(let t=i-3;t<i;t++){const r=t*h,s=r+h;p.push(...Bn(e.slice(r,s),l,n,c,a,t===i-1))}}else for(let t=0;t<i;t++){const r=t*h,s=r+h;p.push(...Bn(e.slice(r,s),l,n,c,a,t===i-1))}const f=2===u?",":"";p[0]="["+p[0]+f;for(let e=1;e<p.length-1;e++)p[e]=" "+p[e]+f;let d=",\n";for(let e=2;e<u;e++)d+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(s?"":d),p}function Un(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class zn{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=tt(e),null!=n){const e=n.length;Qe(e===this.size,(()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ht(t,this.size),this.strides=vt(e)}set(e,...t){0===t.length&&(t=[0]),Qe(t.length===this.rank,(()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`));const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const n of e){if(n<0||n>=this.shape[t]){const t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let t=0;t<e.length-1;++t)n+=this.strides[t]*e[t];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Vn().makeTensor(this.values,this.shape,this.dtype)}}let Vn=null,Wn=null;class jn{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=tt(e),this.strides=vt(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Wn.buffer(this.shape,this.dtype,e)}bufferSync(){return Wn.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return _t(this.shape,e,"complex64"===this.dtype)}arraySync(){return _t(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=Vn().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>Rn(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Vn().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Vn().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>Rn(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Vn().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Vn().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Wn.print(this,e)}clone(){return this.throwIfDisposed(),Wn.clone(this)}toString(e=!1){return Mn(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Wn.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Vn().makeVariable(this,e,t,n)}}Object.defineProperty(jn,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),Ot("Tensor",(()=>jn));class Gn extends jn{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!nt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Vn().disposeTensor(this),this.dataId=e.dataId,Vn().incRef(this,null)}dispose(){Vn().disposeVariable(this),this.isDisposedInternal=!0}}var Hn,Kn,qn,Xn,Yn,Qn;Object.defineProperty(Gn,Symbol.hasInstance,{value:e=>e instanceof jn&&null!=e.assign&&e.assign instanceof Function}),(Qn=Hn||(Hn={})).R0="R0",Qn.R1="R1",Qn.R2="R2",Qn.R3="R3",Qn.R4="R4",Qn.R5="R5",Qn.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Kn||(Kn={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(qn||(qn={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Xn||(Xn={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Yn||(Yn={}));const Jn={float32:Xn,int32:Kn,bool:qn,complex64:Yn};function Zn(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return Jn[e][t]}function er(e,t){if(e.dtype===t.dtype)return[e,t];const n=Zn(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function tr(e){const t=[];return nr(e,t,new Set),t}function nr(e,t,n){if(null==e)return;if(e instanceof jn)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!=typeof r)return;var r;const a=e;for(const e in a){const r=a[e];n.has(r)||(n.add(r),nr(r,t,n))}}function rr(e){return null!=e.kernelName}class ar{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class sr{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ar}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Dt(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Fn(this.backendInstance),!0}setupRegisteredKernels(){Ut(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){Ut(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof He||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0)))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,Dt(`Initialization of backend ${e} failed`),Dt(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return Dt(`Initialization of backend ${e} failed`),Dt(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),s=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return sr.nextTensorId++}nextVariableId(){return sr.nextVariableId++}clone(e){const t=ir.runKernel("Identity",{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e};return ir.runKernel("Cast",t,{dtype:"float32"})}})),[],{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,null==Pt(e,this.backendName))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach((e=>{a+="complex64"===e.dtype?3:1}));const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-s;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,s=this.state.numTensors;let o,i;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const u=rr(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(rr(e)){const{kernelName:t,inputs:a,attrs:s}=e;null==this.backendName&&this.backend;const u=Pt(t,this.backendName);Qe(null!=u,(()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`)),o=()=>{const e=this.backend.numDataIds();i=u.kernelFunc({inputs:a,attrs:s,backend:this.backend});const o=Array.isArray(i)?i:[i];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,o);const l=o.map((e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e)));if(r){const e=this.getTensorsForGradient(t,a,l);n=this.saveTensorsForBackwardMode(e)}return l}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map((e=>this.keep(this.clone(e)))))};o=()=>{const e=this.backend.numDataIds();i=this.tidy((()=>t(this.backend,a)));const n=Array.isArray(i)?i:[i];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,e,n),n}}const{inputs:l,attrs:c}=e,h=rr(e)?null:e.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(u,l,(()=>o())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs):t=o()})),r&&this.addTapeNode(u,l,t,h,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map((e=>null!=l[e]?l[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(i)?t:t[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const r=Bt(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let s;r.saveAllInputs?(Qe(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),s=Object.keys(t).map((e=>t[e]))):s=e.map((e=>t[e]));const o=n.filter(((e,t)=>a[t]));return s.concat(o)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&mt(e[0])&&(a=e.map((e=>$n(e))));const s=r.write(a,t,n),o=new jn(t,n,s,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){const e=this.state.tensorInfo.get(s),t=function(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return o}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,s=new jn(r,a,n,this.nextTensorId());return this.trackTensor(s,t),s}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new Gn(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*dt(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Gn||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*dt(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const e of this.state.activeProfile.kernels)e.kernelTimeMs=await e.kernelTimeMs,e.extraInfo=await e.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,s){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},i=Bt(e);null!=i&&(r=i.gradFunc),null!=r&&(o.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=Tt(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],a,s))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=tr(e),n=new Set(t.map((e=>e.id)));for(let e=0;e<this.state.activeScope.track.length;e++){const t=this.state.activeScope.track[e];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n,r=!1){if(Qe(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const a=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));Qe(a instanceof jn,(()=>"The result y returned by f() must be a tensor."));const s=function(e,t,n){const r={},a={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){const s=e[n],o=s.inputs;for(const e in o){const n=o[e];let i=!1;for(let e=0;e<t.length;e++)if(r[n.id]){s.outputs.forEach((e=>r[e.id]=!0)),i=!0,a[s.id]=!0;break}if(i)break}}const s={};s[n.id]=!0;const o={};for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(s[n.outputs[e].id]){for(const e in r)s[r[e].id]=!0,o[n.id]=!0;break}}const i=[];for(let t=0;t<e.length;t++){const n=e[t];if(a[n.id]&&o[n.id]){const e={};for(const t in n.inputs){const a=n.inputs[t];r[a.id]&&(e[t]=a)}const t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,i.push(t)}}return i}(this.state.activeTape,t,a);if(!r&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[a.id]=null==n?function(e){const t=wt(tt(e),"float32");return ir.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const s=t[a],o=[];if(s.outputs.forEach((t=>{const n=e[t.id];null!=n?o.push(n):o.push(null)})),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const i=s.gradient(o);for(const t in s.inputs){if(!(t in i))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(i)}.`);const a=n((()=>i[t]()));if("float32"!==a.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${a.dtype}'`);const o=s.inputs[t];if(!nt(a.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${t}' has shape '${a.shape}', which does not match the shape of the input '${o.shape}'`);if(null==e[o.id])e[o.id]=a;else{const t=e[o.id];e[o.id]=r(t,a),t.dispose()}}}}(e,s,(e=>this.tidy(e)),ur);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:a,grads:r}}))}customGrad(e){return Qe(yt(e),(()=>"The f passed in customGrad(f) must be a function.")),(...t)=>{let n;Qe(t.every((e=>e instanceof jn)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};return t.forEach(((e,t)=>{r[t]=e})),this.runKernelFunc({forwardFunc:(r,a)=>(n=e(...t,a),Qe(n.value instanceof jn,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),Qe(yt(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(e,r)=>{const a=n.gradFunc(e,r),s=Array.isArray(a)?a:[a];Qe(s.length===t.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),Qe(s.every((e=>e instanceof jn)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return s.forEach(((e,t)=>{o[t]=()=>e})),o},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=An(),n=await this.backend.time(e);return n.wallMs=An()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ar;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function or(){const e=Ft();if(null==e._tfengine){const t=new Ct(e);e._tfengine=new sr(t)}var t;return t=e._tfengine.ENV,Rt=t,Vn=()=>e._tfengine,e._tfengine}sr.nextTensorId=0,sr.nextVariableId=0;const ir=or();function ur(e,t){const n={a:e,b:t};return ir.runKernel("Add",n)}function lr(e){if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function cr(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const hr=At();hr.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),hr.registerFlag("IS_BROWSER",(()=>cr())),hr.registerFlag("IS_NODE",(()=>void 0!==je&&void 0!==je.versions&&void 0!==je.versions.node)),hr.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),hr.registerFlag("PROD",(()=>!1)),hr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>hr.getBool("DEBUG"))),hr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),hr.registerFlag("IS_TEST",(()=>!1)),hr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),hr.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),hr.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var pr=[],fr=[],dr="undefined"!=typeof Uint8Array?Uint8Array:Array,mr=!1;function gr(){mr=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)pr[t]=e[t],fr[e.charCodeAt(t)]=t;fr["-".charCodeAt(0)]=62,fr["_".charCodeAt(0)]=63}function yr(e,t,n){for(var r,a,s=[],o=t;o<n;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],s.push(pr[(a=r)>>18&63]+pr[a>>12&63]+pr[a>>6&63]+pr[63&a]);return s.join("")}function br(e){var t;mr||gr();for(var n=e.length,r=n%3,a="",s=[],o=16383,i=0,u=n-r;i<u;i+=o)s.push(yr(e,i,i+o>u?u:i+o));return 1===r?(t=e[n-1],a+=pr[t>>2],a+=pr[t<<4&63],a+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],a+=pr[t>>10],a+=pr[t>>4&63],a+=pr[t<<2&63],a+="="),s.push(a),s.join("")}function vr(e,t,n,r,a){var s,o,i=8*a-r-1,u=(1<<i)-1,l=u>>1,c=-7,h=n?a-1:0,p=n?-1:1,f=e[t+h];for(h+=p,s=f&(1<<-c)-1,f>>=-c,c+=i;c>0;s=256*s+e[t+h],h+=p,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=p,c-=8);if(0===s)s=1-l;else{if(s===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=l}return(f?-1:1)*o*Math.pow(2,s-r)}function xr(e,t,n,r,a,s){var o,i,u,l=8*s-a-1,c=(1<<l)-1,h=c>>1,p=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(i=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(i=0,o=c):o+h>=1?(i=(t*u-1)*Math.pow(2,a),o+=h):(i=t*Math.pow(2,h-1)*Math.pow(2,a),o=0));a>=8;e[n+f]=255&i,f+=d,i/=256,a-=8);for(o=o<<a|i,l+=a;l>0;e[n+f]=255&o,f+=d,o/=256,l-=8);e[n+f-d]|=128*m}var _r={}.toString,wr=Array.isArray||function(e){return"[object Array]"==_r.call(e)};function Tr(){return Sr.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Er(e,t){if(Tr()<t)throw new RangeError("Invalid typed array length");return Sr.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Sr.prototype:(null===e&&(e=new Sr(t)),e.length=t),e}function Sr(e,t,n){if(!(Sr.TYPED_ARRAY_SUPPORT||this instanceof Sr))return new Sr(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Cr(this,e)}return Ir(this,e,t,n)}function Ir(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),Sr.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Sr.prototype:e=Nr(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Sr.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|Rr(t,n),a=(e=Er(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if($r(t)){var n=0|Ar(t.length);return 0===(e=Er(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?Er(e,0):Nr(e,t);if("Buffer"===t.type&&wr(t.data))return Nr(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function kr(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Cr(e,t){if(kr(t),e=Er(e,t<0?0:0|Ar(t)),!Sr.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Nr(e,t){var n=t.length<0?0:0|Ar(t.length);e=Er(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function Ar(e){if(e>=Tr())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Tr().toString(16)+" bytes");return 0|e}function $r(e){return!(null==e||!e._isBuffer)}function Rr(e,t){if($r(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return aa(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return sa(e).length;default:if(r)return aa(e).length;t=(""+t).toLowerCase(),r=!0}}function Fr(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Kr(this,t,n);case"utf8":case"utf-8":return jr(this,t,n);case"ascii":return Gr(this,t,n);case"latin1":case"binary":return Hr(this,t,n);case"base64":return Wr(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return qr(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function Or(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Dr(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Sr.from(t,r)),$r(t))return 0===t.length?-1:Mr(e,t,n,r,a);if("number"==typeof t)return t&=255,Sr.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Mr(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function Mr(e,t,n,r,a){var s,o=1,i=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,i/=2,u/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var c=-1;for(s=n;s<i;s++)if(l(e,s)===l(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===u)return c*o}else-1!==c&&(s-=s-c),c=-1}else for(n+u>i&&(n=i-u),s=n;s>=0;s--){for(var h=!0,p=0;p<u;p++)if(l(e,s+p)!==l(t,p)){h=!1;break}if(h)return s}return-1}function Lr(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var i=parseInt(t.substr(2*o,2),16);if(isNaN(i))return o;e[n+o]=i}return o}function Pr(e,t,n,r){return oa(aa(t,e.length-n),e,n,r)}function Br(e,t,n,r){return oa(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function Ur(e,t,n,r){return Br(e,t,n,r)}function zr(e,t,n,r){return oa(sa(t),e,n,r)}function Vr(e,t,n,r){return oa(function(e,t){for(var n,r,a,s=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a=n%256,s.push(a),s.push(r);return s}(t,e.length-n),e,n,r)}function Wr(e,t,n){return 0===t&&n===e.length?br(e):br(e.slice(t,n))}function jr(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var s,o,i,u,l=e[a],c=null,h=l>239?4:l>223?3:l>191?2:1;if(a+h<=n)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(s=e[a+1]))&&(u=(31&l)<<6|63&s)>127&&(c=u);break;case 3:s=e[a+1],o=e[a+2],128==(192&s)&&128==(192&o)&&(u=(15&l)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:s=e[a+1],o=e[a+2],i=e[a+3],128==(192&s)&&128==(192&o)&&128==(192&i)&&(u=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&i)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),a+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function Gr(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function Hr(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function Kr(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",s=t;s<n;++s)a+=ra(e[s]);return a}function qr(e,t,n){for(var r=e.slice(t,n),a="",s=0;s<r.length;s+=2)a+=String.fromCharCode(r[s]+256*r[s+1]);return a}function Xr(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Yr(e,t,n,r,a,s){if(!$r(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Qr(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,s=Math.min(e.length-n,2);a<s;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function Jr(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,s=Math.min(e.length-n,4);a<s;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function Zr(e,t,n,r,a,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function ea(e,t,n,r,a){return a||Zr(e,0,n,4),xr(e,t,n,r,23,4),n+4}function ta(e,t,n,r,a){return a||Zr(e,0,n,8),xr(e,t,n,r,52,8),n+8}Sr.TYPED_ARRAY_SUPPORT=void 0===ve.TYPED_ARRAY_SUPPORT||ve.TYPED_ARRAY_SUPPORT,Tr(),Sr.poolSize=8192,Sr._augment=function(e){return e.__proto__=Sr.prototype,e},Sr.from=function(e,t,n){return Ir(null,e,t,n)},Sr.TYPED_ARRAY_SUPPORT&&(Sr.prototype.__proto__=Uint8Array.prototype,Sr.__proto__=Uint8Array),Sr.alloc=function(e,t,n){return function(e,t,n,r){return kr(t),t<=0?Er(e,t):void 0!==n?"string"==typeof r?Er(e,t).fill(n,r):Er(e,t).fill(n):Er(e,t)}(null,e,t,n)},Sr.allocUnsafe=function(e){return Cr(null,e)},Sr.allocUnsafeSlow=function(e){return Cr(null,e)},Sr.isBuffer=function(e){return null!=e&&(!!e._isBuffer||ia(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ia(e.slice(0,0))}(e))},Sr.compare=function(e,t){if(!$r(e)||!$r(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,s=Math.min(n,r);a<s;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},Sr.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Sr.concat=function(e,t){if(!wr(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Sr.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Sr.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var s=e[n];if(!$r(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,a),a+=s.length}return r},Sr.byteLength=Rr,Sr.prototype._isBuffer=!0,Sr.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Or(this,t,t+1);return this},Sr.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Or(this,t,t+3),Or(this,t+1,t+2);return this},Sr.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Or(this,t,t+7),Or(this,t+1,t+6),Or(this,t+2,t+5),Or(this,t+3,t+4);return this},Sr.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?jr(this,0,e):Fr.apply(this,arguments)},Sr.prototype.equals=function(e){if(!$r(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Sr.compare(this,e)},Sr.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Sr.prototype.compare=function(e,t,n,r,a){if(!$r(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),i=Math.min(s,o),u=this.slice(r,a),l=e.slice(t,n),c=0;c<i;++c)if(u[c]!==l[c]){s=u[c],o=l[c];break}return s<o?-1:o<s?1:0},Sr.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Sr.prototype.indexOf=function(e,t,n){return Dr(this,e,t,n,!0)},Sr.prototype.lastIndexOf=function(e,t,n){return Dr(this,e,t,n,!1)},Sr.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return Lr(this,e,t,n);case"utf8":case"utf-8":return Pr(this,e,t,n);case"ascii":return Br(this,e,t,n);case"latin1":case"binary":return Ur(this,e,t,n);case"base64":return zr(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Vr(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},Sr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Sr.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Sr.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Sr.prototype;else{var a=t-e;n=new Sr(a,void 0);for(var s=0;s<a;++s)n[s]=this[s+e]}return n},Sr.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Xr(e,t,this.length);for(var r=this[e],a=1,s=0;++s<t&&(a*=256);)r+=this[e+s]*a;return r},Sr.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Xr(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},Sr.prototype.readUInt8=function(e,t){return t||Xr(e,1,this.length),this[e]},Sr.prototype.readUInt16LE=function(e,t){return t||Xr(e,2,this.length),this[e]|this[e+1]<<8},Sr.prototype.readUInt16BE=function(e,t){return t||Xr(e,2,this.length),this[e]<<8|this[e+1]},Sr.prototype.readUInt32LE=function(e,t){return t||Xr(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Sr.prototype.readUInt32BE=function(e,t){return t||Xr(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Sr.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Xr(e,t,this.length);for(var r=this[e],a=1,s=0;++s<t&&(a*=256);)r+=this[e+s]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},Sr.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Xr(e,t,this.length);for(var r=t,a=1,s=this[e+--r];r>0&&(a*=256);)s+=this[e+--r]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*t)),s},Sr.prototype.readInt8=function(e,t){return t||Xr(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Sr.prototype.readInt16LE=function(e,t){t||Xr(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Sr.prototype.readInt16BE=function(e,t){t||Xr(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Sr.prototype.readInt32LE=function(e,t){return t||Xr(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Sr.prototype.readInt32BE=function(e,t){return t||Xr(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Sr.prototype.readFloatLE=function(e,t){return t||Xr(e,4,this.length),vr(this,e,!0,23,4)},Sr.prototype.readFloatBE=function(e,t){return t||Xr(e,4,this.length),vr(this,e,!1,23,4)},Sr.prototype.readDoubleLE=function(e,t){return t||Xr(e,8,this.length),vr(this,e,!0,52,8)},Sr.prototype.readDoubleBE=function(e,t){return t||Xr(e,8,this.length),vr(this,e,!1,52,8)},Sr.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Yr(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,s=0;for(this[t]=255&e;++s<n&&(a*=256);)this[t+s]=e/a&255;return t+n},Sr.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Yr(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,s=1;for(this[t+a]=255&e;--a>=0&&(s*=256);)this[t+a]=e/s&255;return t+n},Sr.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,1,255,0),Sr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Sr.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,2,65535,0),Sr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Qr(this,e,t,!0),t+2},Sr.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,2,65535,0),Sr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Qr(this,e,t,!1),t+2},Sr.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,4,4294967295,0),Sr.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Jr(this,e,t,!0),t+4},Sr.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,4,4294967295,0),Sr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Jr(this,e,t,!1),t+4},Sr.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Yr(this,e,t,n,a-1,-a)}var s=0,o=1,i=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===i&&0!==this[t+s-1]&&(i=1),this[t+s]=(e/o>>0)-i&255;return t+n},Sr.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Yr(this,e,t,n,a-1,-a)}var s=n-1,o=1,i=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===i&&0!==this[t+s+1]&&(i=1),this[t+s]=(e/o>>0)-i&255;return t+n},Sr.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,1,127,-128),Sr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Sr.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,2,32767,-32768),Sr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Qr(this,e,t,!0),t+2},Sr.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,2,32767,-32768),Sr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Qr(this,e,t,!1),t+2},Sr.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,4,2147483647,-2147483648),Sr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Jr(this,e,t,!0),t+4},Sr.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Yr(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Sr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Jr(this,e,t,!1),t+4},Sr.prototype.writeFloatLE=function(e,t,n){return ea(this,e,t,!0,n)},Sr.prototype.writeFloatBE=function(e,t,n){return ea(this,e,t,!1,n)},Sr.prototype.writeDoubleLE=function(e,t,n){return ta(this,e,t,!0,n)},Sr.prototype.writeDoubleBE=function(e,t,n){return ta(this,e,t,!1,n)},Sr.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,s=r-n;if(this===e&&n<t&&t<r)for(a=s-1;a>=0;--a)e[a+t]=this[a+n];else if(s<1e3||!Sr.TYPED_ARRAY_SUPPORT)for(a=0;a<s;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},Sr.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Sr.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=$r(e)?e:aa(new Sr(e,r).toString()),i=o.length;for(s=0;s<n-t;++s)this[s+t]=o[s%i]}return this};var na=/[^+\/0-9A-Za-z-_]/g;function ra(e){return e<16?"0"+e.toString(16):e.toString(16)}function aa(e,t){var n;t=t||1/0;for(var r=e.length,a=null,s=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&s.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function sa(e){return function(e){var t,n,r,a,s,o;mr||gr();var i=e.length;if(i%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[i-2]?2:"="===e[i-1]?1:0,o=new dr(3*i/4-s),r=s>0?i-4:i;var u=0;for(t=0,n=0;t<r;t+=4,n+=3)a=fr[e.charCodeAt(t)]<<18|fr[e.charCodeAt(t+1)]<<12|fr[e.charCodeAt(t+2)]<<6|fr[e.charCodeAt(t+3)],o[u++]=a>>16&255,o[u++]=a>>8&255,o[u++]=255&a;return 2===s?(a=fr[e.charCodeAt(t)]<<2|fr[e.charCodeAt(t+1)]>>4,o[u++]=255&a):1===s&&(a=fr[e.charCodeAt(t)]<<10|fr[e.charCodeAt(t+1)]<<4|fr[e.charCodeAt(t+2)]>>2,o[u++]=a>>8&255,o[u++]=255&a),o}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(na,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function oa(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function ia(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ua(e,t){let n=e;if(ft(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||ft(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&At().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&la(e,r,[]),r}function la(e,t,n){if(n=n||[],!Array.isArray(e)&&!ft(e))return void Qe(0===t.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`));Qe(t.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`)),Qe(e.length===t[0],(()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`));const r=t.slice(1);for(let t=0;t<e.length;++t)la(e[t],r,n.concat(t))}function ca(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function ha(e,t,n,r="numeric"){if(e instanceof jn)return ca(r,e.dtype,t,n),e;let a=gt(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),ca(r,a,t,n),null==e||!ft(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=ua(e,a);ft(e)||Array.isArray(e)||(e=[e]);const o="string"!==a?Nn(e,a):et(e,[],!0);return ir.makeTensor(o,s,a)}function pa(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map(((e,a)=>ha(e,`${t}[${a}]`,n,r)))}function fa(e){const t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const a=(...e)=>{ir.startScope(n);try{const t=r(...e);return kt(t)&&console.error("Cannot return a Promise inside of tidy."),ir.endScope(t),t}catch(e){throw ir.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const da=fa({complex_:function(e,t){const n=ha(e,"real","complex"),r=ha(t,"imag","complex");Je(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const a={real:n,imag:r};return ir.runKernel("Complex",a)}});function ma(e,t,n,r){if(null==r&&(r=gt(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ft(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Et(t);const e=tt(t),r=tt(n);Qe(e===r,(()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`));for(let e=0;e<n.length;++e){const r=n[e],a=e!==n.length-1||r!==tt(t.slice(e));Qe(n[e]===t[e]||!a,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `))}}return ft(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Nn(e,r):et(e,[],!0),ir.makeTensor(e,t,r)}function ga(e,t,n){return ma(e,t,ua(e,n),n)}const ya={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},ba="undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa;function va(e){return ba?Sr.byteLength(e):new Blob([e]).size}function xa(e){if(1===e.length)return e[0];let t=0;e.forEach((e=>{t+=e.byteLength}));const n=new Uint8Array(t);let r=0;return e.forEach((e=>{n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function _a(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:va(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:va(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function wa(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const a=new ArrayBuffer(4*r.length),s=new Uint32Array(a);for(let a=0;a<r.length;a++){const o=r[a],i=e[n[o>>10]+(1023&o)]+t[o>>10];s[a]=i}return new Float32Array(a)}}class Ta{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Ta.instance&&(Ta.instance=new Ta),Ta.instance}static registerSaveRouter(e){Ta.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ta.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ta.getHandlers(e,"save")}static getLoadHandlers(e,t){return Ta.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?Ta.getInstance().loadRouters:Ta.getInstance().saveRouters).forEach((t=>{const a=t(e,n);null!==a&&r.push(a)})),r}}function Ea(){if(!At().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Sa(e){const t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}class Ia{constructor(e){if(this.indexedDB=Ea(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Sa(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction("models_store","readonly"),r=t.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{const r=_a(t),s=a.transaction("model_info_store","readwrite");let o=s.objectStore("model_info_store");const i=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;i.onsuccess=()=>{u=a.transaction("models_store","readwrite");const i=u.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});i.onsuccess=()=>e({modelArtifactsInfo:r}),i.onerror=e=>{o=s.objectStore("model_info_store");const t=o.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(i.error)),t.onerror=e=>(a.close(),n(i.error))}},i.onerror=e=>(a.close(),n(i.error)),s.oncomplete=()=>{null==u?a.close():u.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)}))}}Ia.URL_SCHEME="indexeddb://";const ka=e=>{return At().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ia.URL_SCHEME)?(t=e.slice(Ia.URL_SCHEME.length),new Ia(t)):null;var t};Ta.registerSaveRouter(ka),Ta.registerLoadRouter(ka);class Ca{constructor(){this.indexedDB=Ea()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>Sa(n),n.onsuccess=()=>{const r=n.result,a=r.transaction("model_info_store","readonly"),s=a.objectStore("model_info_store").getAll();s.onsuccess=()=>{const t={};for(const e of s.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},s.onerror=e=>(r.close(),t(s.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(Ia.URL_SCHEME)?t.slice(Ia.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Sa(r),r.onsuccess=()=>{const a=r.result,s=a.transaction("model_info_store","readwrite"),o=s.objectStore("model_info_store"),i=o.get(e);let u;i.onsuccess=()=>{if(null==i.result)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=o.delete(e),s=()=>{u=a.transaction("models_store","readwrite");const r=u.objectStore("models_store").delete(e);r.onsuccess=()=>t(i.result.modelArtifactsInfo),r.onerror=e=>n(i.error)};r.onsuccess=s,r.onerror=e=>(s(),a.close(),n(i.error))}},i.onerror=e=>(a.close(),n(i.error)),s.oncomplete=()=>{null==u?a.close():u.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)}))}}const Na="tensorflowjs_models",Aa="info",$a="model_topology",Ra="weight_specs",Fa="weight_data",Oa="model_metadata";function Da(e){return{info:[Na,e,Aa].join("/"),topology:[Na,e,$a].join("/"),weightSpecs:[Na,e,Ra].join("/"),weightData:[Na,e,Fa].join("/"),modelMetadata:[Na,e,Oa].join("/")}}function Ma(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function La(e){const t=e.split("/");if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join("/")}class Pa{constructor(e){if(!At().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Da(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=_a(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(ba)return Sr.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let e=0,r=t.length;e<r;e++)n+=String.fromCharCode(t[e]);return btoa(n)}(e.weightData));const a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:r}}catch(e){throw Ma(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(ba){const t=Sr.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n.set([t.charCodeAt(e)],e);return n.buffer}(s),t}}Pa.URL_SCHEME="localstorage://";const Ba=e=>{return At().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Pa.URL_SCHEME)?(t=e.slice(Pa.URL_SCHEME.length),new Pa(t)):null;var t};Ta.registerSaveRouter(Ba),Ta.registerLoadRouter(Ba);class Ua{constructor(){Qe(At().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),Qe("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=Na+"/",n="/"+Aa;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);a.startsWith(t)&&a.endsWith(n)&&(e[La(a)]=JSON.parse(this.LS.getItem(a)))}return e}async removeModel(e){var t;const n=Da(e=(t=e).startsWith(Pa.URL_SCHEME)?t.slice(Pa.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return Ma(n),r}}function za(e,t,n,r){!function(e){Qe(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){Qe(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`)),Qe(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`)),Qe(t>=e,(()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`))}(n=null==n?0:n,r=null==r?1:r);let a=0;return Promise.all(e.map((s=>(s.then((s=>{const o=n+ ++a/e.length*(r-n);return t(o),s})),s))))}class Va{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(Qe("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=At().platform.fetch,Qe(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&Qe(2===e.length,(()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`)),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=function(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:_a(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch(e){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return async function(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),null!=e.weightsManifest){const[r,a]=await t(e.weightsManifest);n.weightSpecs=r,n.weightData=a}return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),n}(t,(e=>this.loadWeights(e)))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),a=this.weightPathPrefix||n,s=[];for(const t of e)s.push(...t.weights);const o=[],i=[];for(const t of e)for(const e of t.paths)null!=this.weightUrlConverter?i.push(this.weightUrlConverter(e)):o.push(a+e+r);this.weightUrlConverter&&o.push(...await Promise.all(i));const u=await async function(e,t){null==t&&(t={});const n=null==t.fetchFunc?At().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),a=(null==t.onProgress?await Promise.all(r):await za(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(a):await za(a,t.onProgress,.5,1)}(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[s,xa(u)]}}function Wa(e){return null!=e.match(Va.URL_SCHEME_REGEX)}Va.URL_SCHEME_REGEX=/^https?:\/\//;const ja=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>Wa(e))):Wa(e),n)return Ga(e,t)}return null};function Ga(e,t){return new Va(e,t)}function Ha(e,t){return Ga(e,t)}Ta.registerSaveRouter(ja),Ta.registerLoadRouter(ja);class Ka{constructor(){this.managers={}}static getInstance(){return null==Ka.instance&&(Ka.instance=new Ka),Ka.instance}static registerManager(e,t){Qe(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith("://")&&(e=e.slice(0,e.indexOf("://"))),Qe(e.length>0,(()=>"scheme must not be an empty string."));const n=Ka.getInstance();Qe(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}const qa=fa({cast_:function(e,t){const n=ha(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return ir.runKernel("Cast",r,a)}}),Xa=fa({matMul_:function(e,t,n=!1,r=!1){let a=ha(e,"a","matMul"),s=ha(t,"b","matMul");[a,s]=er(a,s);const o={a,b:s},i={transposeA:n,transposeB:r};return ir.runKernel("BatchMatMul",o,i)}}),Ya=fa({oneHot_:function(e,t,n=1,r=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const a={indices:ha(e,"indices","oneHot","int32")},s={depth:t,onValue:n,offValue:r};return ir.runKernel("OneHot",a,s)}});function Qa(){return ir}function Ja(e,t){return ir.tidy(e,t)}function Za(e){return ir.keep(e)}function es(e,t,n=1){return ir.registerBackend(e,t,n)}const ts=fa({imag_:function(e){const t={input:ha(e,"input","imag")};return ir.runKernel("Imag",t)}}),ns=fa({neg_:function(e){const t={x:ha(e,"x","neg")};return ir.runKernel("Neg",t)}}),rs=fa({real_:function(e){const t={input:ha(e,"input","real")};return ir.runKernel("Real",t)}}),as=fa({transpose_:function(e,t,n){const r=ha(e,"x","transpose");if(null==t&&(t=r.shape.map(((e,t)=>t)).reverse()),Qe(r.rank===t.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`)),t.forEach((e=>{Qe(e>=0&&e<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${t}`))})),r.rank<=1)return r.clone();const a={x:r},s={perm:t};return"complex64"===r.dtype?Ja((()=>{let e=rs(r),t=ts(r);return e=ir.runKernel("Transpose",{x:e},s),t=ir.runKernel("Transpose",{x:t},s),n&&(t=ns(t)),da(e,t)})):ir.runKernel("Transpose",a,s)}});function ss(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const s=n-1-a,o=e[s]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(s)}return r}function os(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],s=t.length-r-1,o=t[s];(null==a||1===a&&o>1)&&n.unshift(s)}return n}function is(e,t){const n=[],r=Math.max(e.length,t.length);for(let a=0;a<r;a++){let r=e[e.length-a-1];null==r&&(r=1);let s=t[t.length-a-1];if(null==s&&(s=1),1===r)n.unshift(s);else if(1===s)n.unshift(r);else{if(r!==s)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);n.unshift(r)}}return n}let us;const ls=fa({fromPixels_:function(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,s=!1,o=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)s=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);i=!0}if(a){const t=2;if(a&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Pt("FromPixels",ir.backendName)){const n={pixels:e},r={numChannels:t};return ir.runKernel("FromPixels",n,r)}const[u,l]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height];let c,h;if(o)c=e.getContext("2d").getImageData(0,0,u,l).data;else if(r||n)c=e.data;else if(s||a||i){if(null==us)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");us=new OffscreenCanvas(1,1).getContext("2d")}else us=document.createElement("canvas").getContext("2d");us.canvas.width=u,us.canvas.height=l,us.drawImage(e,0,0,u,l),c=us.getImageData(0,0,u,l).data}if(4===t)h=new Int32Array(c);else{const e=u*l;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=c[4*n+e]}return function(e,t,n){if(Ze(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=ua(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ma(e,t,r,n)}(h,[l,u,t],"int32")}});function cs(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(s+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(s+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(s+" update.rank != "+(a+e.length-r));for(let e=0;e<a;++e)if(n.shape[e]!==t.shape[e])throw new Error(s+` updates.shape[${e}] (${n.shape[e]}) != indices.shape[${e}] (${t.shape[e]}).`);for(let t=0;t<n.rank-a;++t)if(n.shape[t+a]!==e[t+r])throw new Error(s+` updates.shape[${t+a}] (${n.shape[t+a]}) != shape[${t+a}] (${e[t+a]})`)}function hs(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}cs(n,t,e)}function ps(e,t,n){const r=e.shape.length;Qe(r===t.length,(()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`)),Qe(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let a=0;a<r;++a)Qe(t[a]+n[a]<=e.shape[a],(()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`))}function fs(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function ds(e,t,n,r){const a=[...e];for(let e=a.length;e<r.length;e++)a.push(1);for(let e=0;e<n;e++)0===e?a[t]=1:(a.splice(t,0,1),a.pop());return a}function ms(e,t,n){return n<=e?n:n-(t-1)}function gs(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function ys(e,t,n,r,a){const s=[...a],o=gs(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const o=ms(t,n,a);let i=r[o];e&1<<o&&(i=0),s[a]=i}return s}function bs(e,t,n,r,a){const s=[...a],o=gs(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const o=ms(t,n,a);let i=r[o];e&1<<o&&(i=Number.MAX_SAFE_INTEGER),s[a]=i}for(let e=0;e<s.length;e++){const t=a[e];s[e]<0&&(s[e]+=t),s[e]=qe(0,s[e],a[e])}return s}function vs(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function xs(e,t,n,r,a,s){let o=t[a];const i=n[a]||1;(e&1<<a||s&1<<a||null==o)&&(o=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[a];return o<0&&(o+=u),o=qe(0,o,u-1),o}function _s(e,t,n,r,a,s){let o=t[a];const i=n[a]||1;(e&1<<a||s&1<<a||null==o)&&(o=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[a];return o<0&&(o+=u),o=i>0?qe(0,o,u):qe(-1,o,u-1),o}function ws(e,t,n){let r=n.length;for(let e=0;e<n.length;e++)if(n[e]>1){r=e;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function Ts(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Es(e,t,n){let r;const a=e.shape.length;let s;return r="number"==typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach((e=>{Qe(-1!==e,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(a).fill(-1):"number"==typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,s=s.map(((t,n)=>t>=0?t:(Qe(-1===t,(()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`)),e.shape[n]-r[n]))),[r,s]}function Ss(e,t,n,r,a,s,o,i,u){let l;if(null==r?(l=new Array(t.length),l.fill(1)):l=r,null!=o&&0!=(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:a,endMask:s,ellipsisMask:o,newAxisMask:i,shrinkAxisMask:u};for(let e=0;e<h.dims;e++)c&&0!=(1<<e&i)&&h.numAddAxisAfterEllipsis++,1<<e&o&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,p);let f=!0,d=!0,m=!0;const g=[],y=[];for(let t=0;t<e.length;++t){if(0===p.strides[t])throw Error(`strides[${t}] must be non-zero`);const n=!!(p.shrinkAxisMask&1<<t),r=e[t];if(-1===r){g.push(n?1:-1);continue}const a=[p.beginMask&1<<t,p.endMask&1<<t],s=[p.strides[t]>0?0:-1,p.strides[t]>0?r:r-1];if(n&&p.strides[t]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===p.strides[t];const o=!!(p.beginMask&1<<t&&p.endMask&1<<t);if(p.beginValid&&p.endValid){if(n){const e=p.begin[t]<0?r+p.begin[t]:p.begin[t];if(p.begin[t]=e,p.end[t]=p.begin[t]+1,e<0||e>=r)throw Error(`slice index ${p.begin[t]} of dimension ${t} out of bounds.`)}else p.begin[t]=Is(p.begin[t],0,p.strides[t],r,a,s),p.end[t]=Is(p.end[t],1,p.strides[t],r,a,s);const e=1===p.strides[t]&&0===p.begin[t]&&p.end[t]===r;f=f&&e,d=d&&(0===t&&1===p.strides[t]||e)}else f=f&&1===p.strides[t]&&o,d=d&&(0===t&&1===p.strides[t]||o);let i,u=!1;if(p.beginValid&&p.endValid?(i=p.end[t]-p.begin[t],u=!0):n?(i=1,u=!0):o&&r>=0&&(i=p.strides[t]<0?-r:r,u=!0),u){let e;e=0===i||i<0!=p.strides[t]<0?0:Math.trunc(i/p.strides[t])+(i%p.strides[t]!=0?1:0),g.push(e)}else g.push(-1)}for(let e=0;e<p.finalShapeGatherIndices.length;++e){const t=p.finalShapeGatherIndices[e];t>=0?y.push(g[t]):-2===t&&y.push(1)}const b=y.filter(((e,t)=>-2!==p.finalShapeGatherIndices[t]));return{finalShapeSparse:b,finalShape:y,isIdentity:f,sliceDim0:d,isSimpleSlice:m,begin:p.begin,end:p.end,strides:p.strides}}function Is(e,t,n,r,a,s){if(a[t])return n>0?s[t]:s[t+1&1];{const t=e<0?r+e:e;return t<s[0]?s[0]:t>s[1]?s[1]:t}}var ks=Object.freeze({__proto__:null,assertParamsValid:ps,maskToAxes:function(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t},computeOutShape:fs,stridesWithElidedDims:ds,getNormalizedAxes:function(e,t,n,r,a,s,o,i,u){const l=e.length;let c=new Array(l),h=new Array(l),p=new Array(l);if(t.length&&n>0){const u=t[0],l=n+1;c=ys(o,u,l,r,e),h=bs(i,u,l,a,e),p=ds(s,u,l,e)}else for(let t=0;t<l;t++)c[t]=xs(o,r,s,e,t,u),h[t]=_s(i,a,s,e,t,u),p[t]=vs(s,t,u);return{begin:c,end:h,strides:p}},startIndicesWithElidedDims:ys,stopIndicesWithElidedDims:bs,stridesForAxis:vs,startForAxis:xs,stopForAxis:_s,isSliceContinous:ws,computeFlatOffset:Ts,parseSliceParams:Es,sliceInfo:Ss});const Cs=fa({add_:function(e,t){let n=ha(e,"a","add"),r=ha(t,"b","add");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Add",a)}}),Ns=fa({floorDiv_:function(e,t){let n=ha(e,"a","floorDiv"),r=ha(t,"b","floorDiv");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("FloorDiv",a)}}),As=fa({div_:function(e,t){let n=ha(e,"a","div"),r=ha(t,"b","div");if([n,r]=er(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Ns(n,r);const a={a:n,b:r};return ir.runKernel("RealDiv",a,{})}}),$s=fa({mul_:function(e,t){let n=ha(e,"a","mul"),r=ha(t,"b","mul");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Multiply",a)}}),Rs=fa({abs_:function(e){const t=ha(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return ir.runKernel("ComplexAbs",e)}{const e={x:t};return ir.runKernel("Abs",e)}}}),Fs=fa({acos_:function(e){const t={x:ha(e,"x","acos")};return ir.runKernel("Acos",t)}}),Os=fa({acosh_:function(e){const t={x:ha(e,"x","acosh")};return ir.runKernel("Acosh",t)}}),Ds=fa({addN_:function(e){Qe(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),Qe(e.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`));const t=e.map(((e,t)=>ha(e,`tensors${t}`,"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!nt(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=t;return ir.runKernel("AddN",r)}}),Ms=fa({all_:function(e,t=null,n=!1){const r={x:ha(e,"x","all","bool")},a={axis:t,keepDims:n};return ir.runKernel("All",r,a)}}),Ls=fa({any_:function(e,t=null,n=!1){const r={x:ha(e,"x","any","bool")},a={axis:t,keepDims:n};return ir.runKernel("Any",r,a)}}),Ps=fa({argMax_:function(e,t=0){const n={x:ha(e,"x","argMax")},r={axis:t};return ir.runKernel("ArgMax",n,r)}}),Bs=fa({argMin_:function(e,t=0){const n={x:ha(e,"x","argMin")},r={axis:t};return ir.runKernel("ArgMin",n,r)}}),Us=fa({asin_:function(e){const t={x:ha(e,"x","asin")};return ir.runKernel("Asin",t)}}),zs=fa({asinh_:function(e){const t={x:ha(e,"x","asinh")};return ir.runKernel("Asinh",t)}}),Vs=fa({atan_:function(e){const t={x:ha(e,"x","atan")};return ir.runKernel("Atan",t)}}),Ws=fa({atan2_:function(e,t){let n=ha(e,"a","atan2"),r=ha(t,"b","atan2");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Atan2",a)}}),js=fa({atanh_:function(e){const t={x:ha(e,"x","atanh")};return ir.runKernel("Atanh",t)}});function Gs(e,t,n,r,a,s,o="channelsLast"){const[i,u]=Xs(t);let l;if("channelsLast"===o)l=[i,u,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);l=[i,u,e[1],e[1]]}return Hs(e,l,n,r,a,s,!1,o)}function Hs(e,t,n,r,a,s,o=!1,i="channelsLast"){let[u,l,c,h]=[-1,-1,-1,-1];if("channelsLast"===i)[u,l,c,h]=e;else{if("channelsFirst"!==i)throw new Error(`Unknown dataFormat ${i}`);[u,h,l,c]=e}const[p,f,,d]=t,[m,g]=Xs(n),[y,b]=Xs(r),v=Qs(p,y),x=Qs(f,b),{padInfo:_,outHeight:w,outWidth:T}=function(e,t,n,r,a,s,o,i,u){let l,c,h;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,a){null==r&&(r=qs(e,t,n));const s=e[1];return[Js((e[0]-t+2*r)/n+1,a),Js((s-t+2*r)/n+1,a)]}([t,n],s,r,e,i);c=a[0],h=a[1]}else if("same"===e){c=Math.ceil(t/r),h=Math.ceil(n/a);const e=Math.max(0,(c-1)*r+s-t),i=Math.max(0,(h-1)*a+o-n),u=Math.floor(e/2),p=e-u,f=Math.floor(i/2);l={top:u,bottom:p,left:f,right:i-f,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{const p="channelsLast"===u?e[1][0]:e[2][0],f="channelsLast"===u?e[1][1]:e[2][1],d="channelsLast"===u?e[2][0]:e[3][0],m="channelsLast"===u?e[2][1]:e[3][1];l={top:p,bottom:f,left:d,right:m,type:0===p&&0===f&&0===d&&0===m?"VALID":"EXPLICIT"},c=Js((t-s+p+f)/r+1,i),h=Js((n-o+d+m)/a+1,i)}}return{padInfo:l,outHeight:c,outWidth:h}}(a,l,c,m,g,v,x,s,i),E=o?d*h:d;let S;return"channelsFirst"===i?S=[u,E,w,T]:"channelsLast"===i&&(S=[u,w,T,E]),{batchSize:u,dataFormat:i,inHeight:l,inWidth:c,inChannels:h,outHeight:w,outWidth:T,outChannels:E,padInfo:_,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:e,outShape:S,filterShape:t}}function Ks(e,t,n,r,a,s=!1,o="channelsLast",i){let[u,l,c,h,p]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[u,l,c,h,p]=e;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[u,p,l,c,h]=e}const[f,d,m,,g]=t,[y,b,v]=Ys(n),[x,_,w]=Ys(r),T=Qs(f,x),E=Qs(d,_),S=Qs(m,w),{padInfo:I,outDepth:k,outHeight:C,outWidth:N}=function(e,t,n,r,a,s,o,i,u,l,c){let h,p,f,d;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const s=function(e,t,n,r,a,s){null==a&&(a=qs(e,t,r));const o=e[1],i=e[2];return[Js((e[0]-t+2*a)/r+1,s),Js((o-t+2*a)/r+1,s),Js((i-t+2*a)/r+1,s),1]}([t,n,r,1],i,0,a,e,c);p=s[0],f=s[1],d=s[2]}else if("same"===e){p=Math.ceil(t/a),f=Math.ceil(n/s),d=Math.ceil(r/o);const e=(p-1)*a+i-t,c=(f-1)*s+u-n,m=(d-1)*o+l-r,g=Math.floor(e/2),y=e-g,b=Math.floor(c/2),v=c-b,x=Math.floor(m/2);h={top:b,bottom:v,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error(`Unknown padding parameter: ${e}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-i+1)/a),f=Math.ceil((n-u+1)/s),d=Math.ceil((r-l+1)/o)}return{padInfo:h,outDepth:p,outHeight:f,outWidth:d}}(a,l,c,h,y,b,v,T,E,S,i),A=s?g*p:g;let $;return"channelsFirst"===o?$=[u,A,k,C,N]:"channelsLast"===o&&($=[u,k,C,N,A]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:h,inChannels:p,outDepth:k,outHeight:C,outWidth:N,outChannels:A,padInfo:I,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:f,filterHeight:d,filterWidth:m,effectiveFilterDepth:T,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:x,dilationHeight:_,dilationWidth:w,inShape:e,outShape:$,filterShape:t}}function qs(e,t,n,r=1){const a=Qs(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Xs(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Ys(e){return"number"==typeof e?[e,e,e]:e}function Qs(e,t){return t<=1?e:e+(e-1)*(t-1)}function Js(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Zs(e){const[t,n,r]=Xs(e);return 1===t&&1===n&&1===r}function eo(e,t){return Zs(e)||Zs(t)}function to(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function no(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)Qe(rt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`));else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach((t=>{t.forEach((t=>{Qe(rt(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`))}))}))}}}const ro=fa({reshape_:function(e,t){const n={x:ha(e,"x","reshape","string_or_numeric")},r={shape:t};return ir.runKernel("Reshape",n,r)}}),ao=fa({avgPool_:function(e,t,n,r,a){const s=ha(e,"x","avgPool","float32");Qe(eo(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let o=s,i=!1;3===s.rank&&(i=!0,o=ro(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Qe(4===o.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`)),no("avgPool",r,a);const u={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let c=ir.runKernel("AvgPool",u,l);return c=qa(c,s.dtype),i?ro(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),so=fa({avgPool3d_:function(e,t,n,r,a,s="NDHWC"){const o=ha(e,"x","avgPool3d","float32");let i=o,u=!1;4===o.rank&&(u=!0,i=ro(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Qe(5===i.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${i.rank}.`)),Qe("NDHWC"===s,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),no("avgPool3d",r,a);const l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s};let h=ir.runKernel("AvgPool3D",l,c);return h=qa(h,i.dtype),u?ro(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),oo=fa({clone_:function(e){const t={x:ha(e,"x","clone","string_or_numeric")};return ir.runKernel("Identity",t)}}),io=fa({concat_:function(e,t=0){Qe(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=pa(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)})),1===n.length)return oo(n[0]);const r=n,a={axis:t};return ir.runKernel("Concat",r,a)}}),uo=fa({sigmoid_:function(e){const t={x:ha(e,"x","sigmoid","float32")};return ir.runKernel("Sigmoid",t)}}),lo=fa({slice_:function(e,t,n){const r=ha(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},s={begin:t,size:n};return ir.runKernel("Slice",a,s)}}),co=fa({tanh_:function(e){const t={x:ha(e,"x","tanh","float32")};return ir.runKernel("Tanh",t)}}),ho=fa({batchToSpaceND_:function(e,t,n){const r=ha(e,"x","batchToSpaceND"),a=t.reduce(((e,t)=>e*t));Qe(r.rank>=1+t.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`)),Qe(n.length===t.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`)),Qe(r.shape[0]%a==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`));const s={x:r},o={blockShape:t,crops:n};return ir.runKernel("BatchToSpaceND",s,o)}}),po=fa({batchNorm_:function(e,t,n,r,a,s){null==s&&(s=.001);const o=ha(e,"x","batchNorm"),i=ha(t,"mean","batchNorm"),u=ha(n,"variance","batchNorm");let l,c;null!=a&&(l=ha(a,"scale","batchNorm")),null!=r&&(c=ha(r,"offset","batchNorm")),Qe(i.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Qe(null==c||i.rank===c.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Qe(null==l||i.rank===l.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h=function(e){let t;return t=0===e.rank||1===e.rank?ro(e,[1,1,1,e.size]):2===e.rank?ro(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?ro(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(o),p={x:h,scale:l,offset:c,mean:i,variance:u},f={varianceEpsilon:s},d=ir.runKernel("FusedBatchNorm",p,f);return ro(d,o.shape)}}),fo=fa({bincount_:function(e,t,n){const r=ha(e,"x","bincount"),a=ha(t,"weights","bincount");Qe("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),Qe(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Qe(a.size===r.size||0===a.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`));const s={x:r,weights:a},o={size:n};return ir.runKernel("Bincount",s,o)}}),mo=fa({broadcastArgs_:function(e,t){const n=ha(e,"s0","broadcastArgs","int32"),r=ha(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const a={s0:n,s1:r};return ir.runKernel("BroadcastArgs",a)}}),go=fa({broadcastTo_:function(e,t){let n=ha(e,"broadcastTo","x");const r=n.shape;if(t.some((e=>!(e>0)||e%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=ro(n,e)}const a=n.shape,s=Array.from(t);for(let e=t.length-1;e>=0;e--)if(a[e]===t[e])s[e]=1;else if(1!==n.shape[e])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);const o=s.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0));if(0===o.length)return oo(n);const i={x:n},u={reps:s};return ir.runKernel("Tile",i,u)}});function yo(e,t="float32",n){return t=t||"float32",Et(e),new zn(e,t,n)}const bo=fa({ceil_:function(e){const t={x:ha(e,"x","ceil","float32")};return ir.runKernel("Ceil",t)}}),vo=fa({clipByValue_:function(e,t,n){const r=ha(e,"x","clipByValue");Qe(t<=n,(()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`));const a={x:r},s={clipValueMin:t,clipValueMax:n};return ir.runKernel("ClipByValue",a,s)}}),xo=fa({conv2d_:function(e,t,n,r,a="NHWC",s=[1,1],o){const i=ha(e,"x","conv2d","float32"),u=ha(t,"filter","conv2d","float32");let l=i,c=!1;3===i.rank&&(c=!0,l=ro(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Qe(4===l.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`)),Qe(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),no("conv2d",r,o);const h="NHWC"===a?l.shape[3]:l.shape[1];Qe(h===u.shape[2],(()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`)),Qe(eo(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const p={x:l,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o},d=ir.runKernel("Conv2D",p,f);return c?ro(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),_o=fa({conv1d_:function(e,t,n,r,a="NWC",s=1,o){const i=ha(e,"x","conv1d"),u=ha(t,"filter","conv1d");let l=i,c=!1;2===i.rank&&(c=!0,l=ro(i,[1,i.shape[0],i.shape[1]])),Qe(3===l.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`)),Qe(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),no("conv1d",r,o),Qe(l.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),Qe(eo(n,s),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`)),Qe("NWC"===a,(()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`));const h=ro(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=ro(l,[l.shape[0],1,l.shape[1],l.shape[2]]),f=xo(p,h,[1,n],r,"NHWC",[1,s],o);return ro(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),wo=fa({conv2DBackpropInput_:function(e,t,n,r,a,s="NHWC",o){Qe(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let i=e,u=t,l=!1;3===t.rank&&(l=!0,u=ro(t,[1,t.shape[0],t.shape[1],t.shape[2]]),i=[1,e[0],e[1],e[2]]),Qe(4===i.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${i.length}.`)),Qe(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),Qe(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const c="NHWC"===s?i[3]:i[1],h="NHWC"===s?u.shape[3]:u.shape[1];Qe(c===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`)),Qe(h===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`)),no("conv2dDerInput",a,o);const p={dy:u,filter:n},f={strides:r,pad:a,dataFormat:s,dimRoundingMode:o,inputShape:i},d=ir.runKernel("Conv2DBackpropInput",p,f);return l?ro(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),To=fa({conv2dTranspose_:function(e,t,n,r,a,s){const o=ha(e,"x","conv2dTranspose"),i=ha(t,"filter","conv2dTranspose");return wo(n,o,i,r,a,"NHWC",s)}}),Eo=fa({conv3d_:function(e,t,n,r,a="NDHWC",s=[1,1,1]){const o=ha(e,"x","conv3d"),i=ha(t,"filter","conv3d");let u=o,l=!1;4===o.rank&&(l=!0,u=ro(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Qe(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),Qe(5===i.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${i.rank}.`)),Qe(u.shape[4]===i.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${i.shape[3]}.`)),Qe(eo(n,s),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),Qe("NDHWC"===a,(()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`));const c={x:u,filter:i},h={strides:n,pad:r,dataFormat:a,dilations:s},p=ir.runKernel("Conv3D",c,h);return l?ro(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),So=fa({cos_:function(e){const t={x:ha(e,"x","cos","float32")};return ir.runKernel("Cos",t)}}),Io=fa({cosh_:function(e){const t={x:ha(e,"x","cosh","float32")};return ir.runKernel("Cosh",t)}}),ko=fa({cumprod_:function(e,t=0,n=!1,r=!1){const a={x:ha(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:r};return ir.runKernel("Cumprod",a,s)}}),Co=fa({cumsum_:function(e,t=0,n=!1,r=!1){const a={x:ha(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:r};return ir.runKernel("Cumsum",a,s)}}),No=fa({denseBincount_:function(e,t,n,r=!1){const a=ha(e,"x","denseBincount"),s=ha(t,"weights","denseBincount");Qe("int32"===a.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`)),Qe(a.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`)),Qe(n>=0,(()=>`size must be non-negative, but got ${n}.`)),Qe(s.size===a.size||0===s.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${s.shape}.`));const o={x:a,weights:s},i={size:n,binaryOutput:r};return ir.runKernel("DenseBincount",o,i)}}),Ao=fa({depthToSpace_:function(e,t,n="NHWC"){const r=ha(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];Qe(t>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`)),Qe(a*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${a} and ${t}  for depthToSpace with input shape\n    ${r.shape}`)),Qe(s*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${t} for depthToSpace with input shape\n        ${r.shape}`)),Qe(o%(t*t)==0,(()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`));const i={x:r},u={blockSize:t,dataFormat:n};return ir.runKernel("DepthToSpace",i,u)}}),$o=fa({depthwiseConv2d_:function(e,t,n,r,a="NHWC",s=[1,1],o){const i=ha(e,"x","depthwiseConv2d","float32"),u=ha(t,"filter","depthwiseConv2d","float32");let l=i,c=!1;3===i.rank&&(c=!0,l=ro(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Qe(4===l.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`)),Qe(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),Qe(l.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),no("depthwiseConv2d",r,o);const h={x:l,filter:u},p={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o},f=ir.runKernel("DepthwiseConv2dNative",h,p);return c?ro(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),Ro=fa({dilation2d_:function(e,t,n,r,a=[1,1],s="NHWC"){const o=ha(e,"x","dilation2d"),i=ha(t,"filter","dilation2d");Qe(3===o.rank||4===o.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`)),Qe(3===i.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${i.rank}.`)),Qe("NHWC"===s,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`));let u=o,l=!1;3===o.rank&&(u=ro(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);const c={x:u,filter:i},h={strides:n,pad:r,dilations:a},p=ir.runKernel("Dilation2D",c,h);return l?ro(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),Fo=fa({equal_:function(e,t){let n=ha(e,"a","equal","string_or_numeric"),r=ha(t,"b","equal","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("Equal",a)}}),Oo=fa({where_:function(e,t,n){const r=ha(t,"a","where"),a=ha(n,"b","where"),s=ha(e,"condition","where","bool"),o=is(is(s.shape,r.shape),a.shape),i={condition:go(s,o),t:go(r,o),e:go(a,o)};return ir.runKernel("Select",i)}}),Do=fa({zerosLike_:function(e){const t={x:ha(e,"x","zerosLike")};return ir.runKernel("ZerosLike",t)}}),Mo=fa({divNoNan_:function(e,t){let n=ha(e,"a","div"),r=ha(t,"b","div");[n,r]=er(n,r);const a=As(n,r),s=Do(a),o=Fo(r,s);return Oo(o,s,a)}}),Lo=fa({einsum_:function(e,...t){const n=t.map(((e,t)=>ha(e,`tensors${t}`,"einsum"))),r={equation:e};return ir.runKernel("Einsum",n,r)}}),Po=fa({elu_:function(e){const t={x:ha(e,"x","elu","float32")};return ir.runKernel("Elu",t)}}),Bo=fa({erf_:function(e){let t=ha(e,"x","erf");Qe("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=qa(t,"float32"));const n={x:t};return ir.runKernel("Erf",n)}});function Uo(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function zo(e,t,n){const r=e.length+t.length,a=[];let s=0,o=0;for(let i=0;i<r;i++)-1===n.indexOf(i)?a.push(e[s++]):a.push(t[o++]);return a}function Vo(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((t=>e[t]))]}function Wo(e,t){return zo(e,t.map((e=>1)),t)}function jo(e,t,n){Qe(Uo(t,n),(()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`))}function Go(e,t){if(Uo(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function Ho(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const Ko=fa({max_:function(e,t=null,n=!1){const r={x:ha(e,"x","max")},a={reductionIndices:t,keepDims:n};return ir.runKernel("Max",r,a)}}),qo=fa({min_:function(e,t=null,n=!1){const r={x:ha(e,"x","min")},a={axis:t,keepDims:n};return ir.runKernel("Min",r,a)}}),Xo=fa({pow_:function(e,t){let n=ha(e,"base","pow"),r=ha(t,"exp","pow");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Pow",a)}});function Yo(e,t){if((ft(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&ft(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ma(e,[],[],t)}const Qo=fa({sqrt_:function(e){const t={x:ha(e,"x","sqrt","float32")};return ir.runKernel("Sqrt",t)}}),Jo=fa({square_:function(e){const t=ha(e,"x","square");return ir.runKernel("Square",{x:t},{})}}),Zo=fa({sum_:function(e,t=null,n=!1){let r=ha(e,"x","sum");"bool"===r.dtype&&(r=qa(r,"int32"));const a={x:r},s={axis:t,keepDims:n};return ir.runKernel("Sum",a,s)}});function ei(e,t,n=null){if(0===e.rank)return Rs(e);if(1!==e.rank&&null===n)return ei(ro(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Zo(Rs(e),n);if(t===1/0)return Ko(Rs(e),n);if(t===-1/0)return qo(Rs(e),n);if("euclidean"===t||2===t)return Qo(Zo(Xo(Rs(e),Yo(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return Ko(Zo(Rs(e),n[0]),n[1]-1);if(t===1/0)return Ko(Zo(Rs(e),n[1]),n[0]);if(t===-1/0)return qo(Zo(Rs(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Qo(Zo(Jo(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ti=fa({norm_:function(e,t="euclidean",n=null,r=!1){const a=ei(e=ha(e,"x","norm"),t,n);let s=a.shape;if(r){const t=ut(n,e.shape);s=Wo(a.shape,t)}return ro(a,s)}}),ni=fa({euclideanNorm_:function(e,t=null,n=!1){return ti(e,"euclidean",t,n)}}),ri=fa({exp_:function(e){const t={x:ha(e,"x","exp")};return ir.runKernel("Exp",t)}}),ai=fa({expandDims_:function(e,t=0){const n=ha(e,"x","expandDims","string_or_numeric");Qe(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},a={dim:t};return ir.runKernel("ExpandDims",r,a)}}),si=fa({expm1_:function(e){const t={x:ha(e,"x","expm1")};return ir.runKernel("Expm1",t)}}),oi=fa({tile_:function(e,t){const n=ha(e,"x","tile","string_or_numeric");Qe(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`));const r={x:n},a={reps:t};return ir.runKernel("Tile",r,a)}}),ii=fa({eye_:function(e,t,n,r="float32"){null==t&&(t=e);const a=yo([e,t],r),s=e<=t?e:t;for(let e=0;e<s;++e)a.set(1,e,e);const o=ro(a.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return oi(ai(o,0),[n[0],1,1]);if(2===n.length)return oi(ai(ai(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return oi(ai(ai(ai(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});function ui(e,t,n){const r={shape:e,value:t,dtype:n};return ir.runKernel("Fill",{},r)}const li=fa({floor_:function(e){const t={x:ha(e,"x","floor","float32")};return ir.runKernel("Floor",t)}}),ci=fa({gather_:function(e,t,n=0,r=0){const a={x:ha(e,"x","gather"),indices:ha(t,"indices","gather","int32")},s={axis:n,batchDims:r};return ir.runKernel("GatherV2",a,s)}}),hi=fa({greater_:function(e,t){let n=ha(e,"a","greater","string_or_numeric"),r=ha(t,"b","greater","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("Greater",a)}}),pi=fa({greaterEqual_:function(e,t){let n=ha(e,"a","greaterEqual","string_or_numeric"),r=ha(t,"b","greaterEqual","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("GreaterEqual",a)}}),fi=fa({isNaN_:function(e){const t={x:ha(e,"x","isNaN")};return ir.runKernel("IsNan",t)}}),di=fa({leakyRelu_:function(e,t=.2){const n={x:ha(e,"x","leakyRelu")},r={alpha:t};return ir.runKernel("LeakyRelu",n,r)}}),mi=fa({less_:function(e,t){let n=ha(e,"a","less","string_or_numeric"),r=ha(t,"b","less","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("Less",a)}}),gi=fa({lessEqual_:function(e,t){let n=ha(e,"a","lessEqual","string_or_numeric"),r=ha(t,"b","lessEqual","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("LessEqual",a)}});function yi(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return ir.runKernel("LinSpace",{},r)}const bi=fa({localResponseNormalization_:function(e,t=5,n=1,r=1,a=.5){const s=ha(e,"x","localResponseNormalization");Qe(4===s.rank||3===s.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`)),Qe(rt(t),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`));let o=s,i=!1;3===s.rank&&(i=!0,o=ro(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={x:o},l={depthRadius:t,bias:n,alpha:r,beta:a},c=ir.runKernel("LRN",u,l);return i?ro(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),vi=fa({log_:function(e){const t={x:ha(e,"x","log","float32")};return ir.runKernel("Log",t)}}),xi=fa({log1p_:function(e){const t={x:ha(e,"x","log1p")};return ir.runKernel("Log1p",t)}});function _i(e){return ir.customGrad(e)}const wi=fa({softplus_:function(e){const t={x:ha(e,"x","softplus")};return ir.runKernel("Softplus",t)}}),Ti=fa({sub_:function(e,t){let n=ha(e,"a","sub"),r=ha(t,"b","sub");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Sub",a)}}),Ei=fa({logSoftmax_:function(e,t=-1){const n=ha(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);const r=_i(((e,n)=>{const r=Ko(e,t,!0),a=Ti(e,r),s=Ti(qa(a,"float32"),vi(Zo(ri(a),t,!0)));return n([s]),{value:s,gradFunc:(e,n)=>{const[r]=n,a=ri(r);return Ti(e,$s(Zo(e,t,!0),a))}}}));return r(n)}}),Si=fa({logSumExp_:function(e,t=null,n=!1){const r=ha(e,"x","logSumExp"),a=ut(t,r.shape),s=Ko(r,a,!0),o=Ti(r,s),i=ri(o),u=Zo(i,a),l=vi(u),c=Cs(ro(s,l.shape),l);if(n){const e=Wo(c.shape,a);return ro(c,e)}return c}}),Ii=fa({logicalAnd_:function(e,t){const n=ha(e,"a","logicalAnd","bool"),r=ha(t,"b","logicalAnd","bool");is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("LogicalAnd",a)}}),ki=fa({logicalNot_:function(e){const t={x:ha(e,"x","logicalNot","bool")};return ir.runKernel("LogicalNot",t)}}),Ci=fa({logicalOr_:function(e,t){const n=ha(e,"a","logicalOr","bool"),r=ha(t,"b","logicalOr","bool");is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("LogicalOr",a)}}),Ni=fa({searchSorted_:function(e,t,n="left"){const r=ha(e,"sortedSequence","searchSorted"),a=ha(t,"values","searchSorted"),s=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],i=ro(r,[-1,s]),u=ro(a,[-1,o]);if(i.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(i.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(tt(u.shape)>=2147483648)throw new Error("values tensor size must less than 2147483648");if(i.shape[1]>=2147483648)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${i.shape[1]}`);const l={sortedSequence:i,values:u},c={side:n};return ir.runKernel("SearchSorted",l,c)}});function Ai(e,t){return Ni(e,t,"left")}const $i=fa({maxPool_:function(e,t,n,r,a){const s=ha(e,"x","maxPool");let o=s,i=!1;3===s.rank&&(i=!0,o=ro(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Qe(4===o.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`)),Qe(eo(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),no("maxPool",r,a);const u={x:o},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a},c=ir.runKernel("MaxPool",u,l);return i?ro(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Ri=fa({maxPool3d_:function(e,t=[1,1,1],n,r,a,s="NDHWC"){const o=ha(e,"x","maxPool3d");let i=o,u=!1;4===o.rank&&(u=!0,i=ro(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Qe(5===i.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${i.rank}.`)),Qe("NDHWC"===s,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),no("maxPool3d",r,a);const l={x:i},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},h=ir.runKernel("MaxPool3D",l,c);return u?ro(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),Fi=fa({maxPoolWithArgmax_:function(e,t,n,r,a=!1){const s={x:ha(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},i=ir.runKernel("MaxPoolWithArgmax",s,o);return{result:i[0],indexes:i[1]}}}),Oi=fa({maximum_:function(e,t){let n=ha(e,"a","maximum"),r=ha(t,"b","maximum");[n,r]=er(n,r),"bool"===n.dtype&&(n=qa(n,"int32"),r=qa(r,"int32")),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("Maximum",a)}}),Di=fa({mean_:function(e,t=null,n=!1){const r={x:ha(e,"x","mean")},a={axis:t,keepDims:n};return ir.runKernel("Mean",r,a)}});function Mi(e,t="float32"){if("complex64"===t){const t=Mi(e,"float32"),n=Mi(e,"float32");return da(t,n)}const n=Tt(tt(e),t);return ir.makeTensor(n,e,t)}function Li(e,t="float32"){if("complex64"===t){const t=Li(e,"float32"),n=Mi(e,"float32");return da(t,n)}const n=wt(tt(e),t);return ir.makeTensor(n,e,t)}const Pi=fa({minimum_:function(e,t){let n=ha(e,"a","minimum"),r=ha(t,"b","minimum");[n,r]=er(n,r),"bool"===n.dtype&&(n=qa(n,"int32"),r=qa(r,"int32")),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("Minimum",a)}}),Bi=fa({mirrorPad_:function(e,t,n){Qe("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=ha(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Qe(t.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`));const a="reflect"===n?1:0;for(let e=0;e<r.rank;e++)Qe(2===t[e].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Qe(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(()=>`Padding in dimension ${e} cannot be greater than or equal to ${r.shape[e]-a} or less than 0 for input of shape ${r.shape}`));const s={paddings:t,mode:n},o={x:r};return ir.runKernel("MirrorPad",o,s)}}),Ui=fa({mod_:function(e,t){let n=ha(e,"a","mod"),r=ha(t,"b","mod");[n,r]=er(n,r);const a={a:n,b:r};return ir.runKernel("Mod",a)}}),zi=fa({multinomial_:function(e,t,n,r=!1){const a=ha(e,"logits","multinomial"),s=a.size,o=a.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const i={logits:1===o?ro(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},l=ir.runKernel("Multinomial",i,u);return 1===o?ro(l,[l.size]):l}}),Vi=fa({notEqual_:function(e,t){let n=ha(e,"a","notEqual","string_or_numeric"),r=ha(t,"b","notEqual","string_or_numeric");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("NotEqual",a)}}),Wi=fa({onesLike_:function(e){const t={x:ha(e,"x","onesLike")};return ir.runKernel("OnesLike",t)}}),ji=fa({pad_:function(e,t,n=0){const r=ha(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},s={x:r};return ir.runKernel("PadV2",s,a)}}),Gi=fa({spaceToBatchND_:function(e,t,n){const r=ha(e,"x","spaceToBatchND");Qe(r.rank>=1+t.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`)),Qe(n.length===t.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`)),Qe(r.shape.reduce(((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`));const a={x:r},s={blockShape:t,paddings:n};return ir.runKernel("SpaceToBatchND",a,s)}}),Hi=fa({prelu_:function(e,t){const n={x:ha(e,"x","prelu"),alpha:ha(t,"alpha","prelu")};return ir.runKernel("Prelu",n)}}),Ki=fa({prod_:function(e,t=null,n=!1){let r=ha(e,"x","prod");"bool"===r.dtype&&(r=qa(r,"int32"));const a={x:r},s={axis:t,keepDims:n};return ir.runKernel("Prod",a,s)}});function qi(e){var t={exports:{}};return e(t,t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self&&self;var Xi=qi((function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function s(e,t){var n=new r(e),s=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,s&&("object"==typeof s&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.alea=s}(0,e)})),Yi=qi((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function s(e,t){var n=new r(e),s=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.xor128=s}(0,e)})),Qi=qi((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function s(e,t){var n=new r(e),s=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.xorwow=s}(0,e)})),Ji=qi((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function s(e,t){null==e&&(e=+new Date);var n=new r(e),s=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,s&&(s.x&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.xorshift7=s}(0,e)})),Zi=qi((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,s=t.i;return t.w=r=r+1640531527|0,n=a[s+34&127],e=a[s=s+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[s]=n^e,t.i=s,n+(r^r>>>16)|0},function(e,t){var n,r,a,s,o,i=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,s=-32;s<u;++s)t&&(r^=t.charCodeAt((s+32)%t.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(o=o+1640531527|0,a=0==(n=i[127&s]^=r+o)?a+1:0);for(a>=128&&(i[127&(t&&t.length||0)]=-1),a=127,s=512;s>0;--s)r=i[a+34&127],n=i[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[a]=r^n;e.w=o,e.X=i,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function s(e,t){null==e&&(e=+new Date);var n=new r(e),s=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,s&&(s.X&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.xor4096=s}(0,e)})),eu=qi((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function s(e,t){var n=new r(e),s=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,s&&("object"==typeof s&&a(s,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=s:this.tychei=s}(0,e)})),tu=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(Object.freeze({__proto__:null,default:{}})),nu=qi((function(e){!function(t,n){var r,a=this,s=256,o=n.pow(s,6),i=n.pow(2,52),u=2*i,l=255;function c(e,l,c){var g=[],y=d(f((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(s):(e=new Uint8Array(s),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(e){var n=a.navigator,o=n&&n.plugins;return[+new Date,a,o,a.screen,m(t)]}}():e,3),g),b=new h(g),v=function(){for(var e=b.g(6),t=o,n=0;e<i;)e=(e+n)*s,t*=s,n=b.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,d(m(b.S),t),(l.pass||c||function(e,t,r,a){return a&&(a.S&&p(a,b),e.state=function(){return p(b,{})}),r?(n.random=e,t):e})(v,y,"global"in l?l.global:this==n,l.state)}function h(e){var t,n=e.length,r=this,a=0,o=r.i=r.j=0,i=r.S=[];for(n||(e=[n++]);a<s;)i[a]=a++;for(a=0;a<s;a++)i[a]=i[o=l&o+e[a%n]+(t=i[a])],i[o]=t;(r.g=function(e){for(var t,n=0,a=r.i,o=r.j,i=r.S;e--;)t=i[a=l&a+1],n=n*s+i[l&(i[a]=i[o=l&o+t])+(i[o]=t)];return r.i=a,r.j=o,n})(s)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(f(e[n],t-1))}catch(e){}return r.length?r:"string"==a?e:e+"\0"}function d(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n.seedrandom=c,d(n.random(),t),e.exports){e.exports=c;try{r=tu}catch(e){}}}([],Math)}));nu.alea=Xi,nu.xor128=Yi,nu.xorwow=Qi,nu.xorshift7=Ji,nu.xor4096=Zi,nu.tychei=eu;var ru=nu;class au{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=a||Math.random();this.random=ru.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,s;do{r=2*this.random()-1,a=2*this.random()-1,s=r*r+a*a}while(s>=1||0===s);const o=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*a*o,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class su{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=ru.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const ou=fa({randomUniform_:function(e,t=0,n=1,r="float32",a){const s=yo(e,r),o=new su(t,n,null,a);for(let e=0;e<s.values.length;e++)s.values[e]=o.nextValue();return s.toTensor()}});function iu(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return ir.runKernel("Range",{},a)}const uu=fa({reciprocal_:function(e){const t={x:ha(e,"x","reciprocal")};return ir.runKernel("Reciprocal",t)}}),lu=fa({relu_:function(e){const t={x:ha(e,"x","relu")};return ir.runKernel("Relu",t)}}),cu=fa({relu6_:function(e){const t={x:ha(e,"x","relu6")};return ir.runKernel("Relu6",t)}}),hu=fa({reverse_:function(e,t){const n={x:ha(e,"x","reverse")},r={dims:t};return ir.runKernel("Reverse",n,r)}}),pu=fa({round_:function(e){const t={x:ha(e,"x","round")};return ir.runKernel("Round",t)}}),fu=fa({rsqrt_:function(e){const t={x:ha(e,"x","rsqrt","float32")};return ir.runKernel("Rsqrt",t)}}),du=fa({selu_:function(e){const t={x:ha(e,"x","selu")};return ir.runKernel("Selu",t)}}),mu=fa({sign_:function(e){const t={x:ha(e,"x","sign")};return ir.runKernel("Sign",t)}}),gu=fa({sin_:function(e){const t={x:ha(e,"x","sin","float32")};return ir.runKernel("Sin",t)}}),yu=fa({sinh_:function(e){const t={x:ha(e,"x","sinh")};return ir.runKernel("Sinh",t)}}),bu=fa({softmax_:function(e,t=-1){const n=ha(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},a={dim:t};return ir.runKernel("Softmax",r,a)}}),vu=fa({fft_:function(e){Qe("complex64"===e.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`));const t={input:e};return ir.runKernel("FFT",t)}}),xu=fa({ifft_:function(e){Qe("complex64"===e.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`));const t={input:e};return ir.runKernel("IFFT",t)}}),_u=fa({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=ro(e,[n,t]);r=xu(a)}else{const a=[n,2*(t-1)],s=ro(rs(e),[n,t]),o=ro(ts(e),[n,t]),i=hu(lo(s,[0,1],[n,t-2]),1),u=$s(hu(lo(o,[0,1],[n,t-2]),1),Yo(-1)),l=io([s,i],1),c=io([o,u],1),h=ro(da(l,c),[a[0],a[1]]);r=xu(h)}if(r=rs(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=ro(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}}),wu=fa({split_:function(e,t,n=0){const r={x:ha(e,"x","split")},a={numOrSizeSplits:t,axis:n};return ir.runKernel("SplitV",r,a)}}),Tu=fa({rfft_:function(e,t){Qe("float32"===e.dtype,(()=>`The dtype for rfft() must be real value but got ${e.dtype}`));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map((e=>0)),s=e.shape.map((e=>e));s[e.shape.length-1]=t,a=lo(e,r,s),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,a=io([e,Mi(r)],e.shape.length-1),n=t}else a=e;const s=Do(a),o=ro(da(a,s),[r,n]),i=vu(o),u=Math.floor(n/2)+1,l=rs(i),c=ts(i),h=wu(l,[u,n-u],l.shape.length-1),p=wu(c,[u,n-u],c.shape.length-1),f=a.shape.slice();return f[a.shape.length-1]=u,ro(da(h[0],p[0]),f)}}),Eu=fa({squaredDifference_:function(e,t){let n=ha(e,"a","squaredDifference"),r=ha(t,"b","squaredDifference");[n,r]=er(n,r),is(n.shape,r.shape);const a={a:n,b:r};return ir.runKernel("SquaredDifference",a,{})}}),Su=fa({squeeze_:function(e,t){const n=ha(e,"x","squeeze");return ro(n,lt(n.shape,t).newShape)}}),Iu=fa({stack_:function(e,t=0){const n=pa(e,"tensors","stack","string_or_numeric");Qe(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&Qe(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,a={axis:t};return ir.runKernel("Pack",r,a)}}),ku=fa({step_:function(e,t=0){const n={x:ha(e,"x","step")},r={alpha:t};return ir.runKernel("Step",n,r)}}),Cu=fa({stridedSlice_:function(e,t,n,r,a=0,s=0,o=0,i=0,u=0){const l={x:ha(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:s,ellipsisMask:o,newAxisMask:i,shrinkAxisMask:u};return ir.runKernel("StridedSlice",l,c)}}),Nu=fa({tan_:function(e){const t={x:ha(e,"x","tan","float32")};return ir.runKernel("Tan",t)}});function Au(e,t){Ze(e);const n=ua(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ma(e,null,n,t)}function $u(e,t,n){if(Ze(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=ua(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ma(e,t,r,n)}const Ru=fa({topk_:function(e,t=1,n=!0){const r=ha(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);const s={x:r},o={k:t,sorted:n},[i,u]=ir.runKernel("TopK",s,o);return{values:i,indices:u}}}),Fu=fa({truncatedNormal_:function(e,t=0,n=1,r,a){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new au(t,n,r,!0,a),o=yo(e,r);for(let e=0;e<o.values.length;e++)o.values[e]=s.nextValue();return o.toTensor()}}),Ou=fa({unique_:function(e,t=0){const n=ha(e,"x","unique","string_or_numeric");Qe(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},a={axis:t},[s,o]=ir.runKernel("Unique",r,a);return{values:s,indices:o}}}),Du=fa({unstack_:function(e,t=0){const n=ha(e,"x","unstack","string_or_numeric");Qe(t>=-n.shape.length&&t<n.shape.length,(()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},a={axis:t};return ir.runKernel("Unpack",r,a)}});function Mu(e,t){return Ni(e,t,"right")}function Lu(e,t){const n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(e);const r=yo(e,"int32"),a=yo([n.length,e.length],"int32");for(let t=0;t<n.length;t++){const s=r.indexToLoc(n[t]),o=t*e.length;a.values.set(s,o)}return a.toTensor()}const Pu=async function(e){const t=ha(e,"condition","whereAsync","bool"),n=await t.data(),r=Lu(t.shape,n);return e!==t&&t.dispose(),r},Bu=fa({scatterND_:function(e,t,n){const r=ha(e,"indices","scatterND","int32"),a=ha(t,"updates","scatterND");hs(a,r,n);const s={indices:r,updates:a},o={shape:n};return ir.runKernel("ScatterNd",s,o)}}),Uu=fa({sparseToDense_:function(e,t,n,r=0){const a=ha(e,"sparseIndices","sparseToDense","int32"),s=ha(t,"sparseValues","sparseToDense","string_or_numeric"),o=ha(r,"defaultValue","sparseToDense",s.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const a=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,s,n,o);const i={sparseIndices:a,sparseValues:s,defaultValue:o},u={outputShape:n};return ir.runKernel("SparseToDense",i,u)}}),zu=fa({gatherND_:function(e,t){const n=ha(t,"indices","gatherND","int32"),r={params:ha(e,"x","gatherND","string_or_numeric"),indices:n};return ir.runKernel("GatherNd",r)}});function Vu(e,t,n){const r=1-e%2,a=new Float32Array(e);for(let s=0;s<e;++s){const o=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(o)}return Au(a,"float32")}const Wu=fa({conv2DBackpropFilter_:function(e,t,n,r,a,s="NHWC",o){let i=e;3===e.rank&&(i=ro(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;3===u.rank&&(u=ro(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Qe(4===i.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${i.shape}.`)),Qe(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),Qe(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const l="NHWC"===s?i.shape[3]:i.shape[1],c="NHWC"===s?u.shape[3]:u.shape[1];Qe(l===n[2],(()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`)),Qe(c===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`)),no("conv2dDerFilter",a,o);const h={x:i,dy:u},p={strides:r,pad:a,dataFormat:s,dimRoundingMode:o,filterShape:n};return ir.runKernel("Conv2DBackpropFilter",h,p)}});function ju(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return $s(e,ku(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Gu(e,t){let n=t;const r=os(e.shape,t.shape);return r.length>0&&(n=Zo(n,r)),ro(n,e.shape)}function Hu(e,t,n,r){if("linear"===t)return e;if("relu"===t)return lu(e);if("elu"===t)return Po(e);if("relu6"===t)return cu(e);if("prelu"===t)return Hi(e,n);if("leakyrelu"===t)return di(e,r);if("sigmoid"===t)return uo(e);throw new Error(`Unknown fused activation ${t}.`)}const Ku=(e,t)=>!(e>0)||"linear"===t,qu=fa({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",!1===Ku(ir.state.gradientDepth,u)){Qe("NHWC"===a,(()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let h=xo(e,t,n,r,a,s,o);return null!=i&&(h=Cs(h,i)),Hu(h,u,l,c)}const h=ha(e,"x","conv2d","float32"),p=ha(t,"filter","conv2d","float32");let f=h,d=!1;3===h.rank&&(d=!0,f=ro(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Qe(4===f.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`)),Qe(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),no("fused conv2d",r,o);const m="NHWC"===a?f.shape[3]:f.shape[1];Qe(p.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${p.shape[2]}.`)),Qe(eo(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const g=Hs(f.shape,p.shape,n,s,r,o);let y,b;if(null!=i&&(y=ha(i,"bias","fused conv2d"),[y]=er(y,h),"NHWC"===a?is(g.outShape,y.shape):(Qe(y.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`)),Qe(0===y.shape.length||y.shape[0]===g.outChannels||1===y.shape[0],(()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)))),null!=l){const e=l.shape;if(Qe(e.length<=1||3===e.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`)),1===e.length)Qe(1===e[0]||e[0]===g.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${g.outChannels}).`));else if(3===e.length)try{is(e,g.outShape)}catch(t){const n=`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}b=ha(l,"prelu weights","fused conv2d")}const v=(e,t)=>{Qe("NHWC"===a,(()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`));const[o,i,l,c]=t,h=ju(e,l,u);Qe(Zs(s),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const p=[wo(i.shape,h,o,n,r),Wu(i,h,o.shape,n,r)];if(null!=c){const e=Gu(c,h);p.push(e)}return p},x={x:f,filter:p,bias:y,preluActivationWeights:b},_={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};if(null==i){const e=_i(((e,t,n)=>{let r=ir.runKernel("FusedConv2D",x,_);return n([t,e,r]),d&&(r=ro(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return e(f,p)}{const e=_i(((e,t,n,r)=>{let a=ir.runKernel("FusedConv2D",x,_);return r([t,e,a,n]),d&&(a=ro(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:v}}));return e(f,p,y)}}}),Xu=fa({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a,s=[1,1],o){let i=e;3===e.rank&&(i=ro(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;3===u.rank&&(u=ro(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:i,dy:u},c={strides:r,pad:a,dimRoundingMode:o,dilations:s,filterShape:n};return ir.runKernel("DepthwiseConv2dNativeBackpropFilter",l,c)}}),Yu=fa({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a,s=[1,1],o){let i=t,u=!1;3===t.rank&&(u=!0,i=ro(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:i,filter:n},c={strides:r,pad:a,dimRoundingMode:o,dilations:s,inputShape:e},h=ir.runKernel("DepthwiseConv2dNativeBackpropInput",l,c);return u?ro(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Qu=fa({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:i,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(!1===Ku(ir.state.gradientDepth,u)){let h=$o(e,t,n,r,a,s,o);return null!=i&&(h=Cs(h,i)),Hu(h,u,l,c)}const h=ha(e,"x","depthwiseConv2d","float32"),p=ha(t,"filter","depthwiseConv2d","float32");let f=h,d=!1;3===h.rank&&(d=!0,f=ro(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Qe(4===f.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`)),Qe(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),Qe(f.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==s&&(s=[1,1]),Qe(eo(n,s),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),no("fused depthwiseConv2d",r,o);const m=Hs(f.shape,p.shape,n,s,r,o,!0);let g,y;null!=i&&(g=ha(i,"bias","fused conv2d"),[g]=er(g,h),is(m.outShape,g.shape)),null!=l&&(y=ha(l,"prelu weights","fused depthwiseConv2d"));const b=(e,t)=>{Qe(Zs(s),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`));const[a,i,l,c]=t,h=ju(e,l,u),p=Yu(i.shape,h,a,n,r,s,o),f=Xu(i,h,a.shape,n,r,s,o);return null!=c?[p,f,Gu(g,h)]:[p,f]},v={x:f,filter:p,bias:g,preluActivationWeights:y},x={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};if(null==i){const e=_i(((e,t,n)=>{let r=ir.runKernel("FusedDepthwiseConv2D",v,x);return n([t,e,r]),d&&(r=ro(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return e(f,p)}{const e=_i(((e,t,n,r)=>{let a=ir.runKernel("FusedDepthwiseConv2D",v,x);return r([t,e,a,n]),d&&(a=ro(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}}));return e(f,p,g)}}}),Ju=fa({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:i}){if(!1===Ku(ir.state.gradientDepth,s)){let u=Xa(e,t,n,r);return null!=a&&(u=Cs(u,a)),Hu(u,s,o,i)}let u=ha(e,"a","fused matMul"),l=ha(t,"b","fused matMul");[u,l]=er(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],h=r?l.shape[l.rank-1]:l.shape[l.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-2]:l.shape[l.rank-1],d=u.shape.slice(0,-2),m=l.shape.slice(0,-2),g=tt(d),y=tt(m);Qe(c===h,(()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=is(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([p,f]),v=ro(u,n?[g,c,p]:[g,p,c]),x=ro(l,r?[y,f,h]:[y,h,f]);let _,w;null!=a&&(_=ha(a,"bias","fused matMul"),[_]=er(_,u),is(b,_.shape)),null!=o&&(w=ha(o,"prelu weights","fused matMul"));const T=(e,t)=>{const[o,i,u,l]=t,c=ju(ro(e,u.shape),u,s);let h,p;return n||r?!n&&r?(h=Xa(c,i,!1,!1),p=Xa(c,o,!0,!1)):n&&!r?(h=Xa(i,c,!1,!0),p=Xa(o,c,!1,!1)):(h=Xa(i,c,!0,!0),p=Xa(c,o,!0,!0)):(h=Xa(c,i,!1,!0),p=Xa(o,c,!0,!1)),null!=a?[h,p,Gu(l,c)]:[h,p]},E={a:v,b:x,bias:_,preluActivationWeights:w},S={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:i};if(null==a){const e=_i(((e,t,n)=>{const r=ir.runKernel("_FusedMatMul",E,S);return n([e,t,r]),{value:ro(r,b),gradFunc:T}}));return e(v,x)}{const e=_i(((e,t,n,r)=>{const a=ir.runKernel("_FusedMatMul",E,S);return r([e,t,a,n]),{value:ro(a,b),gradFunc:T}}));return e(v,x,_)}}});fa({hammingWindow_:function(e){return Vu(e,.54,.46)}});const Zu=fa({hannWindow_:function(e){return Vu(e,.5,.5)}}),el=fa({frame_:function(e,t,n,r=!1,a=0){let s=0;const o=[];for(;s+t<=e.size;)o.push(lo(e,s,t)),s+=n;if(r)for(;s<e.size;){const r=s+t-e.size,i=io([lo(e,s,t-r),ui([r],a)]);o.push(i),s+=n}return 0===o.length?$u([],[0,t]):ro(io(o),[o.length,t])}});fa({stft_:function(e,t,n,r,a=Zu){var s;null==r&&(s=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));const o=el(e,t,n),i=$s(o,a(t));return Tu(i,r)}});const tl=fa({cropAndResize_:function(e,t,n,r,a="bilinear",s=0){const o=ha(e,"image","cropAndResize"),i=ha(t,"boxes","cropAndResize","float32"),u=ha(n,"boxInd","cropAndResize","int32"),l=i.shape[0];Qe(4===o.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`)),Qe(2===i.rank&&4===i.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${i.shape}.`)),Qe(1===u.rank&&u.shape[0]===l,(()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${i.shape}.`)),Qe(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),Qe(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),Qe("bilinear"===a||"nearest"===a,(()=>`method must be bilinear or nearest, but was ${a}`));const c={image:o,boxes:i,boxInd:u},h={method:a,extrapolationValue:s,cropSize:r};return ir.runKernel("CropAndResize",c,h)}}),nl=fa({flipLeftRight_:function(e){const t=ha(e,"image","flipLeftRight","float32");Qe(4===t.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`));const n={image:t};return ir.runKernel("FlipLeftRight",n,{})}}),rl=fa({grayscaleToRGB_:function(e){const t=ha(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];Qe(t.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`)),Qe(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,oi(t,a)}}),al=fa({rotateWithOffset_:function(e,t,n=0,r=.5){const a=ha(e,"image","rotateWithOffset","float32");Qe(4===a.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`));const s={image:a},o={radians:t,fillValue:n,center:r};return ir.runKernel("RotateWithOffset",s,o)}});function sl(e,t,n,r,a,s){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==s&&(s=0);const o=e.shape[0];return n=Math.min(n,o),Qe(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),Qe(2===e.rank,(()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`)),Qe(4===e.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`)),Qe(1===t.rank,(()=>"scores must be a 1D tensor")),Qe(t.shape[0]===o,(()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`)),Qe(0<=s&&s<=1,(()=>`softNmsSigma must be in [0, 1], but was '${s}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}const ol=fa({nonMaxSuppression_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const s=ha(e,"boxes","nonMaxSuppression","float32"),o=ha(t,"scores","nonMaxSuppression","float32"),i=sl(s,o,n,r,a),u={maxOutputSize:n=i.maxOutputSize,iouThreshold:r=i.iouThreshold,scoreThreshold:a=i.scoreThreshold};return ir.runKernel("NonMaxSuppressionV3",{boxes:s,scores:o},u)}});function il(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,s=0,o=!1;for(;r<a;){s=r+(a-r>>>1);const i=n(t,e[s]);i>0?r=s+1:(a=s,o=!i)}return o?r:-r-1}(e,t,n||ul)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function ul(e,t){return e>t?1:e<t?-1:0}function ll(e,t,n,r,a,s,o=!1,i=!1,u=!1){const l=[];for(let e=0;e<t.length;e++)t[e]>a&&l.push({score:t[e],boxIndex:e,suppressBeginIndex:0});l.sort(pl);const c=s>0?-.5/s:0,h=[],p=[];for(;h.length<n&&l.length>0;){const t=l.pop(),{score:n,boxIndex:s,suppressBeginIndex:o}=t;if(n<a)break;let i=!1;for(let n=h.length-1;n>=o;--n){const o=cl(e,s,h[n]);if(o>=r){i=!0;break}if(t.score=t.score*hl(r,c,o),t.score<=a)break}t.suppressBeginIndex=h.length,i||(t.score===n?(h.push(s),p.push(t.score)):t.score>a&&il(l,t,pl))}const f=h.length,d=n-f;i&&d>0&&(h.push(...new Array(d).fill(0)),p.push(...new Array(d).fill(0)));const m={selectedIndices:h};return o&&(m.selectedScores=p),u&&(m.validOutputs=f),m}function cl(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(i-s)*(u-o),d=(h-l)*(p-c);if(f<=0||d<=0)return 0;const m=Math.max(s,l),g=Math.max(o,c),y=Math.min(i,h),b=Math.min(u,p),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(f+d-v)}function hl(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function pl(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const fl=fa({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){const o=ha(e,"boxes","nonMaxSuppression"),i=ha(t,"scores","nonMaxSuppression"),u=sl(o,i,n,r,a,s),l={boxes:o,scores:i},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:s=u.softNmsSigma},h=ir.runKernel("NonMaxSuppressionV5",l,c);return{selectedIndices:h[0],selectedScores:h[1]}}}),dl=fa({nonMaxSuppressionPadded_:function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){const o=ha(e,"boxes","nonMaxSuppression"),i=ha(t,"scores","nonMaxSuppression"),u=sl(o,i,n,r,a,null),l={boxes:o,scores:i},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:s},h=ir.runKernel("NonMaxSuppressionV4",l,c);return{selectedIndices:h[0],validOutputs:h[1]}}}),ml=fa({resizeBilinear_:function(e,t,n=!1,r=!1){const a=ha(e,"images","resizeBilinear");Qe(3===a.rank||4===a.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`)),Qe(2===t.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`)),Qe(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let s=a,o=!1;3===a.rank&&(o=!0,s=ro(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const i={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=ir.runKernel("ResizeBilinear",i,u);return o?ro(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),gl=fa({resizeNearestNeighbor_:function(e,t,n=!1,r=!1){const a=ha(e,"images","resizeNearestNeighbor");Qe(3===a.rank||4===a.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`)),Qe(2===t.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`)),Qe("float32"===a.dtype||"int32"===a.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),Qe(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let s=a,o=!1;3===a.rank&&(o=!0,s=ro(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const i={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=ir.runKernel("ResizeNearestNeighbor",i,u);return o?ro(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),yl=fa({threshold_:function(e,t="binary",n=!1,r=.5){const a=ha(e,"image","threshold"),s=a.shape[0]*a.shape[1];let o,i,u,l,c=$s(Au([r]),255);if(Qe(3===a.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`)),Qe(3===a.shape[2]||1===a.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`)),Qe("int32"===a.dtype||"float32"===a.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`)),Qe("otsu"===t||"binary"===t,(()=>`Method must be binary or otsu, but was ${t}`)),3===a.shape[2]){[o,i,u]=wu(a,[1,1,1],-1);const e=$s(o,.2989),t=$s(i,.587),n=$s(u,.114);l=Cs(Cs(e,t),n)}else l=e;"otsu"===t&&(c=function(e,t){let n,r,a,s,o,i,u=Au([-1]),l=Au([0]),c=Au([0]);for(let h=0;h<e.size-1;h++){n=lo(e,0,h+1),r=lo(e,h+1),o=As(Zo(n),t),i=As(Zo(r),t);const p=Zo($s(n,iu(0,n.size)));a=As(p,Zo(n));const f=ui(r.shape,n.size),d=Cs(iu(0,r.size),f),m=$s(r,d);s=As(Zo(m),Zo(r));const g=Ti(a,s),y=Ti(a,s),b=$s(o,i);c=$s($s(b,g),y);const v=hi(c,l);l=Oo(v,c,l),u=Oo(v,Au([h]),u)}return u}(fo(qa(pu(l),"int32"),ga([]),256),s));const h=n?gi(l,c):hi(l,c);return qa($s(h,255),"int32")}}),bl=fa({transform_:function(e,t,n="nearest",r="constant",a=0,s){const o=ha(e,"image","transform","float32"),i=ha(t,"transforms","transform","float32");Qe(4===o.rank,(()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`)),Qe(2===i.rank&&(i.shape[0]===o.shape[0]||1===i.shape[0])&&8===i.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),Qe(null==s||2===s.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`));const u={image:o,transforms:i},l={interpolation:n,fillMode:r,fillValue:a,outputShape:s};return ir.runKernel("Transform",u,l)}});function vl(e,t=!1){return ir.tidy((()=>{Qe(2===e.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`));const n=e.shape[0],r=e.shape[1];let a=ii(n),s=oo(e);const o=$u([[1]],[1,1]);let i=oo(o);const u=n>=r?r:n;for(let e=0;e<u;++e){const t=s,u=i,l=a;[i,s,a]=ir.tidy((()=>{const t=lo(s,[e,e],[n-e,1]),u=ti(t),l=lo(s,[e,e],[1,1]),c=Oo(hi(l,0),$u([[-1]]),$u([[1]])),h=Ti(l,$s(c,u)),p=As(t,h);i=1===p.shape[0]?oo(o):io([o,lo(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);const f=ns(As(Xa(c,h),u)),d=lo(s,[e,0],[n-e,r]),m=$s(f,i),g=as(i);if(0===e)s=Ti(d,Xa(m,Xa(g,d)));else{const t=Ti(d,Xa(m,Xa(g,d)));s=io([lo(s,[0,0],[e,r]),t],0)}const y=as(m),b=lo(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Ti(b,Xa(Xa(b,i),y));else{const t=Ti(b,Xa(Xa(b,i),y));a=io([lo(a,[0,0],[n,e]),t],1)}return[i,s,a]})),tr([t,u,l]).forEach((e=>e.dispose()))}return!t&&n>r&&(a=lo(a,[0,0],[n,r]),s=lo(s,[0,0],[r,r])),[a,s]}))}var xl;fa({bandPart_:function(e,t,n){Qe(t%1==0,(()=>`bandPart(): numLower must be an integer, got ${t}.`)),Qe(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=ha(e,"a","bandPart");Qe(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const a=r.shape,[s,o]=r.shape.slice(-2);if(!(t<=s))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);t<0&&(t=s),n<0&&(n=o);const i=ro(iu(0,s,1,"int32"),[-1,1]),u=iu(0,o,1,"int32"),l=Ti(i,u),c=Ii(gi(l,Yo(+t,"int32")),pi(l,Yo(-n,"int32"))),h=Mi([s,o],r.dtype);return ro(Iu(Du(ro(r,[-1,s,o])).map((e=>Oo(c,e,h)))),a)}}),fa({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,Qe(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)Qe(e[t].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`))}else t=!0,e=wu(e,e.shape[0],0).map((e=>Su(e,[0])));Qe(e.length<=e[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`));const n=[],r=e;for(let t=0;t<e.length;++t)n.push(ir.tidy((()=>{let e=r[t];if(t>0)for(let r=0;r<t;++r){const t=$s(Zo($s(n[r],e)),n[r]);e=Ti(e,t)}return As(e,ti(e,"euclidean"))})));return t?Iu(n,0):n}}),fa({qr_:function(e,t=!1){if(Qe(e.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`)),2===e.rank)return vl(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=Du(ro(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];return r.forEach((e=>{const[n,r]=vl(e,t);a.push(n),s.push(r)})),[ro(Iu(a,0),e.shape),ro(Iu(s,0),e.shape)]}}}),function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xl||(xl={}));const _l=fa({computeWeightedLoss_:function(e,t,n=xl.SUM_BY_NONZERO_WEIGHTS){const r=ha(e,"losses","computeWeightedLoss");let a=null;null!=t&&(a=ha(t,"weights","computeWeightedLoss"));const s=null==a?r:$s(r,a);if(n===xl.NONE)return s;if(n===xl.SUM)return Zo(s);if(n===xl.MEAN){if(null==a)return Di(s);{const e=r.size/a.size,t=As(Zo(s),Zo(a));return e>1?As(t,Yo(e)):t}}if(n===xl.SUM_BY_NONZERO_WEIGHTS){if(null==a)return As(Zo(s),Yo(r.size));{const e=$s(a,Li(r.shape)),t=qa(Zo(Vi(e,Yo(0))),"float32");return As(Zo(s),t)}}throw Error(`Unknown reduction: ${n}`)}});fa({absoluteDifference_:function(e,t,n,r=xl.SUM_BY_NONZERO_WEIGHTS){const a=ha(e,"labels","absoluteDifference"),s=ha(t,"predictions","absoluteDifference");let o=null;null!=n&&(o=ha(n,"weights","absoluteDifference")),Je(a.shape,s.shape,"Error in absoluteDifference: ");const i=Rs(Ti(a,s));return _l(i,o,r)}}),fa({cosineDistance_:function(e,t,n,r,a=xl.SUM_BY_NONZERO_WEIGHTS){const s=ha(e,"labels","cosineDistance"),o=ha(t,"predictions","cosineDistance");let i=null;null!=r&&(i=ha(r,"weights","cosineDistance")),Je(s.shape,o.shape,"Error in cosineDistance: ");const u=Yo(1),l=Ti(u,Zo($s(s,o),n,!0));return _l(l,i,a)}}),fa({hingeLoss_:function(e,t,n,r=xl.SUM_BY_NONZERO_WEIGHTS){let a=ha(e,"labels","hingeLoss");const s=ha(t,"predictions","hingeLoss");let o=null;null!=n&&(o=ha(n,"weights","hingeLoss")),Je(a.shape,s.shape,"Error in hingeLoss: ");const i=Yo(1);a=Ti($s(Yo(2),a),i);const u=lu(Ti(i,$s(a,s)));return _l(u,o,r)}}),fa({huberLoss_:function(e,t,n,r=1,a=xl.SUM_BY_NONZERO_WEIGHTS){const s=ha(e,"labels","huberLoss"),o=ha(t,"predictions","huberLoss");let i=null;null!=n&&(i=ha(n,"weights","huberLoss")),Je(s.shape,o.shape,"Error in huberLoss: ");const u=Yo(r),l=Rs(Ti(o,s)),c=Pi(l,u),h=Ti(l,c),p=Cs($s(Yo(.5),Jo(c)),$s(u,h));return _l(p,i,a)}}),fa({logLoss_:function(e,t,n,r=1e-7,a=xl.SUM_BY_NONZERO_WEIGHTS){const s=ha(e,"labels","logLoss"),o=ha(t,"predictions","logLoss");let i=null;null!=n&&(i=ha(n,"weights","logLoss")),Je(s.shape,o.shape,"Error in logLoss: ");const u=Yo(1),l=Yo(r),c=ns($s(s,vi(Cs(o,l)))),h=$s(Ti(u,s),vi(Cs(Ti(u,o),l))),p=Ti(c,h);return _l(p,i,a)}}),fa({meanSquaredError_:function(e,t,n,r=xl.SUM_BY_NONZERO_WEIGHTS){const a=ha(e,"labels","meanSquaredError"),s=ha(t,"predictions","meanSquaredError");let o=null;null!=n&&(o=ha(n,"weights","meanSquaredError")),Je(a.shape,s.shape,"Error in meanSquaredError: ");const i=Eu(a,s);return _l(i,o,r)}}),fa({sigmoidCrossEntropy_:function(e,t,n,r=0,a=xl.SUM_BY_NONZERO_WEIGHTS){let s=ha(e,"multiClassLabels","sigmoidCrossEntropy");const o=ha(t,"logits","sigmoidCrossEntropy");let i=null;if(null!=n&&(i=ha(n,"weights","sigmoidCrossEntropy")),Je(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=Yo(r),t=Yo(1),n=Yo(.5);s=Cs($s(s,Ti(t,e)),$s(n,e))}const u=function(e,t){const n=ha(e,"labels","sigmoidCrossEntropyWithLogits"),r=ha(t,"logits","sigmoidCrossEntropyWithLogits");Je(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const a=lu(r),s=$s(r,n),o=xi(ri(ns(Rs(r))));return Cs(Ti(a,s),o)}(s,o);return _l(u,i,a)}}),fa({softmaxCrossEntropy_:function(e,t,n,r=0,a=xl.SUM_BY_NONZERO_WEIGHTS){let s=ha(e,"onehotLabels","softmaxCrossEntropy");const o=ha(t,"logits","softmaxCrossEntropy");let i=null;if(null!=n&&(i=ha(n,"weights","softmaxCrossEntropy")),Je(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const e=Yo(r),t=Yo(1),n=Yo(s.shape[1]);s=Cs($s(s,Ti(t,e)),As(e,n))}const u=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);const r=_i(((e,t,r)=>{const a=Si(t,[n],!0),s=Ti(qa(t,"float32"),a);r([e,s]);const o=ns($s(s,e));return{value:Zo(o,[n]),gradFunc:(e,t)=>{const[r,a]=t,s=Wo(e.shape,[n]);return[$s(ro(e,s),Ti(qa(r,"float32"),ri(a))),$s(ro(e,s),Ti(ri(a),qa(r,"float32")))]}}}));return r(e,t)}(s,o);return _l(u,i,a)}});const wl=fa({sparseFillEmptyRows_:function(e,t,n,r){const a=ha(e,"indices","sparseFillEmptyRows","int32"),s=ha(t,"values","sparseFillEmptyRows"),o=ha(n,"denseShape","sparseFillEmptyRows","int32"),i=ha(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(2!==a.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${a.shape}`);if(1!==s.rank)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(1!==o.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(0!==i.rank)throw new Error(`Default value should be a scalar but received shape ${i.shape}`);const u={indices:a,values:s,denseShape:o,defaultValue:i},l=ir.runKernel("SparseFillEmptyRows",u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}}),Tl=fa({sparseReshape_:function(e,t,n){const r=ha(e,"inputIndices","sparseReshape","int32"),a=ha(t,"inputShape","sparseReshape","int32"),s=ha(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==a.rank)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(1!==s.rank)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:a,newShape:s},i=ir.runKernel("SparseReshape",o);return{outputIndices:i[0],outputShape:i[1]}}}),El=fa({sparseSegmentMean_:function(e,t,n){const r=ha(e,"data","sparseSegmentMean"),a=ha(t,"indices","sparseSegmentMean","int32"),s=ha(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${a.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${s.shape}`);const o={data:r,indices:a,segmentIds:s};return ir.runKernel("SparseSegmentMean",o)}}),Sl=fa({sparseSegmentSum_:function(e,t,n){const r=ha(e,"data","sparseSegmentSum"),a=ha(t,"indices","sparseSegmentSum","int32"),s=ha(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${a.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${s.shape}`);const o={data:r,indices:a,segmentIds:s};return ir.runKernel("SparseSegmentSum",o)}}),Il=fa({stringNGrams_:function(e,t,n,r,a,s,o,i){const u=ha(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=ha(t,"dataSplits","stringNGrams");if("int32"!==l.dtype)throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:a,rightPad:s,padWidth:o,preserveShortSequences:i},h={data:u,dataSplits:l},p=ir.runKernel("StringNGrams",h,c);return{nGrams:p[0],nGramsSplits:p[1]}}}),kl=fa({stringSplit_:function(e,t,n=!0){const r=ha(e,"input","stringSplit","string"),a=ha(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==a.rank)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);const s={skipEmpty:n},o={input:r,delimiter:a},i=ir.runKernel("StringSplit",o,s);return{indices:i[0],values:i[1],shape:i[2]}}}),Cl=fa({stringToHashBucketFast_:function(e,t){const n=ha(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const a={input:n};return ir.runKernel("StringToHashBucketFast",a,r)}}),Nl={flipLeftRight:nl,grayscaleToRGB:rl,resizeNearestNeighbor:gl,resizeBilinear:ml,rotateWithOffset:al,cropAndResize:tl,nonMaxSuppression:ol,nonMaxSuppressionAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){const s=ha(e,"boxes","nonMaxSuppressionAsync"),o=ha(t,"scores","nonMaxSuppressionAsync"),i=sl(s,o,n,r,a);n=i.maxOutputSize,r=i.iouThreshold,a=i.scoreThreshold;const u=await Promise.all([s.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:h}=function(e,t,n,r,a){return ll(e,t,n,r,a,0)}(l,c,n,r,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),Au(h,"int32")},nonMaxSuppressionWithScore:fl,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){const o=ha(e,"boxes","nonMaxSuppressionAsync"),i=ha(t,"scores","nonMaxSuppressionAsync"),u=sl(o,i,n,r,a,s);n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,s=u.softNmsSigma;const l=await Promise.all([o.data(),i.data()]),c=l[0],h=l[1],{selectedIndices:p,selectedScores:f}=function(e,t,n,r,a,s){return ll(e,t,n,r,a,s,!0)}(c,h,n,r,a,s);return o!==e&&o.dispose(),i!==t&&i.dispose(),{selectedIndices:Au(p,"int32"),selectedScores:Au(f)}},nonMaxSuppressionPadded:dl,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){const o=ha(e,"boxes","nonMaxSuppressionAsync"),i=ha(t,"scores","nonMaxSuppressionAsync"),u=sl(o,i,n,r,a,null),l=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[p,f]=await Promise.all([o.data(),i.data()]),{selectedIndices:d,validOutputs:m}=function(e,t,n,r,a,s){return ll(e,t,n,r,a,0,!1,s,!0)}(p,f,l,c,h,s);return o!==e&&o.dispose(),i!==t&&i.dispose(),{selectedIndices:Au(d,"int32"),validOutputs:Yo(m,"int32")}},threshold:yl,transform:bl},Al={sparseFillEmptyRows:wl,sparseReshape:Tl,sparseSegmentMean:El,sparseSegmentSum:Sl},$l={stringNGrams:Il,stringSplit:kl,stringToHashBucketFast:Cl},Rl="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function Fl(e,t){const n=e[0].length;e.forEach(((e,t)=>{Qe(e.length===n,(()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`))})),Qe(t>=0&&t<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=e[0];e.forEach(((e,a)=>{for(let s=0;s<n;s++)Qe(s===t||e[s]===r[s],(()=>`Error in concat${n}D: Shape of tensors[${a}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${a}.`))}))}function Ol(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Dl(e){return e<=30?e:bt(e,Math.floor(Math.sqrt(e)))}function Ml(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)a=a.concat([e[r+1]/t[r],t[r]]);a=a.concat(e.slice(n+1))}return a}function Ll(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],a=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?a.push(r):n.push(r);r.push(...n),r.push(0),r.push(...a)}return r}function Pl(e,t,n,r=!0){const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let n=1;n<e.length;++n)n<=t.length?r?a.push(t[n-1]*e[n]):a.push(e[n]/t[n-1]):a.push(e[n]);return a}function Bl(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Ul(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function zl(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}const Vl=/->/g;function Wl(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function jl(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function Gl(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function Hl(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function Kl(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function ql(e,t){return`size ${e} must be non-negative, not ${t}`}function Xl(e,t){return`Input to reshape is a SparseTensor with ${tt(e)}\n  dense values, but the requested shape requires a multiple of ${tt(t)}. inputShape=${e} outputShape= ${t}`}function Yl(e,t){return`Input to reshape is a tensor with ${tt(e)} dense values, but the requested shape has ${tt(t)}. inputShape=${e} outputShape=${t}`}function Ql(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Jl(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var Zl=Object.freeze({__proto__:null,segOpComputeOptimalWindowSize:function(e,t){let n,r=!1;for(e<=30?(n=e,r=!0):n=bt(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=bt(e,n+1);return n},computeOutShape:function(e,t,n){const r=[],a=e.length;for(let s=0;s<a;s++)s!==t?r.push(e[s]):r.push(n);return r},collectGatherOpShapeInfo:function(e,t,n,r){const a=t.shape.length,s=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(e.shape[n]!==t.shape[n])throw new Error(`x.shape[${n}]: ${e.shape[n]} should be equal to indices.shape[${n}]: ${t.shape[n]}.`);const o=e.shape[n],i=[];let u=1,l=1,c=1;for(let t=0;t<r;++t)i.push(e.shape[t]),u*=e.shape[t];for(let t=r;t<n;t++)i.push(e.shape[t]),l*=e.shape[t];for(let e=r;e<a;e++)i.push(t.shape[e]);for(let t=n+1;t<s;t++)i.push(e.shape[t]),c*=e.shape[t];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:i}}});function ec(e){try{return e.map((e=>Rn(e)))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function tc(e){return e.map((e=>$n(e)))}var nc=Object.freeze({__proto__:null,slice_util:ks,segment_util:Zl,fromUint8ToStringArray:ec,fromStringArrayToUint8:tc,upcastType:Zn,axesAreInnerMostDims:Uo,combineLocations:zo,computeOutAndReduceShapes:Vo,expandShapeToKeepDim:Wo,assertAxesAreInnerMostDims:jo,getAxesPermutation:Go,getUndoAxesPermutation:function(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))},getInnerMostAxes:Ho,getBroadcastDims:ss,getReductionAxes:os,assertAndGetBroadcastShape:is,assertParamsConsistent:Fl,computeOutShape:Ol,computeDilation2DInfo:function(e,t,n,r,a="NHWC",s){return Hs(e,[...t,e[3]],n,s,r,null,null,to(a))},computePool2DInfo:Gs,computePool3DInfo:function(e,t,n,r,a,s,o="NDHWC"){const[i,u,l]=Ys(t);let c,h;if("NDHWC"===o)h="channelsLast",c=[i,u,l,e[4],e[4]];else{if("NCDHW"!==o)throw new Error(`Unknown dataFormat ${o}`);h="channelsFirst",c=[i,u,l,e[1],e[1]]}return Ks(e,c,n,r,a,!1,h,s)},computeConv2DInfo:Hs,computeConv3DInfo:Ks,computeDefaultPad:qs,tupleValuesAreOne:Zs,eitherStridesOrDilationsAreOne:eo,convertConv2DDataFormat:to,checkPadOnDimRoundingMode:no,getFusedDyActivation:ju,getFusedBiasGradient:Gu,applyActivation:Hu,shouldFuse:Ku,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Dl,getImageCenter:function(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]},getReshaped:Ml,getPermuted:Ll,getReshapedPermuted:Pl,getSliceBeginCoords:Bl,getSliceSize:Ul,prepareAndValidate:function(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===tt(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const a=t.shape,s=a[a.length-1];let o=1;for(let e=0;e<a.length-1;++e)o*=a[e];const i=e.shape,u=a.slice();u.pop();let l=1;for(let e=s;e<n;++e)l*=i[e],u.push(i[e]);const c=[...vt(e.shape).map((e=>e/l)),1].slice(0,s);return[u,o,l,c]},validateUpdateShape:cs,validateInput:hs,calculateShapes:function(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length;let o=1;for(let e=a;e<s;++e)o*=n[e];const i=a<1?1:a;return{sliceRank:a,numUpdates:tt(t.shape)/i,sliceSize:o,strides:[...vt(n.slice(0,a)),1],outputSize:tt(n)}},SELU_SCALEALPHA:1.7580993408473768,SELU_SCALE:1.0507009873554805,ERF_P:.3275911,ERF_A1:.254829592,ERF_A2:-.284496736,ERF_A3:1.421413741,ERF_A4:-1.453152027,ERF_A5:1.061405429,warn:Dt,log:function(...e){At().getBool("IS_TEST")||At().getBool("PROD")||console.log(...e)},mergeRealAndImagArrays:zl,splitRealAndImagArrays:function(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}},complexWithEvenIndex:function(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}},complexWithOddIndex:function(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=2;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}},getComplexWithIndex:function(e,t){return{real:e[2*t],imag:e[2*t+1]}},assignToTypedArray:function(e,t,n,r){e[2*r]=t,e[2*r+1]=n},exponents:function(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const s=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(s),r[a]=Math.sin(s)}return{real:n,imag:r}},exponent:function(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}},decodeEinsumEquation:function(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(Vl,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,a]=e.split("->");Qe(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const s=r.split(","),o=s.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const i=[];for(let e=0;e<a.length;++e){const t=a[e];if(!s.some((e=>-1!==e.indexOf(t))))throw new Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===i.indexOf(t)&&i.push(t)}for(let e=0;e<r.length;++e){const t=r[e];-1===i.indexOf(t)&&","!==t&&i.push(t)}const u=new Array(s.length);for(let e=0;e<o;++e){if(new Set(s[e].split("")).size!==s[e].length)throw new Error(`Found duplicate axes in input component ${s[e]}. Support for duplicate axes in input is not implemented yet.`);u[e]=[];for(let t=0;t<s[e].length;++t)u[e].push(i.indexOf(s[e][t]))}const l=i.length,c=[];for(let e=a.length;e<l;++e)c.push(e);return{allDims:i,summedDims:c,idDims:u}},getEinsumPermutation:function(e,t){let n=new Array(e);n.fill(-1);for(let e=0;e<t.length;++e)n[t[e]]=e;const r=[];for(let t=0;t<e;++t)-1===n[t]&&r.push(t);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}},checkEinsumDimSizes:function(e,t,n){const r=new Array(e);for(let e=0;e<n.length;++e){const a=n[e].shape;for(let n=0;n<t[e].length;++n)void 0===r[t[e][n]]?r[t[e][n]]=a[n]:Qe(r[t[e][n]]===a[n],(()=>`Expected dimension ${r[t[e][n]]} at axis ${n} of input shaped ${JSON.stringify(a)}, but got dimension ${a[n]}`))}},getEinsumComputePath:function(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let e=0;e<a;++e)r.push([]);const s=[];for(let e=0;e<n.length;++e){const a=Wl(t,n[e]);for(const t of a)-1===s.indexOf(t)&&(r[e].push(t),s.push(t))}return{path:n,steps:r}},isIdentityPermutation:function(e){return e.every(((e,t)=>e===t))},prepareSplitSize:function(e,t,n=0){let r=[];if("number"==typeof t)Qe(e.shape[n]%t==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{Qe(t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0)<=1,(()=>"There should be only one negative value in split array."));const a=t.indexOf(-1);if(-1!==a){const r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}Qe(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r},getSparseFillEmptyRowsIndicesDenseShapeMismatch:jl,getSparseFillEmptyRowsNegativeIndexErrorMessage:Gl,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Hl,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Kl,getSparseReshapeNegativeOutputDimErrorMessage:ql,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMultipleErrorMessage:Xl,getSparseReshapeInputOutputMismatchErrorMessage:Yl,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Ql,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Jl});class rc{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if(At().get("IS_BROWSER")){At().setPlatform("browser",new rc);try{Ka.registerManager(Pa.URL_SCHEME,new Ua)}catch(Qn){}try{Ka.registerManager(Ia.URL_SCHEME,new Ca)}catch(Qn){}}let ac;At().get("IS_NODE")&&!At().get("IS_BROWSER")&&At().setPlatform("node",new class{constructor(){this.util=r(345),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=At().global.fetch?At().global.fetch(e,t):(null==ac&&(ac=r(683)),ac(e,t))}now(){const e=je.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}),or();const sc={buffer:yo,cast:qa,clone:oo,print:function(e,t=!1){console.log(e.toString(t))}};var oc,ic;Wn=sc,At().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(oc||(oc={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(ic||(ic={}));const uc={};function lc(e){return uc[e]}function cc(e,t,n,r,a){const s=t.inputParams[e];if(s&&void 0!==s.inputIndexStart){const e=s.inputIndexStart,o=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?e+1:s.inputIndexEnd;if("tensor"===s.type)return hc(t.inputNames[s.inputIndexStart],n,r,a);if("tensors"===s.type)return t.inputNames.slice(e,o).map((e=>hc(e,n,r,a)));const i=hc(t.inputNames.slice(e)[0],n,r,a),u=i.dataSync();return"number"===s.type?u[0]:_t(i.shape,u)}const o=t.attrParams[e];return o&&o.value}function hc(e,t,n,r){const[a,s]=dc(e);if(null!=r){const e=r.getHashTableHandleByName(a);if(null!=e)return e}const o=n.currentContextIds.find((e=>!!t[fc(a,e)]));return void 0!==o?t[fc(a,o)][s]:void 0}function pc(e,t){const[n,r,a]=dc(e);return[fc(n,t&&t.currentContextId),r,a]}function fc(e,t){return t?`${e}-${t}`:e}function dc(e){const t=e.split(":");if(1===t.length)return[e,0,void 0];const n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function mc(e,t,n){let r=cc("pad",e,t,n);if("explicit"===r){r=cc("explicitPaddings",e,t,n);const a=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)a[e][0]=r[2*e],a[e][1]=r[2*e+1];return a}return r}function gc(e){return e.kept?e:oo(e)}var yc=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),bc=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),vc=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]}),xc=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]}),_c=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),wc=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Tc=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]}),Ec=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),Sc=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]}),Ic=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]}),kc=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Cc=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]}),Nc=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Ac=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]}),$c=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Rc=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]}),Fc=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Oc=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]}),Dc=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]});class Mc{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[yc,bc,vc,xc,_c,wc,Tc,Ec,Sc,Ic,kc,Cc,Nc,Ac,$c,Rc,Fc,Oc,Dc].map((e=>e.json)));this.opMappers=e.reduce(((e,t)=>(e[t.tfOpName]=t,e)),{})}transformGraph(e,t={}){const n=e.node,r=[],a=[],s=[],o=n.reduce(((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):null!=t.input&&0!==t.input.length||s.push(e[t.name]),e)),{});let i=[];const u=[];let l={},c={};null!=t&&(l=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));const h=Object.keys(o);h.forEach((e=>{const t=o[e];t.inputNames.forEach(((e,n)=>{const[r,,a]=pc(e),s=o[r];if(null!=s.outputs){const e=s.outputs.indexOf(a);if(-1!==e){const a=`${r}:${e}`;t.inputNames[n]=a}}t.inputs.push(s),s.children.push(t)}))})),0===Object.keys(c).length?h.forEach((e=>{const t=o[e];0===t.children.length&&u.push(t)})):Object.keys(c).forEach((e=>{const[t]=pc(e),n=o[t];null!=n&&(n.signatureKey=c[e],u.push(n))})),Object.keys(l).length>0?Object.keys(l).forEach((e=>{const[t]=pc(e),n=o[t];n&&(n.signatureKey=l[e],i.push(n))})):i=r;let p={};null!=e.library&&null!=e.library.function&&(p=e.library.function.reduce(((e,t)=>(e[t.signature.name]=this.mapFunction(t),e)),{}));const f={nodes:o,inputs:i,outputs:u,weights:a,placeholders:r,signature:t,functions:p};return s.length>0&&(f.initNodes=s),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce(((t,n)=>(t[e[n].name]=n,t)),{})}mapNode(e){const t=lc(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((e=>e.startsWith("^")?e.slice(1):e)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce(((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e)),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce(((t,n)=>{const r=n.type;let a;switch(n.type){case"string":a=Pc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Pc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":a=qc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=qc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":a=Uc(e.attr,n.tfName,n.defaultValue||0),void 0===a&&n.tfDeprecatedName&&(a=Uc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":a=Kc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Kc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":a=Bc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Bc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":a=Yc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Yc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":a=Hc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Hc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":a=Xc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Xc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":a=Wc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Wc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":a=jc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=jc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":a=Vc(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Vc(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${e.op}`)}return t[n.name]={value:a,type:r},t}),{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce(((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e)),{}));const a=[],s=[];e.signature.inputArg.forEach((e=>{const[t]=pc(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:zc(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n})),Object.keys(r).forEach((e=>{const t=r[e];t.inputNames.forEach(((e,n)=>{const[a,,s]=pc(e),o=r[a];if(null!=o.outputs){const e=o.outputs.indexOf(s);if(-1!==e){const r=`${a}:${e}`;t.inputNames[n]=r}}t.inputs.push(o),o.children.push(t)}))}));const o=e.ret;e.signature.outputArg.forEach((e=>{const[t,n]=pc(o[e.name]),a=r[t];null!=a&&(a.defaultOutput=n,s.push(a))}));const i=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:s,weights:n,placeholders:[],signature:i}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e)),{}),outputs:e.signature.outputArg.reduce(((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t)),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function Lc(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=At().global;return void 0!==t.atob?t.atob(e):new Sr(e,"base64").toString()}(e);return t?n:n.toLowerCase()}function Pc(e,t,n,r=!1){const a=e[t];return null!=a?Lc(a.s,r):n}function Bc(e,t,n){const r=e[t];return r?r.b:n}function Uc(e,t,n){const r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function zc(e){switch("string"==typeof e&&(e=oc[e]),e){case oc.DT_FLOAT:case oc.DT_HALF:return"float32";case oc.DT_INT32:case oc.DT_INT64:case oc.DT_INT8:case oc.DT_UINT8:return"int32";case oc.DT_BOOL:return"bool";case oc.DT_DOUBLE:return"float32";case oc.DT_STRING:return"string";default:return null}}function Vc(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function Wc(e,t,n){const r=e[t];return r&&r.type?zc(r.type):n}function jc(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map((e=>zc(e))):n}function Gc(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((e=>"number"==typeof e.size?e.size:parseInt(e.size,10))):[]}function Hc(e,t,n){const r=e[t];return r&&r.shape?Gc(r.shape):n}function Kc(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((e=>"number"==typeof e?e:parseInt(e,10))):n}function qc(e,t,n,r=!1){const a=e[t];return a&&a.list&&a.list.s?a.list.s.map((e=>Lc(e,r))):n}function Xc(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((e=>Gc(e))):n}function Yc(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class Qc{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map((e=>this.getInput(e))),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(((e,t)=>(e[t]=this.getAttr(t),e)),{}))}getInput(e){return hc(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return hc(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Uc(this.node.rawAttrs,e,t);if(null!=n.s)return Pc(this.node.rawAttrs,e,t);if(null!=n.b)return Bc(this.node.rawAttrs,e,t);if(null!=n.shape)return Hc(this.node.rawAttrs,e,t);if(null!=n.type)return Wc(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Kc(this.node.rawAttrs,e,t);if(null!=n.list.s)return qc(this.node.rawAttrs,e,t);if(null!=n.list.shape)return Xc(this.node.rawAttrs,e,t);if(null!=n.list.b)return Yc(this.node.rawAttrs,e,t);if(null!=n.list.type)return jc(this.node.rawAttrs,e,t)}return t}}function Jc(e,t,n=""){if("number"!=typeof e&&"number"!=typeof t){Qe(e.length===t.length,(()=>n+` Shapes ${e} and ${t} must match`));for(let r=0;r<e.length;r++){const a=e[r],s=t[r];Qe(a<0||s<0||a===s,(()=>n+` Shapes ${e} and ${t} must match`))}}}function Zc(e){return"number"!=typeof e&&!e.some((e=>e<0))}function eh(e,t,n){let r=th(e,n);const a=!Zc(r);if(a&&0===t.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach((e=>{r=th(e.shape,r)})),!Zc(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function th(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);const n=[];for(let r=0;r<e.length;++r){const a=e[r],s=t[r];if(a>=0&&s>=0&&a!==s)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:s}return n}class nh{constructor(e,t,n,r,a,s,o){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=Yo(0),Za(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map((e=>this.read(e)))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},\n          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),Jc(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,Za(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach(((e,n)=>this.write(e,t[n])))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return ga([],[0].concat(this.elementShape));const n=this.readMany(e);return Jc(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Iu(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(0===this.size())return ga([],[0].concat(this.elementShape));const t=[];for(let e=0;e<this.size();e++)t.push(e);const n=this.readMany(t);return Jc(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),io(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Du(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0;const r=e.map((e=>(n+=e,n)));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const a=0===n?0:t.size/n,s=[];Ja((()=>{t=ro(t,[1,n,a]);for(let n=0;n<e.length;++n){const o=[0,0===n?0:r[n-1],0],i=[1,e[n],a];s[n]=ro(lo(t,o,i),this.elementShape)}return s}));const o=[];for(let t=0;t<e.length;t++)o[t]=t;this.writeMany(o,s)}}class rh{constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach((e=>{if(n!==e.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);Jc(t,e.shape,"TensorList shape mismatch: "),Za(e)})),this.idTensor=Yo(0),this.maxNumElements=r,Za(this.idTensor)}get id(){return this.idTensor.id}copy(){return new rh([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach((t=>{null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Jc(e,this.elementShape,"TensorList shape mismatch: ");const r=eh(this.elementShape,this.tensors,e);return Ja((()=>{const e=this.tensors.map((e=>ro(e,r)));return Iu(e,0)}))}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=eh(this.elementShape,this.tensors,e),r=this.tensors.pop();return Jc(r.shape,e,"TensorList shape mismatch: "),ro(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Jc(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Za(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new rh([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw new Error(`element at index ${e} is null.`);Jc(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=eh(this.elementShape,this.tensors,t);return ro(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Jc(this.elementShape,t.shape,"TensorList shape mismatch: "),Za(t),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Jc(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=eh(this.elementShape,this.tensors,n);return 0===e.length?ga([],[0].concat(r)):Ja((()=>{const t=e.map((e=>ro(this.tensors[e],r)));return Iu(t,0)}))}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Jc(this.elementShape,t,"TensorList shape mismatch: ");const n=eh(this.elementShape,this.tensors,t);return 0===this.size()?ga([],[0].concat(n)):Ja((()=>{const e=this.tensors.map((e=>ro(e,n)));return io(e,0)}))}}function ah(e,t,n){const[r,a]=cc("fusedOps",e,t,n),s="biasadd"===r,o=!s,i="prelu"===a,u="fusedbatchnorm"===r,l=cc("numArgs",e,t,n);if(s){if(i&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&s&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=cc("strides",e,t,n),h=mc(e,t,n),p=cc("dataFormat",e,t,n).toUpperCase(),f=cc("dilations",e,t,n);let[d,m]=cc("args",e,t,n);return o&&(m=d,d=void 0),{stride:c,pad:h,dataFormat:p,dilations:f,biasArg:d,preluArg:m,activationFunc:a,leakyreluAlpha:cc("leakyreluAlpha",e,t,n)}}function sh(e,t,n){return{boxes:cc("boxes",e,t,n),scores:cc("scores",e,t,n),maxOutputSize:cc("maxOutputSize",e,t,n),iouThreshold:cc("iouThreshold",e,t,n),scoreThreshold:cc("scoreThreshold",e,t,n),softNmsSigma:cc("softNmsSigma",e,t,n)}}class oh{constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Yo(0),this.tensorMap=new Map,Za(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Yo(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach((e=>e.dispose())),this.tensorMap.clear(),Ja((()=>{const e=Du(t),r=n.length,a=e.length;Qe(r===a,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${a} elements.`));for(let t=0;t<r;t++){const r=n[t],a=e[t];Za(a),this.tensorMap.set(r,a)}return this.handle}))}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return Ja((()=>{const e=[];for(let r=0;r<n.length;r++){const a=n[r],s=this.findWithDefault(a,t);e.push(s)}return Iu(e)}))}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}function ih(e,t,n,r){const a=((e,t,n)=>{switch(e.category){case"arithmetic":return Ja((()=>((e,t,n)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[Cs(cc("a",e,t,n),cc("b",e,t,n))];case"AddN":return[Ds(cc("tensors",e,t,n))];case"FloorMod":case"Mod":return[Ui(cc("a",e,t,n),cc("b",e,t,n))];case"Mul":return[$s(cc("a",e,t,n),cc("b",e,t,n))];case"RealDiv":case"Div":return[As(cc("a",e,t,n),cc("b",e,t,n))];case"DivNoNan":return[Mo(cc("a",e,t,n),cc("b",e,t,n))];case"FloorDiv":return[Ns(cc("a",e,t,n),cc("b",e,t,n))];case"Sub":return[Ti(cc("a",e,t,n),cc("b",e,t,n))];case"Minimum":return[Pi(cc("a",e,t,n),cc("b",e,t,n))];case"Maximum":return[Oi(cc("a",e,t,n),cc("b",e,t,n))];case"Pow":return[Xo(cc("a",e,t,n),cc("b",e,t,n))];case"SquaredDifference":return[Eu(cc("a",e,t,n),cc("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"basic_math":return Ja((()=>((e,t,n)=>{switch(e.op){case"Abs":case"ComplexAbs":return[Rs(cc("x",e,t,n))];case"Acos":return[Fs(cc("x",e,t,n))];case"Acosh":return[Os(cc("x",e,t,n))];case"Asin":return[Us(cc("x",e,t,n))];case"Asinh":return[zs(cc("x",e,t,n))];case"Atan":return[Vs(cc("x",e,t,n))];case"Atan2":return[Ws(cc("x",e,t,n),cc("y",e,t,n))];case"Atanh":return[js(cc("x",e,t,n))];case"Ceil":return[bo(cc("x",e,t,n))];case"Complex":return[da(cc("real",e,t,n),cc("imag",e,t,n))];case"Cos":return[So(cc("x",e,t,n))];case"Cosh":return[Io(cc("x",e,t,n))];case"Elu":return[Po(cc("x",e,t,n))];case"Erf":return[Bo(cc("x",e,t,n))];case"Exp":return[ri(cc("x",e,t,n))];case"Expm1":return[si(cc("x",e,t,n))];case"Floor":return[li(cc("x",e,t,n))];case"Log":return[vi(cc("x",e,t,n))];case"Log1p":return[xi(cc("x",e,t,n))];case"Imag":return[ts(cc("x",e,t,n))];case"Neg":return[ns(cc("x",e,t,n))];case"Reciprocal":return[uu(cc("x",e,t,n))];case"Real":return[rs(cc("x",e,t,n))];case"Relu":return[lu(cc("x",e,t,n))];case"Round":return[pu(cc("x",e,t,n))];case"Selu":return[du(cc("x",e,t,n))];case"Sigmoid":return[uo(cc("x",e,t,n))];case"Sin":return[gu(cc("x",e,t,n))];case"Sign":return[mu(cc("x",e,t,n))];case"Sinh":return[yu(cc("x",e,t,n))];case"Softplus":return[wi(cc("x",e,t,n))];case"Sqrt":return[Qo(cc("x",e,t,n))];case"Square":return[Jo(cc("x",e,t,n))];case"Tanh":return[co(cc("x",e,t,n))];case"Tan":return[Nu(cc("x",e,t,n))];case"ClipByValue":return[vo(cc("x",e,t,n),cc("clipValueMin",e,t,n),cc("clipValueMax",e,t,n))];case"Relu6":return[cu(cc("x",e,t,n))];case"Rsqrt":return[fu(hc(e.inputNames[0],t,n))];case"Prod":return[Ki(cc("x",e,t,n),cc("axes",e,t,n))];case"LeakyRelu":return[di(cc("x",e,t,n),cc("alpha",e,t,n))];case"Prelu":return[Hi(cc("x",e,t,n),cc("alpha",e,t,n))];case"IsNan":return[fi(hc(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"control":return(async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=cc("thenBranch",e,t,n),a=cc("elseBranch",e,t,n),s=cc("cond",e,t,n),o=cc("args",e,t,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=cc("body",e,t,n),a=cc("cond",e,t,n),s=cc("args",e,t,n),o=await n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),i=s.map((e=>e.id));let u=await o[0].data();o.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||e.dispose()}));let l=s;for(;u[0];){const e=l;l=await n.functionMap[r].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);const t=l.map((e=>e.id));e.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}));const s=await n.functionMap[a].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap);u=await s[0].data(),s.forEach((e=>{e.kept||-1!==i.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}))}return l}case"LoopCond":return[gc(cc("pred",e,t,n))];case"Switch":{const r=cc("pred",e,t,n);let a=cc("data",e,t,n);return a.kept||(a=gc(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{const r=e.inputNames.find((e=>void 0!==hc(e,t,n)));return r?[gc(hc(r,t,n))]:void 0}case"Enter":{const r=cc("frameName",e,t,n),a=cc("tensor",e,t,n);return n.enterFrame(r),[gc(a)]}case"Exit":{const r=cc("tensor",e,t,n);return n.exitFrame(),[gc(r)]}case"NextIteration":{const r=cc("tensor",e,t,n);return n.nextIteration(),[gc(r)]}case"TensorArrayV3":{const r=cc("size",e,t,n),a=cc("dtype",e,t,n),s=cc("elementShape",e,t,n),o=cc("dynamicSize",e,t,n),i=cc("clearAfterRead",e,t,n),u=cc("identicalElementShapes",e,t,n),l=cc("name",e,t,n),c=new nh(l,a,r,s,u,o,i);return n.addTensorArray(c),[c.idTensor,Yo(1)]}case"TensorArrayWriteV3":{const r=cc("tensorArrayId",e,t,n),a=cc("index",e,t,n),s=cc("tensor",e,t,n),o=n.getTensorArray(r.id);return o.write(a,s),[o.idTensor]}case"TensorArrayReadV3":{const r=cc("tensorArrayId",e,t,n),a=cc("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{const r=cc("tensorArrayId",e,t,n),a=cc("indices",e,t,n),s=cc("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,s)]}case"TensorArrayScatterV3":{const r=cc("tensorArrayId",e,t,n),a=cc("indices",e,t,n),s=cc("tensor",e,t,n),o=n.getTensorArray(r.id);return o.scatter(a,s),[o.idTensor]}case"TensorArrayConcatV3":{const r=cc("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),s=cc("dtype",e,t,n);return[a.concat(s)]}case"TensorArraySplitV3":{const r=cc("tensorArrayId",e,t,n),a=cc("tensor",e,t,n),s=cc("lengths",e,t,n),o=n.getTensorArray(r.id);return o.split(s,a),[o.idTensor]}case"TensorArraySizeV3":{const r=cc("tensorArrayId",e,t,n);return[Yo(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=cc("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{const r=cc("tensorListId",e,t,n),a=cc("index",e,t,n),s=cc("tensor",e,t,n),o=n.getTensorList(r.id);return o.setItem(a,s),[o.idTensor]}case"TensorListGetItem":{const r=cc("tensorListId",e,t,n),a=cc("index",e,t,n),s=cc("elementShape",e,t,n),o=cc("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=cc("indices",e,t,n),a=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const a=Math.max(...t);if(null!=r&&-1!==r&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);const s=new rh([],n,e.dtype,r),o=Du(e,0);return t.forEach(((e,t)=>{s.setItem(e,o[t])})),s}(cc("tensor",e,t,n),r,cc("elementShape",e,t,n),cc("numElements",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=cc("elementShape",e,t,n),a=cc("elementDType",e,t,n);let s;s="TensorListReserve"===e.op?"numElements":"maxNumElements";const o=function(e,t,n){return new rh([],e,t,n)}(r,a,cc(s,e,t,n));return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=cc("tensorListId",e,t,n),a=cc("indices",e,t,n),s=cc("elementShape",e,t,n),o=cc("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,o,s)]}case"TensorListStack":{const r=cc("tensorListId",e,t,n),a=cc("elementShape",e,t,n),s=cc("elementDType",e,t,n),o=cc("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,s,o)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);Jc(e.shape.slice(1),t,"TensorList shape mismatch: ");const a=Du(e);return new rh(a,t,r)}(cc("tensor",e,t,n),cc("elementShape",e,t,n),cc("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=cc("tensorListId",e,t,n),a=n.getTensorList(r.id),s=cc("dtype",e,t,n),o=cc("elementShape",e,t,n);return[a.concat(s,o)]}case"TensorListPushBack":{const r=cc("tensorListId",e,t,n),a=cc("tensor",e,t,n),s=n.getTensorList(r.id);return s.pushBack(a),[s.idTensor]}case"TensorListPopBack":{const r=cc("tensorListId",e,t,n),a=cc("elementShape",e,t,n),s=cc("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,s)]}case"TensorListSplit":{const r=cc("tensor",e,t,n),a=cc("elementShape",e,t,n),s=function(e,t,n){let r=0;const a=t.map((e=>(r+=e,r)));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${e.shape}`);const s=th(e.shape.slice(1),n),o=0===r?0:e.size/r,i=Ja((()=>{const n=[];e=ro(e,[1,r,o]);for(let r=0;r<t.length;++r){const i=[0,0===r?0:a[r-1],0],u=[1,t[r],o];n[r]=ro(lo(e,i,u),s)}return e.dispose(),n})),u=new rh([],n,e.dtype,t.length);for(let e=0;e<i.length;e++)u.setItem(e,i[e]);return u}(r,cc("lengths",e,t,n),a);return n.addTensorList(s),[s.idTensor]}case"TensorListLength":{const r=cc("tensorListId",e,t,n);return[Yo(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=cc("tensorListId",e,t,n),a=cc("size",e,t,n),s=n.getTensorList(r.id).resize(a);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"convolution":return Ja((()=>((e,t,n)=>{switch(e.op){case"Conv1D":{const r=cc("stride",e,t,n),a=cc("pad",e,t,n),s=cc("dataFormat",e,t,n).toUpperCase(),o=cc("dilation",e,t,n);return[_o(cc("x",e,t,n),cc("filter",e,t,n),r,a,s,o)]}case"Conv2D":{const r=cc("strides",e,t,n),a=mc(e,t,n),s=cc("dataFormat",e,t,n).toUpperCase(),o=cc("dilations",e,t,n);return[xo(cc("x",e,t,n),cc("filter",e,t,n),[r[1],r[2]],a,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:a,dataFormat:s,dilations:o,biasArg:i,preluArg:u,activationFunc:l,leakyreluAlpha:c}=ah(e,t,n);return[qu({x:cc("x",e,t,n),filter:cc("filter",e,t,n),strides:[r[1],r[2]],pad:a,dataFormat:s,dilations:[o[1],o[2]],bias:i,activation:l,preluActivationWeights:u,leakyreluAlpha:c})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:a,dataFormat:s,dilations:o,biasArg:i,preluArg:u,activationFunc:l,leakyreluAlpha:c}=ah(e,t,n);return[Qu({x:cc("x",e,t,n),filter:cc("filter",e,t,n),strides:[r[1],r[2]],pad:a,dataFormat:s,dilations:[o[1],o[2]],bias:i,activation:l,preluActivationWeights:u,leakyreluAlpha:c})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=cc("outputShape",e,t,n),a=cc("strides",e,t,n),s=mc(e,t,n);return[To(cc("x",e,t,n),cc("filter",e,t,n),r,[a[1],a[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=cc("strides",e,t,n),a=mc(e,t,n),s=cc("dilations",e,t,n),o=cc("dataFormat",e,t,n).toUpperCase();return[$o(cc("input",e,t,n),cc("filter",e,t,n),[r[1],r[2]],a,o,[s[1],s[2]])]}case"Conv3D":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("dataFormat",e,t,n).toUpperCase(),o=cc("dilations",e,t,n);return[Eo(cc("x",e,t,n),cc("filter",e,t,n),[r[1],r[2],r[3]],a,s,[o[1],o[2],o[3]])]}case"AvgPool":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("kernelSize",e,t,n);return[ao(cc("x",e,t,n),[s[1],s[2]],[r[1],r[2]],a)]}case"MaxPool":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("kernelSize",e,t,n);return[$i(cc("x",e,t,n),[s[1],s[2]],[r[1],r[2]],a)]}case"MaxPoolWithArgmax":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("kernelSize",e,t,n),o=cc("includeBatchInIndex",e,t,n),{result:i,indexes:u}=Fi(cc("x",e,t,n),[s[1],s[2]],[r[1],r[2]],a,o);return[i,u]}case"AvgPool3D":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("kernelSize",e,t,n);return[so(cc("x",e,t,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],a)]}case"MaxPool3D":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("kernelSize",e,t,n);return[Ri(cc("x",e,t,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],a)]}case"Dilation2D":{const r=cc("strides",e,t,n),a=cc("pad",e,t,n),s=cc("dilations",e,t,n),o=r[1],i=r[2],u=s[1],l=s[2];return[Ro(cc("x",e,t,n),cc("filter",e,t,n),[o,i],a,[u,l],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"creation":return Ja((()=>((e,t,n)=>{switch(e.op){case"Fill":{const r=cc("shape",e,t,n),a=cc("dtype",e,t,n);return[ui(r,cc("value",e,t,n),a)]}case"LinSpace":return[yi(cc("start",e,t,n),cc("stop",e,t,n),cc("num",e,t,n))];case"Multinomial":{const r=cc("logits",e,t,n),a=cc("numSamples",e,t,n),s=cc("seed",e,t,n);return[zi(r,a,s)]}case"OneHot":{const r=cc("indices",e,t,n),a=cc("depth",e,t,n),s=cc("onValue",e,t,n),o=cc("offValue",e,t,n);return[Ya(r,a,s,o)]}case"Ones":return[Li(cc("shape",e,t,n),cc("dtype",e,t,n))];case"OnesLike":return[Wi(cc("x",e,t,n))];case"RandomUniform":return[ou(cc("shape",e,t,n),cc("minval",e,t,n),cc("maxval",e,t,n),cc("dtype",e,t,n))];case"Range":return[iu(cc("start",e,t,n),cc("stop",e,t,n),cc("step",e,t,n),cc("dtype",e,t,n))];case"TruncatedNormal":{const r=cc("shape",e,t,n),a=cc("mean",e,t,n),s=cc("stdDev",e,t,n),o=cc("seed",e,t,n);return[Fu(r,a,s,cc("dtype",e,t,n),o)]}case"Zeros":return[Mi(cc("shape",e,t,n),cc("dtype",e,t,n))];case"ZerosLike":return[Do(cc("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"dynamic":return(async(e,t,n)=>{switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:i,softNmsSigma:u}=sh(e,t,n),l=await Nl.nonMaxSuppressionWithScoreAsync(r,a,s,o,i,u);return[l.selectedIndices,l.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:i}=sh(e,t,n),u=cc("padToMaxOutputSize",e,t,n),l=await Nl.nonMaxSuppressionPaddedAsync(r,a,s,o,i,u);return[l.selectedIndices,l.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:i}=sh(e,t,n);return[await Nl.nonMaxSuppressionAsync(r,a,s,o,i)]}case"Where":{const r=qa(cc("condition",e,t,n),"bool"),a=[await Pu(r)];return r.dispose(),a}case"ListDiff":return async function(e,t){const n=ha(e,"x","setdiff1d"),r=ha(t,"y","setdiff1d");Qe(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),Qe(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),Qe(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const a=await n.data(),s=await r.data(),o=new Set(s);let i=0;for(let e=0;e<a.length;e++)o.has(a[e])||i++;const u=new zn([i],n.dtype),l=new zn([i],"int32");for(let e=0,t=0;e<a.length;e++)o.has(a[e])||(u.values[t]=a[e],l.values[t]=e,t++);return[u.toTensor(),l.toTensor()]}(cc("x",e,t,n),cc("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n);case"evaluation":return Ja((()=>((e,t,n)=>{switch(e.op){case"LowerBound":return[Ai(cc("sortedSequence",e,t,n),cc("values",e,t,n))];case"TopKV2":{const r=cc("x",e,t,n),a=cc("k",e,t,n),s=cc("sorted",e,t,n),o=Ru(r,a,s);return[o.values,o.indices]}case"UpperBound":return[Mu(cc("sortedSequence",e,t,n),cc("values",e,t,n))];case"Unique":{const r=cc("x",e,t,n),a=Ou(r);return[a.values,a.indices]}case"UniqueV2":{const r=cc("x",e,t,n),a=cc("axis",e,t,n),s=Ou(r,a);return[s.values,s.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"image":return Ja((()=>((e,t,n)=>{switch(e.op){case"ResizeBilinear":{const r=cc("images",e,t,n),a=cc("size",e,t,n),s=cc("alignCorners",e,t,n),o=cc("halfPixelCenters",e,t,n);return[Nl.resizeBilinear(r,[a[0],a[1]],s,o)]}case"ResizeNearestNeighbor":{const r=cc("images",e,t,n),a=cc("size",e,t,n),s=cc("alignCorners",e,t,n),o=cc("halfPixelCenters",e,t,n);return[Nl.resizeNearestNeighbor(r,[a[0],a[1]],s,o)]}case"CropAndResize":{const r=cc("image",e,t,n),a=cc("boxes",e,t,n),s=cc("boxInd",e,t,n),o=cc("cropSize",e,t,n),i=cc("method",e,t,n),u=cc("extrapolationValue",e,t,n);return[Nl.cropAndResize(r,a,s,o,i,u)]}case"ImageProjectiveTransformV3":{const r=cc("images",e,t,n),a=cc("transforms",e,t,n),s=cc("outputShape",e,t,n),o=cc("fillValue",e,t,n),i=cc("interpolation",e,t,n),u=cc("fillMode",e,t,n);return[Nl.transform(r,a,i.toLowerCase(),u.toLowerCase(),o,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"graph":return Ja((()=>((e,t,n)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const r=cc("default",e,t,n);return[hc(e.name,t,n)||r];case"Placeholder":return[hc(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[gc(cc("x",e,t,n))];case"IdentityN":return cc("x",e,t,n).map((e=>gc(e)));case"Shape":return[Au(cc("x",e,t,n).shape,"int32")];case"ShapeN":return cc("x",e,t,n).map((e=>Au(e.shape)));case"Size":return[Yo(cc("x",e,t,n).size,"int32")];case"Rank":return[Yo(cc("x",e,t,n).rank,"int32")];case"NoOp":return[Yo(1)];case"Print":const a=cc("x",e,t,n),s=cc("data",e,t,n),o=cc("message",e,t,n),i=cc("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<s.length;e++)console.log(Array.prototype.slice.call(s[e].dataSync()).slice(0,i));return[a];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"logical":return Ja((()=>((e,t,n)=>{switch(e.op){case"Equal":return[Fo(cc("a",e,t,n),cc("b",e,t,n))];case"NotEqual":return[Vi(cc("a",e,t,n),cc("b",e,t,n))];case"Greater":return[hi(cc("a",e,t,n),cc("b",e,t,n))];case"GreaterEqual":return[pi(cc("a",e,t,n),cc("b",e,t,n))];case"Less":return[mi(cc("a",e,t,n),cc("b",e,t,n))];case"LessEqual":return[gi(cc("a",e,t,n),cc("b",e,t,n))];case"LogicalAnd":return[Ii(cc("a",e,t,n),cc("b",e,t,n))];case"LogicalNot":return[ki(cc("a",e,t,n))];case"LogicalOr":return[Ci(cc("a",e,t,n),cc("b",e,t,n))];case"Select":case"SelectV2":return[Oo(cc("condition",e,t,n),cc("a",e,t,n),cc("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"matrices":return Ja((()=>((e,t,n)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Xa(cc("a",e,t,n),cc("b",e,t,n),cc("transposeA",e,t,n),cc("transposeB",e,t,n))];case"Einsum":return[Lo(cc("equation",e,t,n),...cc("tensors",e,t,n))];case"Transpose":return[as(cc("x",e,t,n),cc("perm",e,t,n))];case"_FusedMatMul":const[r,a]=cc("fusedOps",e,t,n),s="biasadd"===r,o="prelu"===a,i=cc("numArgs",e,t,n),u=cc("leakyreluAlpha",e,t,n);if(s){if(o&&2!==i)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==i)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[l,c]=cc("args",e,t,n);return[Ju({a:cc("a",e,t,n),b:cc("b",e,t,n),transposeA:cc("transposeA",e,t,n),transposeB:cc("transposeB",e,t,n),bias:l,activation:a,preluActivationWeights:c,leakyreluAlpha:u})];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"normalization":return Ja((()=>((e,t,n)=>{switch(e.op){case"EuclideanNorm":return[ni(cc("x",e,t,n),cc("axis",e,t,n),cc("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[po(cc("x",e,t,n),cc("mean",e,t,n),cc("variance",e,t,n),cc("offset",e,t,n),cc("scale",e,t,n),cc("epsilon",e,t,n))];case"LRN":return[bi(cc("x",e,t,n),cc("radius",e,t,n),cc("bias",e,t,n),cc("alpha",e,t,n),cc("beta",e,t,n))];case"Softmax":return[bu(cc("x",e,t,n))];case"LogSoftmax":return[Ei(cc("x",e,t,n))];case"SparseToDense":return[Uu(cc("sparseIndices",e,t,n),cc("outputShape",e,t,n),cc("sparseValues",e,t,n),cc("defaultValue",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"reduction":return Ja((()=>((e,t,n)=>{switch(e.op){case"Max":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Ko(cc("x",e,t,n),r,a)]}case"Mean":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Di(cc("x",e,t,n),r,a)]}case"Min":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[qo(cc("x",e,t,n),r,a)]}case"Sum":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Zo(cc("x",e,t,n),r,a)]}case"All":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Ms(cc("x",e,t,n),r,a)]}case"Any":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Ls(cc("x",e,t,n),r,a)]}case"ArgMax":{const r=cc("axis",e,t,n);return[Ps(cc("x",e,t,n),r)]}case"ArgMin":{const r=cc("axis",e,t,n);return[Bs(cc("x",e,t,n),r)]}case"Prod":{const r=cc("axis",e,t,n),a=cc("keepDims",e,t,n);return[Ki(cc("x",e,t,n),r,a)]}case"Cumprod":{const r=cc("axis",e,t,n),a=cc("exclusive",e,t,n),s=cc("reverse",e,t,n);return[ko(cc("x",e,t,n),r,a,s)]}case"Cumsum":{const r=cc("axis",e,t,n),a=cc("exclusive",e,t,n),s=cc("reverse",e,t,n);return[Co(cc("x",e,t,n),r,a,s)]}case"Bincount":const r=cc("x",e,t,n),a=cc("weights",e,t,n),s=cc("size",e,t,n);return[fo(r,a,s)];case"DenseBincount":{const r=cc("x",e,t,n),a=cc("weights",e,t,n),s=cc("size",e,t,n),o=cc("binaryOutput",e,t,n);return[No(r,a,s,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"slice_join":return Ja((()=>((e,t,n)=>{switch(e.op){case"ConcatV2":case"Concat":{const r=cc("n",e,t,n),a=cc("axis",e,t,n);let s=cc("tensors",e,t,n);return s=s.slice(0,r),[io(s,a)]}case"Gather":{const r=cc("x",e,t,n),a=cc("indices",e,t,n);return[ci(r,qa(a,"int32"),0)]}case"GatherV2":{const r=cc("axis",e,t,n),a=cc("batchDims",e,t,n),s=cc("x",e,t,n),o=cc("indices",e,t,n);return[ci(s,qa(o,"int32"),r,a)]}case"Reverse":{const r=cc("dims",e,t,n),a=[];for(let e=0;e<r.length;e++)r[e]&&a.push(e);const s=cc("x",e,t,n);return[hu(s,a)]}case"ReverseV2":{const r=cc("axis",e,t,n),a=cc("x",e,t,n);return[hu(a,r)]}case"Slice":{const r=cc("begin",e,t,n),a=cc("size",e,t,n);return[lo(cc("x",e,t,n),r,a)]}case"StridedSlice":{const r=cc("begin",e,t,n),a=cc("end",e,t,n),s=cc("strides",e,t,n),o=cc("beginMask",e,t,n),i=cc("endMask",e,t,n),u=cc("ellipsisMask",e,t,n),l=cc("newAxisMask",e,t,n),c=cc("shrinkAxisMask",e,t,n),h=cc("x",e,t,n);return[Cu(h,r,a,s,o,i,u,l,c)]}case"Pack":return Ja((()=>{const r=cc("axis",e,t,n),a=cc("tensors",e,t,n),s=a[0].shape,o=Su(a[0]).shape,i=a.map((e=>{const t=nt(e.shape,s);if(!t&&!nt(Su(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:ro(e,s)}));return[Iu(i,r)]}));case"Unpack":{const r=cc("axis",e,t,n),a=cc("tensor",e,t,n);return Du(a,r)}case"Tile":{const r=cc("reps",e,t,n);return[oi(cc("x",e,t,n),r)]}case"Split":case"SplitV":{const r=cc("axis",e,t,n),a=cc("numOrSizeSplits",e,t,n),s=cc("x",e,t,n);return wu(s,a,r)}case"ScatterNd":{const r=cc("indices",e,t,n),a=cc("values",e,t,n),s=cc("shape",e,t,n);return[Bu(r,a,s)]}case"GatherNd":{const r=cc("x",e,t,n),a=cc("indices",e,t,n);return[zu(r,a)]}case"SparseToDense":{const r=cc("sparseIndices",e,t,n),a=cc("outputShape",e,t,n),s=cc("sparseValues",e,t,n),o=cc("defaultValue",e,t,n);return[Uu(r,s,a,s.dtype===o.dtype?o:qa(o,s.dtype))]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"sparse":return Ja((()=>((e,t,n)=>{switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:a,emptyRowIndicator:s,reverseIndexMap:o}=Al.sparseFillEmptyRows(cc("indices",e,t,n),cc("values",e,t,n),cc("denseShape",e,t,n),cc("defaultValue",e,t,n));return[r,a,s,o]}case"SparseReshape":{const{outputIndices:r,outputShape:a}=Al.sparseReshape(cc("inputIndices",e,t,n),cc("inputShape",e,t,n),cc("newShape",e,t,n));return[r,a]}case"SparseSegmentMean":return[Al.sparseSegmentMean(cc("data",e,t,n),cc("indices",e,t,n),cc("segmentIds",e,t,n))];case"SparseSegmentSum":return[Al.sparseSegmentSum(cc("data",e,t,n),cc("indices",e,t,n),cc("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"spectral":return Ja((()=>((e,t,n)=>{switch(e.op){case"FFT":return[vu(cc("x",e,t,n))];case"IFFT":return[xu(cc("x",e,t,n))];case"RFFT":return[Tu(cc("x",e,t,n))];case"IRFFT":return[_u(cc("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"string":return Ja((()=>((e,t,n)=>{switch(e.op){case"StringNGrams":{const{nGrams:r,nGramsSplits:a}=$l.stringNGrams(cc("data",e,t,n),cc("dataSplits",e,t,n),cc("separator",e,t,n),cc("nGramWidths",e,t,n),cc("leftPad",e,t,n),cc("rightPad",e,t,n),cc("padWidth",e,t,n),cc("preserveShortSequences",e,t,n));return[r,a]}case"StringSplit":{const{indices:r,values:a,shape:s}=$l.stringSplit(cc("input",e,t,n),cc("delimiter",e,t,n),cc("skipEmpty",e,t,n));return[r,a,s]}case"StringToHashBucketFast":return[$l.stringToHashBucketFast(cc("input",e,t,n),cc("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"transformation":return Ja((()=>((e,t,n)=>{switch(e.op){case"Cast":return[qa(cc("x",e,t,n),cc("dtype",e,t,n))];case"ExpandDims":{const r=cc("axis",e,t,n);return[ai(cc("x",e,t,n),r)]}case"Squeeze":{const r=cc("axis",e,t,n);return[Su(cc("x",e,t,n),r)]}case"Reshape":return[ro(cc("x",e,t,n),cc("shape",e,t,n))];case"MirrorPad":return[Bi(cc("x",e,t,n),cc("padding",e,t,n),cc("mode",e,t,n))];case"PadV2":case"Pad":return[ji(cc("x",e,t,n),cc("padding",e,t,n),cc("constantValue",e,t,n))];case"SpaceToBatchND":{const r=cc("blockShape",e,t,n),a=cc("paddings",e,t,n);return[Gi(cc("x",e,t,n),r,a)]}case"BatchToSpaceND":{const r=cc("blockShape",e,t,n),a=cc("crops",e,t,n);return[ho(cc("x",e,t,n),r,a)]}case"DepthToSpace":{const r=cc("blockSize",e,t,n),a=cc("dataFormat",e,t,n).toUpperCase();return[Ao(cc("x",e,t,n),r,a)]}case"BroadcastTo":return[go(cc("x",e,t,n),cc("shape",e,t,n))];case"BroadcastArgs":return[mo(cc("s0",e,t,n),cc("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n)));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const a=cc("keyDType",e,t,n),s=cc("valueDType",e,t,n),o=new oh(a,s);return r.addHashTable(e.name,o),[o.handle]}case"LookupTableImport":case"LookupTableImportV2":{const a=cc("tableHandle",e,t,n,r),s=cc("keys",e,t,n),o=cc("values",e,t,n),i=r.getHashTableById(a.id);return[await i.import(s,o)]}case"LookupTableFind":case"LookupTableFindV2":{const a=cc("tableHandle",e,t,n,r),s=cc("keys",e,t,n),o=cc("defaultValue",e,t,n),i=r.getHashTableById(a.id);return[await i.find(s,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const a=cc("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}})(e,t,n,r);case"custom":const a=lc(e.op);if(a&&a.customExecutor)return a.customExecutor(new Qc(e,t,n));throw TypeError(`Custom op ${e.op} is not registered.`);default:throw TypeError(`Unknown op '${e.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return kt(a)?a.then((e=>[].concat(e))):[].concat(a)}class uh{constructor(e={},t={},n={},r={}){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map((e=>0===e.id&&0===e.iterationId?"":`${e.frameName}-${e.iterationId}`)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function lh(e,t,n,r){const a=new Set,s=[];let o=null,i=null;const u=new Set,l=Object.keys(e).map((e=>dc(e)[0]));let c=[];null!=r&&(c=r.map((e=>dc(e.name)[0])));const h=[...t];for(;h.length>0;){const e=h.pop();(fh(e)||dh(e)||mh(e))&&null==o&&(o=e,i=o.children.map((e=>e.name)).filter((e=>a.has(e)))),a.add(e.name),null==n[e.name]&&-1===l.indexOf(e.name)&&-1===c.indexOf(e.name)&&(0!==e.inputs.length?e.inputs.forEach((e=>{u.has(e.name)||(u.add(e.name),h.push(e))})):s.push(e.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:s,dynamicNode:o,syncInputs:i}}const ch=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],hh=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],ph=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function fh(e){return ch.indexOf(e.op)>=0}function dh(e){return hh.indexOf(e.op)>=0}function mh(e){return ph.indexOf(e.op)>=0}class gh{constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach((t=>{this._functionExecutorMap[t]=new gh(e.functions[t],this)}))}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map((t=>e[t].map((e=>e.id))));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((e=>e.signatureKey||e.name))}get outputNodes(){return this._outputs.map((e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t}))}get functions(){return Object.keys(this._functions).reduce(((e,t)=>(e[t]=this._functions[t].signature,e)),{})}getCompilationKey(e,t){const n=e.map((e=>e.name)).sort(),r=t.map((e=>e.name)).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(e,t){const n=lh(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:s}=n;if(null!=a)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(r.length>0){const n=t.map((e=>e.name)),a=Object.keys(e);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${a}]. Missing the following inputs: [${r}]`)}return function(e,t,n){const{usedNodes:r,inputs:a}=n,s=[],o=Object.keys(a).map((e=>dc(e)[0])).map((t=>e.nodes[t])),i=e.initNodes;o.forEach((e=>{r.has(e.name)&&s.push(e)})),e.weights.forEach((e=>{r.has(e.name)&&s.push(e)})),null!=i&&i.forEach((e=>{r.has(e.name)&&s.push(e)}));const u=new Set,l=[];for(;s.length>0;){const e=s.pop();u.add(e.name),t[e.name]||l.push(e),e.children.forEach((e=>{!u.has(e.name)&&r.has(e.name)&&e.inputs.every((e=>u.has(e.name)))&&s.push(e)}))}return l}(this.graph,this.weightMap,n)}execute(e,t){e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map((e=>this.graph.nodes[dc(e)[0]])),a=t.map((e=>dc(e)[0]));let s=a.map((e=>this.graph.nodes[e]));this.resetIntermediateTensors(),0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let i=this.compiledMap.get(o);null==i&&(i=this.compile(e,s),this.compiledMap.set(o,i));const u={},l={};return Ja((()=>{const n=new uh(this.weightMap,u,l,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,a]=dc(t),s=[];s[a]=e[t],r[n]=s}));const s=this.getFrozenTensorIds(r),o={};for(let e=0;e<i.length;e++){const t=i[e];if(!r[t.name]){const e=ih(t,r,n,this._resourceManager);if(kt(e))throw new Error(`The execution of the op '${t.op}' returned a promise. Please use model.executeAsync() instead.`);r[t.name]=e,this.checkTensorForDisposal(t.name,t,r,n,s,a,o)}}return null==this.parent&&n.dispose(s),t.map((e=>hc(e,r,n)))}))}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map((t=>e[t])).map((e=>e.map((e=>e.id)))));return new Set(t)}checkTensorForDisposal(e,t,n,r,a,s,o){"control"!==t.category&&-1===s.indexOf(e)&&(n[e].forEach((e=>{null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((e=>{if("control"!==e.category){const s=function(e,t,n){return t[fc(e,n.currentContextId)]}(e.name,n,r);null!=s&&s.forEach((e=>{if(e&&!e.kept&&!a.has(e.id)){const n=o[e.id];if(1===n){if(this.keepTensorForDebug){const[n,a]=pc(t.name,r);this.intermediateTensors[n]||(this.intermediateTensors[n]=[]),this.intermediateTensors[n][a]=e}else e.dispose();delete o[e.id]}else null!=n&&o[e.id]--}}))}})))}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((e=>this.intermediateTensors[e].forEach((e=>e.dispose())))),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach((e=>{this.tensorsMap[e].forEach((e=>{!e||e.kept||e.isDisposed||this.keepIds.has(e.id)||e.dispose()}))}))}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const e in this.intermediateTensors)this.intermediateTensors[e].forEach((e=>e.dispose())),delete this.intermediateTensors[e]}async _executeAsync(e,t,n=!1,r={},a={}){n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepTensorForDebug=At().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e){console.warn(e.message)}this.resetIntermediateTensors();const s=new uh(this.weightMap,r,a,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(e,s,t,n);const o=t.map((e=>hc(e,this.tensorsMap,s))),i=o.map((e=>e.id)),u=Object.keys(e).map((t=>e[t].id));return this.keepIds=new Set([...i,...u,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&s.dispose(this.keepIds),o}async executeFunctionAsync(e,t,n){const r=e.reduce(((e,t,n)=>(e[this.inputs[n].name]=t,e)),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const a=Object.keys(e),s=a.map((e=>this.graph.nodes[dc(e)[0]])),o=n.map((e=>dc(e)[0]));let i=o.map((e=>this.graph.nodes[e]));0===i.length&&(i=this._outputs);const{usedNodes:u,missingInputs:l,dynamicNode:c,syncInputs:h}=lh(e,i,this.weightMap,this._initNodes),p=[...s,...this.graph.weights,...this._initNodes||[]].map((e=>({node:e,contexts:t.currentContext}))),f=Object.assign({},this.weightMap);Object.keys(e).forEach((t=>{const[n,r]=dc(t),a=[];a[r]=e[t],f[n]=a}));const d={},m=this.getFrozenTensorIds(f),g={};for(;p.length>0;){const e=this.processStack(s,p,t,f,g,m,o,d,u);await Promise.all(e)}null!=c||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=i.filter((e=>!fh(e)&&!hc(e.name,f,t))).map((e=>e.name));if(y.length>0){let e="";throw null!=c&&(e=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${y}] from the provided inputs [${a}]. Consider providing the following inputs: [${l}]. ${e}`)}return f}processStack(e,t,n,r,a,s,o,i,u){const l=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let c="";if("Enter"===e.node.op&&cc("isConstant",e.node,r,n)&&([c]=pc(e.node.name,n)),null==r[e.node.name]){const h=ih(e.node,r,n,this._resourceManager);c||([c]=pc(e.node.name,n));const p=n.currentContext;kt(h)?l.push(h.then((l=>(r[c]=l,n.currentContext=p,this.checkTensorForDisposal(c,e.node,r,n,s,o,i),this.processChildNodes(e.node,t,n,r,a,u),l)))):(r[c]=h,this.checkTensorForDisposal(c,e.node,r,n,s,o,i),this.processChildNodes(e.node,t,n,r,a,u))}else this.processChildNodes(e.node,t,n,r,a,u)}return l}processChildNodes(e,t,n,r,a,s){e.children.forEach((e=>{const[o]=pc(e.name,n);!a[o]&&s.has(e.name)&&("Merge"===e.op?e.inputNames.some((e=>!!hc(e,r,n)))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((e=>!!hc(e,r,n)))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})))}))}dispose(){Object.keys(this.weightMap).forEach((e=>this.weightMap[e].forEach((e=>e.dispose()))))}checkInputShapeAndType(e){Object.keys(e).forEach((t=>{const n=e[t],[r]=dc(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){const e=a.attrParams.shape.value;Qe(e.length===n.shape.length&&n.shape.every(((t,n)=>-1===e[n]||e[n]===t)),(()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${e}], but was [${n.shape}]`))}a.attrParams.dtype&&a.attrParams.dtype.value&&Qe(n.dtype===a.attrParams.dtype.value,(()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(e){const t={};for(const n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}checkInputs(e){const t=Object.keys(e).filter((e=>{const[t]=dc(e);return null==this.graph.nodes[t]}));if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map((e=>null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[e]?this._signature.outputs[e].name:e),{})}checkOutputs(e){e.forEach((e=>{const[t]=dc(e);if(!this.graph.nodes[t])throw new Error(`The output '${e}' is not found in the graph`)}))}}class yh{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}class bh{constructor(e,t={}){this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={}),this.resourceManager=new yh}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=Ha(e,this.loadOptions);else{const r=(t=e,n=this.loadOptions,Ta.getLoadHandlers(t,n));if(0===r.length)r.push(Ha(e,this.loadOptions));else if(r.length>1)throw new Error(`Found more than one (${r.length}) load handlers for URL '${[e]}'`);this.handler=r[0]}var t,n}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return kt(e)?e.then((e=>this.loadSync(e))):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let n;n=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=n,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=function(e,t){const n={};let r,a=0;for(const s of t){const t=s.name,o=s.dtype,i=s.shape,u=tt(i);let l;if("quantization"in s){const n=s.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${s.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${s.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const i=ya[n.dtype],c=e.slice(a,a+u*i),h="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=t*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=wa()),l=r(h)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);l=new Int32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=Math.round(t*n.scale+n.min)}}a+=u*i}else if("string"===o){const t=tt(s.shape);l=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(a,a+4))[0];a+=4;const n=new Uint8Array(e.slice(a,a+t));l.push(n),a+=t}}else{const r=ya[o],s=e.slice(a,a+u*r);if("float32"===o)l=new Float32Array(s);else if("int32"===o)l=new Int32Array(s);else if("bool"===o)l=new Uint8Array(s);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${t}': ${o}`);{l=new Float32Array(s);const e=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let t=0;t<e.length;t++)e[t]=l[2*t],r[t]=l[2*t+1];const a=ga(e,i,"float32"),o=ga(r,i,"float32");n[t]=da(a,o),a.dispose(),o.dispose()}}a+=u*r}"complex64"!==o&&(n[t]=ga(l,i,o))}return n}(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new gh(Mc.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=Mc.Instance.transformGraph(e.modelInitializer);this.initializer=new gh(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,t){if("string"==typeof e){const t=(n=e,Ta.getSaveHandlers(n));if(0===t.length)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Error(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}var n;if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,t){return this.execute(e,this.outputNodes)}normalizeInputs(e){if(!(e instanceof jn||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce(((t,n,r)=>(t[n]=e[r],t)),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function vh(e,t={}){if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==t&&(t={}),t.fromTFHub&&"string"==typeof e&&(e=function(e){return e.endsWith("/")||(e+="/"),`${e}model.json?tfjs-format=file`}(e));const n=new bh(e,t);return await n.load(),n}function xh(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Qe("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}const _h=Lu;class wh extends He{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Ge(this,Qa())}nextDataId(){return wh.nextDataId++}write(e,t,n){this.firstUse&&(this.firstUse=!1,At().get("IS_NODE")&&Dt("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&mt(n[0])){const a=n.map((e=>$n(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);return"complex64"===t?zl(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>Rn(e)));return yo(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return yo(e.shape,e.dtype,t)}makeOutput(e,t,n){return Qa().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=An();return e(),{kernelMs:An()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){xh([e],"where");const t=this.readSync(e.dataId);return _h(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function Th(e){return(t,n,r,a,s)=>{const o=is(t,n),i=o.length,u=vt(o),l=ct(s,tt(o)),c=t.length,h=n.length,p=vt(t),f=vt(n),d=ss(t,o),m=ss(n,o);if(d.length+m.length===0)for(let t=0;t<l.length;++t)l[t]=e(r[t%r.length],a[t%a.length]);else for(let t=0;t<l.length;++t){const n=It(t,i,u),s=n.slice(-c);d.forEach((e=>s[e]=0));const o=St(s,c,p),g=n.slice(-h);m.forEach((e=>g[e]=0));const y=St(g,h,f);l[t]=e(r[o],a[y])}return[l,o]}}function Eh(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,i=n.makeTensorInfo(r.shape,"complex64");return n.data.get(i.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(a.shape,"float32",o)},i}function Sh(e,t,n="float32"){if("complex64"===n)return Eh({inputs:{real:Sh(e,t,"float32"),imag:Sh(e,t,"float32")},backend:e});const r=Tt(tt(t),n);return e.makeTensorInfo(t,n,r)}function Ih(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}wh.nextDataId=0;const kh={kernelName:"Identity",backendName:"cpu",kernelFunc:Ih};function Ch(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}function Nh(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if("complex64"===s){if("complex64"===a.dtype)return Ih({inputs:{x:a},backend:n});const e=Sh(n,a.shape,a.dtype),t=Nh({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=Eh({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=Ch({inputs:{input:a},backend:n}),t=Nh({inputs:{x:e},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(e),t}if(!pt(a.dtype,s)){const e=Ih({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:s}}if("int32"===s){const e=n.data.get(a.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(a.shape,"int32",t)}if("bool"===s){const e=n.data.get(a.dataId).values,t=Nn([0],a.dtype),[r,s]=Th(((e,t)=>e!==t?1:0))(a.shape,[],e,t,"bool");return n.makeTensorInfo(s,"bool",r)}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${s}`)}const Ah={kernelName:"Cast",backendName:"cpu",kernelFunc:Nh};function $h(e,t,n,r){return null==n?({inputs:n,backend:a})=>{const{a:s,b:o}=n,i=a;xh([s,o],e);const u=i.data.get(s.dataId).values,l=i.data.get(o.dataId).values,c="string"===s.dtype?ec(u):u,h="string"===s.dtype?ec(l):l,p=r||s.dtype,[f,d]=t(s.shape,o.shape,c,h,p);return i.makeTensorInfo(d,p,f)}:({inputs:e,backend:a})=>{const{a:s,b:o}=e,i=a;if("complex64"===s.dtype||"complex64"===o.dtype){const e=Nh({inputs:{x:s},backend:i,attrs:{dtype:"complex64"}}),t=i.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,u=i.data.get(r.dataId).values,l=i.data.get(a.dataId).values,c=Nh({inputs:{x:o},backend:i,attrs:{dtype:"complex64"}}),h=i.data.get(c.dataId),p=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,d=i.data.get(p.dataId).values,m=i.data.get(f.dataId).values,[g,y,b]=n(s.shape,o.shape,u,l,d,m),v=i.makeTensorInfo(b,"float32",g),x=i.makeTensorInfo(b,"float32",y),_=Eh({inputs:{real:v,imag:x},backend:i});return i.disposeIntermediateTensorInfo(e),i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),_}{const e=i.data.get(s.dataId).values,n=i.data.get(o.dataId).values,a=r||s.dtype,[u,l]=t(s.shape,o.shape,e,n,a);return i.makeTensorInfo(l,a,u)}}}function Rh(e){return(t,n,r,a,s,o)=>{const i=is(t,n),u=tt(i),l=i.length,c=vt(i),h=ct("float32",u),p=ct("float32",u),f=ss(t,i),d=ss(n,i),m=zl(r,a),g=zl(s,o),y=t.length,b=vt(t),v=n.length,x=vt(n);if(f.length+d.length===0)for(let t=0;t<h.length;t++){const n=t%m.length,r=t%g.length,a=e(m[2*n],m[2*n+1],g[2*r],g[2*r+1]);h[t]=a.real,p[t]=a.imag}else for(let t=0;t<h.length;t++){const n=It(t,l,c),r=n.slice(-y);f.forEach((e=>r[e]=0));const a=St(r,y,b),s=n.slice(-v);d.forEach((e=>s[e]=0));const o=St(s,v,x),i=e(m[2*a],m[2*a+1],g[2*o],g[2*o+1]);h[t]=i.real,p[t]=i.imag}return[h,p,i]}}const Fh=Th(((e,t)=>e+t)),Oh=$h("Add",Fh,Rh(((e,t,n,r)=>({real:e+n,imag:t+r})))),Dh={kernelName:"Add",backendName:"cpu",kernelFunc:Oh};function Mh(e){return(t,n,r)=>{const a=ct(n,t.length);for(let n=0;n<t.length;++n)a[n]=e(t[n],r);return a}}function Lh(e,t,n){return({inputs:r,attrs:a,backend:s})=>{const{x:o}=r;if(xh(o,e),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const i=s,u=i.data.get(o.dataId).values,l=tt(o.shape),c=n||o.dtype,h=ht(c,l);for(let e=0;e<l;++e)h[e]=t(u[e],a);return i.makeTensorInfo(o.shape,c,h)}}const Ph=Mh((e=>Math.ceil(e)));function Bh(e,t,n,r){const a=ht(n,tt(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=tt(e.shape);a.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const s="string"===n?ec(e.vals):e.vals;let o=0;for(let n=0;n<e.shape[0];++n){const i=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[i+t]=s[o++]}r+=e.shape[1]}))}return a}const Uh=Th(((e,t)=>e===t?1:0)),zh=Mh((e=>Math.exp(e))),Vh=Mh((e=>Math.expm1(e))),Wh=Mh((e=>Math.floor(e))),jh=Th(((e,t)=>e>t?1:0)),Gh=Th(((e,t)=>e>=t?1:0)),Hh=Th(((e,t)=>e<t?1:0)),Kh=Th(((e,t)=>e<=t?1:0)),qh=Mh((e=>Math.log(e))),Xh=Th(((e,t)=>Math.max(e,t))),Yh=Th(((e,t)=>Math.min(e,t))),Qh=Th(((e,t)=>e*t)),Jh=Rh(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),Zh={kernelName:"Multiply",backendName:"cpu",kernelFunc:$h("Multiply",Qh,Jh)},ep=Th(((e,t)=>e!==t?1:0));function tp(e,t,n,r,a){const s=t.length,o=tt(t),i=vt(t),u=vt(a),l=ct(n,tt(a));for(let t=0;t<o;++t){const n=It(t,s,i),a=new Array(n.length);for(let e=0;e<a.length;e++)a[e]=n[r[e]];l[St(a,s,u)]=e[t]}return l}function np(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:s}=n;xh(a,"transpose");const o=a.shape.length,i=new Array(o);for(let e=0;e<i.length;e++)i[e]=a.shape[s[e]];const u=tp(r.data.get(a.dataId).values,a.shape,a.dtype,s,i);return{dataId:r.write(u,i,a.dtype),shape:i,dtype:a.dtype}}const rp=Mh((e=>1/Math.sqrt(e))),ap=Mh((e=>1/(1+Math.exp(-e)))),sp=Lh("Sigmoid",(e=>1/(1+Math.exp(-e)))),op={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:sp};function ip(e,t,n,r,a){const s=ws(r,t,n),o=tt(n),i=vt(r);if(s){const n=Ts(t,i);return"string"===a?e.slice(n,n+o):e.subarray(n,n+o)}const u=yo(r,a,"string"===a?ec(e):e),l=yo(n,a);for(let e=0;e<l.size;++e){const n=l.indexToLoc(e),r=n.map(((e,n)=>e+t[n]));l.set(u.get(...r),...n)}return"string"===a?tc(l.values):l.values}function up(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:o}=r;xh(a,"slice");const[i,u]=Es(a,s,o);ps(a,i,u);const l=ip(n.data.get(a.dataId).values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}const lp=Mh((e=>Math.sqrt(e))),cp=Th(((e,t)=>{const n=e-t;return n*n}));function hp(e,t,n,r){const a=yo(e,t.dtype);for(let e=0;e<a.size;e++){const s=a.indexToLoc(e),o=new Array(s.length);for(let e=0;e<o.length;e++)o[e]=s[e]*n[e]+r[e];a.set(t.get(...o),...s)}return a}class pp{constructor(e,t,n,r,a,s){this.separator=$n(e),this.nGramWidths=t,this.leftPad=$n(n),this.rightPad=$n(r),this.padWidth=a,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,s){for(let o=0;o<a;++o){const i=this.getPadWidth(s),u=Math.max(0,i-o),l=Math.max(0,i-(a-(o+1))),c=s-(u+l),h=t+(u>0?0:o-i);let p=0;p+=u*this.leftPad.length;for(let t=0;t<c;++t)p+=e[h+t].length;p+=l*this.rightPad.length,p+=(u+l+c-1)*this.separator.length,n[r+o]=new Uint8Array(p);const f=n[r+o];let d=0;const m=e=>e.forEach((e=>f[d++]=e));for(let e=0;e<u;++e)m(this.leftPad),m(this.separator);for(let t=0;t<c-1;++t)m(e[h+t]),m(this.separator);if(c>0){m(e[h+c-1]);for(let e=0;e<l;++e)m(this.separator),m(this.rightPad)}else{for(let e=0;e<l-1;++e)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error(`Invalid split value ${t[a]}, must be in [${e}, ${n}]`);e=t[a]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const a=r-1,s=ht("int32",r);if(0===n||0===r){const e=new Array(n);for(let e=0;e<=a;++e)s[e]=0;return[e,s]}s[0]=0;for(let e=1;e<=a;++e){const n=t[e]-t[e-1];let r=0;this.nGramWidths.forEach((e=>{r+=this.getNumNGrams(n,e)})),this.preserveShort&&n>0&&0===r&&(r=1),s[e]=s[e-1]+r}const o=new Array(s[a]);for(let n=0;n<a;++n){const r=t[n];let a=s[n];if(this.nGramWidths.forEach((s=>{const i=t[n+1]-t[n],u=this.getNumNGrams(i,s);this.createNGrams(e,r,o,a,u,s),a+=u})),this.preserveShort&&a===s[n]){const s=t[n+1]-t[n];if(0===s)continue;const i=s+2*this.padWidth,u=1;this.createNGrams(e,r,o,a,u,i)}}return[o,s]}}function fp(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let s=e.indexOf(a);for(;-1!==s;){const t=e.subarray(0,s);n&&0===t.length||r.push(t),s=(e=e.subarray(s+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let s=0;s<e.length+1;s++)if(s===e.length||-1!==t.indexOf(e[s])){const t=e.subarray(a,s);n&&0===t.length||r.push(t),a=s+1}}const dp=Th(((e,t)=>e-t)),mp={kernelName:"Sub",backendName:"cpu",kernelFunc:$h("Sub",dp,Rh(((e,t,n,r)=>({real:e-n,imag:t-r}))))},gp=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function yp(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,s=t-n+1,o=Math.log(a),i=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*i*(a-i)/a)*Math.sign(s-a/2);yp(e,t,Math.max(n,Math.floor(t-s*i/a+u)),Math.min(r,Math.floor(t+(a-s)*i/a+u)))}const a=e[t];let s=n,o=r;for(Ye(e,n,t),gp(e[r],a)>0&&Ye(e,n,r);s<o;){for(Ye(e,s,o),s++,o--;gp(e[s],a)<0;)s+=1;for(;gp(e[o],a)>0;)o-=1}0===gp(e[n],a)?Ye(e,n,o):(o+=1,Ye(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}var bp=Object.freeze({__proto__:null,simpleAbsImpl:function(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t},addImpl:Fh,bincountImpl:function(e,t,n,r,a){const s=tt(r),o=Tt(a,n);for(let n=0;n<e.length;n++){const r=e[n];if(r<0)throw new Error("Input x must be non-negative!");r>=a||(o[r]+=s>0?t[n]:1)}return o},bincountReduceImpl:function(e,t,n,r=!1){const a=e.shape[0],s=e.shape[1],o=yo([a,n],t.dtype);for(let i=0;i<a;i++)for(let a=0;a<s;a++){const s=e.get(i,a);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(r?o.set(1,i,s):t.size>0?o.set(o.get(i,s)+t.get(i,a),i,s):o.set(o.get(i,s)+1,i,s))}return o},ceilImpl:Ph,concatImpl:Bh,equalImpl:Uh,expImpl:zh,expm1Impl:Vh,floorImpl:Wh,gatherNdImpl:function(e,t,n,r,a,s,o,i,u){const l=yo([r,s],n);for(let n=0;n<r;n++){const r=[];let c=0;for(let t=0;t<a;t++){const s=e[n*a+t];c+=s*o[t],r.push(s)}if(c<0||c>=u/s)throw new Error(`Invalid indices: ${r} does not index into ${i}`);for(let e=0;e<s;e++)l.values[n*s+e]=t.get(...t.indexToLoc(c*s+e))}return l},gatherV2Impl:function(e,t,n){const r=yo(n,e.dtype);for(let n=0;n<r.size;++n){const a=r.indexToLoc(n).slice(),s=a[0],o=a[2],i=t.locToIndex([s,o]);a[2]=t.values[i];const u=e.locToIndex(a);0<=u&&u<e.values.length&&(r.values[n]=e.values[u])}return r},greaterImpl:jh,greaterEqualImpl:Gh,lessImpl:Hh,lessEqualImpl:Kh,linSpaceImpl:function(e,t,n){const r=(t-e)/(n-1),a=Tt(n,"float32");a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+r;return a},logImpl:qh,maxImpl:function(e,t,n,r){const a=ct(r,tt(n));for(let n=0;n<a.length;++n){const r=n*t;let s=e[r];for(let n=0;n<t;++n){const t=e[r+n];(Number.isNaN(t)||t>s)&&(s=t)}a[n]=s}return a},maximumImpl:Xh,minimumImpl:Yh,multiplyImpl:Qh,negImpl:function(e,t,n){const r=Cn(-1,n);return Qh([],t,r,e,n)},notEqualImpl:ep,prodImpl:function(e,t,n,r){const[a,s]=Vo(e,r),o=Zn(t,"int32"),i=Tt(tt(a),o),u=tt(s);for(let e=0;e<i.length;++e){const t=e*u;let r=1;for(let e=0;e<u;++e)r*=n[t+e];i[e]=r}return{outVals:i,outShape:a,outDtype:o}},rangeImpl:function(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Tt(0,r);const a=Tt(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+n;return a},rsqrtImpl:rp,scatterImpl:function(e,t,n,r,a,s,o,i,u,l){const c=[r/a,a],h=e.values,p=t.values;if(0===r)return yo(n,t.dtype);const f=yo(c,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(let e=0;e<s;e++){const s=[];let u=0;for(let t=0;t<o;t++){const n=h[e*o+t];s.push(n),u+=n*i[t]}if(u<0||u>=r/a)throw new Error(`Invalid indices: ${s} does not index into ${n}`);for(let n=0;n<a;n++)l?f.values[u*a+n]+=p[e*a+n]:f.values[u*a+n]=0===t.rank?p[0]:p[e*a+n]}return f},sigmoidImpl:ap,sliceImpl:ip,sparseFillEmptyRowsImpl:function(e,t,n,r,a,s,o){const i=t[0],u=s[0],l=new Array(u),c=new Array(i),h=t[1];if(0===u){if(0!==i)throw new Error(jl(i));return[ht(n,0),[0,h],ht(a,0),l,c]}let p=!0,f=0;const d=new Array(u).fill(0);for(let t=0;t<i;++t){const n=e[t*h];if(n<0)throw new Error(Gl(t,n));if(n>=u)throw new Error(Hl(t,n,u));++d[n],p=p&&n>=f,f=n}let m=!0;for(let e=0;e<u;++e){const t=0===d[e];l[e]=t,m=m&&!t,d[e]=Math.max(d[e],1),e>0&&(d[e]+=d[e-1])}if(m&&p){const t=e,n=r;for(let e=0;e<i;++e)c[e]=e;return[t,[i,h],n,l,c]}{const t=d[u-1],s=ht(n,t*h),p=ht(a,t),f=new Array(u).fill(0);for(let t=0;t<i;++t){const n=e[t*h],a=f[n],o=(0===n?0:d[n-1])+a;f[n]++;for(let n=0;n<h;++n)s[o*h+n]=e[t*h+n];p[o]=r[t],c[t]=o}for(let e=0;e<u;++e)if(0===f[e]){const t=0===e?0:d[e-1];s[t*h+0]=e;for(let e=1;e<h;++e)s[t*h+e]=0;p[t]=o}return[s,[t,h],p,l,c]}},sparseReshapeImpl:function(e,t,n,r,a){const s=tt(r),o=t[0],i=a.length,u=[];let l=1,c=-1;for(let e=0;e<i;++e){const t=a[e];if(-1===t){if(-1!==c)throw new Error(Kl(c,e));c=e,u.push(1)}else{if(t<0)throw new Error(ql(e,t));l*=t,u.push(t)}}if(-1!==c){if(l<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(s/l);if(l*e!==s)throw new Error(Xl(r,u));u[c]=e}if(tt(u)!==s)throw new Error(Yl(r,u));const h=r.length,p=[];if(h>0){p[h-1]=1;for(let e=h-2;e>=0;--e)p[e]=p[e+1]*r[e+1]}const f=[];if(i>0){f[i-1]=1;for(let e=i-2;e>=0;--e)f[e]=f[e+1]*u[e+1]}const d=ht(n,o*i);for(let t=0;t<o;++t){let n=0;for(let r=0;r<h;++r)n+=e[t*h+r]*p[r];for(let e=0;e<i;++e)d[t*i+e]=Math.trunc(n/f[e]),n%=f[e]}return[d,[o,i],u]},sparseSegmentReductionImpl:function(e,t,n,r,a,s=!1,o=0){const i=r.length,u=[t[0],e.length/t[0]],l=u[1],c=i>0?a[i-1]+1:0;if(c<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=c;const p=ht(n,h.reduce(((e,t)=>e*t),1));if(0===i)return c>0&&p.fill(o),[p,h];if(c<=0)throw new Error("segment ids must be >= 0");let f=0,d=1,m=0,g=a[f];for(;;){let t=0;if(d<i){if(t=a[d],g===t){++d;continue}if(g>=t)throw new Error("segment ids are not increasing")}if(g<0||g>=c)throw new Error(Ql(g,c));g>m&&p.fill(o,m*l,g*l);for(let t=f;t<d;++t){const n=r[t];if(n<0||n>=u[0])throw new Error(Jl(t,r[t],u[0]));for(let t=0;t<l;t++)p[g*l+t]+=e[n*l+t]}if(s)for(let e=0;e<l;e++)p[g*l+e]/=d-f;if(f=d,++d,m=g+1,g=t,d>i)break}return m<c&&p.fill(o,m*l,c*l),[p,h]},sqrtImpl:lp,squaredDifferenceImpl:cp,stridedSliceImpl:hp,stringNGramsImpl:function(e,t,n,r,a,s,o,i){return new pp(n,r,a,s,o,i).compute(e,t)},stringSplitImpl:function(e,t,n){const r=e.length,a=[];let s=0,o=0;const i=new Array(r);for(let u=0;u<r;++u){const r=a.length;fp(e[u],t,n,a);const l=a.length-r;i[u]=l,s+=l,o=Math.max(o,l)}const u=ht("int32",2*s),l=new Array(s),c=[r,o];let h=0;for(let e=0;e<r;++e)for(let t=0;t<i[e];++t)u[2*h]=e,u[2*h+1]=t,l[h]=a[h],++h;return[u,l,c]},stringToHashBucketFastImpl:function(e,t){const n=ht("int32",e.length);for(let r=0;r<e.length;++r)n[r]=kn(e[r]).modulo(t).getLowBitsUnsigned();return n},subImpl:dp,tileImpl:function(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const r=yo(n,e.dtype);for(let t=0;t<r.values.length;++t){const n=r.indexToLoc(t),a=new Array(e.rank);for(let t=0;t<a.length;t++)a[t]=n[t]%e.shape[t];const s=e.locToIndex(a);r.values[t]=e.values[s]}return r},topKImpl:function(e,t,n,r,a){const s=t[t.length-1],[o,i]=[e.length/s,s],u=ct(n,o*r),l=ct("int32",o*r);for(let t=0;t<o;t++){const n=t*i,s=e.subarray(n,n+i);let o=new Array(s.length);s.forEach(((e,t)=>o[t]={value:e,index:t})),r<o.length&&(yp(o,r),o=o.slice(0,r)),a&&o.sort(gp);const c=t*r,h=u.subarray(c,c+r),p=l.subarray(c,c+r);for(let e=0;e<r;e++)h[e]=o[e].value,p[e]=o[e].index}const c=t.slice();return c[c.length-1]=r,[yo(c,n,u),yo(c,"int32",l)]},transposeImpl:tp,uniqueImpl:function(e,t,n,r){const a=ut(t,n)[0],s=[1,n[0],1];for(let e=0;e<a;e++)s[0]*=n[e];s[1]=n[a];for(let e=a+1;e<n.length;e++)s[2]*=n[e];const o={},i=new Int32Array(n[a]),u=new zn(s,r,e),l=[],c=1===s[0]&&1===s[2];for(let t=0;t<n[a];t++){let n;if(c)n=e[t].toString();else{const e=[];for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)e.push(u.get(n,t,r));n=e.join(",")}if(void 0!==o[n])i[t]=o[n];else{const e=Object.keys(o).length;o[n]=e,i[t]=e,l.push(t)}}const h=s.slice();h[1]=Object.keys(o).length;const p=new zn(h,r);l.forEach(((e,t)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)p.set(u.get(n,e,r),n,t,r)}));const f=n.slice();return f[a]=h[1],{outputValues:p.values,outputShape:f,indices:i}}});function vp(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,o=tt(a.shape),i=it(s,o),u=tt(i);Qe(o===u,(()=>`The new shape (${i}) has ${u} elements and the old shape (${a.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(a.dataId);const l=n.data.get(a.dataId);if(null!=l.complexTensorInfos){const e=l.complexTensorInfos.real,t=l.complexTensorInfos.imag;e.shape=i,t.shape=i}return{dataId:a.dataId,shape:i,dtype:a.dtype}}es("cpu",(()=>new wh),1);const xp={kernelName:"Reshape",backendName:"cpu",kernelFunc:vp},_p={kernelName:"ResizeBilinear",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:i}=r;xh(a,"resizeBilinear");const u=vt(a.shape),[l,c]=i,[h,p,f,d]=a.shape,m=n.data.get(a.dataId).values,g=new Float32Array(tt([h,l,c,d])),y=[s&&l>1?p-1:p,s&&c>1?f-1:f],b=[s&&l>1?l-1:l,s&&c>1?c-1:c];let v=0;const x=y[0]/b[0],_=y[1]/b[1];for(let e=0;e<h;e++)for(let t=0;t<l;t++){let n;n=o?x*(t+.5)-.5:x*t;const r=Math.max(0,Math.floor(n)),a=n-r,s=Math.min(p-1,Math.ceil(n)),i=e*u[0]+r*u[1],l=e*u[0]+s*u[1];for(let e=0;e<c;e++){let t;t=o?_*(e+.5)-.5:_*e;const n=Math.max(0,Math.floor(t)),r=t-n,s=Math.min(f-1,Math.ceil(t)),c=i+n*u[2],h=l+n*u[2],p=i+s*u[2],y=l+s*u[2];for(let e=0;e<d;e++){const t=m[c+e],n=m[h+e],s=t+(m[p+e]-t)*r,o=s+(n+(m[y+e]-n)*r-s)*a;g[v++]=o}}}return n.makeTensorInfo([h,l,c,d],"float32",g)}},wp={kernelName:"RealDiv",backendName:"cpu",kernelFunc:$h("RealDiv",Th(((e,t)=>e/t)))},Tp={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:o}=r;xh(a,"pad");const i=s.map(((e,t)=>e[0]+a.shape[t]+e[1])),u=s.map((e=>e[0])),l=n.data.get(a.dataId).values,c=tt(a.shape),h=a.shape.length,p=vt(a.shape),f=tt(i),d=i.length,m=vt(i),g=ct(a.dtype,f);0!==o&&g.fill(o);for(let e=0;e<c;e++)g[St(It(e,h,p).map(((e,t)=>e+u[t])),d,m)]=l[e];return{dataId:n.write(g,i,a.dtype),shape:i,dtype:a.dtype}}},Ep=Lh("Elu",(e=>e>=0?e:Math.exp(e)-1)),Sp=Th(((e,t)=>e<0?t*e:e)),Ip=Lh("Relu",(e=>Math.max(0,e))),kp={kernelName:"Relu",backendName:"cpu",kernelFunc:Ip},Cp=Lh("Relu6",(e=>Math.min(Math.max(0,e),6))),Np={kernelName:"Relu6",backendName:"cpu",kernelFunc:Cp};function Ap(e,t,n,r,a){if("linear"===n)return Ih({inputs:{x:t},backend:e});if("relu"===n)return Ip({inputs:{x:t},backend:e});if("elu"===n)return Ep({inputs:{x:t},backend:e});if("relu6"===n)return Cp({inputs:{x:t},backend:e});if("prelu"===n)return function(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;xh([r,a],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,[i,u]=Sp(r.shape,a.shape,s,o,"float32");return n.makeTensorInfo(u,"float32",i)}({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r;xh([a],"leakyRelu");const o=tt(a.shape),i=n.data.get(a.dataId).values,u=ct("float32",o);for(let e=0;e<i.length;e++)u[e]=i[e]<0?s*i[e]:i[e];return n.makeTensorInfo(a.shape,"float32",u)}({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return sp({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}const $p={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r;let m=function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r;xh([a,s],"conv2d");const h=to(u),p=Hs(a.shape,s.shape,o,l,i,c,!1,h),f=p.filterHeight,d=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v="channelsLast"===p.dataFormat,x=new zn(p.outShape,a.dtype),_=vt(a.shape),w=vt(s.shape),T=_[0],E=v?_[1]:_[2],S=v?_[2]:1,I=v?1:_[1],k=x.strides[0],C=v?x.strides[1]:x.strides[2],N=v?x.strides[2]:1,A=v?1:x.strides[1],$=n.data.get(a.dataId).values,R=n.data.get(s.dataId).values,F=x.values;for(let e=0;e<p.batchSize;++e){const t=e*T,n=e*k;for(let e=0;e<p.outHeight;++e){const r=n+e*C,a=e*p.strideHeight-b;for(let e=0;e<f;++e){const n=a+e*m;if(n<0||n>=p.inHeight)continue;const s=e*w[0],o=t+n*E;for(let e=0;e<p.outWidth;++e){const t=r+e*N,n=e*p.strideWidth-y;for(let e=0;e<d;++e){const r=n+e*g;if(r<0||r>=p.inWidth)continue;const a=o+r*S;let i=s+e*w[1];for(let e=0;e<p.inChannels;++e){const n=$[a+e*I];for(let e=0;e<p.outChannels;++e)F[t+e*A]+=n*R[i+e];i+=p.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,F)}({inputs:{x:a,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p}});if(o){const e=m;if("NCHW"===c&&1===o.shape.length&&1!==o.shape[0]){const e=vp({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Oh({inputs:{a:m,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else m=Oh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(e)}if(f){const e=m;if("NCHW"===c&&"prelu"===f&&1===i.shape.length&&1!==i.shape[0]){const e=vp({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});m=Ap(n,m,f,e,d),n.disposeIntermediateTensorInfo(e)}else m=Ap(n,m,f,i,d);n.disposeIntermediateTensorInfo(e)}return m}};function Rp(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:i,dilations:u,dimRoundingMode:l}=r;xh([a,s],"depthwiseConv2DNative");const c=vt(a.shape),h=vt(s.shape);let p=u;null==p&&(p=[1,1]),Qe(eo(o,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`));const f=Hs(a.shape,s.shape,o,p,i,l,!0),{filterHeight:d,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=f,v=b.left,x=b.top,_=f.outChannels/f.inChannels,w=new zn(f.outShape,a.dtype),T=n.data.get(a.dataId).values,E=n.data.get(s.dataId).values,S=w.values;for(let e=0;e<f.batchSize;++e){const t=e*c[0],n=e*w.strides[0];for(let e=0;e<f.outHeight;++e){const r=n+e*w.strides[1],a=e*f.strideHeight-x;for(let e=0;e<d;++e){const n=a+e*g;if(n<0||n>=f.inHeight)continue;const s=e*h[0],o=t+n*c[1];for(let e=0;e<f.outWidth;++e){const t=r+e*w.strides[2],n=e*f.strideWidth-v;for(let e=0;e<m;++e){const r=n+e*y;if(r<0||r>=f.inWidth)continue;const a=s+e*h[1],i=o+r*f.inChannels;let u=t,l=a;for(let e=0;e<f.inChannels;++e){const t=T[i+e];for(let e=0;e<_;++e)S[u+e]+=t*E[l+e];u+=_,l+=_}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const Fp={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:Rp},Op={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r;let m=Rp({inputs:{x:a,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p}});if(o){const e=m;m=Oh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=m;m=Ap(n,m,f,i,d),n.disposeIntermediateTensorInfo(e)}return m}},Dp={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:o}=r;xh([a],"spaceToBatchND");const i=tt(s),u=[[0,0]];u.push(...o);for(let e=1+s.length;e<a.shape.length;++e)u.push([0,0]);const l=Tp.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=Ml(l.shape,s,i,!1),h=Ll(c.length,s.length,!1),p=Pl(l.shape,s,i,!1),f=vp({inputs:{x:l},backend:n,attrs:{shape:c}}),d=np({inputs:{x:f},backend:n,attrs:{perm:h}}),m=vp({inputs:{x:d},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),m}},Mp={kernelName:"BatchToSpaceND",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:o}=r;xh([a],"batchToSpaceND");const i=s.reduce(((e,t)=>e*t)),u=Ml(a.shape,s,i),l=Ll(u.length,s.length),c=Pl(a.shape,s,i),h=Bl(o,s.length),p=Ul(c,o,s.length),f=vp({inputs:{x:a},backend:n,attrs:{shape:u}}),d=np({inputs:{x:f},backend:n,attrs:{perm:l}}),m=vp({inputs:{x:d},backend:n,attrs:{shape:c}}),g=up({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),g}},Lp={kernelName:"StridedSlice",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:o,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r;xh(a,"stridedSlice");const{finalShapeSparse:f,finalShape:d,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:v,strides:x}=Ss(a.shape,s,o,i,u,l,c,h,p);let _;if(m)_=vp({inputs:{x:a},backend:n,attrs:{shape:d}});else if(g||y){Qe(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=fs(b,v,x),t=up({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});_=vp({inputs:{x:t},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(t)}else{const e=hp(f,n.bufferSync(a),x,b);_=n.makeTensorInfo(d,e.dtype,e.values)}return _}};function Pp(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=ut(a,t[0].shape)[0];let o=Ol(t.map((e=>e.shape)),s);if(0===tt(o))return n.makeTensorInfo(o,t[0].dtype,[]);const i=t.filter((e=>tt(e.shape)>0));if(1===i.length)return Ih({inputs:{x:i[0]},backend:n});if(Fl(i.map((e=>e.shape)),s),"complex64"===i[0].dtype){const e=i.map((e=>Ch({inputs:{input:e},backend:n}))),t=i.map((e=>function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}({inputs:{input:e},backend:n}))),r=Pp({inputs:e,backend:n,attrs:{axis:s}}),a=Pp({inputs:t,backend:n,attrs:{axis:s}}),o=Eh({inputs:{real:r,imag:a},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),o}const u=i.map((e=>{const t=tt(e.shape.slice(s));return vp({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),l=u.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));o=Ol(u.map((e=>e.shape)),1);const c=1===u[0].shape[0],h=Bh(l,o,t[0].dtype,c),p=Ol(i.map((e=>e.shape)),s),f=n.makeTensorInfo(p,t[0].dtype,h);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}const Bp={kernelName:"Concat",backendName:"cpu",kernelFunc:Pp};function Up(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:s}=r,o=a.shape.length,i=a.shape.slice();let u=s;return s<0&&(Qe(-(o+1)<=s,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+s+1),i.splice(u,0,1),vp({inputs:{x:a},backend:n,attrs:{shape:i}})}const zp={kernelName:"Pack",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return Up({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const s=t[0].shape,o=t[0].dtype;t.forEach((e=>{Je(s,e.shape,"All tensors passed to stack must have matching shapes"),Qe(o===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],u=Pp({inputs:t.map((e=>{const t=Up({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}},Vp={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:o,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r;xh([a,s],"conv2dBackpropInput");const h=vt(s.shape),p=vt(a.shape);let f=to(l);const d=Hs(o,s.shape,i,1,u,c,!1,f),m=new zn(d.inShape,"float32"),g=m.values,y=n.data.get(a.dataId).values,b=n.data.get(s.dataId).values,[v,x,_]=h,{batchSize:w,filterHeight:T,filterWidth:E,inChannels:S,inHeight:I,inWidth:k,outChannels:C,outHeight:N,outWidth:A,strideHeight:$,strideWidth:R}=d;f=d.dataFormat;const F=T-1-d.padInfo.top,O=E-1-d.padInfo.left,D="channelsLast"===f,M=m.strides[0],L=D?m.strides[1]:m.strides[2],P=D?m.strides[2]:1,B=D?1:m.strides[1],U=p[0],z=D?p[1]:p[2],V=D?p[2]:1,W=D?1:p[1];for(let e=0;e<w;++e)for(let t=0;t<S;++t)for(let n=0;n<I;++n){const r=n-F,a=Math.max(0,Math.ceil(r/$)),s=Math.min(N,(T+r)/$);for(let o=0;o<k;++o){const i=o-O,u=Math.max(0,Math.ceil(i/R)),l=Math.min(A,(E+i)/R);let c=0;for(let n=a;n<s;++n){const a=n*$-r;for(let r=u;r<l;++r){const s=U*e+z*n+V*r,o=v*(T-1-a)+x*(E-1-(r*R-i))+_*t;for(let e=0;e<C;++e)c+=y[s+W*e]*b[o+e]}}g[M*e+L*n+P*o+B*t]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},Wp={kernelName:"CropAndResize",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:o}=t,{cropSize:i,method:u,extrapolationValue:l}=r,[c,h,p,f]=a.shape,d=s.shape[0],[m,g]=i,y=yo([d,m,g,f],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(a.dataId).values,_=vt(a.shape),w=vt(y.shape);for(let e=0;e<d;e++){const t=4*e,n=b[t],r=b[t+1],a=b[t+2],s=b[t+3],o=v[e];if(o>=c)continue;const i=m>1?(a-n)*(h-1)/(m-1):0,d=g>1?(s-r)*(p-1)/(g-1):0;for(let t=0;t<m;t++){const c=m>1?n*(h-1)+t*i:.5*(n+a)*(h-1);if(c<0||c>h-1)for(let n=0;n<g;n++)for(let r=0;r<f;r++){const a=r+n*w[2]+t*w[1]+e*w[0];y.values[a]=l}else if("bilinear"===u){const n=Math.floor(c),a=Math.ceil(c),i=c-n;for(let u=0;u<g;u++){const c=g>1?r*(p-1)+u*d:.5*(r+s)*(p-1);if(c<0||c>p-1){for(let n=0;n<f;n++){const r=n+u*w[2]+t*w[1]+e*w[0];y.values[r]=l}continue}const h=Math.floor(c),m=Math.ceil(c),b=c-h;for(let r=0;r<f;r++){let s=r+h*_[2]+n*_[1]+o*_[0];const l=x[s];s=r+m*_[2]+n*_[1]+o*_[0];const c=x[s];s=r+h*_[2]+a*_[1]+o*_[0];const p=x[s];s=r+m*_[2]+a*_[1]+o*_[0];const f=l+(c-l)*b,d=p+(x[s]-p)*b;s=r+u*w[2]+t*w[1]+e*w[0],y.values[s]=f+(d-f)*i}}}else for(let n=0;n<g;++n){const a=g>1?r*(p-1)+n*d:.5*(r+s)*(p-1);if(a<0||a>p-1){for(let r=0;r<f;r++){const a=r+n*w[2]+t*w[1]+e*w[0];y.values[a]=l}continue}const i=Math.round(a),u=Math.round(c);for(let r=0;r<f;r++){const a=r+i*_[2]+u*_[1]+o*_[0],s=r+n*w[2]+t*w[1]+e*w[0];y.values[s]=x[a]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},jp={kernelName:"Reverse",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r;xh(a,"reverse");const o=a.shape.length,i=ut(s,a.shape);if(0===o)return Ih({inputs:{x:a},backend:n});const u=new zn(a.shape,a.dtype),l=n.bufferSync(a);for(let e=0;e<u.size;e++){const t=u.indexToLoc(e),n=t.slice();i.forEach((e=>n[e]=a.shape[e]-1-n[e])),u.set(l.get(...n),...t)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}},Gp={kernelName:"Unpack",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:s}=r;s<0&&(s+=a.shape.length);const o=a.shape.length,i=a.shape[s],u=new Array(o-1);let l=0;for(let e=0;e<o;e++)e!==s&&(u[l++]=a.shape[e]);const c=new Array(o).fill(0),h=a.shape.slice();h[s]=1;const p=new Array(i);for(let e=0;e<p.length;e++){c[s]=e;const t=up({inputs:{x:a},backend:n,attrs:{begin:c,size:h}});p[e]=vp({inputs:{x:t},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(t)}return p}},Hp={kernelName:"ArgMax",backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;xh(a,"argMax");let o=ut(s,a.shape);const i=Go(o,a.shape.length);let u=a;const l=[];null!=i&&(u=np({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),o=Ho(o.length,u.shape.length)),o=[o[0]],jo("argMax",o,u.shape.length);const[c,h]=Vo(u.shape,o),p=Tt(tt(c),"int32"),f=tt(h),d=n.data.get(u.dataId).values;for(let e=0;e<p.length;++e){const t=e*f;let n=d[t],r=0;for(let e=0;e<f;++e){const a=d[t+e];a>n&&(n=a,r=e)}p[e]=r}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",p)}},Kp={},qp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Xp(e,t){if(!(e in Kp)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete Kp[e]}),!1),1===e?n.getContext("webgl",qp)||n.getContext("experimental-webgl",qp):n.getContext("webgl2",qp)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;Kp[e]=n}const n=Kp[e];return null==n||n.isContextLost()?(delete Kp[e],Xp(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Kp[e])}var Yp,Qp,Jp;function Zp(e,t){return[t,e]}function ef(e){const t=tt(e);return at(Math.ceil(t/4))}function tf(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function nf(e,t){const n=e;let r,a,s,o,i,u,l,c,h,p;return 2===At().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,s=n.RGBA16F,o=n.RGBA32F,i=n.RED,l=4,c=1,h=n.HALF_FLOAT,p=n.FLOAT,u=n.RGBA8):(r=e.RGBA,a=e.RGBA,s=e.RGBA,o=n.RGBA,i=e.RGBA,l=4,c=4,h=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:p}}function rf(e,t){const n=t();return At().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}(e,t))}(e),n}function af(e){return!!(At().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function sf(e,t){return df(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Yp||(Yp={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Qp||(Qp={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Jp||(Jp={}));const of=/ERROR: [0-9]+:([0-9]+):/g;function uf(e,t){const n=of.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const r=+n[1],a=e.split("\n"),s=a.length.toString().length+2,o=a.map(((e,t)=>st((t+1).toString(),s)+e));let i=0;for(let e=0;e<o.length;e++)i=Math.max(o[e].length,i);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${st(l[0],i)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function lf(e,t){if(rf(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function cf(e,t,n,r,a,s,o){const i=e.getAttribLocation(t,n);return-1!==i&&(rf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),rf(e,(()=>e.vertexAttribPointer(i,a,e.FLOAT,!1,s,o))),rf(e,(()=>e.enableVertexAttribArray(i))),!0)}function hf(e,t,n){rf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),rf(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function pf(e,t){rf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),rf(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function ff(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}(e,t))}function df(e,t,n){const r=rf(e,(()=>t()));if(null==r)throw new Error(n);return r}function mf(e,t=2){return tt(e.slice(0,e.length-t))}function gf(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function yf(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[mf(e),...gf(e)]),t}function bf(e){return e%2==0}function vf(e,t){if(nt(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(bf(n)&&bf(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&bf(e[0])&&bf(t[0])}let xf,_f;function wf(e,t){return null!=e.getExtension(t)}function Tf(e){try{if(null!=Xp(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Ef(e){const t=nf(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}const Sf=At();function If(){let e,t,n,r,a,s,o,i,u,l;return 2===At().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",o="out vec4 outputColor;",i="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",o="",i="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:o,defineSpecialNaN:i,defineSpecialInf:u,defineRound:l}}function kf(e,t,n="index"){const r=vt(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / ${t}; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * ${t}`:`index -= ${e[a]} * ${t}`};`)).join("")}function Cf(e,t,n="index"){const r=vt(t);return r.map(((t,a)=>`int ${e[a]} = ${n} / outShapeStrides[${a}]; ${a===r.length-1?`int ${e[a+1]} = ${n} - ${e[a]} * outShapeStrides[${a}]`:`index -= ${e[a]} * outShapeStrides[${a}]`};`)).join("")}function Nf(e){const t=vt(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}Sf.registerFlag("HAS_WEBGL",(()=>Sf.getNumber("WEBGL_VERSION")>0)),Sf.registerFlag("WEBGL_VERSION",(()=>Tf(2)?2:Tf(1)?1:0)),Sf.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Sf.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Sf.get("WEBGL_VERSION"))),Sf.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Sf.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Sf.registerFlag("WEBGL_PACK",(()=>Sf.getBool("HAS_WEBGL"))),Sf.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_CLIP",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_PACK_REDUCE",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_CONV_IM2COL",(()=>Sf.getBool("WEBGL_PACK"))),Sf.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==xf){const t=Xp(e);xf=t.getParameter(t.MAX_TEXTURE_SIZE)}return xf}(Sf.getNumber("WEBGL_VERSION")))),Sf.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==_f){const t=Xp(e);_f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,_f)}(Sf.getNumber("WEBGL_VERSION")))),Sf.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=Sf.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=Xp(e);return t=wf(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:wf(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),Sf.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Sf.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!lr())),Sf.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=Xp(e);if(1===e){if(!wf(t,"OES_texture_float"))return!1}else if(!wf(t,"EXT_color_buffer_float"))return!1;return Ef(t)}(Sf.getNumber("WEBGL_VERSION")))),Sf.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Sf.getBool("WEBGL_FORCE_F16_TEXTURES")&&Sf.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Sf.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>function(e){if(0===e)return!1;const t=Xp(e);if(1!==e){if(wf(t,"EXT_color_buffer_float"))return Ef(t);const e="EXT_color_buffer_half_float";if(wf(t,e)){const n=t.getExtension(e);return function(e,t){const n=nf(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),s}(t,n)}return!1}return!!wf(t,"OES_texture_float")&&!!wf(t,"WEBGL_color_buffer_float")&&Ef(t)}(Sf.getNumber("WEBGL_VERSION")))),Sf.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=Sf.getNumber("WEBGL_VERSION"))&&null!=Xp(e).fenceSync;var e})),Sf.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Sf.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Sf.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),Sf.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>lr()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),Sf.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Sf.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Sf.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Sf.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const Af="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:$f}=nc;function Rf(e,t,n){const r=[];if(e.forEach((e=>{const t=tt(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(r.push(`uniform sampler2D ${e.name};`),r.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=Vf(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push(`uniform int ${e.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${e.name}Shape;`)}r.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));const a=r.join("\n"),s=e.map((e=>function(e,t,n=!1,r){let a="";a+=n?Of(e,r):Ff(e,r);const s=e.shapeInfo.logicalShape,o=t.logicalShape;return s.length<=o.length&&(a+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,i=$f(e.shapeInfo.logicalShape,t.logicalShape),u=zf(o),l=o-s;let c;const h=["x","y","z","w","u","v"];c=0===s?"":o<2&&i.length>=1?"coords = 0;":i.map((e=>`coords.${h[e+l]} = 0;`)).join("\n");let p="";p=o<2&&s>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${h[t+l]}`)).join(", ");let f="return outputValue;";const d=1===tt(e.shapeInfo.logicalShape),m=1===tt(t.logicalShape);if(1!==s||d||m){if(d&&!m)f=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(i.length){const e=s-2,t=s-1;i.indexOf(e)>-1&&i.indexOf(t)>-1?f="return vec4(outputValue.x);":i.indexOf(e)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(t)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${a}() {\n      ${u} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${p});\n      ${f}\n    }\n  `}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=t.texShape,o=e.shapeInfo.texShape,i=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===u&&null==e.shapeInfo.flatOffset&&nt(o,s))return`\n      float ${a}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=zf(u),c=$f(e.shapeInfo.logicalShape,t.logicalShape),h=u-i;let p;const f=["x","y","z","w","u","v"];p=0===i?"":u<2&&c.length>=1?"coords = 0;":c.map((e=>`coords.${f[e+h]} = 0;`)).join("\n");let d="";return d=u<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${f[t+h]}`)).join(", "),`\n    float ${a}() {\n      ${l} coords = getOutputCoords();\n      ${p}\n      return get${r}(${d});\n    }\n  `}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),o=t.texShape,i=If(),u=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(i);let l,c,h=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${Df}\n    ${Mf}\n    ${Lf}\n  `}(i);return t.isPacked?(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `:1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(nt(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),s=a*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),s=a*Math.ceil(e[e.length-2]/2);let o=s,i="",u="b, r, c";for(let t=2;t<e.length-1;t++)o*=e[e.length-t-1],i=`\n      int b${t} = index / ${o};\n      index -= b${t} * ${o};\n    `+i,u=`b${t}, `+u;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${i}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${a});\n      int c = imod(index, ${a}) * 2;\n\n      return ivec${e.length}(${u});\n    }\n  `}(e,t,n)}}(t.logicalShape,o,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(i)):(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){return nt(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${Cf(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`;const r=kf(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n)return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${Cf(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `;const r=kf(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){const n=kf(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=kf(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,o,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(i)),n.packedInputs&&(h+=Pf),[h,u,c,a,l,s,n.userCode].join("\n")}function Ff(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[a,s]=e.shapeInfo.texShape;if(1===a&&1===s)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=Bf(n);if(t)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[i,u]=e.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${i}, ${u}, ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${Uf(e)}\n      }\n    `;const a=e.shapeInfo.texShape,s=a[0],o=a[1];if(1===o&&1===s)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const i=Bf(n);return 1===o?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===s?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${i}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${i}) + 0.5) / ${o}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${o}, index + ${i});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(null!=s&&nt(n,s)){if(t)return`\n      float ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const e=s[0];return`\n    float ${a}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${e}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:o,keptDims:i}=lt(n),u=o;if(u.length<n.length){const n=["row","col"];return`\n      ${Ff(Wf(e,u),t)}\n      float ${a}(int row, int col) {\n        return ${a}(${jf(n,i)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${Uf(e)}\n      }\n    `;const l=s[0],c=s[1],h=Bf(r);return 1===c?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===l?t?`\n      float ${a}(int row, int col) {\n        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:t?`\n      float ${a}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${h};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n  float ${a}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${l}, ${c}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:i,keptDims:u}=lt(n),l=i;if(l.length<n.length){const n=["row","col","depth"];return`\n        ${Ff(Wf(e,l),t)}\n        float ${a}(int row, int col, int depth) {\n          return ${a}(${jf(n,u)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${o}, 1)));\n        ${Uf(e)}\n      }\n    `;const c=e.shapeInfo.texShape,h=c[0],p=c[1],f=e.shapeInfo.flatOffset;if(p===s&&null==f)return t?`\n      float ${a}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${a}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${o}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${p}.0, ${h}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(p===o&&null==f)return t?`\n      float ${a}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${a}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const d=Bf(r);return t?`\n    float ${a}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * ${s} + col * ${o} + depth + ${d};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `:`\n      float ${a}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${o} + depth + ${d};\n        vec2 uv = uvFromFlat(${h}, ${p}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,i=n[1]*o,{newShape:u,keptDims:l}=lt(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${Ff(Wf(e,u),t)}\n      float ${a}(int row, int col, int depth, int depth2) {\n        return ${a}(${jf(n,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${a}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${i}, ${o}, ${s}, 1)));\n        ${Uf(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1],d=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(f===i&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        ${d}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${o}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(f===s&&null==c)return t?`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${a}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=Bf(r);return t?`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${d}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n    float ${a}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${i} + col * ${o} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${p}, ${f}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],s=t[3]*a,o=t[2]*s,i=t[1]*o,{newShape:u,keptDims:l}=lt(t);if(u.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${Ff(Wf(e,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${jf(t,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${i}, ${o}, ${s}, ${a})) +\n          depth3;\n        ${Uf(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1];return f===i&&null==c?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${s}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:f===a&&null==c?`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${i} + col * ${o} + depth * ${s} +\n          depth2 * ${a} + depth3 + ${Bf(n)};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:s}=lt(t);if(a.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${Ff(Wf(e,a))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${jf(t,s)});\n      }\n    `}const o=t[5],i=t[4]*o,u=t[3]*i,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${l}, ${u}, ${i})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${Uf(e)}\n      }\n    `;const h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],d=p[1];return d===c&&null==h?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${l}, ${u}, ${i}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:d===o&&null==h?`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${l} + depth * ${u} +\n          depth2 * ${i} + depth3 * ${o} + depth4 + ${Bf(n)};\n      vec2 uv = uvFromFlat(${f}, ${d}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Of(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${If().texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,s=If();if(t)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${o[0]}, ${o[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=s[0],i=s[1],u=If();if(null!=s&&nt(n,s))return t?`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${a}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}.0, ${o}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(t)return`\n    vec4 ${a}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`\n    vec4 ${a}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${l[0]}, ${l[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=["b","row","col"];return`\n        ${Of(Wf(e,n.slice(1)),t)}\n        vec4 ${a}(int b, int row, int col) {\n          return ${a}(${jf(s,r)});\n        }\n      `}const i=If();if(t)return`\n    vec4 ${a}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${i.texture2D}(${r}, uv);\n    }\n  `;const u=o[0],l=o[1],c=Math.ceil(n[2]/2);return`\n    vec4 ${a}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${l}, ${c*Math.ceil(n[1]/2)}, ${c}, b, row, col);\n      return ${i.texture2D}(${r}, uv);\n    }\n  `}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=If();if(t)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);\n    }\n  `;const s=e.shapeInfo.logicalShape,o=s.length,i=e.shapeInfo.texShape,u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=u[0],c=u[1],h=Math.ceil(s[o-1]/2);let p=h*Math.ceil(s[o-2]/2),f="int b, int row, int col",d=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let e=2;e<o-1;e++)f=`int b${e}, `+f,p*=s[o-e-1],d=`b${e} * ${p} + `+d;return`\n    vec4 ${r}(${f}) {\n      int index = ${d};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}const Df="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Mf="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Lf="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pf="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Bf(e){return`offset${e}`}function Uf(e){const t=e.name,n=tt(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function zf(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function Vf(e,t,n){const{newShape:r,keptDims:a}=lt(t),s=t.length,o=e&&3===s&&1===t[0],i=o?t.slice(1):r,u=!e&&s>1&&!nt(t,n)&&r.length<s||o;return{useSqueezeShape:u,uniformShape:u?i:t,keptDims:a}}function Wf(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function jf(e,t){return t.map((t=>e[t])).join(", ")}function Gf(e,t,n){const r={},a={},s={},o=[];let i,u,l,c=null,h=null;h=e.getUniformLocation(n,"NAN",!1),1===At().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));const p=!1;for(let o=0;o<t.variableNames.length;o++){const i=t.variableNames[o];r[i]=e.getUniformLocation(n,i,p),r[`offset${i}`]=e.getUniformLocation(n,`offset${i}`,p),t.enableShapeUniforms&&(a[`${i}Shape`]=e.getUniformLocation(n,`${i}Shape`,p),s[`${i}TexShape`]=e.getUniformLocation(n,`${i}TexShape`,p))}return t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",p),l=e.getUniformLocation(n,"outShapeStrides",p),u=e.getUniformLocation(n,"outTexShape",p)),t.customUniforms&&t.customUniforms.forEach(((t,r)=>{o[r]=e.getUniformLocation(n,t.name,p)})),{uniformLocations:r,customUniformLocations:o,infLoc:c,nanLoc:h,inShapesLocations:a,inTexShapesLocations:s,outShapeLocation:i,outShapeStridesLocation:l,outTexShapeLocation:u}}function Hf(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const r=e.logicalShape,a=t[n],s=a.shape;if(!nt(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(e.isUniform&&a.isUniform)return;const o=e.texShape,i=a.isUniform?null:a.texData.texShape;if(!nt(o,i))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${i} must match`)}))}function Kf(e){return At().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class qf{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Yp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=If();this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Cf(["r","c","d"],e):kf(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}class Xf{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Yp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=If();this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Cf(["r","c","d"],e):kf(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}class Yf{constructor(e){this.variableNames=["A"],this.outTexUsage=Qp.DOWNLOAD;const t=If();this.outputShape=e,this.userCode=`\n      ${Af}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class Qf{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Qp.DOWNLOAD;const t=If();this.outputShape=e,this.userCode=`\n      ${Af}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class Jf{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=If();this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length);let r="result";t&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Nf(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}class Zf{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=If();this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let a=0;a<=1;a++){const s=2*t+a;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${a};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${s}] = values[0];\n            } else if (offset == 1) {\n              result[${s}] = values[1];\n            } else if (offset == 2) {\n              result[${s}] = values[2];\n            } else {\n              result[${s}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Nf(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${a};\n        }\n    `}}function ed(e,t,n,r,a,s){!function(e,t){const n=At().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const o=function(e){return df(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),i=e.TEXTURE_2D;return rf(e,(()=>e.bindTexture(i,o))),rf(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),rf(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),rf(e,(()=>e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST))),rf(e,(()=>e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===At().getNumber("WEBGL_VERSION")?rf(e,(()=>e.texImage2D(i,0,r,t,n,0,a,s,null))):rf(e,(()=>e.texStorage2D(i,1,r,t,n))),rf(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:o,texShape:[n,t]}}function td(e){return e.internalFormatFloat}function nd(e){return e.internalFormatHalfFloat}function rd(e){return e.downloadTextureFormat}function ad(e){return e.internalFormatPackedFloat}function sd(e){return e.internalFormatPackedHalfFloat}class od{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=At().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Kp[e]=t}(t,e)):this.gl=Xp(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===At().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=sf(this.gl,e),wf(this.gl,t))this.textureHalfFloatExtension=sf(this.gl,t);else if(At().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),wf(this.gl,r))this.colorBufferHalfFloatExtension=sf(this.gl,r);else if(At().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",wf(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!wf(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function(e){return function(e,t){const n=df(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return rf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),rf(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=df(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return rf(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),rf(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return df(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=nf(this.gl,this.textureHalfFloatExtension)}get debug(){return At().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;rf(e,(()=>e.finish())),rf(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),rf(e,(()=>e.deleteFramebuffer(this.framebuffer))),rf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),rf(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),rf(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,s]=Zp(t,n);return ed(e,a,s,td(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,s]=Zp(t,n);return ed(e,a,s,nd(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,s]=Zp(t,n);return ed(e,a,s,rd(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){rf(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===At().getNumber("WEBGL_VERSION")?rf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):rf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===At().getNumber("WEBGL_VERSION")?rf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):rf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),rf(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,s){let o,i,u;rf(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),i=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),i=e.FLOAT,u=s.internalFormatPackedFloat),o.set(a),2===At().getNumber("WEBGL_VERSION")?rf(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,i,o))):rf(e,(()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,i,o))),rf(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,s]=tf(t,n);return ed(e,a,s,sd(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,s]=tf(t,n);return ed(e,a,s,ad(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(pf(this.gl,this.framebuffer),this.outputTexture=null),rf(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,r){const[a,s]=Zp(t,n),o=new Uint8Array(t*n*4);return rf(e,(()=>e.readPixels(0,0,a,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,o))),new Float32Array(o.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,a,s){return function(e,t,n,r,a,s,o,i){const u=e,l=new Float32Array(function(e,t){const[n,r]=tf(e,t);return n*r*4}(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,a,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n,r){const a=e.createBuffer();rf(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a)));const s=16*t*n;return rf(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ))),rf(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),rf(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(At().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const r=new Float32Array(t*n*4);return rf(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=function(e){const t=If();return function(e,t){const n=df(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(rf(e,(()=>e.shaderSource(n,t))),rf(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t));const n=function(e){return df(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);return rf(t,(()=>t.attachShader(n,this.vertexShader))),rf(t,(()=>t.attachShader(n,e))),function(e,t){if(rf(e,(()=>e.linkProgram(t))),!At().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n),this.debug&&lf(t,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(e,t,n){return rf(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),cf(e,t,"clipSpacePos",n,3,20,0)&&cf(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),n}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&rf(this.gl,(()=>this.gl.deleteProgram(e)))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&lf(this.gl,this.program),rf(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return df(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),rf(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){rf(e,(()=>function(e,t,n){!function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)}(e,n),rf(e,(()=>e.activeTexture(e.TEXTURE0+n))),rf(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,r))),rf(e,(()=>e.uniform1i(n,r)))}(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=tf(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&lf(this.gl,this.program),ff(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),rf(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),rf(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=sf(this.gl,2===At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await ot((()=>this.disposed||this.isQueryAvailable(e,At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ot((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),hf(this.gl,e,this.framebuffer),this.debug&&ff(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(hf(this.gl,this.outputTexture,this.framebuffer),this.debug&&ff(this.gl)):pf(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;hf(r,e,this.framebuffer),this.debug&&ff(r),this.outputTexture=e,rf(r,(()=>r.viewport(0,0,t,n))),rf(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),rf(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:id,bincountImpl:ud,bincountReduceImpl:ld,ceilImpl:cd,concatImpl:hd,equalImpl:pd,expImpl:fd,expm1Impl:dd,floorImpl:md,gatherNdImpl:gd,gatherV2Impl:yd,greaterImpl:bd,greaterEqualImpl:vd,lessImpl:xd,lessEqualImpl:_d,linSpaceImpl:wd,logImpl:Td,maxImpl:Ed,maximumImpl:Sd,minimumImpl:Id,multiplyImpl:kd,negImpl:Cd,notEqualImpl:Nd,prodImpl:Ad,rangeImpl:$d,rsqrtImpl:Rd,scatterImpl:Fd,sigmoidImpl:Od,simpleAbsImpl:Dd,sliceImpl:Md,sparseFillEmptyRowsImpl:Ld,sparseReshapeImpl:Pd,sparseSegmentReductionImpl:Bd,sqrtImpl:Ud,stridedSliceImpl:zd,stringNGramsImpl:Vd,stringSplitImpl:Wd,stringToHashBucketFastImpl:jd,subImpl:Gd,tileImpl:Hd,topKImpl:Kd,transposeImpl:qd,uniqueImpl:Xd}=bp;function Yd(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function Qd(e,t){return 1===t?[e]:Yd(e,t)}class Jd{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Kf(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=Qd("rc",this.rank),t=zf(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${a}));\n          }\n        }\n      `}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)a=`${e[e.length-1-t]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(e){const t=this.getSourceCoordsArr(e);return 1===this.rank?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}class Zd{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${e}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${e>0?"}":""}\n      `}var r,a;this.userCode=`\n      ${r=t,a=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${a?function(e,t,n="index"){const r=e.map(((e,t)=>t)),a=function(e,t){const n=e.length,r=e.map((e=>`${t}[${e}]`)),a=new Array(n-1);a[n-2]=r[n-1];for(let e=n-3;e>=0;--e)a[e]=`(${a[e+1]} * ${r[e+1]})`;return a}(r,t);return a.map(((t,r)=>`int ${e[r]} = ${n} / ${a[r]}; ${r===a.length-1?`int ${e[r+1]} = ${n} - ${e[r]} * ${a[r]}`:`index -= ${e[r]} * ${a[r]}`};`)).join("")}(["r","c","d"],"inputShape"):kf(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Nf(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class em{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=nm(t,n),a=rm(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const s=tm(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const e=this.freeTextures[a].shift();return this.usedTextures[a].push(e),e}let o;return r===Jp.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Jp.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Jp.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Jp.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Jp.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=nm(n,r),s=rm(t,a,r);s in this.freeTextures||(this.freeTextures[s]=[]);const o=tm(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),i=At().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==i&&this._numBytesAllocated>i?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const u=this.usedTextures[s],l=u.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function tm(e,t,n,r,a){const s=function(e,t){switch(e){case Jp.PACKED_2X2_FLOAT32:return ad(t);case Jp.PACKED_2X2_FLOAT16:return sd(t);case Jp.UNPACKED_FLOAT32:return td(t);case Jp.UNPACKED_FLOAT16:return nd(t);case Jp.PACKED_4X1_UNSIGNED_BYTE:return rd(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,r);let o;if(a){const[t,n]=tf(e[0],e[1]);o=t*n}else{const[t,n]=Zp(e[0],e[1]);o=t*n}const i=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}(n,s);return o*i}function nm(e,t){if(e===Qp.UPLOAD)return Jp.PACKED_2X2_FLOAT32;if(e===Qp.RENDER||null==e)return function(e){return At().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Jp.PACKED_2X2_FLOAT32:Jp.UNPACKED_FLOAT32:e?Jp.PACKED_2X2_FLOAT16:Jp.UNPACKED_FLOAT16}(t);if(e===Qp.DOWNLOAD||e===Qp.PIXELS)return Jp.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function rm(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class am{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const sm="return abs(x);",om="return x;";class im{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class um{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length);const t=e.length,n=Qd("rc",t),r=zf(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),s=n.slice(-2),o=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${a});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}const lm=Lu,cm={},hm=At().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class pm extends He{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!At().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof od)t=e;else{const n=Xp(At().getNumber("WEBGL_VERSION"),e);t=new od(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=Xp(At().getNumber("WEBGL_VERSION"));t=new od(e),this.binaryCache=((n=At().getNumber("WEBGL_VERSION"))in cm||(cm[n]={}),cm[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new em(this.gpgpu),this.numMBBeforeWarning=null==At().global.screen?1024:At().global.screen.height*At().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Ge(this,Qa())}nextDataId(){return pm.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,n){if((At().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||At().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Qp.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r,a){if(At().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Qp.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:s,shape:o,isPacked:i}=t;if(null!=s){let t;t=i?new im(o,om):new am(o,om);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const u=null!=this.activeTimers;let l,c;return u&&(l=An()),c="complex64"===r?zl(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),u&&(this.downloadWaitMs+=An()-l),this.convertAndCacheOnCPU(e,c)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:s,complexTensorInfos:o,isPacked:i}=t;if(null!=a){let t;t=i?new im(r,om):new am(r,om);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:s}],s),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(At().getBool("DEBUG")&&!At().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===At().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,l,c=null;if("complex64"!==s&&At().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const t=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(t.texture.texture,...ef(r))}if(this.pendingRead.set(e,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);l=zl(e[0],e[1])}else if(null==c)l=this.getValuesFromTexture(e);else{const e=tt(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,e)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=c){const e=this.gpgpu.gl;rf(e,(()=>e.deleteBuffer(c)))}const h=this.convertAndCacheOnCPU(e,l),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach((e=>e(h))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Qa().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,t={}){const n=this.texData.get(e),{values:r,shape:a,slice:s,dtype:o,isPacked:i,texture:u}=n;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=i?new im(a,om):new am(a,om);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:o}],o),s=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),s}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(e,t.customTexShape),c=Qa().makeTensorFromTensorInfo(l),h=this.texData.get(l.dataId);return Object.assign({tensorRef:c},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>Rn(e)));return yo(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return yo(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!af(n)){if(At().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=tt(t);if(At().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...ef(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),s}const s=At().getBool("WEBGL_PACK")&&!0===r,o=s?yf(t):t,i=s?new Qf(o):new Yf(o),u=this.runWebGLProgram(i,[{shape:o,dtype:n,dataId:e}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(u),c}timerAvailable(){return At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=et(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),s=et(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);o.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),o.getExtraProfileInfo=()=>e.map(((e,t)=>({name:s[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else o.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:An(),endMs:null}}endTimer(e){return At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=An(),e)}async getQueryTime(e){if(At().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:s,slice:o}=this.texData.get(e),i=o&&o.origDataId||e,u=this.dataRefCount.get(i);u>1?this.dataRefCount.set(i,u-1):(this.dataRefCount.delete(i),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,s)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=hm){return At().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&tt(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){Dt("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return lm(e.shape,t)}packedUnaryOp(e,t,n){const r=new im(e.shape,t),a=this.compileAndRun(r,[e],n);return Qa().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=Dd(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(At().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sm,e.dtype);const t=new am(e.shape,sm),n=this.compileAndRun(t,[e]);return Qa().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&mt(n[0])){const a=n.map((e=>$n(e)));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return Qa().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new um(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Jd(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[mf(e.shape),...gf(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[mf(t),...gf(t)],s=new Zd(a,n),o=[n],i=this.runWebGLProgram(s,[r],e.dtype,o,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:s}=n;null!=t&&Qe(tt(a)<=t[0]*t[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."));const o=yf(a);let i;i=r?new Xf(o):new qf(o);const u=[null!=t?t:ef(o)];return{dtype:s,shape:a,dataId:this.runWebGLProgram(i,[{shape:o,dtype:s,dataId:e}],s,u,!0,t).dataId}}runWebGLProgram(e,t,n,r,a=!1,s){const o=this.makeTensorInfo(e.outputShape,n),i=this.texData.get(o.dataId);if(e.packedOutput&&(i.isPacked=!0),e.outPackingScheme===Yp.DENSE){const t=null!=s?s:ef(e.outputShape);i.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(i.usage=e.outTexUsage),0===tt(o.shape))return i.values=ct(o.dtype,0),o;const u=[],l=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&tt(t.shape)<=At().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),u.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!vf(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),u.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);const c={shape:o.shape,texData:i,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach((t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const s=t.texData.texShape,{useSqueezeShape:o,uniformShape:i,keptDims:u}=Vf(e.packedInputs,t.shape,s);let l="",c="",h="";if(1===i.length&&e.packedInputs){const e=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];l=`${e[0]>1}_${e[1]>1}`}else if(2!==i.length||e.packedInputs){if(i.length>2&&!e.packedInputs){const e=vt(i);h=`${e[0]===s[1]}_${e[e.length-1]===s[1]}`}}else c=`${i[0]>1}_${i[1]>1}`;const p=t.shape.length,f=2===i.length&&nt(t.shape,s),d=1===tt(t.shape),m=ss(t.shape,n.shape),g=!e.packedInputs&&p===n.shape.length&&nt(s,n.texData.texShape),y=e.packedInputs||i.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${p}_${g}_${o?u:""}_${i.length}_${d}_${m}_${f}_${l}_${c}_${h}_${y}_${a}`}else{const e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${a}`}}));const a=e.userCode;let s=e.constructor.name;return s+="_"+r+"_"+a+`${At().getNumber("WEBGL_VERSION")}`,s}(e,l,c),p=this.getAndSaveBinary(h,(()=>function(e,t,n,r){const a=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=a.map((e=>e.shapeInfo)),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},i=Rf(a,o,t),u=function(e,t){const n=df(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(rf(e,(()=>e.shaderSource(n,t))),rf(e,(()=>e.compileShader(n))),At().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw uf(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,i),l=e.createProgram(u);return At().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:i,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},Gf(e,t,l))}(this.gpgpu,e,l,c))),f=null!=this.activeTimers;let d;f&&(d=this.startTimer()),At().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(Hf(t.inShapeInfos,n),Hf([t.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):e.setOutputMatrixTexture(s.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===At().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,r)=>{const a=t.program.variableNames[r],s=t.uniformLocations[a],o=t.uniformLocations[`offset${a}`],i=t.inShapesLocations[`${a}Shape`],u=t.inTexShapesLocations[`${a}TexShape`];if(i){const{uniformShape:r}=Vf(t.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:e.gl.uniform1iv(i,new Int32Array(r));break;case 2:e.gl.uniform2iv(i,new Int32Array(r));break;case 3:e.gl.uniform3iv(i,new Int32Array(r));break;case 4:e.gl.uniform4iv(i,new Int32Array(r))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(tt(n.shape)<2)e.gl.uniform1f(s,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(s,t)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,s,r)}));const i=t.outShapeLocation;if(i)switch(r.shape.length){case 1:e.gl.uniform1iv(i,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(i,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(i,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(i,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=vt(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach(((n,r)=>{const s=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(s,o);else if("vec2"===n.type)e.gl.uniform2fv(s,o);else if("vec3"===n.type)e.gl.uniform3fv(s,o);else if("vec4"===n.type)e.gl.uniform4fv(s,o);else if("int"===n.type)e.gl.uniform1iv(s,o);else if("ivec2"===n.type)e.gl.uniform2iv(s,o);else if("ivec3"===n.type)e.gl.uniform3iv(s,o);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(s,o)}})),e.executeProgram()}(this.gpgpu,p,l,c,r),u.forEach((e=>this.disposeIntermediateTensorInfo(e))),f&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));const m=At().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const e=An();e-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!At().getBool("WEBGL_LAZILY_UNPACK")&&i.isPacked&&!1===a){const e=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),e}return o}compileAndRun(e,t,n,r,a=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(At().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Ja((()=>{if(!At().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=At().getBool("DEBUG");At().set("DEBUG",!1);const t=this.abs(Yo(1e-8)).dataSync()[0];if(At().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:s,usage:o,isPacked:i}=t;if(null!=s)return;const u=null!=this.activeTimers;let l;u&&(l=An());let c=t.texShape;if(null==c&&(c=function(e,t=!1){let n=At().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map(((t,n)=>n>=e.length-2?Xe(e[n]):e[n])),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=lt(e);e=t.newShape}let r=tt(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=mf(e);let n=2,a=2;return e.length&&([n,a]=gf(e)),r=t*(n/2)*(a/2),at(r).map((e=>2*e))}return at(r)}(n,i),t.texShape=c),null!=a){const e=yf(n);let s,o=c[1],h=c[0];const p=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!i&&p||([o,h]=tf(c[0],c[1])),s=i?new Zf(e,p):new Jf(e,p);const f=p?[h,o]:c,d=this.makeTensorInfo(f,r),m=this.texData.get(d.dataId);m.usage=p?Qp.PIXELS:Qp.UPLOAD,m.texShape=f,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(d.dataId),o,h,a);const g=[[h,o]],y=!0,b=this.runWebGLProgram(s,[d],r,g,y),v=this.texData.get(b.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,At().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(d),u&&(this.uploadWaitMs+=An()-l)}else{const e=this.acquireTexture(c,o,r,i);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*dt(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await new Promise((e=>Rl((()=>e())))),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw uf(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,inShapesLocations:s,inTexShapesLocations:o,outShapeLocation:i,outShapeStridesLocation:u,outTexShapeLocation:l}=Gf(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.inShapesLocations=s,e.inTexShapesLocations=o,e.outShapeLocation=i,e.outShapeStridesLocation=u,e.outTexShapeLocation=l}}}pm.nextDataId=0,cr()&&es("webgl",(()=>new pm),2);class fm{constructor(e){this.variableNames=["A"];const t=If(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class dm{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=If(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const mm={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:s}=r,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,[u,l]=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=[l,u],h=[l,u,s];(i||o)&&(null==gm&&(gm=document.createElement("canvas").getContext("2d")),gm.canvas.width=u,gm.canvas.height=l,gm.drawImage(a,0,0,u,l),a=gm.canvas);const p=n.makeTensorInfo(c,"int32");n.texData.get(p.dataId).usage=Qp.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);const f=At().getBool("WEBGL_PACK")?new dm(h):new fm(h),d=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),d}};let gm;function ym(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,o=n,i=tt(a.shape),u=it(s,i),l=tt(u);Qe(i===l,(()=>`The new shape (${u}) has ${l} elements and the old shape (${a.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`));const c=o.texData.get(a.dataId);return!c.isPacked||vf(a.shape,u)||null!==c.texture&&vf(c.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){const r=[mf(e.shape),...gf(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},s=[mf(t),...gf(t)],o=new Zd(s,r),i=[r],u=n.runWebGLProgram(o,[a],e.dtype,i,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}const bm={kernelName:"Reshape",backendName:"webgl",kernelFunc:ym};class vm{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[s,o,i,u]=e;this.outputShape=[s,t,n,u];const l=[r&&t>1?o-1:o,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${i}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class xm{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,o,i,u]=e;this.outputShape=[s,t,n,u];const l=[r&&t>1?o-1:o,r&&n>1?i-1:i],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${i}.0,\n                                     ${i}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const _m={kernelName:"ResizeBilinear",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:i}=r,[u,l]=i,c=At().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xm(a.shape,u,l,s,o):new vm(a.shape,u,l,s,o);return n.runWebGLProgram(c,[a],"float32")}};function wm(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Tm={kernelName:"Identity",backendName:"webgl",kernelFunc:wm};function Em(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),i=wm({inputs:{x:r},backend:n}),u=wm({inputs:{x:a},backend:n});return o.complexTensorInfos={real:i,imag:u},s}class Sm{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=is(t,n),this.enableShapeUniforms=Kf(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}class Im{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=is(t,n);const a=this.outputShape.length;this.enableShapeUniforms=Kf(a);let s="";if(r)if(0===a||1===tt(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(s=`\n          ${zf(a)} coords = getOutputCoords();\n        `,1===a)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=Qd("coords",a);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= outShape[${a} - 2];\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= outShape[${a} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${e[a-2]} + 1) >= ${this.outputShape[a-2]};\n            bool nextColOutOfBounds =\n              (${e[a-1]} + 1) >= ${this.outputShape[a-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}function km({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:s})=>{const{x:o}=a,i=s,u=r||o.dtype;if(i.shouldExecuteOnCPU([o])&&null!=n){const e=i.texData.get(o.dataId),t=n(e.values,u);return i.makeTensorInfo(o.shape,u,t)}let l;return l=At().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new im(o.shape,t):new am(o.shape,e),i.runWebGLProgram(l,[o],u)}}function Cm({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:s}){return({inputs:o,backend:i})=>{const{a:u,b:l}=o,c=i;if(r&&"complex64"===u.dtype){const t=c.texData.get(u.dataId),n=c.texData.get(l.dataId),[r,a]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{const[n,r]=t,a={dataId:n.dataId,dtype:n.dtype,shape:u.shape},s={dataId:r.dataId,dtype:r.dtype,shape:l.shape},o=new Sm(e,u.shape,l.shape);return c.runWebGLProgram(o,[a,s],Zn(n.dtype,r.dtype))})),s=Em({inputs:{real:r,imag:a},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(a),s}const h=s||Zn(u.dtype,l.dtype);if(("string"===u.dtype||"string"===l.dtype||c.shouldExecuteOnCPU([u,l]))&&null!=a){const e=c.texData.get(u.dataId).values,t=c.texData.get(l.dataId).values,n="string"===u.dtype?ec(e):e,r="string"===u.dtype?ec(t):t,[s,o]=a(u.shape,l.shape,n,r,h),i=c.makeTensorInfo(o,h);return c.texData.get(i.dataId).values=s,i}let p;return p=At().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new Im(t,u.shape,l.shape,n):new Sm(e,u.shape,l.shape),c.runWebGLProgram(p,[u,l],h)}}function Nm(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?"\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n":"return (a < 0.) ? b * a : a;";if("leakyrelu"===e)return t?"\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n":"return (a < 0.) ? b * a : a;";if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}const Am=Cm({opSnippet:"return float(a != b);",cpuKernelImpl:Nd,dtype:"bool"});function $m(e){const{inputs:t,backend:n}=e,{input:r}=t;return wm({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const Rm={kernelName:"Cast",backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:a}=t,{x:s}=n,{dtype:o}=a;if("complex64"===o){if("complex64"===s.dtype)return wm({inputs:{x:s},backend:r});const t=Mi(s.shape),n=e({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),a=Em({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===s.dtype){const t=$m({inputs:{input:s},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(t),n}if(!pt(s.dtype,o)){const e=wm({inputs:{x:s},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:o}}if("int32"===o)return function(e,t){const n=new am(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===o){const e=r.makeTensorInfo([],"bool",ct("bool",1)),t=Am({inputs:{a:s,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}},Fm=Cm({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Om={kernelName:"RealDiv",backendName:"webgl",kernelFunc:Fm};class Dm{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=zf(r),s=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${a} start = ${a}(${s});\n      ${a} end = ${a}(${o});\n\n      void main() {\n        ${a} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${a} coords = outC - start;\n          setOutput(getX(${i}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class Mm{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,a=zf(r),s=t.map((e=>e[0])).join(","),o=t.map(((t,n)=>t[0]+e[n])).join(","),i=Qd("rc",r),u=Qd("source",r),l=`${i[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,h=[`${a} rc = outputLoc;`,`${i[r-1]} += 1;\n       if(${l}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${i[r-2]} += 1;\n       if(${i[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${i[r-1]} += 1;\n         if(${l}) {`],p=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let e=0,t=1===r?2:4;e<t;e++)f+=`\n        ${h[e]}\n        if (${p}) {\n          result[${e}] = float(value);\n        } else {\n          ${a} source = rc - start;\n          result[${e}] = getChannel(getX(${u.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${a} start = ${a}(${s});\n      const ${a} end = ${a}(${o});\n\n      void main() {\n        ${a} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}class Lm{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}const Pm=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:o}=r;if(0===tt(a.shape)){const e=s.map(((e,t)=>e[0]+a.shape[t]+e[1]));return function(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:s}=n;if(s=s||gt(a),"string"===s){const e=ht(s,tt(r));return e.fill(a),t.makeTensorInfo(r,s,e)}{const e=new Lm(r,a),n=[[a]];return t.runWebGLProgram(e,[],s,n)}}({backend:n,attrs:{shape:e,value:o,dtype:a.dtype}})}const i=At().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Mm(a.shape,s,o):new Dm(a.shape,s,o),u=[[o]];return n.runWebGLProgram(i,[a],a.dtype,u)},Bm={kernelName:"PadV2",backendName:"webgl",kernelFunc:Pm};class Um{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.top,o=e.padInfo.left,i=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),d=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",x="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${i}, ${u});\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${p}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===d}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===d}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===d}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${_}\n        ${x}\n        setOutput(result);\n      }\n    `}}class zm{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Kf(this.outputShape.length);const{dataFormat:n}=t,r=If(),a="channelsLast"===n,s=a?0:1,o=a?1:2,i=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${e[1]} && pos < ${e[0]}) {`;let u="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)u+=`\n          blockIndex = rc.y + ${t};\n          pos = rc.x + ${e};\n\n          ${i}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${o}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}class Vm{constructor(e,t,n,r=!1,a=!1,s=!1,o=null,i=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Kf(this.outputShape.length);const l=r?e[1]:e[2],c=Math.ceil(l/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";o&&(m=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(v=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${c}; i++) {\n          int batchA = ${b};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${p});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${f[0]} * ${d[0]});\n          result += (${f[1]} * ${d[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}class Wm{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=is(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const jm="return a * b;";function Gm(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,s=Zn(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),s=new Wm("return areal * breal - aimag * bimag;",r.shape,a.shape),o=new Wm("return areal * bimag + aimag * breal;",r.shape,a.shape),i=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],u=n.runWebGLProgram(s,i,"float32"),l=n.runWebGLProgram(o,i,"float32"),c=Em({inputs:{real:u,imag:l},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[o,i]=kd(r.shape,a.shape,e.values,t.values,s),u=n.makeTensorInfo(i,s);return n.texData.get(u.dataId).values=o,u}let o;return o=At().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Im(jm,r.shape,a.shape):new Sm(jm,r.shape,a.shape),n.runWebGLProgram(o,[r,a],s)}const Hm={kernelName:"Multiply",backendName:"webgl",kernelFunc:Gm};class Km{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];const o=4*Math.floor(n/4),i=n%4;let u="sumValue += dot(values, ones);";if(null!=t){const e=1/t;u=`sumValue += dot(values * ${rt(e)?e.toPrecision(2):e}, ones);`}let l="";a%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===i}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===i}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===i}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}class qm{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let o="0.0",i="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",i="min"):"max"===t&&(o="-1.0 / 1e-20",i="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");const l=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${i}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${i}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,p="vec4";"all"===t?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===t&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");let f="";a%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${a}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${l}; i += 4) {\n          int inIdx = inOffset + i;\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${l};\n        if (${1===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${u});\n      }\n    `}}function Xm(e,t,n,r){const a=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=Dl(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let s=e;for(let o=0;o<a.length;o++){const{inSize:i,windowSize:u,outSize:l}=a[o];let c,h;c="mean"===n?0===o?new Km({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l},i):new Km({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l}):new qm({windowSize:u,inSize:i,batchSize:e.shape[0],outSize:l},n),h=s,s=r.runWebGLProgram(c,[s],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return s}class Ym{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;const r=zf(this.rank),a=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let t=0;t<e.length;t++)r[e[t]]=n[t];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${a}));\n    }\n    `}}class Qm{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=zf(this.rank),a=Yd("rc",this.rank),s=new Array(this.rank);for(let e=0;e<t.length;e++)s[t[e]]=a[e];const o=`vec2(${s.slice(-2).join()})`,i=`++${a[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${i}) {\n        result[1] = ${u};\n      }\n      --${a[this.rank-1]};\n      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${i}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function Jm(e,t,n){const r=At().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qm(e.shape,t):new Ym(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Zm(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;return function(e,t,n,r){const a=t,s=e.shape.length,o=ut(a,e.shape);let i=o;const u=Go(i,s),l=null!=u;let c=e;l&&(c=Jm(e,u,r),i=Ho(i.length,s)),jo("sum",i,s);const[h,p]=Vo(c.shape,i);let f=h;n&&(f=Wo(h,o));const d=tt(p),m=ym({inputs:{x:c},attrs:{shape:[tt(e.shape)/d,d]},backend:r}),g=Xm(m,Zn(e.dtype,"int32"),"sum",r),y=ym({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(c),y}(a,s,o,n)}function eg(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:s}=r,o=n,i=a.shape.length,u=new Array(i);for(let e=0;e<u.length;e++)u[e]=a.shape[s[e]];let l;if(o.shouldExecuteOnCPU([a])){const e=o.texData.get(a.dataId).values,t=qd(e,a.shape,a.dtype,s,u);l=o.makeTensorInfo(u,a.dtype),o.texData.get(l.dataId).values=t}else l=Jm(a,s,o);return l}function tg({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,h=n?e.shape[l-2]:e.shape[l-1],p=r?t.shape[c-1]:t.shape[c-2],f=n?e.shape[l-1]:e.shape[l-2],d=r?t.shape[c-2]:t.shape[c-1],m=e.shape.slice(0,-2),g=t.shape.slice(0,-2),y=tt(m),b=tt(g),v=is(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,d]);Qe(h===p,(()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=n?[y,h,f]:[y,f,h],_=r?[b,d,p]:[b,p,d],w=ym({inputs:{x:e},backend:a,attrs:{shape:x}}),T=ym({inputs:{x:t},backend:a,attrs:{shape:_}}),E=[w,T],S=Math.max(y,b),I=n?w.shape[1]:w.shape[2],k=null!=s,C=null!=o,N="leakyrelu"===u,A=null!=u?Nm(u,!0):null;let $;if((1===f||1===d)&&I>1e3&&!1===(k||C||N||null!=A)){let e=w,t=T;n&&(e=eg({inputs:{x:w},backend:a,attrs:{perm:[0,2,1]}}),E.push(e)),r&&(t=eg({inputs:{x:T},backend:a,attrs:{perm:[0,2,1]}}),E.push(t));const s=1===d;let o=e;1!==d&&(o=ym({inputs:{x:e},backend:a,attrs:{shape:[S,I,1]}}),E.push(o));const i=1===d?2:1;let u=t;s&&(u=ym({inputs:{x:t},backend:a,attrs:{shape:[S,1,I]}}),E.push(u));const l=Gm({inputs:{a:o,b:u},backend:a});$=Zm({inputs:{x:l},backend:a,attrs:{axis:i,keepDims:!0}}),E.push(l)}else{const u=Zn(e.dtype,t.dtype),l=new Vm(x,_,[S,f,d],n,r,k,A,C,N),c=[w,T];if(null!=s&&c.push(s),C&&c.push(o),N){const e=a.makeTensorInfo([],"float32",Cn(i,"float32"));c.push(e),E.push(e)}$=a.runWebGLProgram(l,c,u)}const R=ym({inputs:{x:$},backend:a,attrs:{shape:v}});E.push($);for(const e of E)a.disposeIntermediateTensorInfo(e);return R}function ng({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:i=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,h=u[0]*u[1]*u[2],p=n.outChannels,f="channelsLast"===n.dataFormat;let d;const m=[];if(null!=s&&!f&&3===s.shape.length){const e=eg({inputs:{x:s},backend:r,attrs:{perm:[1,2,0]}});m.push(e),s=e}if((1!==h&&1!==p||!(c>1e3))&&l.isPacked&&f&&null!=l.texture&&u[2]%2!=0&&nt(l.shape.slice(-3),u.slice(-3))){const c=u[0]*u[1]*(u[2]+1),h={dataId:e.dataId,shape:[1,c,n.inChannels],dtype:e.dtype},p=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,Qe(vf(l.shape,h.shape),(()=>`packed reshape ${l.shape} to ${h.shape} isn't free`));const f=ym({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(f);const g=tg({a:h,b:f,backend:r,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s,leakyreluAlpha:o}),y=r.texData.get(g.dataId);Qe(y.isPacked,(()=>"batchMatMul result is expected to be packed")),l.shape=p,y.shape=n.outShape,d=wm({inputs:{x:g},backend:r}),d.shape=n.outShape,m.push(g)}else{const u=f?e:eg({inputs:{x:e},backend:r,attrs:{perm:[0,2,3,1]}}),l=u.shape,c=ym({inputs:{x:u},backend:r,attrs:{shape:[1,l[0]*l[1]*l[2],n.inChannels]}}),h=ym({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),p=tg({a:c,b:h,transposeA:!1,transposeB:!1,backend:r,bias:a,activation:i,preluActivationWeights:s,leakyreluAlpha:o}),g=ym({inputs:{x:p},backend:r,attrs:{shape:[n.batchSize,n.outHeight,n.outWidth,n.outChannels]}});d=f?g:eg({inputs:{x:g},backend:r,attrs:{perm:[0,3,1,2]}}),f||(m.push(u),m.push(g)),m.push(c),m.push(h),m.push(p)}for(const e of m)r.disposeIntermediateTensorInfo(e);return d}function rg({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:i=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:h,outHeight:p,dataFormat:f}=n,d="channelsLast"===f,m=u*l*c,g=p*h,y=[m,g],b=[];if(null!=s&&!d&&3===s.shape.length){const e=eg({inputs:{x:s},backend:r,attrs:{perm:[1,2,0]}});b.push(e),s=e}const v=ym({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),x=ym({inputs:{x:t},backend:r,attrs:{shape:[1,m,tt(t.shape)/m]}});b.push(v),b.push(x);const _=new zm(y,n),w=[v.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=r.runWebGLProgram(_,[v],"float32",w),E=ym({inputs:{x:T},backend:r,attrs:{shape:[1,y[0],y[1]]}});b.push(T),b.push(E);const S=null!=a,I=null!=s,k="leakyrelu"===i,C=i?Nm(i,!0):null,N=new Vm(E.shape,x.shape,[1,g,n.outChannels],!0,!1,S,C,I,k),A=[E,x];if(a&&A.push(a),I&&A.push(s),k){const e=r.makeTensorInfo([],"float32",Cn(o,"float32"));A.push(e),b.push(e)}const $=r.runWebGLProgram(N,A,"float32"),R=ym({inputs:{x:$},backend:r,attrs:{shape:[1,p,h,n.outChannels]}}),F=d?R:eg({inputs:{x:R},backend:r,attrs:{perm:[0,3,1,2]}});d||b.push(R),b.push($);for(const e of b)r.disposeIntermediateTensorInfo(e);return F}const ag={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:i}=t,{strides:u,pad:l,dataFormat:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r,m=to(c),g=Hs(a.shape,s.shape,u,h,l,p,!1,m);let y;const b=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(At().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])y=rg({x:a,filter:s,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:i,leakyreluAlpha:d});else{const e=null!=o,t=null!=i,r="leakyrelu"===f,u=f?Nm(f,!1):null,l=new Um(g,e,u,t,r),h=[a,s],p=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=ym({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(e&&h.push(p(o,c)),t&&h.push(p(i,c)),r){const e=n.makeTensorInfo([],"float32",Cn(d,"float32"));h.push(e),b.push(e)}y=n.runWebGLProgram(l,h,"float32")}else y=ng({x:a,filter:s,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:i,leakyreluAlpha:d});const v=ym({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}};class sg{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Kf(this.outputShape.length);const s=e.filterHeight,o=e.filterWidth,i=e.outChannels/e.inChannels;let u="",l="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,l="result = activation(result);");const c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${i};\n        int q = d2 - d1 * ${i};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${o}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${l}\n        setOutput(result);\n      }\n    `}}class og{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Kf(this.outputShape.length);const s=e.outChannels/e.inChannels,o=e.padInfo.left,i=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,h=c;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<c;e++)p+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;p+=`\n    for (int r = 0; r < ${l}; r++) {\n      `;for(let e=0;e<c;e++)p+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(h+1)/2;e++){const t=2*e;if(p+=`\n          xC = xCCorner + ${t*u};\n          `,1===i){if(t<c&&(o%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,p+=1===u&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<c)){const e=o%2==0?Xe(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,u>1&&(p+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                      xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${t}Ready = 1;\n                    }\n                    `),p+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                  `):p+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<c&&(o%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<c&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<c&&(p+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<c&&(p+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<c&&(p+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let f="",d="";n&&(f=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,d="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${f}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${d}\n        setOutput(result);\n      }\n    `}}const ig={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:i}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=r,d=[];let m=c;null==m&&(m=[1,1]),Qe(eo(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const g=Hs(a.shape,s.shape,u,m,l,h,!0),y=At().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,b=p?Nm(p,y):null,v=[a,s],x=null!=o,_=null!=i,w="leakyrelu"===p;if(x&&v.push(o),_&&v.push(i),w){const e=n.makeTensorInfo([],"float32",Cn(f,"float32"));v.push(e),d.push(e)}let T;T=y?new og(g,x,b,_,w):new sg(g,x,b,_,w);const E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],S=n.runWebGLProgram(T,v,"float32",E);return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),S}},ug="return a + b;",lg={kernelName:"Add",backendName:"webgl",kernelFunc:Cm({opSnippet:ug,packedOpSnippet:ug,supportsComplex:!0,cpuKernelImpl:id})},cg={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:o}=r;Qe(a.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const i=s.reduce(((e,t)=>e*t)),u=[[0,0]];u.push(...o);for(let e=1+s.length;e<a.shape.length;++e)u.push([0,0]);const l=[],c=Pm({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=Ml(c.shape,s,i,!1),p=Ll(h.length,s.length,!1),f=Pl(c.shape,s,i,!1),d=ym({inputs:{x:c},backend:n,attrs:{shape:h}}),m=eg({inputs:{x:d},backend:n,attrs:{perm:p}}),g=ym({inputs:{x:m},backend:n,attrs:{shape:f}});return l.push(c),l.push(d),l.push(m),l.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}},hg={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:i,dilations:u,dimRoundingMode:l}=r;let c=u;null==c&&(c=[1,1]),Qe(eo(o,c),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const h=Hs(a.shape,s.shape,o,c,i,l,!0);let p;p=At().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels==1?new og(h):new sg(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,s],"float32",f)}};class pg{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=zf(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return fg.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let r;const a=e.map(((e,t)=>`sourceLoc.${fg[t]} = start[${t}] + coords.${fg[t]};`));r=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${a.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const fg=["x","y","z","w","u","v"];class dg{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=zf(this.rank),n=Qd("coords",this.rank),r=Qd("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${a})`,o=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,i=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${o}\n        ${i}\n        setOutput(result);\n      }\n    `}}function mg(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:o}=r,[i,u]=Es(a,s,o);if(ps(a,i,u),0===tt(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=Md(e.values,i,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,t)}const{isPacked:l}=n.texData.get(a.dataId),c=ws(a.shape,i,u);if(l||!c){const e=At().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dg(u):new pg(u),t=[i];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){const a=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),o=r.texData.get(s.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;let i=Ts(t,vt(e.shape));a.slice&&(i+=a.slice.flatOffset),o.slice={flatOffset:i,origDataId:a.slice&&a.slice.origDataId||e.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),s}(a,i,u,n)}const gg={kernelName:"Slice",backendName:"webgl",kernelFunc:mg},yg={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:o}=r;Qe(a.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const i=s.reduce(((e,t)=>e*t)),u=Ml(a.shape,s,i),l=Ll(u.length,s.length),c=Pl(a.shape,s,i),h=Bl(o,s.length),p=Ul(c,o,s.length),f=[],d=ym({inputs:{x:a},backend:n,attrs:{shape:u}}),m=eg({inputs:{x:d},backend:n,attrs:{perm:l}}),g=ym({inputs:{x:m},backend:n,attrs:{shape:c}}),y=mg({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return f.push(d),f.push(m),f.push(g),f.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}},bg={kernelName:"Relu6",backendName:"webgl",kernelFunc:km({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})};class vg{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=zf(n.length),s=zf(n.length);let o="";if(1===r)o="coords * strides + begin";else{let e=0;o=n.map(((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${a} begin = ${a}(${e});\n      ${a} strides = ${a}(${t});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}const xg={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:o,strides:i,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:d,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:b,end:v,strides:x}=Ss(a.shape,s,o,i,u,l,c,h,p);let _;if(m)_=ym({inputs:{x:a},backend:n,attrs:{shape:d}});else if(g||y){Qe(a.shape.length>=1,(()=>`Input must have rank at least 1, got: ${a.shape.length}`));const e=fs(b,v,x),t=mg({inputs:{x:a},backend:n,attrs:{begin:b,size:e}});_=ym({inputs:{x:t},backend:n,attrs:{shape:d}}),n.disposeIntermediateTensorInfo(t)}else if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=yo(a.shape,a.dtype,e),r=zd(f,t,x,b);_=n.makeTensorInfo(d,a.dtype,r.values)}else{const e=new vg(b,x,f);_=n.runWebGLProgram(e,[a],a.dtype)}const w=ym({inputs:{x:_},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(_),w}};class _g{constructor(e){this.outputShape=[],this.outputShape=Ol(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){const r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}const r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class wg{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ol(e,t);const n=this.outputShape,r=n.length,a=zf(r),s=Qd("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>`T${t}`));const i=new Array(e.length-1);i[0]=e[0][t];for(let n=1;n<i.length;n++)i[n]=i[n-1]+e[n][t];const u=o[t],l=o.slice(-2),c=o.join();let h=`if (${u} < ${i[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${l.join()}));\n        }`;for(let e=1;e<i.length;e++){const t=i[e-1];h+=`\n        if (${u} < ${i[e]}  && ${u} >= ${i[e-1]}) {\n          return getChannel(\n            getT${e}(${Tg(o,u,t)}),\n            vec2(${Tg(l,u,t)}));\n        }`}const p=i.length,f=i[i.length-1];h+=`\n        return getChannel(\n          getT${p}(${Tg(o,u,f)}),\n          vec2(${Tg(l,u,f)}));`,this.userCode=`\n      float getValue(${o.map((e=>"int "+e))}) {\n        ${h}\n      }\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function Tg(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}function Eg(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>$m({inputs:{input:e},backend:n}))),a=e.map((e=>function(e){const{inputs:t,backend:n}=e,{input:r}=t;return wm({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}({inputs:{input:e},backend:n}))),s=Eg(r,t,n),o=Eg(a,t,n),i=Em({inputs:{real:s,imag:o},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),a.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),i}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map((e=>{const r=tt(e.shape.slice(t));return ym({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),s=a.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),o=Ol(a.map((e=>e.shape)),1),i=1===a[0].shape[0],u=hd(s,o,r,i),l=Ol(e.map((e=>e.shape)),t),c=n.makeTensorInfo(l,r,u);return a.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}if(e.length>At().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(e.length/2),a=Eg(e.slice(0,r),t,n),s=Eg(e.slice(r),t,n),o=Eg([a,s],t,n);return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),o}if(At().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const a=new wg(e.map((e=>e.shape)),t);return n.runWebGLProgram(a,e,r)}const{tensors2D:s,outShape:o}=function(e,t,n){const r=Ol(e.map((e=>e.shape)),t),a=e.map((e=>ym({inputs:{x:e},attrs:{shape:[-1,tt(e.shape.slice(t))]},backend:n})));return{tensors2D:a,outShape:r}}(e,t,n),i=new _g(s.map((e=>e.shape))),u=n.runWebGLProgram(i,s,r);s.forEach((e=>n.disposeIntermediateTensorInfo(e)));const l=ym({inputs:{x:u},attrs:{shape:o},backend:n});return n.disposeIntermediateTensorInfo(u),l}function Sg(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=ut(a,t[0].shape)[0],o=Ol(t.map((e=>e.shape)),s);if(0===tt(o))return n.makeTensorInfo(o,t[0].dtype,[]);const i=t.filter((e=>tt(e.shape)>0));return 1===i.length?wm({inputs:{x:i[0]},backend:n}):(Fl(i.map((e=>e.shape)),s),Eg(i,s,n))}const Ig={kernelName:"Concat",backendName:"webgl",kernelFunc:Sg};function kg(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:s}=t,o=s.shape.length,i=s.shape.slice();let u=a;return a<0&&(Qe(-(o+1)<=a,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+a+1),i.splice(u,0,1),ym({inputs:{x:s},backend:r,attrs:{shape:i}})}const Cg={kernelName:"Pack",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return kg({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const s=t[0].shape,o=t[0].dtype;t.forEach((e=>{Je(s,e.shape,"All tensors passed to stack must have matching shapes"),Qe(o===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],u=Sg({inputs:t.map((e=>{const t=kg({inputs:{input:e},backend:n,attrs:{dim:a}});return i.push(t),t})),backend:n,attrs:{axis:a}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}};class Ng{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,i=n-1-e.padInfo.left,u=s?1:2,l=s?2:3,c=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${a}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Ag={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:o,strides:i,pad:u,dataFormat:l,dimRoundingMode:c}=r,h=to(l),p=Hs(o,s.shape,i,1,u,c,!1,h),f=new Ng(p);return n.runWebGLProgram(f,[a,s],"float32")}},$g={kernelName:"Relu",backendName:"webgl",kernelFunc:km({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"})},Rg={kernelName:"Sigmoid",backendName:"webgl",kernelFunc:km({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Od})};class Fg{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,o,i,u]=e,[l]=t,[c,h]=n;this.outputShape=[l,c,h,u];const p="bilinear"===r?1:0,[f,d]=[o-1+".0",i-1+".0"],[m,g,y]=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[b,v,x]=h>1?[""+(i-1)/(h-1),"(x2-x1) * width_ratio",`x1*${d} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${d}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${a}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${d} ) {\n          setOutput(float(${a}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${p} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const Og={kernelName:"CropAndResize",backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:o}=t,{cropSize:i,method:u,extrapolationValue:l}=r,c=new Fg(a.shape,s.shape,i,u,l);return n.runWebGLProgram(c,[a,s,o],"float32")}};class Dg{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),a=zf(n);this.userCode=`\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class Mg{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=Qd("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=zf(n);function i(n){const r=e.map(((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}(a,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${a}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return i(e)}(r.slice())};\n          if(${a}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",i(e)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice())};\n            if(${a}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const Lg={kernelName:"Reverse",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,o=a.shape.length,i=ut(s,a.shape);if(0===o)return wm({inputs:{x:a},backend:n});const u=At().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Mg(a.shape,i):new Dg(a.shape,i);return n.runWebGLProgram(u,[a],a.dtype)}},Pg="return a - b;",Bg=Cm({opSnippet:Pg,packedOpSnippet:Pg,supportsComplex:!0,cpuKernelImpl:Gd}),Ug={kernelName:"Sub",backendName:"webgl",kernelFunc:Bg},zg={kernelName:"Unpack",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:s}=r;s<0&&(s+=a.shape.length);const o=a,i=o.shape.length,u=a.shape[s],l=new Array(i-1);let c=0;for(let e=0;e<i;e++)e!==s&&(l[c++]=o.shape[e]);const h=[],p=new Array(i).fill(0),f=o.shape.slice();f[s]=1;const d=new Array(u);for(let e=0;e<d.length;e++){p[s]=e;const t=mg({inputs:{x:o},backend:n,attrs:{begin:p,size:f}}),r=ym({inputs:{x:t},backend:n,attrs:{shape:l}});d[e]=r,h.push(t)}return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}};class Vg{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];const o="max"===t?">":"<",i=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${i};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${o} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class Wg{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Qe(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const o=this.outputShape,i=o.length,u=zf(i),l=Qd("coords",i);let c,h;if(1===s){h=i+1;const e=zf(h);c=`\n        ${e} sourceLocR = ${e}(${l.join()}, 0);\n        ++${l[i-1]};\n        ${e} sourceLocG = ${e}(${l.join()}, 0);\n        ++${l[i-2]};\n        ${e} sourceLocA = ${e}(${l.join()}, 0);\n        --${l[i-1]};\n        ${e} sourceLocB = ${e}(${l.join()}, 0);\n        --${l[i-2]};`}else h=i,c=`\n        ${u} sourceLocR = coords;\n        ++${l[i-1]};\n        ${u} sourceLocG = coords;\n        ++${l[i-2]};\n        ${u} sourceLocA = coords;\n        --${l[i-1]};\n        ${u} sourceLocB = coords;\n        --${l[i-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),f="."+p[h-1],d=p.map((e=>"int "+e)),m=Qd("sourceLocR",h-1).concat("inIdx.r"),g=Qd("sourceLocG",h-1).concat("inIdx.g"),y=Qd("sourceLocB",h-1).concat("inIdx.b"),b=Qd("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",x=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,_=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,w=r?"":`\n      float getBestIndicesAChannel(${d.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${d.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${w}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${l[i-1]} < ${o[i-1]-1};\n        bool hasNextRow = ${l[i-2]} < ${o[i-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${_};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${_};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function jg(e,t,n,r=null){let a=t.shape[0],s=t.shape[1];null!=r&&(a=r.shape[0],s=r.shape[1]);const o=Dl(s),i={windowSize:o,inSize:s,batchSize:a,outSize:Math.ceil(s/o)},u=new Vg(i,n,null==r),l=[t];null!=r&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;const h=jg(e,t,n,c);return e.disposeIntermediateTensorInfo(c),h}function Gg(e,t,n,r=null){const a=null!=r?r.shape:t.shape,s=Dl(a[a.length-1]),o=new Wg(a,s,n,null==r),i=null==r?[t]:[t,r],u=e.runWebGLProgram(o,i,"int32");if(u.shape.length===t.shape.length){const r=Gg(e,t,n,u);return e.disposeIntermediateTensorInfo(u),r}return u}function Hg(e,t,n,r){const a=[n];if(jo("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!At().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],s=e.texData.get(t.dataId);let o=t;null!==s&&s.isPacked&&(o=e.unpackTensor(t),n.push(o));const[i,u]=Vo(o.shape,a),l=tt(u),c=ym({inputs:{x:o},backend:e,attrs:{shape:[-1,l]}});n.push(c);const h=jg(e,c,r);n.push(h);const p=ym({inputs:{x:h},backend:e,attrs:{shape:i}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),p}return Gg(e,t,r)}const Kg={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;let o=ut(s,a.shape);const i=Go(o,a.shape.length);let u=a;const l=[];null!=i&&(u=eg({inputs:{x:a},backend:n,attrs:{perm:i}}),l.push(u),o=Ho(o.length,u.shape.length)),jo("argMax",[o[0]],u.shape.length);const c=Hg(n,u,o[0],"max");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}},qg={kernelName:"Mean",backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:a,axis:s}=t,o=n,i=r.shape.length,u=ut(s,r.shape);let l=u;const c=Go(l,i),h=null!=c,p=o.shouldExecuteOnCPU([r]),f=[];let d=r;if(h){if(p){const e=o.texData.get(d.dataId).values,t=new Array(i);for(let e=0;e<t.length;e++)t[e]=r.shape[c[e]];const n=qd(e,r.shape,r.dtype,c,t);d=o.makeTensorInfo(t,r.dtype),o.texData.get(d.dataId).values=n}else d=Jm(r,c,o);f.push(d),l=Ho(l.length,i)}jo("sum",l,i);const[m,g]=Vo(d.shape,l);let y=m;a&&(y=Wo(m,u));const b=function(e,t,n,r){const a=tt(t),s=ym({inputs:{x:e},attrs:{shape:[tt(e.shape)/a,a]},backend:r}),o=Xm(s,"float32","mean",r),i=ym({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),i}(d,g,y,o);for(const e of f)o.disposeIntermediateTensorInfo(e);return b}},Xg={kernelName:"BatchMatMul",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:o,transposeB:i}=r;return tg({a,b:s,transposeA:o,transposeB:i,backend:n})}};class Yg{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const s=e.filterWidth,o=e.strideHeight,i=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const d="avg"===t,m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(d||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${i});\n        const ivec2 pads = ivec2(${p}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${l}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?a?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(b="avgValue / count");const v=4*Math.floor(s/4),x=s%4,_=`\n      if (${d}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${i});\n      const ivec2 pads = ivec2(${p}, ${f});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${v}; wC += 4) {\n            int xC = xCCorner + wC * ${l};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              getValue(batch, xR, xC + 3 * ${l}, d)\n            );\n\n            ${_}\n          }\n\n          int xC = xCCorner + ${v};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${_}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${_}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              initializationValue\n            );\n\n            ${_}\n          }\n        }\n        setOutput(${b});\n      }\n    `}}const Qg={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;!function(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Qe("complex64"!==e.dtype,(()=>"avgPool does not support complex64 tensors in the WebGL backend."))}))}(a);const{filterSize:s,strides:o,pad:i,dimRoundingMode:u}=r;Qe(eo(o,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '1'`));const l=Gs(a.shape,s,o,1,i,u);if(1===l.filterWidth&&1===l.filterHeight&&nt(l.inShape,l.outShape))return wm({inputs:{x:a},backend:n});const c=new Yg(l,"avg",!1);return n.runWebGLProgram(c,[a],"float32")}};class Jg{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class Zg{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const ey={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:o}=r;let i;i=At().getBool("WEBGL_PACK_CLIP")?new Zg(a.shape):new Jg(a.shape);const u=[[s],[o]];return n.runWebGLProgram(i,[a],a.dtype,u)}},ty={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:i,dataFormat:u,dilations:l,dimRoundingMode:c}=r,h=to(u),p=Hs(a.shape,s.shape,o,l,i,c,!1,h);let f;if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(At().getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])f=rg({x:a,filter:s,convInfo:p,backend:n});else{const e=new Um(p);f=n.runWebGLProgram(e,[a,s],"float32")}else f=ng({x:a,filter:s,convInfo:p,backend:n});const d=ym({inputs:{x:f},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(f),d}},ny=km({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:fd,dtype:"float32"}),ry={kernelName:"Softmax",backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,o=ut([s],a.shape),i=function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:o}=r,i=a.shape.length,u=ut(s,a.shape);let l=u;const c=Go(l,i),h=null!=c,p=n.shouldExecuteOnCPU([a]);let f=a;if(h){if(p){const e=n.texData.get(f.dataId).values,t=new Array(i);for(let e=0;e<t.length;e++)t[e]=a.shape[c[e]];const r=qd(e,a.shape,a.dtype,c,t);f=n.makeTensorInfo(t,a.dtype),n.texData.get(f.dataId).values=r}else f=Jm(a,c,n);l=Ho(l.length,i)}jo("max",l,i);const[d,m]=Vo(f.shape,l);let g,y=d;if(o&&(y=Wo(d,u)),p){const e=n.texData.get(f.dataId).values,t=Ed(e,tt(m),y,a.dtype);g=n.makeTensorInfo(y,a.dtype),n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const a=tt(t),s=ym({inputs:{x:e},attrs:{shape:[tt(e.shape)/a,a]},backend:r}),o=Xm(s,e.dtype,"max",r),i=ym({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(o),i}(f,m,y,n);return h&&n.disposeIntermediateTensorInfo(f),g}({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Wo(i.shape,o),l=ym({inputs:{x:i},backend:n,attrs:{shape:u}}),c=Bg({inputs:{a,b:l},backend:n}),h=ny({inputs:{x:c},backend:n}),p=Zm({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),f=ym({inputs:{x:p},backend:n,attrs:{shape:u}}),d=Fm({inputs:{a:h,b:f},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),d}};zt(xp),zt(_p),zt(Ah),zt(wp),zt(Tp),zt($p),zt(Op),zt(Dh),zt(Dp),zt(Fp),zt(Mp),zt(Zh),zt(Np),zt(Lp),zt(zp),zt(Vp),zt(kp),zt(op),zt(kh),zt(Wp),zt(jp),zt(Bp),zt(mp),zt(Gp),zt(Hp),zt(mm),zt(bm),zt(_m),zt(Rm),zt(Om),zt(Bm),zt(ag),zt(ig),zt(lg),zt(cg),zt(hg),zt(yg),zt(Hm),zt(bg),zt(xg),zt(Cg),zt(Ag),zt($g),zt(Rg),zt(Tm),zt(Og),zt(Lg),zt(Ig),zt(Ug),zt(zg),zt(Kg),zt(qg),zt(Xg),zt(Qg),zt(ey),zt(ty),zt(ry),zt(gg);var ay={};function sy(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(d(n))return oy(n,null);if(m(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return oy(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var a=e.pop();return oy(e=1===e.length&&d(e[0])?e[0]:e,null).pipe(K((function(e){return a.apply(void 0,e)})))}return oy(e,null)}function oy(e,t){return new I((function(n){var r=e.length;if(0!==r)for(var a=new Array(r),s=0,o=0,i=function(i){var u=G(e[i]),l=!1;n.add(u.subscribe({next:function(e){l||(l=!0,o++),a[i]=e},error:function(e){return n.error(e)},complete:function(){++s!==r&&l||(o===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},u=0;u<r;u++)i(u);else n.complete()}))}var iy="undefined"!=typeof window&&window,uy="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ly=iy||void 0!==ve&&ve||uy;function cy(e,t){return void 0===t&&(t=null),new yy({method:"GET",url:e,headers:t})}function hy(e,t,n){return new yy({method:"POST",url:e,body:t,headers:n})}function py(e,t){return new yy({method:"DELETE",url:e,headers:t})}function fy(e,t,n){return new yy({method:"PUT",url:e,body:t,headers:n})}function dy(e,t,n){return new yy({method:"PATCH",url:e,body:t,headers:n})}var my=K((function(e,t){return e.response}));function gy(e,t){return my(new yy({method:"GET",url:e,responseType:"json",headers:t}))}var yy=function(e){function t(t){var n=e.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(ly.XMLHttpRequest)return new ly.XMLHttpRequest;if(ly.XDomainRequest)return new ly.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(ly.XMLHttpRequest)return new ly.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(e=t[n],new ly.ActiveXObject(e))break}catch(e){}return new ly.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a]);return n.request=r,n}var n;return u(t,e),t.prototype._subscribe=function(e){return new by(e,this.request)},t.create=((n=function(e){return new t(e)}).get=cy,n.post=hy,n.delete=py,n.put=fy,n.patch=dy,n.getJSON=gy,n),t}(I),by=function(e){function t(t,n){var r=e.call(this,t)||this;r.request=n,r.done=!1;var a=n.headers=n.headers||{};return n.crossDomain||r.getHeader(a,"X-Requested-With")||(a["X-Requested-With"]="XMLHttpRequest"),r.getHeader(a,"Content-Type")||ly.FormData&&n.body instanceof ly.FormData||void 0===n.body||(a["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return u(t,e),t.prototype.next=function(e){this.done=!0;var t,n=this,r=n.xhr,a=n.request,s=n.destination;try{t=new vy(e,r,a)}catch(e){return s.error(e)}s.next(t)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,r=t.method,a=t.url,s=t.async,o=t.password,i=t.headers,u=t.body;try{var l=this.xhr=e.createXHR();this.setupEvents(l,e),n?l.open(r,a,s,n,o):l.open(r,a,s),s&&(l.timeout=e.timeout,l.responseType=e.responseType),"withCredentials"in l&&(l.withCredentials=!!e.withCredentials),this.setHeaders(l,i),u?l.send(u):l.send()}catch(e){this.error(e)}},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(ly.FormData&&e instanceof ly.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.getHeader=function(e,t){for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n]},t.prototype.setupEvents=function(e,t){var n,r,a=t.progressSubscriber;function s(e){var t,n=s,r=n.subscriber,a=n.progressSubscriber,o=n.request;a&&a.error(e);try{t=new wy(this,o)}catch(e){t=e}r.error(t)}function o(e){}function i(e){var t=i,n=t.subscriber,r=t.progressSubscriber,a=t.request;if(4===this.readyState){var s=1223===this.status?204:this.status,o="text"===this.responseType?this.response||this.responseText:this.response;if(0===s&&(s=o?200:0),s<400)r&&r.complete(),n.next(e),n.complete();else{r&&r.error(e);var u=void 0;try{u=new xy("ajax error "+s,this,a)}catch(e){u=e}n.error(u)}}}e.ontimeout=s,s.request=t,s.subscriber=this,s.progressSubscriber=a,e.upload&&"withCredentials"in e&&(a&&(n=function(e){n.progressSubscriber.next(e)},ly.XDomainRequest?e.onprogress=n:e.upload.onprogress=n,n.progressSubscriber=a),r=function(e){var t,n=r,a=n.progressSubscriber,s=n.subscriber,o=n.request;a&&a.error(e);try{t=new xy("ajax error",this,o)}catch(e){t=e}s.error(t)},e.onerror=r,r.request=t,r.subscriber=this,r.progressSubscriber=a),e.onreadystatechange=o,o.subscriber=this,o.progressSubscriber=a,o.request=t,e.onload=i,i.subscriber=this,i.progressSubscriber=a,i.request=t},t.prototype.unsubscribe=function(){var t=this.done,n=this.xhr;!t&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},t}(_),vy=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=_y(this.responseType,t)},xy=function(){function e(e,t,n){return Error.call(this),this.message=e,this.name="AjaxError",this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=_y(this.responseType,t),this}return e.prototype=Object.create(Error.prototype),e}();function _y(e,t){switch(e){case"json":return function(e){return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null")}(t);case"xml":return t.responseXML;default:return"response"in t?t.response:t.responseText}}var wy=function(e,t){return xy.call(this,"ajax timeout",e,t),this.name="AjaxTimeoutError",this},Ty=yy.create,Ey=Uint8Array,Sy=Uint16Array,Iy=Uint32Array,ky=new Ey([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cy=new Ey([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ny=new Ey([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ay=function(e,t){for(var n=new Sy(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new Iy(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)a[s]=s-n[r]<<5|r;return[n,a]},$y=Ay(ky,2),Ry=$y[0],Fy=$y[1];Ry[28]=258,Fy[258]=28;for(var Oy=Ay(Cy,0)[0],Dy=new Sy(32768),My=0;My<32768;++My){var Ly=(43690&My)>>>1|(21845&My)<<1;Ly=(61680&(Ly=(52428&Ly)>>>2|(13107&Ly)<<2))>>>4|(3855&Ly)<<4,Dy[My]=((65280&Ly)>>>8|(255&Ly)<<8)>>>1}var Py=function(e,t,n){for(var r=e.length,a=0,s=new Sy(t);a<r;++a)++s[e[a]-1];var o,i=new Sy(t);for(a=0;a<t;++a)i[a]=i[a-1]+s[a-1]<<1;if(n){o=new Sy(1<<t);var u=15-t;for(a=0;a<r;++a)if(e[a])for(var l=a<<4|e[a],c=t-e[a],h=i[e[a]-1]++<<c,p=h|(1<<c)-1;h<=p;++h)o[Dy[h]>>>u]=l}else for(o=new Sy(r),a=0;a<r;++a)e[a]&&(o[a]=Dy[i[e[a]-1]++]>>>15-e[a]);return o},By=new Ey(288);for(My=0;My<144;++My)By[My]=8;for(My=144;My<256;++My)By[My]=9;for(My=256;My<280;++My)By[My]=7;for(My=280;My<288;++My)By[My]=8;var Uy=new Ey(32);for(My=0;My<32;++My)Uy[My]=5;var zy=Py(By,9,1),Vy=Py(Uy,5,1),Wy=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},jy=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Gy=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Hy=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Sy?Sy:e instanceof Iy?Iy:Ey)(n-t);return r.set(e.subarray(t,n)),r},Ky=new Ey(0),qy=function(e,t){return e[t]|e[t+1]<<8},Xy=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Yy=function(e,t){return Xy(e,t)+4294967296*Xy(e,t+4)};function Qy(e,t){return function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Ey(0);var a=!t||n,s=!n||n.i;n||(n={}),t||(t=new Ey(3*r));var o,i=function(e){var n=t.length;if(e>n){var r=new Ey(Math.max(2*n,e));r.set(t),t=r}},u=n.f||0,l=n.p||0,c=n.b||0,h=n.l,p=n.d,f=n.m,d=n.n,m=8*r;do{if(!h){n.f=u=jy(e,l,1);var g=jy(e,l+1,3);if(l+=3,!g){var y=e[(C=((o=l)/8|0)+(7&o&&1)+4)-4]|e[C-3]<<8,b=C+y;if(b>r){if(s)throw"unexpected EOF";break}a&&i(c+y),t.set(e.subarray(C,b),c),n.b=c+=y,n.p=l=8*b;continue}if(1==g)h=zy,p=Vy,f=9,d=5;else{if(2!=g)throw"invalid block type";var v=jy(e,l,31)+257,x=jy(e,l+10,15)+4,_=v+jy(e,l+5,31)+1;l+=14;for(var w=new Ey(_),T=new Ey(19),E=0;E<x;++E)T[Ny[E]]=jy(e,l+3*E,7);l+=3*x;var S=Wy(T),I=(1<<S)-1,k=Py(T,S,1);for(E=0;E<_;){var C,N=k[jy(e,l,I)];if(l+=15&N,(C=N>>>4)<16)w[E++]=C;else{var A=0,$=0;for(16==C?($=3+jy(e,l,3),l+=2,A=w[E-1]):17==C?($=3+jy(e,l,7),l+=3):18==C&&($=11+jy(e,l,127),l+=7);$--;)w[E++]=A}}var R=w.subarray(0,v),F=w.subarray(v);f=Wy(R),d=Wy(F),h=Py(R,f,1),p=Py(F,d,1)}if(l>m){if(s)throw"unexpected EOF";break}}a&&i(c+131072);for(var O=(1<<f)-1,D=(1<<d)-1,M=l;;M=l){var L=(A=h[Gy(e,l)&O])>>>4;if((l+=15&A)>m){if(s)throw"unexpected EOF";break}if(!A)throw"invalid length/literal";if(L<256)t[c++]=L;else{if(256==L){M=l,h=null;break}var P=L-254;if(L>264){var B=ky[E=L-257];P=jy(e,l,(1<<B)-1)+Ry[E],l+=B}var U=p[Gy(e,l)&D],z=U>>>4;if(!U)throw"invalid distance";if(l+=15&U,F=Oy[z],z>3&&(B=Cy[z],F+=Gy(e,l)&(1<<B)-1,l+=B),l>m){if(s)throw"unexpected EOF";break}a&&i(c+131072);for(var V=c+P;c<V;c+=4)t[c]=t[c-F],t[c+1]=t[c+1-F],t[c+2]=t[c+2-F],t[c+3]=t[c+3-F];c=V}}n.l=h,n.p=M,n.b=c,h&&(u=1,n.m=f,n.d=p,n.n=d)}while(!u);return c==t.length?t:Hy(t,0,c)}(e,t)}var Jy="undefined"!=typeof TextDecoder&&new TextDecoder;try{Jy.decode(Ky,{stream:!0})}catch(Qn){}function Zy(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(Jy)return Jy.decode(e);var a=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return[t,Hy(e,n-1)];a?3==a?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&a?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}}(e),s=a[0];if(a[1].length)throw"invalid utf-8 data";return s}var eb=function(e,t){return t+30+qy(e,t+26)+qy(e,t+28)},tb=function(e,t,n){var r=qy(e,t+28),a=Zy(e.subarray(t+46,t+46+r),!(2048&qy(e,t+8))),s=t+46+r,o=Xy(e,t+20),i=n&&4294967295==o?nb(e,s):[o,Xy(e,t+24),Xy(e,t+42)],u=i[0],l=i[1],c=i[2];return[qy(e,t+10),u,l,a,s+qy(e,t+30)+qy(e,t+32),c]},nb=function(e,t){for(;1!=qy(e,t);t+=4+qy(e,t+2));return[Yy(e,t+12),Yy(e,t+4),Yy(e,t+20)]};function rb(e){for(var t={},n=e.length-22;101010256!=Xy(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=qy(e,n+8);if(!r)return{};var a=Xy(e,n+16),s=4294967295==a;if(s){if(n=Xy(e,n-12),101075792!=Xy(e,n))throw"invalid zip file";r=Xy(e,n+32),a=Xy(e,n+48)}for(var o=0;o<r;++o){var i=tb(e,a,s),u=i[0],l=i[1],c=i[2],h=i[3],p=i[4],f=i[5],d=eb(e,f);if(a=p,u){if(8!=u)throw"unknown compression type "+u;t[h]=Qy(e.subarray(d,d+l),new Ey(c))}else t[h]=Hy(e,d,d+l)}return t}function ab(e){if(e)for(var t=0;t<e.length;t++)e[t]=~e[t];return e}var sb=function(){function e(e,t){this.jsonModel=e,this.weights=t}return e.prototype.load=function(){return t(this,void 0,void 0,(function(){var e,t,r,a;return n(this,(function(n){switch(n.label){case 0:return e={modelTopology:this.jsonModel.modelTopology,format:this.jsonModel.format,generatedBy:this.jsonModel.generatedBy,convertedBy:this.jsonModel.convertedBy},null==this.jsonModel.weightsManifest?[3,2]:[4,this.loadWeights()];case 1:t=n.sent(),r=t[0],a=t[1],e.weightSpecs=r,e.weightData=a,n.label=2;case 2:return null!=this.jsonModel.trainingConfig&&(e.trainingConfig=this.jsonModel.trainingConfig),null!=this.jsonModel.userDefinedMetadata&&(e.userDefinedMetadata=this.jsonModel.userDefinedMetadata),[2,e]}}))}))},e.prototype.loadWeights=function(){return t(this,void 0,void 0,(function(){var e,t,r,a,s,o,i,u;return n(this,(function(n){for(e=[],t=[],r=0,a=this.jsonModel.weightsManifest;r<a.length;r++){for(s=a[r],o=0,i=s.paths;o<i.length;o++){if(u=i[o],!this.weights[u])throw new Error("Error loading weights: cannot find ".concat(u));e.push(this.weights[u])}t.push.apply(t,s.weights)}return[2,[t,this.toArrayBuffer(e)]]}))}))},e.prototype.toArrayBuffer=function(e){if(Array.isArray(e)){for(var t=0,n=0,r=e;n<r.length;n++)t+=r[n].length;for(var a=new ArrayBuffer(t),s=new Uint8Array(a),o=0,i=0,u=e;i<u.length;i++)o+=u[i].copy(s,o);return a}return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)},e}();function ob(e,t){var n=new ie(0),r=new ie(0),a=new ie(0),s=new ie(0),o=V([n,r,a,s]).pipe(K((function(e){return e.reduce((function(t,n){return t+n/e.length}),0)})));if("string"==typeof e){var i=function(e,t){return Ty({url:e,method:"GET",responseType:"arraybuffer",async:!0,progressSubscriber:new _((function(e){return t.next(e.loaded/e.total)}),(function(e){}),(function(){return t.next(1)}))}).pipe(ue(2))}(e,n).pipe(he((function(e){return ib(e.response)})),he((function(e){return ub(e,t,r).pipe(K((function(t){return{jszip:e,config:t}})))})),he((function(e){var t=e.jszip,n=e.config;return lb(t,n,a).pipe(K((function(e){return{jszip:t,config:n,jsonModel:e}})))})),he((function(e){var t=e.jszip,n=e.config,r=e.jsonModel;return cb(t,r,s).pipe(K((function(e){return{config:n,jsonModel:r,weights:e}})))})),he((function(e){var t=e.config,n=e.jsonModel,r=e.weights;return G(vh(new sb(n,r))).pipe(K((function(e){return{config:t,graphModel:e}})))})));return{model$:i,progress$:o}}return i=ib(e).pipe(he((function(e){return ub(e,t,r).pipe(K((function(t){return{jszip:e,config:t}})))})),he((function(e){var t=e.jszip,n=e.config;return lb(t,n,a).pipe(K((function(e){return{jszip:t,config:n,jsonModel:e}})))})),he((function(e){var t=e.jszip,n=e.config,r=e.jsonModel;return cb(t,r,s).pipe(K((function(e){return{config:n,jsonModel:r,weights:e}})))})),he((function(e){var t=e.config,n=e.jsonModel,r=e.weights;return G(vh(new sb(n,r))).pipe(K((function(e){return{config:t,graphModel:e}})))}))),{model$:i,progress$:o}}function ib(e){return H(rb(new Uint8Array(e)))}function ub(e,t,n){return e[t]?be((function(){return n.next(1),H(JSON.parse(Zy(e[t])))})):Q("Unable to retrieve model config: ".concat(t," is missing"))}function lb(e,t,n){return t?e[t.filename]?be((function(){return n.next(1),H(JSON.parse(Zy(ab(e[t.filename]))))})):Q("Error extracting model: ".concat(t.filename," is missing")):Q("Invalid model config")}function cb(e,t,n){if(!t)return Q("Unable to extract weights: model is undefined");if(!t.weightsManifest)return n.next(1),H({});for(var r=0,a=0,s=t.weightsManifest;a<s.length;a++){var o=s[a];r+=o.paths.length}for(var i=new Array(r).fill(0),u={},l=0,c=0,h=t.weightsManifest;c<h.length;c++)for(var p=function(t){if(!e[t])return{value:Q("Error extracting weight: ".concat(t," is missing"))};u[t]=be((function(){var a=e[t];return i[l]=1,n.next(i.reduce((function(e,t){return e+t}),0)/r),H(ab(Sr.from(a,a.byteOffset,a.byteLength)))})),l++},f=0,d=(o=h[c]).paths;f<d.length;f++){var m=p(d[f]);if("object"==typeof m)return m.value}return sy(u)}At().set("WEBGL_FORCE_F16_TEXTURES",!0);var hb,pb,fb=function(){function r(){this._initialized=!1}return r.prototype.getWidth=function(){return this._modelConfig?this._modelConfig.inWidth:0},r.prototype.getHeight=function(){return this._modelConfig?this._modelConfig.inHeight:0},r.prototype.isInitialized=function(){return this._initialized},r.prototype.getOutput=function(){return this._cnnOutputData},r.prototype.initialize=function(r,a,s){return t(this,void 0,void 0,(function(){var t,o,i,u,l=this;return n(this,(function(n){switch(n.label){case 0:if(null==r)throw"Invalid parameter";return this.release(),this._videoManager=r,this._config=a?e(e({},ay),a):ay,t=ob(this._config.filename,"config.json"),o=t.model$,i=t.progress$,u=i.pipe(K((function(e){return s&&s(e)}))).subscribe(),[4,o.pipe(K((function(e){var t=e.config,n=e.graphModel;l._modelConfig=t,l._model=n;var r=Mi([1,l._modelConfig.inHeight,l._modelConfig.inWidth,l._modelConfig.inChannels]),a=l._model.predict(r,{batchSize:1,verbose:!0});Array.isArray(a)?a.forEach((function(e){e.dispose()})):a.dispose(),l._cnnOutput=Mi([1,l._modelConfig.inHeight,l._modelConfig.inWidth,1]),r.dispose(),l._initialized=!0})),Z((function(){return u.unsubscribe()}))).toPromise()];case 1:return n.sent(),[2]}}))}))},r.prototype.processSync=function(){var e;if(this._initialized){var t=this._videoManager.getLastBuffer();if(null!=t){var n,r=ls(t),a=Nl.resizeBilinear(r,[this._modelConfig.inHeight,this._modelConfig.inWidth]),s=qa(a,"float32"),o=ro(s,[1,this._modelConfig.inHeight,this._modelConfig.inWidth,3]),i=Yo(255);if(4==this._modelConfig.inChannels){var u=ro(this._cnnOutput,[1,this._modelConfig.inHeight,this._modelConfig.inWidth,1]),l=As(o,i);n=io([l,u],3),l.dispose(),u.dispose()}else n=As(o,i);var c,h=this._model.predict(n);c=Array.isArray(h)?h[2]:h,null===(e=this._cnnOutput)||void 0===e||e.dispose();var p=c.shape;if(p&&p[3]>1){var f=bu(c);this._cnnOutput=lo(f,[0,0,0,1],[-1,-1,-1,1]),f.dispose(),this._cnnOutputData=this._cnnOutput.dataSync()}else this._cnnOutput=vo(c,0,1),this._cnnOutputData=this._cnnOutput.dataSync();Array.isArray(h)?h.forEach((function(e){e.dispose()})):h.dispose(),r.dispose(),a.dispose(),s.dispose(),o.dispose(),i.dispose(),n.dispose()}else console.error("No video frame to process")}else console.error("Foot must be initialized to track")},r.prototype.release=function(){var e,t;null===(e=this._cnnOutput)||void 0===e||e.dispose(),null===(t=this._model)||void 0===t||t.dispose(),this._initialized=!1},r}(),db=(hb="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,r;e=e||{},t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){n=e,r=t}));var a=Object.assign({},t),s="./this.program",o="";"undefined"!=typeof document&&document.currentScript&&(o=document.currentScript.src),hb&&(o=hb),o=0!==o.indexOf("blob:")?o.substr(0,o.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var i,u=t.print||console.log.bind(console),l=t.printErr||console.warn.bind(console);Object.assign(t,a),a=null,t.thisProgram&&(s=t.thisProgram),t.wasmBinary&&(i=t.wasmBinary),t.noExitRuntime,"object"!=typeof WebAssembly&&O("no native wasm support detected");var c,h,p,f,d,m,g,y,b,v=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function _(e,t){for(var n=t+NaN,r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&x)return x.decode(e.subarray(t,r));for(n="";t<r;){var a=e[t++];if(128&a){var s=63&e[t++];if(192==(224&a))n+=String.fromCharCode((31&a)<<6|s);else{var o=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|s<<6|o:(7&a)<<18|s<<12|o<<6|63&e[t++])?n+=String.fromCharCode(a):(a-=65536,n+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else n+=String.fromCharCode(a)}return n}function w(e){return e?_(f,e):""}function T(e,t,n,r){if(!(0<r))return 0;var a=n;r=n+r-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(n+3>=r)break;t[n++]=240|o>>18,t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-a}function E(){var e=c.buffer;h=e,t.HEAP8=p=new Int8Array(e),t.HEAP16=d=new Int16Array(e),t.HEAP32=m=new Int32Array(e),t.HEAPU8=f=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAPU32=g=new Uint32Array(e),t.HEAPF32=y=new Float32Array(e),t.HEAPF64=b=new Float64Array(e)}var S=[],I=[],k=[];function C(){var e=t.preRun.shift();S.unshift(e)}var N,A,$,R=0,F=null;function O(e){throw t.onAbort&&t.onAbort(e),l(e="Aborted("+e+")"),v=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function D(){return N.startsWith("data:application/octet-stream;base64,")}if(N="libxzimgPoseEstimation.wasm",!D()){var M=N;N=t.locateFile?t.locateFile(M,o):o+M}function L(){var e=N;try{if(e==N&&i)return new Uint8Array(i);throw"both async and sync fetching of the wasm failed"}catch(e){O(e)}}function P(e){for(;0<e.length;)e.shift()(t)}function B(e){this.F=e-24,this.ta=function(e){g[this.F+4>>2]=e},this.oa=function(e){g[this.F+8>>2]=e},this.pa=function(){m[this.F>>2]=0},this.ma=function(){p[this.F+12>>0]=0},this.qa=function(){p[this.F+13>>0]=0},this.I=function(e,t){this.la(),this.ta(e),this.oa(t),this.pa(),this.ma(),this.qa()},this.la=function(){g[this.F+16>>2]=0}}var U=(e,t)=>{for(var n=0,r=e.length-1;0<=r;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},z=e=>{var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=U(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},V=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."},W=e=>{if("/"===e)return"/";var t=(e=(e=z(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)};function j(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!=typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=U(e.split("/").filter((e=>!!e)),!t).join("/"))||"."}function G(e,t){for(var n=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);127>=a?n++:2047>=a?n+=2:55296<=a&&57343>=a?(n+=4,++r):n+=3}return e=T(e,n=Array(n+1),0,n.length),t&&(n.length=e),n}var H=[];function K(e,t){H[e]={input:[],m:[],J:t},_e(e,J)}var q,X,Y,Q,J={open:function(e){var t=H[e.node.P];if(!t)throw new ue(43);e.l=t,e.seekable=!1},close:function(e){e.l.J.M(e.l)},M:function(e){e.l.J.M(e.l)},read:function(e,t,n,r){if(!e.l||!e.l.J.ca)throw new ue(60);for(var a=0,s=0;s<r;s++){try{var o=e.l.J.ca(e.l)}catch(e){throw new ue(29)}if(void 0===o&&0===a)throw new ue(6);if(null==o)break;a++,t[n+s]=o}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,n,r){if(!e.l||!e.l.J.V)throw new ue(60);try{for(var a=0;a<r;a++)e.l.J.V(e.l,t[n+a])}catch(e){throw new ue(29)}return r&&(e.node.timestamp=Date.now()),a}},Z={ca:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=G(t,!0)}return e.input.shift()},V:function(e,t){null===t||10===t?(u(_(e.m,0)),e.m=[]):0!=t&&e.m.push(t)},M:function(e){e.m&&0<e.m.length&&(u(_(e.m,0)),e.m=[])}},ee={V:function(e,t){null===t||10===t?(l(_(e.m,0)),e.m=[]):0!=t&&e.m.push(t)},M:function(e){e.m&&0<e.m.length&&(l(_(e.m,0)),e.m=[])}},te={o:null,v:function(){return te.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new ue(63);return te.o||(te.o={dir:{node:{B:te.h.B,s:te.h.s,K:te.h.K,N:te.h.N,ha:te.h.ha,ja:te.h.ja,ia:te.h.ia,ga:te.h.ga,R:te.h.R},stream:{D:te.i.D}},file:{node:{B:te.h.B,s:te.h.s},stream:{D:te.i.D,read:te.i.read,write:te.i.write,Y:te.i.Y,da:te.i.da,fa:te.i.fa}},link:{node:{B:te.h.B,s:te.h.s,L:te.h.L},stream:{}},Z:{node:{B:te.h.B,s:te.h.s},stream:xe}}),16384==(61440&(n=de(e,t,n,r)).mode)?(n.h=te.o.dir.node,n.i=te.o.dir.stream,n.g={}):32768==(61440&n.mode)?(n.h=te.o.file.node,n.i=te.o.file.stream,n.j=0,n.g=null):40960==(61440&n.mode)?(n.h=te.o.link.node,n.i=te.o.link.stream):8192==(61440&n.mode)&&(n.h=te.o.Z.node,n.i=te.o.Z.stream),n.timestamp=Date.now(),e&&(e.g[t]=n,e.timestamp=n.timestamp),n},Ga:function(e){return e.g?e.g.subarray?e.g.subarray(0,e.j):new Uint8Array(e.g):new Uint8Array(0)},$:function(e,t){var n=e.g?e.g.length:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)>>>0),0!=n&&(t=Math.max(t,256)),n=e.g,e.g=new Uint8Array(t),0<e.j&&e.g.set(n.subarray(0,e.j),0))},ua:function(e,t){if(e.j!=t)if(0==t)e.g=null,e.j=0;else{var n=e.g;e.g=new Uint8Array(t),n&&e.g.set(n.subarray(0,Math.min(t,e.j))),e.j=t}},h:{B:function(e){var t={};return t.Fa=8192==(61440&e.mode)?e.id:1,t.Ia=e.id,t.mode=e.mode,t.Ka=1,t.uid=0,t.Ha=0,t.P=e.P,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.j:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.Ca=new Date(e.timestamp),t.Ja=new Date(e.timestamp),t.Ea=new Date(e.timestamp),t.ka=4096,t.Da=Math.ceil(t.size/t.ka),t},s:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&te.ua(e,t.size)},K:function(){throw le[44]},N:function(e,t,n,r){return te.createNode(e,t,n,r)},ha:function(e,t,n){if(16384==(61440&e.mode)){try{var r=fe(t,n)}catch(e){}if(r)for(var a in r.g)throw new ue(55)}delete e.parent.g[e.name],e.parent.timestamp=Date.now(),e.name=n,t.g[n]=e,t.timestamp=e.parent.timestamp,e.parent=t},ja:function(e,t){delete e.g[t],e.timestamp=Date.now()},ia:function(e,t){var n,r=fe(e,t);for(n in r.g)throw new ue(55);delete e.g[t],e.timestamp=Date.now()},ga:function(e){var t,n=[".",".."];for(t in e.g)e.g.hasOwnProperty(t)&&n.push(t);return n},R:function(e,t,n){return(e=te.createNode(e,t,41471,0)).link=n,e},L:function(e){if(40960!=(61440&e.mode))throw new ue(28);return e.link}},i:{read:function(e,t,n,r,a){var s=e.node.g;if(a>=e.node.j)return 0;if(8<(e=Math.min(e.node.j-a,r))&&s.subarray)t.set(s.subarray(a,a+e),n);else for(r=0;r<e;r++)t[n+r]=s[a+r];return e},write:function(e,t,n,r,a,s){if(t.buffer===p.buffer&&(s=!1),!r)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.g||e.g.subarray)){if(s)return e.g=t.subarray(n,n+r),e.j=r;if(0===e.j&&0===a)return e.g=t.slice(n,n+r),e.j=r;if(a+r<=e.j)return e.g.set(t.subarray(n,n+r),a),r}if(te.$(e,a+r),e.g.subarray&&t.subarray)e.g.set(t.subarray(n,n+r),a);else for(s=0;s<r;s++)e.g[a+s]=t[n+s];return e.j=Math.max(e.j,a+r),r},D:function(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.node.mode)&&(t+=e.node.j),0>t)throw new ue(28);return t},Y:function(e,t,n){te.$(e.node,t+n),e.node.j=Math.max(e.node.j,t+n)},da:function(e,t,n,r,a){if(32768!=(61440&e.node.mode))throw new ue(43);if(e=e.node.g,2&a||e.buffer!==h){if((0<n||n+t<e.length)&&(e=e.subarray?e.subarray(n,n+t):Array.prototype.slice.call(e,n,n+t)),n=!0,O(),!(t=void 0))throw new ue(48);p.set(e,t)}else n=!1,t=e.byteOffset;return{F:t,Ba:n}},fa:function(e,t,n,r,a){if(32768!=(61440&e.node.mode))throw new ue(43);return 2&a||te.i.write(e,t,0,r,n,!1),0}}},ne=null,re={},ae=[],se=1,oe=null,ie=!0,ue=null,le={},ce=(e,t={})=>{if(!(e=j("/",e)))return{path:"",node:null};if(8<(t=Object.assign({ba:!0,W:0},t)).W)throw new ue(32);e=U(e.split("/").filter((e=>!!e)),!1);for(var n=ne,r="/",a=0;a<e.length;a++){var s=a===e.length-1;if(s&&t.parent)break;if(n=fe(n,e[a]),r=z(r+"/"+e[a]),n.O&&(!s||s&&t.ba)&&(n=n.O.root),!s||t.aa)for(s=0;40960==(61440&n.mode);)if(n=Ie(r),r=j(V(r),n),n=ce(r,{W:t.W+1}).node,40<s++)throw new ue(32)}return{path:r,node:n}},he=e=>{for(var t;;){if(e===e.parent)return e=e.v.ea,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}},pe=(e,t)=>{for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%oe.length},fe=(e,t)=>{var n;if(n=(n=ye(e,"x"))?n:e.h.K?0:2)throw new ue(n,e);for(n=oe[pe(e.id,t)];n;n=n.sa){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.h.K(e,t)},de=(e,t,n,r)=>(e=new Ve(e,t,n,r),t=pe(e.parent.id,e.name),e.sa=oe[t],oe[t]=e),me={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},ge=e=>{var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},ye=(e,t)=>ie?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2,be=(e,t)=>{try{return fe(e,t),20}catch(e){}return ye(e,"wx")},ve=(e,t)=>(Y||((Y=function(){this.I={}}).prototype={},Object.defineProperties(Y.prototype,{object:{get:function(){return this.node},set:function(e){this.node=e}},flags:{get:function(){return this.I.flags},set:function(e){this.I.flags=e}},position:{get:function(){return this.I.position},set:function(e){this.I.position=e}}})),e=Object.assign(new Y,e),t=((e=0)=>{for(;4096>=e;e++)if(!ae[e])return e;throw new ue(33)})(t),e.A=t,ae[t]=e),xe={open:e=>{e.i=re[e.node.P].i,e.i.open&&e.i.open(e)},D:()=>{throw new ue(70)}},_e=(e,t)=>{re[e]={i:t}},we=(e,t)=>{var n="/"===t,r=!t;if(n&&ne)throw new ue(10);if(!n&&!r){var a=ce(t,{ba:!1});if(t=a.path,(a=a.node).O)throw new ue(10);if(16384!=(61440&a.mode))throw new ue(54)}t={type:e,La:{},ea:t,ra:[]},(e=e.v(t)).v=t,t.root=e,n?ne=e:a&&(a.O=t,a.v&&a.v.ra.push(t))},Te=(e,t,n)=>{var r=ce(e,{parent:!0}).node;if(!(e=W(e))||"."===e||".."===e)throw new ue(28);var a=be(r,e);if(a)throw new ue(a);if(!r.h.N)throw new ue(63);return r.h.N(r,e,t,n)},Ee=(e,t,n)=>{void 0===n&&(n=t,t=438),Te(e,8192|t,n)},Se=(e,t)=>{if(!j(e))throw new ue(44);var n=ce(t,{parent:!0}).node;if(!n)throw new ue(44);t=W(t);var r=be(n,t);if(r)throw new ue(r);if(!n.h.R)throw new ue(63);n.h.R(n,t,e)},Ie=e=>{if(!(e=ce(e).node))throw new ue(44);if(!e.h.L)throw new ue(28);return j(he(e.parent),e.h.L(e))},ke=(e,n,r)=>{if(""===e)throw new ue(44);if("string"==typeof n){var a=me[n];if(void 0===a)throw Error("Unknown file open mode: "+n);n=a}if(r=64&n?4095&(void 0===r?438:r)|32768:0,"object"==typeof e)var s=e;else{e=z(e);try{s=ce(e,{aa:!(131072&n)}).node}catch(e){}}if(a=!1,64&n)if(s){if(128&n)throw new ue(20)}else s=Te(e,r,0),a=!0;if(!s)throw new ue(44);if(8192==(61440&s.mode)&&(n&=-513),65536&n&&16384!=(61440&s.mode))throw new ue(54);if(!a&&(r=s?40960==(61440&s.mode)?32:16384==(61440&s.mode)&&("r"!==ge(n)||512&n)?31:ye(s,ge(n)):44))throw new ue(r);if(512&n&&!a){if(!(r="string"==typeof(r=s)?ce(r,{aa:!0}).node:r).h.s)throw new ue(63);if(16384==(61440&r.mode))throw new ue(31);if(32768!=(61440&r.mode))throw new ue(28);if(a=ye(r,"w"))throw new ue(a);r.h.s(r,{size:0,timestamp:Date.now()})}return n&=-131713,(s=ve({node:s,path:he(s),flags:n,seekable:!0,position:0,i:s.i,Aa:[],error:!1})).i.open&&s.i.open(s),!t.logReadFiles||1&n||(Q||(Q={}),e in Q||(Q[e]=1)),s},Ce=(e,t,n)=>{if(null===e.A)throw new ue(8);if(!e.seekable||!e.i.D)throw new ue(70);if(0!=n&&1!=n&&2!=n)throw new ue(28);e.position=e.i.D(e,t,n),e.Aa=[]},Ne=()=>{ue||((ue=function(e,t){this.node=t,this.va=function(e){this.C=e},this.va(e),this.message="FS error"}).prototype=Error(),ue.prototype.constructor=ue,[44].forEach((e=>{le[e]=new ue(e),le[e].stack="<generic error, no stack>"})))},Ae=(e,t,n)=>{e=z("/dev/"+e);var r=((e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n})(!!t,!!n);X||(X=64);var a=X++<<8|0;_e(a,{open:e=>{e.seekable=!1},close:()=>{n&&n.buffer&&n.buffer.length&&n(10)},read:(e,n,r,a)=>{for(var s=0,o=0;o<a;o++){try{var i=t()}catch(e){throw new ue(29)}if(void 0===i&&0===s)throw new ue(6);if(null==i)break;s++,n[r+o]=i}return s&&(e.node.timestamp=Date.now()),s},write:(e,t,r,a)=>{for(var s=0;s<a;s++)try{n(t[r+s])}catch(e){throw new ue(29)}return a&&(e.node.timestamp=Date.now()),s}}),Ee(e,r,a)},$e={},Re=void 0;function Fe(){return m[(Re+=4)-4>>2]}function Oe(e){if(!(e=ae[e]))throw new ue(8);return e}var De,Me={};function Le(){if(!De){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(e in Me)void 0===Me[e]?delete t[e]:t[e]=Me[e];var n=[];for(e in t)n.push(e+"="+t[e]);De=n}return De}function Pe(e){return 0==e%4&&(0!=e%100||0==e%400)}var Be=[31,29,31,30,31,30,31,31,30,31,30,31],Ue=[31,28,31,30,31,30,31,31,30,31,30,31];function ze(e,n,r,a){var s={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);t=Xe(n),T(e,f,t,n)}return t},array:e=>{var t=Xe(e.length);return p.set(e,t),t}};e=t["_"+e];var o,i=[],u=0;if(a)for(var l=0;l<a.length;l++){var c=s[r[l]];c?(0===u&&(u=Ke()),i[l]=c(a[l])):i[l]=a[l]}return o=r=e.apply(null,i),0!==u&&qe(u),"string"===n?w(o):"boolean"===n?!!o:o}function Ve(e,t,n,r){e||(e=this),this.parent=e,this.v=e.v,this.O=null,this.id=se++,this.name=t,this.mode=n,this.h={},this.i={},this.P=r}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le"),Object.defineProperties(Ve.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}}),Ne(),oe=Array(4096),we(te,"/"),Te("/tmp",16895,0),Te("/home",16895,0),Te("/home/web_user",16895,0),(()=>{Te("/dev",16895,0),_e(259,{read:()=>0,write:(e,t,n,r)=>r}),Ee("/dev/null",259),K(1280,Z),K(1536,ee),Ee("/dev/tty",1280),Ee("/dev/tty1",1536);var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}return()=>O("randomDevice")}();Ae("random",e),Ae("urandom",e),Te("/dev/shm",16895,0),Te("/dev/shm/tmp",16895,0)})(),(()=>{Te("/proc",16895,0);var e=Te("/proc/self",16895,0);Te("/proc/self/fd",16895,0),we({v:()=>{var t=de(e,"fd",16895,73);return t.h={K:(e,t)=>{var n=ae[+t];if(!n)throw new ue(8);return(e={parent:null,v:{ea:"fake"},h:{L:()=>n.path}}).parent=e}},t}},"/proc/self/fd")})();var We={__assert_fail:function(e,t,n,r){O("Assertion failed: "+w(e)+", at: "+[t?w(t):"unknown filename",n,r?w(r):"unknown function"])},__cxa_allocate_exception:function(e){return je(e+24)+24},__cxa_throw:function(e,t,n){throw new B(e).I(t,n),e},__syscall_fcntl64:function(e,t,n){Re=n;try{var r=Oe(e);switch(t){case 0:var a=Fe();return 0>a?-28:ve(r,a).A;case 1:case 2:case 6:case 7:return 0;case 3:return r.flags;case 4:return a=Fe(),r.flags|=a,0;case 5:return a=Fe(),d[a+0>>1]=2,0;case 16:case 8:default:return-28;case 9:return m[He()>>2]=28,-1}}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return-e.C}},__syscall_ioctl:function(e,t,n){Re=n;try{var r=Oe(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return r.l?0:-59;case 21519:if(!r.l)return-59;var a=Fe();return m[a>>2]=0;case 21520:return r.l?-28:-59;case 21531:if(e=a=Fe(),!r.i.na)throw new ue(59);return r.i.na(r,t,e);default:return-28}}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return-e.C}},__syscall_openat:function(e,t,n,r){Re=r;try{var a=t=w(t);if("/"===a.charAt(0))t=a;else{var s=-100===e?"/":Oe(e).path;if(0==a.length)throw new ue(44);t=z(s+"/"+a)}var o=r?Fe():0;return ke(t,n,o).A}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return-e.C}},abort:function(){O("")},emscripten_memcpy_big:function(e,t,n){f.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){var t=f.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math;r=Math.max(e,r),a=a.min.call(a,2147483648,r+(65536-r%65536)%65536);e:{try{c.grow(a-h.byteLength+65535>>>16),E();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1},environ_get:function(e,t){var n=0;return Le().forEach((function(r,a){var s=t+n;for(a=g[e+4*a>>2]=s,s=0;s<r.length;++s)p[a++>>0]=r.charCodeAt(s);p[a>>0]=0,n+=r.length+1})),0},environ_sizes_get:function(e,t){var n=Le();g[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),g[t>>2]=r,0},fd_close:function(e){try{var t=Oe(e);if(null===t.A)throw new ue(8);t.U&&(t.U=null);try{t.i.close&&t.i.close(t)}catch(e){throw e}finally{ae[t.A]=null}return t.A=null,0}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return e.C}},fd_read:function(e,t,n,r){try{e:{var a=Oe(e);e=t;for(var s=t=0;s<n;s++){var o=g[e>>2],i=g[e+4>>2];e+=8;var u=a,l=o,c=i,h=void 0,f=p;if(0>c||0>h)throw new ue(28);if(null===u.A)throw new ue(8);if(1==(2097155&u.flags))throw new ue(8);if(16384==(61440&u.node.mode))throw new ue(31);if(!u.i.read)throw new ue(28);var d=void 0!==h;if(d){if(!u.seekable)throw new ue(70)}else h=u.position;var m=u.i.read(u,f,l,c,h);d||(u.position+=m);var y=m;if(0>y){var b=-1;break e}if(t+=y,y<i)break}b=t}return g[r>>2]=b,0}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return e.C}},fd_seek:function(e,t,n,r,a){try{if(t=n+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*n:NaN,isNaN(t))return 61;var s=Oe(e);return Ce(s,t,r),$=[s.position>>>0,(A=s.position,1<=+Math.abs(A)?0<A?(0|Math.min(+Math.floor(A/4294967296),4294967295))>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],m[a>>2]=$[0],m[a+4>>2]=$[1],s.U&&0===t&&0===r&&(s.U=null),0}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return e.C}},fd_write:function(e,t,n,r){try{e:{var a=Oe(e);e=t;for(var s=t=0;s<n;s++){var o=g[e>>2],i=g[e+4>>2];e+=8;var u=a,l=o,c=i,h=void 0,f=p;if(0>c||0>h)throw new ue(28);if(null===u.A)throw new ue(8);if(0==(2097155&u.flags))throw new ue(8);if(16384==(61440&u.node.mode))throw new ue(31);if(!u.i.write)throw new ue(28);u.seekable&&1024&u.flags&&Ce(u,0,2);var d=void 0!==h;if(d){if(!u.seekable)throw new ue(70)}else h=u.position;var m=u.i.write(u,f,l,c,h,void 0);d||(u.position+=m);var y=m;if(0>y){var b=-1;break e}t+=y}b=t}return g[r>>2]=b,0}catch(e){if(void 0===$e||!(e instanceof ue))throw e;return e.C}},strftime_l:function(e,t,n,r){return function(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function s(e,t){return a(e,t,"0")}function o(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function i(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function u(e){var t=e.G;for(e=new Date(new Date(e.H+1900,0,1).getTime());0<t;){var n=e.getMonth(),r=(Pe(e.getFullYear())?Be:Ue)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return n=new Date(e.getFullYear()+1,0,4),t=i(new Date(e.getFullYear(),0,4)),n=i(n),0>=o(t,e)?0>=o(n,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var l=m[r+40>>2];for(var c in r={ya:m[r>>2],xa:m[r+4>>2],S:m[r+8>>2],X:m[r+12>>2],T:m[r+16>>2],H:m[r+20>>2],u:m[r+24>>2],G:m[r+28>>2],Ma:m[r+32>>2],wa:m[r+36>>2],za:l?w(l):""},n=w(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),f="January February March April May June July August September October November December".split(" ");for(c in l={"%a":function(e){return h[e.u].substring(0,3)},"%A":function(e){return h[e.u]},"%b":function(e){return f[e.T].substring(0,3)},"%B":function(e){return f[e.T]},"%C":function(e){return s((e.H+1900)/100|0,2)},"%d":function(e){return s(e.X,2)},"%e":function(e){return a(e.X,2," ")},"%g":function(e){return u(e).toString().substring(2)},"%G":function(e){return u(e)},"%H":function(e){return s(e.S,2)},"%I":function(e){return 0==(e=e.S)?e=12:12<e&&(e-=12),s(e,2)},"%j":function(e){for(var t=0,n=0;n<=e.T-1;t+=(Pe(e.H+1900)?Be:Ue)[n++]);return s(e.X+t,3)},"%m":function(e){return s(e.T+1,2)},"%M":function(e){return s(e.xa,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.S&&12>e.S?"AM":"PM"},"%S":function(e){return s(e.ya,2)},"%t":function(){return"\t"},"%u":function(e){return e.u||7},"%U":function(e){return s(Math.floor((e.G+7-e.u)/7),2)},"%V":function(e){var t=Math.floor((e.G+7-(e.u+6)%7)/7);if(2>=(e.u+371-e.G-2)%7&&t++,t)53==t&&(4==(n=(e.u+371-e.G)%7)||3==n&&Pe(e.H)||(t=1));else{t=52;var n=(e.u+7-e.G-1)%7;(4==n||5==n&&Pe(e.H%400-1))&&t++}return s(t,2)},"%w":function(e){return e.u},"%W":function(e){return s(Math.floor((e.G+7-(e.u+6)%7)/7),2)},"%y":function(e){return(e.H+1900).toString().substring(2)},"%Y":function(e){return e.H+1900},"%z":function(e){var t=0<=(e=e.wa);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.za},"%%":function(){return"%"}},n=n.replace(/%%/g,"\0\0"),l)n.includes(c)&&(n=n.replace(new RegExp(c,"g"),l[c](r)));return(c=G(n=n.replace(/\0\0/g,"%"),!1)).length>t?0:(p.set(c,e),c.length-1)}(e,t,n,r)}};!function(){function e(e){t.asm=e.exports,c=t.asm.memory,E(),I.unshift(t.asm.__wasm_call_ctors),R--,t.monitorRunDependencies&&t.monitorRunDependencies(R),0==R&&F&&(e=F,F=null,e())}function n(t){e(t.instance)}function a(e){return(i||"function"!=typeof fetch?Promise.resolve().then((function(){return L()})):fetch(N,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+N+"'";return e.arrayBuffer()})).catch((function(){return L()}))).then((function(e){return WebAssembly.instantiate(e,s)})).then((function(e){return e})).then(e,(function(e){l("failed to asynchronously prepare wasm: "+e),O(e)}))}var s={env:We,wasi_snapshot_preview1:We};if(R++,t.monitorRunDependencies&&t.monitorRunDependencies(R),t.instantiateWasm)try{return t.instantiateWasm(s,e)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e),!1}(i||"function"!=typeof WebAssembly.instantiateStreaming||D()||"function"!=typeof fetch?a(n):fetch(N,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,s).then(n,(function(e){return l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.__wasm_call_ctors).apply(null,arguments)};var je=t._malloc=function(){return(je=t._malloc=t.asm.malloc).apply(null,arguments)};t._free=function(){return(t._free=t.asm.free).apply(null,arguments)},t._xzimgInitializeCamera=function(){return(t._xzimgInitializeCamera=t.asm.xzimgInitializeCamera).apply(null,arguments)},t._xzimgPoseEstimationInitializeFacePose=function(){return(t._xzimgPoseEstimationInitializeFacePose=t.asm.xzimgPoseEstimationInitializeFacePose).apply(null,arguments)},t._xzimgPoseEstimationInitialize=function(){return(t._xzimgPoseEstimationInitialize=t.asm.xzimgPoseEstimationInitialize).apply(null,arguments)},t._xzimgPoseEstimationRelease=function(){return(t._xzimgPoseEstimationRelease=t.asm.xzimgPoseEstimationRelease).apply(null,arguments)},t._xzimgPoseEstimationPrepareCrop=function(){return(t._xzimgPoseEstimationPrepareCrop=t.asm.xzimgPoseEstimationPrepareCrop).apply(null,arguments)},t._xzimgPoseEstimationEstimateFacePose=function(){return(t._xzimgPoseEstimationEstimateFacePose=t.asm.xzimgPoseEstimationEstimateFacePose).apply(null,arguments)},t._xzimgGetHeatmapsLocations=function(){return(t._xzimgGetHeatmapsLocations=t.asm.xzimgGetHeatmapsLocations).apply(null,arguments)},t._xzimgEstimateRigidPose=function(){return(t._xzimgEstimateRigidPose=t.asm.xzimgEstimateRigidPose).apply(null,arguments)},t._xzimgEstimateGetSimilarity=function(){return(t._xzimgEstimateGetSimilarity=t.asm.xzimgEstimateGetSimilarity).apply(null,arguments)},t._xzimgWarpAffine=function(){return(t._xzimgWarpAffine=t.asm.xzimgWarpAffine).apply(null,arguments)},t._xzimgMatchRecKeypsInit=function(){return(t._xzimgMatchRecKeypsInit=t.asm.xzimgMatchRecKeypsInit).apply(null,arguments)},t._xzimgMatchRecKeyps=function(){return(t._xzimgMatchRecKeyps=t.asm.xzimgMatchRecKeyps).apply(null,arguments)},t._xzimgEstimateInitNonRigidPose=function(){return(t._xzimgEstimateInitNonRigidPose=t.asm.xzimgEstimateInitNonRigidPose).apply(null,arguments)},t._xzimgEstimateNonRigidPose=function(){return(t._xzimgEstimateNonRigidPose=t.asm.xzimgEstimateNonRigidPose).apply(null,arguments)},t._xzimgEstimateBodyNonRigidPose=function(){return(t._xzimgEstimateBodyNonRigidPose=t.asm.xzimgEstimateBodyNonRigidPose).apply(null,arguments)},t._xzimgEstimateNonRigidPoseBase=function(){return(t._xzimgEstimateNonRigidPoseBase=t.asm.xzimgEstimateNonRigidPoseBase).apply(null,arguments)},t._xzimgEstimateGetNumVertices=function(){return(t._xzimgEstimateGetNumVertices=t.asm.xzimgEstimateGetNumVertices).apply(null,arguments)},t._xzimgEstimateGetDenseVertices=function(){return(t._xzimgEstimateGetDenseVertices=t.asm.xzimgEstimateGetDenseVertices).apply(null,arguments)};var Ge,He=t.___errno_location=function(){return(He=t.___errno_location=t.asm.__errno_location).apply(null,arguments)},Ke=t.stackSave=function(){return(Ke=t.stackSave=t.asm.stackSave).apply(null,arguments)},qe=t.stackRestore=function(){return(qe=t.stackRestore=t.asm.stackRestore).apply(null,arguments)},Xe=t.stackAlloc=function(){return(Xe=t.stackAlloc=t.asm.stackAlloc).apply(null,arguments)};function Ye(){function e(){if(!Ge&&(Ge=!0,t.calledRun=!0,!v)){if(t.noFSInit||q||(q=!0,Ne(),t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?Ae("stdin",t.stdin):Se("/dev/tty","/dev/stdin"),t.stdout?Ae("stdout",null,t.stdout):Se("/dev/tty","/dev/stdout"),t.stderr?Ae("stderr",null,t.stderr):Se("/dev/tty1","/dev/stderr"),ke("/dev/stdin",0),ke("/dev/stdout",1),ke("/dev/stderr",1)),ie=!1,P(I),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();k.unshift(e)}P(k)}}if(!(0<R)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)C();P(S),0<R||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),e()}),1)):e())}}if(t.___cxa_is_pointer_type=function(){return(t.___cxa_is_pointer_type=t.asm.__cxa_is_pointer_type).apply(null,arguments)},t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.dynCall_jiji).apply(null,arguments)},t.dynCall_viijii=function(){return(t.dynCall_viijii=t.asm.dynCall_viijii).apply(null,arguments)},t.dynCall_iiiiij=function(){return(t.dynCall_iiiiij=t.asm.dynCall_iiiiij).apply(null,arguments)},t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.dynCall_iiiiijj).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.dynCall_iiiiiijj).apply(null,arguments)},t.ccall=ze,t.cwrap=function(e,n,r,a){var s=(r=r||[]).every((e=>"number"===e||"boolean"===e));return"string"!==n&&s&&!a?t["_"+e]:function(){return ze(e,n,r,arguments)}},t.setValue=function(e,t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":p[e>>0]=t;break;case"i16":d[e>>1]=t;break;case"i32":m[e>>2]=t;break;case"i64":$=[t>>>0,(A=t,1<=+Math.abs(A)?0<A?(0|Math.min(+Math.floor(A/4294967296),4294967295))>>>0:~~+Math.ceil((A-+(~~A>>>0))/4294967296)>>>0:0)],m[e>>2]=$[0],m[e+4>>2]=$[1];break;case"float":y[e>>2]=t;break;case"double":b[e>>3]=t;break;case"*":g[e>>2]=t;break;default:O("invalid type for setValue: "+n)}},t.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return p[e>>0];case"i16":return d[e>>1];case"i32":case"i64":return m[e>>2];case"float":return y[e>>2];case"double":return b[e>>3];case"*":return g[e>>2];default:O("invalid type for getValue: "+t)}return null},F=function e(){Ge||Ye(),Ge||(F=e)},t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return Ye(),e.ready}),mb={modelFilename:"",featuresFilename:"",objFilename:"",fovY:50,detection_score_t:.2,tracking_score_t:.4,footToDetect:"RIGHT_FOOT",filteringLevel:2,filteringShift:.5};function gb(e,t){e.length;var n=function(e,t){var n=e.length/2,r=xb(n,t),a=r[0],s=r[1],o=[e[a],e[a+n]],i=[e[s],e[s+n]],u=[(o[0]+i[0])/2,(o[1]+i[1])/2],l=-Math.atan2(o[1]-i[1],i[0]-o[0]),c=Math.sqrt((o[0]-i[0])*(o[0]-i[0])+(o[1]-i[1])*(o[1]-i[1]));return[u[0],u[1],l,c]}(e,t),r=n[0],a=n[1],s=n[2],o=n[3],i=[Math.cos(s),Math.sin(s)],u=[-i[1],i[0]],l=o/1,c=o/2;return[r+i[0]*l+u[0]*c,a+i[1]*l+u[1]*c,r+i[0]*l-u[0]*c,a+i[1]*l-u[1]*c,r-i[0]*l-u[0]*c,a-i[1]*l-u[1]*c,r-i[0]*l+u[0]*c,a-i[1]*l+u[1]*c]}function yb(e,t){for(var n=1e4,r=1e4,a=-1e4,s=-1e4,o=0;o<t;o++){var i=e[o],u=e[t+o];i>a&&(a=i),u>s&&(s=u),i<n&&(n=i),u<r&&(r=u)}return[Math.floor(n),Math.floor(a+1),Math.floor(r),Math.floor(s+1)]}function bb(e,t){var n=0,r=e.length;if(6==r&&"RIGHT_FOOT"==t){for(var a=3;a<r;a++)n+=e[a];n/=3}else if(6==r&&"LEFT_FOOT"==t){for(a=0;a<3;a++)n+=e[a];n/=3}else{for(a=0;a<r;a++)n+=e[a];n/=r}return n}function vb(e,t,n,r){var a=Float32Array.from(e),s=e.length/2;if(n)for(var o=0;o<s;o++)a[o+s]=r-1-a[o+s];for(o=0;o<s;o++){var i=a[o],u=a[o+s];a[o]=t[0]*i+t[1]*u+t[2],a[o+s]=t[3]*i+t[4]*u+t[5]}return a}function xb(e,t){if(void 0===t&&(t="face"),"face"==t){if(5==e)return[0,1];if(19==e)return[6,11];if(21==e)return[17,20];if(51==e)return[19,28];if(68==e)return[36,45];if(16==e)return[6,9]}return"eye"==t?[0,1]:6==e&&"RIGHT_FOOT"==t?[3,5]:6==e&&"LEFT_FOOT"==t?[0,2]:18!=e||"RIGHT_FOOT"!=t&&"LEFT_FOOT"!=t?13!=e||"RIGHT_FOOT"!=t&&"LEFT_FOOT"!=t?"hand"==t&&8==e?[7,0]:(console.error("no type or number of feature match"),[0,1]):[0,6]:[0,9]}function _b(e,t){var n=e.length/2,r=xb(n,t),a=r[0],s=r[1],o=[e[a],e[a+n]],i=[e[s],e[s+n]],u=[(4*o[0]+i[0])/5,(4*o[1]+i[1])/5],l=-Math.atan2(o[1]-i[1],i[0]-o[0]);return[u[0],u[1],l]}function wb(e,t,n){for(var r=n[0],a=n[1],s=n[2],o=n[3],i=n[4],u=n[5],l=e.width,c=e.height,h=4*e.width,p=t.width,f=t.height,d=4*t.width,m=0;m<f;m++)for(var g=a*m+s,y=i*m+u,b=m*d,v=0;v<p;v++){var x=4*v,_=Math.floor(g),w=Math.floor(y),T=g-_,E=y-w,S=void 0,I=void 0;if(_>0&&_<l-1&&w>0&&w<c-1){for(var k=w*h+4*_,C=0;C<3;C++,k++){var N=e.data[k];S=N+T*(e.data[k+4]-N),I=e.data[k+h]+T*(e.data[k+h+4]-e.data[k+h]),t.data[b+x+C]=S+E*(I-S)}t.data[b+x+3]=255}else{for(C=0;C<3;C++)t.data[b+x+C]=0;t.data[b+x+3]=255}g+=r,y+=o}return t}function Tb(e,t,n,r,a,s,o){var i,u,l=e.length/2;6!=l&&13!=l&&18!=l&&console.log("foot detection should return 6 features");var c=null,h=0;6==l?((i=_b(e,o))[0],i[1],h=i[2],c=yb("RIGHT_FOOT"==o?[e[3],e[4],e[5],e[3+l],e[4+l],e[5+l]]:[e[0],e[1],e[2],e[0+l],e[1+l],e[2+l]],3)):((u=_b(e,o))[0],u[1],h=u[2],c=yb(e,l)),c[2],c[0],c[3],c[1];var p=Math.cos(h),f=Math.sin(h),d=Math.sqrt((c[1]-c[0])*(c[1]-c[0])+(c[3]-c[2])*(c[3]-c[2])),m=(d+=.25*d)/Math.max(n,t),g=t/2,y=n/2,b=(c[0]+c[1])/2-(p*m*g-f*m*y),v=(c[2]+c[3])/2-(f*m*g+p*m*y);if(null!=s){var x=Math.sqrt((b-s[2])*(b-s[2])+(v-s[5])*(v-s[5])),_=1;x>20&&(_=.1),x>=10&&x<=20&&(_=1-.09*(x-5)),b=(1-_)*b+_*s[2],v=(1-_)*v+_*s[5],h=Math.abs(h-s[6])>1?(1-_)*h-_*s[6]:(1-_)*h+_*s[6],m=(1-_)*m+_*s[7],p=Math.cos(h),f=Math.sin(h)}return[p*m,-f*m,b,f*m,p*m,v,h,m]}function Eb(e,t){var n=e._malloc(4*t.length);return e.HEAPF32.set(t,n/4),n}function Sb(e,t,n){var r=new Float32Array(n),a=t/4;return r.set(e.HEAPF32.subarray(a,a+n)),r.slice()}function Ib(e,t,n){var r=new Uint32Array(t.data.buffer),a=r.length,s=n/4;e.HEAPU32.subarray(s,s+a).set(r)}function kb(e,t,n,r){var a=e._malloc(28);return e.setValue(a,n,"i32"),e.setValue(a+4,r,"i32"),e.setValue(a+8,t,"i32"),e.setValue(a+12,0,"i32"),e.setValue(a+16,4,"i32"),e.setValue(a+20,0,"i32"),e.setValue(a+24,0,"i32"),a}function Cb(e,t,n,r,a){var s=e.cwrap("xzimgMatchRecKeyps","number",["number","number","number","number","number"]),o=r.length/2;Ib(e,t,n);for(var i=kb(e,n,t.width,t.height),u=Eb(e,r),l=Eb(e,r.slice()),c=e._malloc(4*o),h=0;h<o;h++)e.setValue(c+4*h,1,"float"),a.length>h&&0==a[h]&&e.setValue(c+4*h,-1,"float");var p=e._malloc(16);s(i,u,l,o,c,p);var f=Sb(e,c,o),d=Sb(e,l,r.length),m=Sb(e,p,4);for(h=0;h<o;h++)0==f[h]&&(d[h]=r[h],d[h+o]=r[h+o]);return e._free(i),e._free(u),e._free(l),e._free(c),e._free(p),[d,m,f]}function Nb(e,t,n,r){var a=Eb(e,t),s=Eb(e,n),o=e._malloc(16);e.cwrap("xzimgEstimateGetSimilarity","number",["number","number","number","number"])(a,s,t.length/2,o);var i=Sb(e,o,4);return e._free(a),e._free(s),e._free(o),i}function Ab(e,t,n,r,a){var s=t/4,o=new Float32Array(18);o.set(e.HEAPF32.subarray(s,s+18)),o[9]+=n[2]*o[11]/r,o[10]+=n[3]*o[11]/a,e.HEAPF32.set(o,t/4)}function $b(e,t,n,r,a,s,o){void 0===a&&(a=null);for(var i=new Float32Array(2),u=n.length/2,l=0,c=0;c<u;c++)(null==a||a[c]>0)&&(i[0]+=r[c]-n[c],i[1]+=r[c+u]-n[c+u],l+=1);l>0&&(i[0]/=l,i[1]/=l);var h=t/4,p=new Float32Array(18);p.set(e.HEAPF32.subarray(h,h+18)),p[9]+=i[0]*p[11]/s,p[10]+=i[1]*p[11]/o,e.HEAPF32.set(p,t/4)}function Rb(e,t,n,r,a){void 0===a&&(a=!1);var s=function(e,t,n,r){for(var a=new Float32Array(r).fill(0),s=new Int32Array(2*r),o=t*n,i=0;i<o;i++)for(var u=0;u<r;u++){var l=e[i*r+u];l>a[u]&&(a[u]=l,s[u]=i%n,s[r+u]=Math.floor(i/n))}return[s,a]}(e,t,n,r),o=function(e,t,n,r,a){for(var s=[-r*a-a,-r*a,-r*a+a,-a,0,a,r*a-a,r*a,r*a+a],o=new Float32Array(a),i=new Float32Array(2*a),u=0;u<a;u++){var l=t[u],c=t[a+u];i[u]=l,i[a+u]=c;var h=c*r*a+l*a+u,p=0;p=0;for(var f=0;f<9;f++)p+=e[h+s[f]];p/=9,o[u]=p;var d=Math.min(l+2,r-1),m=Math.max(l-2,0),g=Math.min(c+2,n-1),y=Math.max(c-2,0),b=0,v=0,x=c*r*a+m*a+u,_=c*r*a+d*a+u;for(f=0;f<9;f++)b+=e[x+s[f]],v+=e[_+s[f]];var w=2*(2*p-((b/=9)+(v/=9)));if(Math.abs(w)>1e-5){var T=2*(v-b)/w;i[u]+=T}var E=0,S=0,I=y*r*a+l*a+u,k=g*r*a+l*a+u;for(f=0;f<9;f++)E+=e[I+s[f]],S+=e[k+s[f]];w=2*(2*p-((E/=9)+(S/=9))),Math.abs(w)>1e-5&&(T=2*(S-E)/w,i[a+u]+=T)}return[i,o]}(e,s[0],t,n,r),i=o[0],u=o[1];if(a)for(var l=0;l<r;l++)i[l]=n-1-i[l];return[i,u]}function Fb(e,t){var n=new ie(0),r=n.asObservable();if("string"==typeof e)return{model$:a=Ty({url:e,method:"GET",responseType:"text",async:!0,progressSubscriber:new _((function(e){return n.next(e.loaded/e.total)}),(function(e){}),(function(){return n.next(1)}))}).pipe(ue(2),K((function(e){return Ob(e.response,t)}))),progress$:r};var a=be((function(){return n.next(1),H(Ob(function(e){var t,n,r="",a=0,s=new Uint8Array(e);for(a=0;a<s.length;a++)if(s[a]<128)r+=String.fromCharCode(s[a]);else{s[a]<224?(t=(63&s[a])<<6,n=a+1):s[a]<240?(t=(31&s[a])<<12,n=a+2):s[a]<248?(t=(15&s[a])<<18,n=a+3):s[a]<252?(t=(7&s[a])<<24,n=a+4):(t=(3&s[a])<<30,n=a+5);do{t|=(127&s[++a])<<6*(n-a)}while(a!=n);r+=String.fromCharCode(t)}return r}(e),t))}));return{model$:a,progress$:r}}function Ob(e,t){var n,r,a,s,o={vertices:new Float32Array,uvs:new Float32Array,faces:new Uint16Array},i=e.match(/^v( -?\d+(\.\d+)?){3}$/gm);if(i){var u=i.map((function(e){var t=e.split(" ");return t.shift(),t.map((function(e){return+e}))})),l=(n=[]).concat.apply(n,u);o.vertices=new Float32Array(l)}var c=e.match(/^vt( -?\d+(\.\d+)?){2}$/gm);if(c){var h=c.map((function(e){var t=e.split(" ");return t.shift(),t.map((function(e){return+e}))})),p=(r=[]).concat.apply(r,h);o.uvs=new Float32Array(p)}var f=e.match(/^f( \d+\/\d*\/\d*){3}$/gm);if(f){var d=f.map((function(e){var t=e.split(" ");return t.shift(),[+t[0].split("/")[0]-1,+t[1].split("/")[0]-1,+t[2].split("/")[0]-1]})),m=(a=[]).concat.apply(a,d);if(o.faces=new Uint16Array(m),t){var g=f.map((function(e){var t=e.split(" ");return t.shift(),[+t[0].split("/")[1]-1,+t[1].split("/")[1]-1,+t[2].split("/")[1]-1]})),y=new Uint16Array((s=[]).concat.apply(s,g)),b=o.uvs;o.uvs=new Float32Array(b.length);for(var v=0;v<y.length;v++){var x=y[v],_=b[2*x],w=b[2*x+1],T=o.faces[v];o.uvs[2*T]=_,o.uvs[2*T+1]=w}}}if(t){for(v=0;v<o.faces.length;v+=3){var E=o.faces[v];o.faces[v]=o.faces[v+1],o.faces[v+1]=E}for(v=0;v<o.vertices.length;v+=3)o.vertices[v]=-o.vertices[v]}return o}!function(e){e.Detection="DETECTION",e.Detected="DETECTED",e.Tracking="TRACKING"}(pb||(pb={}));var Db,Mb=function(){function e(e,t){this._trackingState=pb.Detection,this._type=0,this._R=Float32Array.from(e),this._t=Float32Array.from(t),this._trackingState=pb.Detection}return e.prototype.setTrackingState=function(e){this._trackingState=e},e.prototype.getTrackingState=function(){return this._trackingState},e.prototype.isDetected=function(){return this._trackingState==pb.Tracking},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!1,configurable:!0}),e.prototype.setRt=function(e,t){this._R=e.slice(0),this._t=t.slice(0)},e.prototype.R=function(){return this._R},e.prototype.t=function(){return this._t},e.prototype.getPosition=function(){return[this._t[0],this._t[1],this._t[2]]},e.prototype.getRotation=function(){return[[this._R[0],this._R[1],this._R[2]],[this._R[3],this._R[4],this._R[5]],[this._R[6],this._R[7],this._R[8]]]},e.prototype.reset=function(){this._R=new Float32Array([1,0,0,0,-1,0,0,0,-1]),this._t=new Float32Array([0,0,0])},e.getQuatFromRotMat=function(e){var t=new Float32Array(4);return t[0]=Math.sqrt(Math.max(0,1+e[0]+e[4]+e[8]))/2,t[1]=Math.sqrt(Math.max(0,1+e[0]-e[4]-e[8]))/2,t[2]=Math.sqrt(Math.max(0,1-e[0]+e[4]-e[8]))/2,t[3]=Math.sqrt(Math.max(0,1-e[0]-e[4]+e[8]))/2,t[1]=e[7]-e[5]<0?-Math.abs(t[1]):Math.abs(t[1]),t[2]=e[2]-e[6]<0?-Math.abs(t[2]):Math.abs(t[2]),t[3]=e[3]-e[1]<0?-Math.abs(t[3]):Math.abs(t[3]),t},e.getRotMatFromQuat=function(e){var t=new Float32Array(9);return t[0]=1-2*e[2]*e[2]-2*e[3]*e[3],t[1]=2*e[1]*e[2]-2*e[3]*e[0],t[2]=2*e[1]*e[3]+2*e[2]*e[0],t[3]=2*e[1]*e[2]+2*e[3]*e[0],t[4]=1-2*e[1]*e[1]-2*e[3]*e[3],t[5]=2*e[2]*e[3]-2*e[1]*e[0],t[6]=2*e[1]*e[3]-2*e[2]*e[0],t[7]=2*e[2]*e[3]+2*e[1]*e[0],t[8]=1-2*e[1]*e[1]-2*e[2]*e[2],t},e.slerp=function(e,t,n){var r,a,s=new Float32Array(4),o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0],i=Math.abs(o);if(i>=.99999)r=1-n,a=n;else{var u=Math.acos(i),l=Math.sin(u);r=Math.sin((1-n)*u)/l,a=Math.sin(n*u)/l}return o<0&&(a=-a),s[1]=r*e[1]+a*t[1],s[2]=r*e[2]+a*t[2],s[3]=r*e[3]+a*t[3],s[0]=r*e[0]+a*t[0],s},e.getCameraMat=function(e,t,n){var r=n/2/Math.tan(e*Math.PI/180/2),a=r,s=(t-1)/2,o=(n-1)/2,i=new Float32Array(9);return i[0]=a,i[2]=s,i[4]=r,i[5]=o,i[8]=1,i},e.getCameraParams=function(e,t,n){var r=n/2/Math.tan(e*Math.PI/180/2);return[r,r,(t-1)/2,(n-1)/2]},e.MatMultVec=function(e,t){var n=new Float32Array(3);return n[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n[1]=e[3]*t[0]+e[4]*t[1]+e[5]*t[2],n[2]=e[6]*t[0]+e[7]*t[1]+e[8]*t[2],n},e.MatMult=function(e,t){var n=new Float32Array(9);return n[0]=e[0]*t[0]+e[1]*t[3]+e[2]*t[6],n[1]=e[0]*t[1]+e[1]*t[4]+e[2]*t[7],n[2]=e[0]*t[2]+e[1]*t[5]+e[2]*t[8],n[3]=e[3]*t[0]+e[4]*t[3]+e[5]*t[6],n[4]=e[3]*t[1]+e[4]*t[4]+e[5]*t[7],n[5]=e[3]*t[2]+e[4]*t[5]+e[5]*t[8],n[6]=e[6]*t[0]+e[7]*t[3]+e[8]*t[6],n[7]=e[6]*t[1]+e[7]*t[4]+e[8]*t[7],n[8]=e[6]*t[2]+e[7]*t[5]+e[8]*t[8],n},e.prototype.project=function(t,n){for(var r=new Float32Array(t.length/3*2),a=0;a<t.length/3;a++){var s=e.MatMultVec(this._R,new Float32Array([t[3*a],t[3*a+1],t[3*a+2]])),o=new Float32Array(3);o[0]=s[0]+this._t[0],o[1]=s[1]+this._t[1],o[2]=s[2]+this._t[2];var i=n[6]*o[0]+n[7]*o[1]+n[8]*o[2];r[2*a]=(n[0]*o[0]+n[1]*o[1]+n[2]*o[2])/i,r[2*a+1]=(n[3]*o[0]+n[4]*o[1]+n[5]*o[2])/i}return r},e.prototype.transform=function(t,n){for(var r=new Float32Array(t.length/3*2),a=0;a<t.length/3;a++){var s=e.MatMultVec(this._R,new Float32Array([t[3*a],t[3*a+1],t[3*a+2]]));r[3*a+0]=s[0]+this._t[0],r[3*a+1]=s[1]+this._t[1],r[3*a+2]=s[2]+this._t[2]}return r},e}(),Lb=function(){function e(e){this.NB_BUFFERS=6,this._poses=[],this._nbFramesDelay=0,this._interpolation=0,this._filteringLevel=2,this._filterThreshold=-1,e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=this._nbFramesDelay:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS)}return e.prototype.setNbFramesDelay=function(e){this._nbFramesDelay=e},e.prototype.setInterpolation=function(e){this._interpolation=e},e.prototype.setFilteringLevel=function(e){this._filteringLevel=e},e.prototype.setFilterThreshold=function(e){this._filterThreshold=e},e.prototype.reset=function(){this._poses=[]},e.prototype.setPose=function(e){this._poses.length===this.NB_BUFFERS&&(this._poses=this._poses.slice(0,-1)),this._poses=s([e],this._poses,!0)},e.prototype.getPose=function(){return this._poses.length>0?this._nbFramesDelay<this._poses.length?this._poses[this._nbFramesDelay]:this._poses[this._poses.length-1]:null},e.prototype.getInterpolatedPoseAtDelay=function(e){if(e>0&&e+1<this._poses.length){var t=this._poses[e-1],n=this._poses[e],r=this._poses[e+1];if(t.getTrackingState()!==pb.Tracking||r.getTrackingState()!==pb.Tracking)return n;for(var a=Mb.getQuatFromRotMat(t.R()),s=Mb.getQuatFromRotMat(r.R()),o=Mb.slerp(a,s,.5),i=Mb.getRotMatFromQuat(o),u=t.t(),l=r.t(),c=new Float32Array(3),h=0;h<3;h++)c[h]=.5*u[h]+.5*l[h];var p=new Mb(i,c);return p.setTrackingState(n.getTrackingState()),p.type=n.type,p}return this._poses.length>0?this.getPose():this.getLastPose()},e.prototype.dst=function(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2]))},e.prototype.mvts=function(e,t,n){return(this.dst(e,t)+this.dst(t,n))/2},e.prototype.getInterpolatedPose=function(){if(1==this._filteringLevel)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);if(2==this._filteringLevel){var e=this.getInterpolatedPoseAtDelay(this._nbFramesDelay-1),t=this.getInterpolatedPoseAtDelay(this._nbFramesDelay+1);if(null==e||null==t)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);if(e.getTrackingState()!==pb.Tracking||t.getTrackingState()!==pb.Tracking)return this.getInterpolatedPoseAtDelay(this._nbFramesDelay);var n=this._poses[this._nbFramesDelay],r=e.t(),a=t.t();if(this._filterThreshold>0){var s=this.dst(r,n.t()),o=this.dst(a,n.t());if(s>this._filterThreshold||o>this._filterThreshold)return n}for(var i=Mb.getQuatFromRotMat(e.R()),u=Mb.getQuatFromRotMat(t.R()),l=Mb.slerp(i,u,this._interpolation),c=Mb.getRotMatFromQuat(l),h=new Float32Array(3),p=0;p<3;p++)h[p]=(1-this._interpolation)*r[p]+this._interpolation*a[p];var f=new Mb(c,h);return f.setTrackingState(n.getTrackingState()),f.type=n.type,f}return this.getLastPose()},e.prototype.updateDelay=function(e){e!=this._nbFramesDelay&&(e>=0&&e<this.NB_BUFFERS?this._nbFramesDelay=e:console.error("Invalid frames delay, delay must be less than ",this.NB_BUFFERS))},e.prototype.getLastPose=function(){return this._poses.length>0?this._poses[0]:null},e}();!function(e){e.Left="LEFT_FOOT",e.Right="RIGHT_FOOT",e.Both="BOTH_FOOT",e.Single="SINGLE_FOOT"}(Db||(Db={}));var Pb=function(){function r(){this._initialized=!1,this._currentWidth=0,this._currentHeight=0,this._trackingState=pb.Detection,this._useWasmForHeatmaps=!0,this._useWasmForPose=!0,this._float_size=4,this._bufferHeatmaps=null,this._bufferKeypsDet=null,this._bufferFeatureScores=null,this._bufferInOutPose_L=null,this._bufferInOutPose_R=null,this._bufferSimToImage=null,this._bufferKeyps3D_R=null,this._bufferKeyps3D_L=null,this._footToDetect=Db.Right,this._leftFootState=pb.Detection,this._rightFootState=pb.Detection,this._bufferKeypsTrack_L=null,this._bufferKeypsTrack_R=null,this._bufferHeatmaps_L=null,this._bufferHeatmaps_R=null,this._fastMovements_L=!1,this._fastMovements_R=!1,this._cnnOutputDataInvMask=null,this._debug=!1,this._debugInitialized=!1,this._reproj_t=15,this._reproj_fast_t=30,this._time_e=0,this._isDetected=!1}return r.prototype.getDebugImage=function(){return this._debugInitialized?this._debugImage:null},r.prototype.isDetected=function(){return this._isDetected},r.prototype.getPosition=function(e){void 0===e&&(e=Db.Right);var t=null;return(t=e==Db.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose())?t.getPosition():null},r.prototype.getRotation=function(e){void 0===e&&(e=Db.Right);var t=null;return(t=e==Db.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose())?t.getRotation():null},r.prototype.getPose=function(e){return void 0===e&&(e=Db.Right),e==Db.Right?this._pose_L:this._pose_R},r.prototype.getInterpolatedPose=function(e){return void 0===e&&(e=Db.Right),e==Db.Right?this._poseManager_R.getInterpolatedPose():this._poseManager_L.getInterpolatedPose()},r.prototype.isInitialized=function(){return this._initialized},r.prototype.initialize=function(r,a,s){return t(this,void 0,void 0,(function(){var t,o,i,u,l,c,h,p,f,d,m,g,y=this;return n(this,(function(n){switch(n.label){case 0:if(null==r)throw"Invalid parameter";return this.release(),this._videoManager=r,this._config=a?e(e({},mb),a):mb,"BOTH"!==this._config.footToDetect&&"BOTH_FEET"!==this._config.footToDetect||(this._footToDetect=Db.Both),this._poseManager_R=new Lb(this._videoManager.getNbFramesDelay()),this._poseManager_R.setInterpolation(this._config.filteringShift),this._poseManager_R.setFilteringLevel(this._config.filteringLevel),this._poseManager_R.setFilterThreshold(.1),this._poseManager_L=new Lb(this._videoManager.getNbFramesDelay()),this._poseManager_L.setInterpolation(this._config.filteringShift),this._poseManager_L.setFilteringLevel(this._config.filteringLevel),this._poseManager_L.setFilterThreshold(.1),t=new ie(0),o=G(db({locateFile:function(e,t){return y._config.poseEstimationWasmFilename||t+e}})).pipe(me((function(){return t.next(1)}))),i=ob(this._config.modelFilename,"config.json"),u=i.model$,l=i.progress$,c=ob(this._config.featuresFilename,"config.json"),h=c.model$,p=c.progress$,f=Fb(this._config.objFilename,!1),d=f.model$,m=f.progress$,g=V([t,l,p,m]).pipe(K((function(e){return e.reduce((function(t,n){return t+n/e.length}),0)})),K((function(e){return s&&s(e)}))).subscribe(),[4,sy({poseModule:o,model:u,features:h,footObjModel:d}).pipe(K((function(e){y._poseModule=e.poseModule,y._footObjModel=e.footObjModel,y._tfFootDetector=e.model.graphModel,y._footDetectorConfig=e.model.config,y._tfFootFeatures=e.features.graphModel,y._footFeaturesConfig=e.features.config;var t=Mi([1,y._footDetectorConfig.inHeight,y._footDetectorConfig.inWidth,3]),n=y._tfFootDetector.predict(t);y._footDetectorShape=n.shape,n.dispose(),t.dispose(),t=Mi([1,y._footFeaturesConfig.inHeight,y._footFeaturesConfig.inWidth,3]),(n=y._tfFootFeatures.predict(t)).dispose(),t.dispose(),t=Mi([2,y._footFeaturesConfig.inHeight,y._footFeaturesConfig.inWidth,3]),n=y._tfFootFeatures.predict(t),y._footFeaturesShape=n.shape,n.dispose(),t.dispose();var r=Math.max(y._footDetectorShape[1]*y._footDetectorShape[2]*y._footDetectorShape[3],y._footFeaturesShape[1]*y._footFeaturesShape[2]*y._footFeaturesShape[3]),a=Math.max(y._footDetectorShape[3],y._footFeaturesShape[3]),s=function(e,t){var n=[54,210,295,415,416,425,463,582,644,721,726,730,813];18==t&&(n=[54,210,295,406,415,416,417,423,425,463,518,582,644,657,721,726,730,813]);for(var r=n.length,a=new Array(3*r),s=0;s<r;s++){var o=n[s];a[3*s]=e[3*o],a[3*s+1]=e[3*o+1],a[3*s+2]=e[3*o+2]}var i=new Array(3*r);for(s=0;s<r;s++)i[3*s]=-a[3*s],i[3*s+1]=a[3*s+1],i[3*s+2]=a[3*s+2];return[a,i]}(y._footObjModel.vertices,y._footFeaturesShape[3]),o=s[0],i=s[1];null==y._bufferKeyps3D_R&&(y._bufferKeyps3D_R=y._poseModule._malloc(o.length*y._float_size),y._poseModule.HEAPF32.set(o,y._bufferKeyps3D_R/4)),null==y._bufferKeyps3D_L&&(y._bufferKeyps3D_L=y._poseModule._malloc(i.length*y._float_size),y._poseModule.HEAPF32.set(i,y._bufferKeyps3D_L/4)),y._bufferHeatmaps=y._poseModule._malloc(r*y._float_size),y._bufferHeatmaps_L=y._poseModule._malloc(r*y._float_size),y._bufferHeatmaps_R=y._poseModule._malloc(r*y._float_size),y._bufferKeypsDet=y._poseModule._malloc(2*y._footDetectorShape[3]*y._float_size),y._bufferKeypsTrack_L=y._poseModule._malloc(2*y._footFeaturesShape[3]*y._float_size),y._bufferKeypsTrack_R=y._poseModule._malloc(2*y._footFeaturesShape[3]*y._float_size),y._bufferFeatureScores=y._poseModule._malloc(a*y._float_size),y._bufferInOutPose_L=y._poseModule._malloc(18*y._float_size),y._bufferInOutPose_R=y._poseModule._malloc(18*y._float_size),y._bufferSimToImage=y._poseModule._malloc(8*y._float_size),y._initialized=!0})),Z((function(){return g.unsubscribe()}))).toPromise()];case 1:return n.sent(),[2]}}))}))},r.prototype.release=function(){this._initialized&&(this._poseModule._free(this._bufferHeatmaps),this._poseModule._free(this._bufferHeatmaps_L),this._poseModule._free(this._bufferHeatmaps_R),this._poseModule._free(this._bufferKeypsDet),this._poseModule._free(this._bufferKeypsTrack_L),this._poseModule._free(this._bufferKeypsTrack_R),this._poseModule._free(this._bufferFeatureScores),this._poseModule._free(this._bufferInOutPose_L),this._poseModule._free(this._bufferInOutPose_R),this._poseModule._free(this._bufferSimToImage),this._poseModule._free(this._bufferKeyps3D_R),this._poseModule._free(this._bufferKeyps3D_L),this._hptrImageBuffer&&this._poseModule._free(this._hptrImageBuffer))},r.prototype.trackSync=function(e){var t;if(this._initialized){var n=this._videoManager.getVideoCanvas();n.width===this._currentWidth&&n.height===this._currentHeight||(this._currentWidth=n.width,this._currentHeight=n.height,t=Mb.getCameraParams(this._config.fovY,this._currentWidth,this._currentHeight),this._fx=t[0],this._fy=t[1],this._cx=t[2],this._cy=t[3],this._poseModule.cwrap("xzimgInitializeCamera","number",["number","number","number"])(this._config.fovY,this._currentWidth,this._currentHeight)),this._poseManager_L.setNbFramesDelay(this._videoManager.getNbFramesDelay()),this._poseManager_R.setNbFramesDelay(this._videoManager.getNbFramesDelay());var r=e;null==e&&(r=this._videoManager.getLastBuffer()),null!=r?this._footToDetect===Db.Left||this._footToDetect===Db.Right?this.trackSingleFootSync(r):(this.trackBothFeetSync(r),performance.now()):console.error("No video frame to process")}else console.error("Foot must be initialized to track")},r.prototype.trackSingleFootSync=function(e){var t=-1;if(this._trackingState===pb.Detection){var n=this.detectFeetSync(e),r=n.refinedFeatures,a=n.scores;this._initShape=r;var s=bb(a,"LEFT_FOOT"),o=bb(a,"RIGHT_FOOT");o>s&&o>=this._config.detection_score_t?(this._footToDetect=Db.Right,this.computePoseSync(this._trackingState,this._footToDetect),this._trackingState=pb.Detected):s>=this._config.detection_score_t&&(this._footToDetect=Db.Left,this.computePoseSync(this._trackingState,this._footToDetect),this._trackingState=pb.Detected)}else{var i;i=this._trackingState==pb.Detected?this._initShape:this._footToDetect==Db.Right?this._rightFootRecShape:this._leftFootRecShape;var u=this.detectFootFeaturesSync(e,this._trackingState,i,this._footToDetect);this._footToDetect==Db.Right?this._rightFootRecShape=u.refinedFeatures:this._leftFootRecShape=u.refinedFeatures,bb(u.scores,this._footToDetect)>=this._config.tracking_score_t?(t=this.computePoseSync(this._trackingState,this._footToDetect),this._trackingState=pb.Tracking,t>this._reproj_t&&(this._trackingState=pb.Detection)):this._trackingState=pb.Detection}this._isDetected=this._trackingState===pb.Tracking,this._trackingState===pb.Detection&&(this._pose_R=new Mb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0])),this._pose_L=new Mb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0])),this._pose_L.setTrackingState(pb.Detection),this._pose_R.setTrackingState(pb.Detection),this._pose_R.type=0,this._pose_L.type=1),this._footToDetect==Db.Right?(this._pose_R.setTrackingState(this._trackingState),this._poseManager_R.setPose(this._pose_R)):this._footToDetect==Db.Left&&(this._pose_L.setTrackingState(this._trackingState),this._poseManager_L.setPose(this._pose_L))},r.prototype.trackBothFeetSync=function(e){var t=-1;if(this._rightFootState!=pb.Detection&&this._leftFootState!=pb.Detection){var n=this.detectBothFeetFeaturesSync(e,this._leftFootState,this._rightFootState,this._leftFootState==pb.Detected?this._initShape:this._leftFootRecShape,this._rightFootState==pb.Detected?this._initShape:this._rightFootRecShape),r=bb(n.scores_R,"RIGHT_FOOT");this._rightFootRecShape=n.refinedFeatures_R;var a=bb(n.scores_L,"LEFT_FOOT");this._leftFootRecShape=n.refinedFeatures_L;var s=this._config.tracking_score_t;this._fastMovements_R&&(s=.1);var o=this._reproj_t;this._fastMovements_R&&(o=this._reproj_fast_t),r>=s?(t=this.computePoseSync(this._rightFootState,"RIGHT_FOOT"),this._rightFootState=pb.Tracking,t>o&&(this._rightFootState=pb.Detection)):this._rightFootState=pb.Detection,s=this._config.tracking_score_t,this._fastMovements_L&&(s=.1),o=this._reproj_t,this._fastMovements_L&&(o=this._reproj_fast_t),a>=s?(t=this.computePoseSync(this._leftFootState,"LEFT_FOOT"),this._leftFootState=pb.Tracking,t>o&&(this._leftFootState=pb.Detection)):this._leftFootState=pb.Detection}else if(this._rightFootState!==pb.Detection&&this._leftFootState===pb.Detection){var i=this.detectFootFeaturesSync(e,this._rightFootState,this._rightFootState==pb.Detected?this._initShape:this._rightFootRecShape,"RIGHT_FOOT");this._rightFootRecShape=i.refinedFeatures,r=bb(i.scores,"RIGHT_FOOT"),s=this._config.tracking_score_t,this._fastMovements_R&&(s=.1),o=this._reproj_t,this._fastMovements_R&&(o=this._reproj_fast_t),r>=s?(t=this.computePoseSync(this._rightFootState,"RIGHT_FOOT"),this._rightFootState=pb.Tracking,t>o&&(this._rightFootState=pb.Detection)):this._rightFootState=pb.Detection,i=this.detectFeetSync(e),this._initShape=i.refinedFeatures,a=bb(i.scores,"LEFT_FOOT"),r=bb(i.scores,"RIGHT_FOOT");var u=!1;if(!this._fastMovements_R&&null!=this._cnnOutputDataInvMask){var l=Rb(this._cnnOutputDataInvMask,this._footDetectorShape[1],this._footDetectorShape[2],this._footDetectorShape[3],!1);l[0];var c=bb(f=l[1],"LEFT_FOOT"),h=bb(f,"RIGHT_FOOT");r>a&&r>h+.1&&c>h&&(u=!0)}u&&r>this._config.detection_score_t?(this.invertFoot(),this.computePoseSync(this._rightFootState,"RIGHT_FOOT"),this._rightFootRecShape=i.refinedFeatures,this._rightFootState=pb.Detected):a>=this._config.detection_score_t&&(this.computePoseSync(this._leftFootState,"LEFT_FOOT"),this._leftFootRecShape=i.refinedFeatures,this._leftFootState=pb.Detected)}else if(this._leftFootState!==pb.Detection&&this._rightFootState===pb.Detection){var p=this.detectFootFeaturesSync(e,this._leftFootState,this._leftFootState==pb.Detected?this._initShape:this._leftFootRecShape,"LEFT_FOOT");if(this._leftFootRecShape=p.refinedFeatures,a=bb(p.scores,"LEFT_FOOT"),s=this._config.tracking_score_t,this._fastMovements_L&&(s=.1),o=this._reproj_t,this._fastMovements_L&&(o=this._reproj_fast_t),a>=s?(t=this.computePoseSync(this._leftFootState,"LEFT_FOOT"),this._leftFootState=pb.Tracking,t>o&&(this._leftFootState=pb.Detection)):this._leftFootState=pb.Detection,p=this.detectFeetSync(e),this._initShape=p.refinedFeatures,r=bb(p.scores,"RIGHT_FOOT"),a=bb(p.scores,"LEFT_FOOT"),u=!1,!this._fastMovements_L&&null!=this._cnnOutputDataInvMask){var f,d=Rb(this._cnnOutputDataInvMask,this._footDetectorShape[1],this._footDetectorShape[2],this._footDetectorShape[3],!1);d[0],c=bb(f=d[1],"LEFT_FOOT"),h=bb(f,"RIGHT_FOOT"),a>r&&a>c+.1&&h>c&&(u=!0)}u&&a>this._config.detection_score_t?(this.invertFoot(),this.computePoseSync(this._leftFootState,"LEFT_FOOT"),this._leftFootRecShape=p.refinedFeatures,this._leftFootState=pb.Detected):r>=this._config.detection_score_t&&(this.computePoseSync(this._rightFootState,"RIGHT_FOOT"),this._rightFootRecShape=p.refinedFeatures,this._rightFootState=pb.Detected)}else if(this._leftFootState===pb.Detection||this._rightFootState===pb.Detection){this._fastMovements_L=!0,this._fastMovements_R=!0;var m=this._poseModule.cwrap("xzimgMatchRecKeypsInit","number",["number"]);null==this._hptrImageBuffer&&(this._hptrImageBuffer=this._poseModule._malloc(e.width*e.height*4)),Ib(this._poseModule,e,this._hptrImageBuffer);var g=kb(this._poseModule,this._hptrImageBuffer,e.width,e.height);m(g),this._poseModule._free(g);var y=this.detectFeetSync(e);this._initShape=y.refinedFeatures;var b=bb(y.scores,"LEFT_FOOT"),v=bb(y.scores,"RIGHT_FOOT");b>=this._config.detection_score_t&&(this.computePoseSync(this._trackingState,"LEFT_FOOT"),this._leftFootState=pb.Detected),v>=this._config.detection_score_t&&(this.computePoseSync(this._trackingState,"RIGHT_FOOT"),this._rightFootState=pb.Detected),this._rightFootState!=pb.Detection&&this._leftFootState!=pb.Detection&&this.bothFeetSamePlaceInit()&&(this._rightFootState==pb.Detected?this._rightFootState=pb.Detection:this._leftFootState=pb.Detection)}this._leftFootState===pb.Detection&&(this._pose_L=new Mb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0]))),this._rightFootState==pb.Detection&&(this._pose_R=new Mb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0]))),this._pose_R.setTrackingState(this._rightFootState),this._pose_R.type=0,this._poseManager_R.setPose(this._pose_R),this._pose_L.setTrackingState(this._leftFootState),this._pose_L.type=1,this._poseManager_L.setPose(this._pose_L)},r.prototype.detectFeetSync=function(e){var t,n,r,a,s=function(e,t){var n,r;return{crop:e>t?[(r=0)/t,(n=(e-t)/2)/e,1,(e-n)/e]:[(r=(t-e)/2)/t,(n=0)/e,(t-r)/t,1],deltaY:r,deltaX:n}}(this._currentWidth,this._currentHeight),o=s.crop,i=s.deltaY,u=s.deltaX,l=ls(e),c=qa(l,"float32"),h=ro(c,[1,this._currentHeight,this._currentWidth,3]),p=Nl.cropAndResize(h,[o],[0],[this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth]),f=Yo(255),d=As(p,f),m=null;if(this._footToDetect==Db.Both&&(this._leftFootState===pb.Tracking||this._rightFootState===pb.Tracking)){var g=function(e,t,n,r,a,s,o,i){for(var u=e.length/2,l=new Float32Array(2*u),c=0;c<u;c++)l[c]=(e[c]-a)/o,l[c+u]=(e[c+u]-r)/s;for(var h=gb(l,i),p=h[0],f=h[1],d=h[2]-p,m=h[3]-f,g=h[6]-p,y=h[7]-f,b=d*d+m*m,v=g*g+y*y,x=new Float32Array(n*t),_=0;_<t;_++)for(var w=0;w<n;w++){var T=w-p,E=_-f,S=T*d+E*m,I=T*g+E*y;S>0&&I>0&&S<b&&I<v||(x[_*n+w]=1)}return x}(this._leftFootState===pb.Tracking?this._leftFootRecShape:this._rightFootRecShape,this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,i,u,(this._currentHeight-2*i)/this._footDetectorConfig.inWidth,(this._currentWidth-2*u)/this._footDetectorConfig.inHeight,this._leftFootState===pb.Tracking?"LEFT_FOOT":"RIGHT_FOOT");this._debug&&(this._debugInitialized=!0,this._debugImage=function(e,t,n){for(var r=new Uint8ClampedArray(e*t*4),a=e*t,s=0;s<a;s++){var o=n[s],i=4*s;r[i+0]=Math.round(255*o),r[i+1]=Math.round(255*o),r[i+2]=Math.round(255*o),r[i+3]=255}return new ImageData(r,t,e)}(this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,g));var y=Au(g,"float32");m=ro(y,[1,this._footDetectorConfig.inHeight,this._footDetectorConfig.inWidth,1]),y.dispose()}var b=this._tfFootDetector.predict(d);if(null!=m){var v=Ti(1,m),x=$s(b,v);this._cnnOutputDataInvMask=x.dataSync(),v.dispose(),x.dispose();var _=$s(b,m);b.dispose(),b=_,m.dispose()}var w,T,E=null!==(n=null==b?void 0:b.shape[3])&&void 0!==n?n:this._footDetectorConfig.outChannels,S=null!==(r=null==b?void 0:b.shape[1])&&void 0!==r?r:this._footDetectorConfig.outHeight,I=null!==(a=null==b?void 0:b.shape[2])&&void 0!==a?a:this._footDetectorConfig.outWidth,k=b.dataSync();w=(t=Rb(k,S,I,E))[0],T=t[1];var C=this._bufferKeypsDet/4;this._poseModule.HEAPF32.subarray(C,C+2*E).set(w),this._debug&&(this._debugInitialized=!0,this._debugImage=function(e,t,n,r){for(var a=new Uint8ClampedArray(e*t*4),s=e*t,o=0;o<s;o++){for(var i=o*n,u=r[i],l=1;l<n;l++){var c=r[i+l];u=Math.max(u,c)}var h=4*o;a[h+0]=Math.round(255*(1-u)),a[h+1]=Math.round(255*(1-u)),a[h+2]=Math.round(255*(1-u)),a[h+3]=255}return new ImageData(a,t,e)}(b.shape[1],b.shape[2],b.shape[3],k)),l.dispose(),c.dispose(),f.dispose(),p.dispose(),d.dispose(),h.dispose(),b.dispose();var N=Math.min(this._currentWidth,this._currentHeight),A=N/this._footDetectorConfig.inWidth,$=N/this._footDetectorConfig.inHeight;return this._simToImage_Det=function(e,t,n,r){var a=new Float32Array(6);return a[0]=r,a[1]=0,a[2]=t,a[3]=0,a[4]=n,a[5]=e,a}(i,u,$,A),{refinedFeatures:vb(w,this._simToImage_Det,!1,b.shape[1]),scores:T}},r.prototype.detectFootFeaturesSync=function(e,t,n,r){var a,s,o,i,u,l,c,h,p,f,d="LEFT_FOOT"==r?this._simToImage_L:this._simToImage_R,m=new Int32Array(n.length/2);m.fill(1),t!=pb.Detected?(p=(a=Cb(this._poseModule,e,this._hptrImageBuffer,n,m))[0],f=a[1],Math.sqrt(f[2]*f[2]+f[3]*f[3])>10?"LEFT_FOOT"==r?this._fastMovements_L=!0:this._fastMovements_R=!0:"LEFT_FOOT"==r?this._fastMovements_L=!1:this._fastMovements_R=!1,"LEFT_FOOT"==r?Ab(this._poseModule,this._bufferInOutPose_L,f,this._fx,this._fy):"RIGHT_FOOT"==r&&Ab(this._poseModule,this._bufferInOutPose_R,f,this._fx,this._fy)):p=n,d=Tb(p,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,t==pb.Detected?null:d,r);var g=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);g=wb(e,g,d);var y=ls(g),b=qa(y,"float32"),v=ro(b,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]),x=Yo(255),_=As(v,x),w=null;w="LEFT_FOOT"==r?hu(_,1):_;var T,E,S=this._tfFootFeatures.predict(w),I=S.dataSync();if(this._useWasmForHeatmaps){var k=this._poseModule.cwrap("xzimgGetHeatmapsLocations","number",["number","number","number","number","number","number","number","number"]),C=(A=null!==(o=null==S?void 0:S.shape[3])&&void 0!==o?o:this._footFeaturesConfig.outChannels)*($=null!==(i=null==S?void 0:S.shape[1])&&void 0!==i?i:this._footFeaturesConfig.outHeight)*(R=null!==(u=null==S?void 0:S.shape[2])&&void 0!==u?u:this._footFeaturesConfig.outWidth),N="LEFT_FOOT"==r?this._bufferHeatmaps_L/4:this._bufferHeatmaps_R/4;this._poseModule.HEAPF32.subarray(N,N+C).set(I),k("LEFT_FOOT"==r?this._bufferHeatmaps_L:this._bufferHeatmaps_R,$,R,A,0,2,"LEFT_FOOT"==r?this._bufferKeypsTrack_L:this._bufferKeypsTrack_R,this._bufferFeatureScores),E=new Float32Array(this._poseModule.HEAPF32.buffer,"LEFT_FOOT"==r?this._bufferKeypsTrack_L:this._bufferKeypsTrack_R,2*A),T=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferFeatureScores,A)}else{var A,$,R,F=(A=null!==(l=null==S?void 0:S.shape[3])&&void 0!==l?l:this._footFeaturesConfig.outChannels)*($=null!==(c=null==S?void 0:S.shape[1])&&void 0!==c?c:this._footFeaturesConfig.outHeight)*(R=null!==(h=null==S?void 0:S.shape[2])&&void 0!==h?h:this._footFeaturesConfig.outWidth);E=(s=Rb(I,$,R,A))[0],T=s[1],N="LEFT_FOOT"==r?this._bufferKeypsTrack_L/4:this._bufferKeypsTrack_R/4,this._poseModule.HEAPF32.subarray(N,N+2*A).set(E),N="LEFT_FOOT"==r?this._bufferHeatmaps_L/4:this._bufferHeatmaps_R/4,this._poseModule.HEAPF32.subarray(N,N+F).set(I)}y.dispose(),b.dispose(),x.dispose(),_.dispose(),v.dispose(),S.dispose(),"LEFT_FOOT"==r&&w.dispose();var O=vb(E,d,"LEFT_FOOT"==r,S.shape[1]);return"LEFT_FOOT"==r?this._simToImage_L=d:this._simToImage_R=d,{refinedFeatures:O,scores:T}},r.prototype.detectBothFeetFeaturesSync=function(e,t,n,r,a){var s,o,i,u,l,c,h,p;if(t!=pb.Detected&&n!=pb.Detected){var f=new Int32Array(r.length);f.fill(1);var d=Cb(this._poseModule,e,this._hptrImageBuffer,function(e,t){for(var n=e.length/2,r=t.length/2,a=n+r,s=new Float32Array(e.length+t.length),o=0;o<n;o++)s[o]=e[o],s[o+a]=e[o+n];for(o=0;o<r;o++)s[o+n]=t[o],s[o+a+n]=t[o+r];return s}(r,a),f),m=d[0];d[1];var g=d[2];s=function(e,t,n){var r=new Float32Array(2*t),a=new Float32Array(2*n),s=e.length/2;t+n!=s&&console.log("ERROR (separateShapes): shapes not correct dims");for(var o=0;o<t;o++)r[o]=e[o],r[o+t]=e[o+s];for(o=0;o<n;o++)a[o]=e[o+t],a[o+n]=e[o+s+t];return[r,a]}(m,r.length/2,a.length/2),h=s[0],p=s[1];var y=g.slice(0,r.length/2),b=g.slice(r.length/2,r.length),v=Nb(this._poseModule,r,h),x=Nb(this._poseModule,a,p);Math.sqrt(v[2]*v[2]+v[3]*v[3])>10?this._fastMovements_L=!0:this._fastMovements_L=!1,Math.sqrt(x[2]*x[2]+x[3]*x[3])>10?this._fastMovements_R=!0:this._fastMovements_R=!1,$b(this._poseModule,this._bufferInOutPose_L,r,h,y,this._fx,this._fy),$b(this._poseModule,this._bufferInOutPose_R,a,p,b,this._fx,this._fy)}else h=r,p=a;this._simToImage_L=Tb(h,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,t==pb.Detected?null:this._simToImage_L,"LEFT_FOOT");var _=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);_=wb(e,_,this._simToImage_L),this._simToImage_R=Tb(p,this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,n==pb.Detected?null:this._simToImage_R,"RIGHT_FOOT");var w=new ImageData(this._footFeaturesConfig.inWidth,this._footFeaturesConfig.inHeight);w=wb(e,w,this._simToImage_R);var T=ls(_),E=qa(T,"float32"),S=ro(E,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]),I=Yo(255),k=As(S,I),C=hu(k,1);T=ls(w),E=qa(T,"float32"),S=ro(E,[1,this._footFeaturesConfig.inHeight,this._footFeaturesConfig.inWidth,3]);var N,A,$,R,F=As(S,I),O=io([C,F]),D=this._tfFootFeatures.predict(O),M=Du(D,0),L=M[0].dataSync(),P=M[1].dataSync(),B=null!==(u=null==D?void 0:D.shape[3])&&void 0!==u?u:this._footFeaturesConfig.outChannels,U=null!==(l=null==D?void 0:D.shape[1])&&void 0!==l?l:this._footFeaturesConfig.outHeight,z=null!==(c=null==D?void 0:D.shape[2])&&void 0!==c?c:this._footFeaturesConfig.outWidth,V=B*U*z,W=L,j=P;N=(o=Rb(W,U,z,B,!1))[0],$=o[1],A=(i=Rb(j,U,z,B,!1))[0],R=i[1];var G=this._bufferKeypsTrack_L/4,H=this._poseModule.HEAPF32.subarray(G,G+2*B);return H.set(N),G=this._bufferKeypsTrack_R/4,(H=this._poseModule.HEAPF32.subarray(G,G+2*B)).set(A),G=this._bufferHeatmaps_L/4,(H=this._poseModule.HEAPF32.subarray(G,G+V)).set(W),G=this._bufferHeatmaps_R/4,(H=this._poseModule.HEAPF32.subarray(G,G+V)).set(j),T.dispose(),E.dispose(),I.dispose(),k.dispose(),C.dispose(),F.dispose(),S.dispose(),D.dispose(),M.forEach((function(e){return e.dispose()})),O.dispose(),{refinedFeatures_L:vb(N,this._simToImage_L,!0,D.shape[1]),refinedFeatures_R:vb(A,this._simToImage_R,!1,D.shape[1]),scores_L:$,scores_R:R}},r.prototype.computePoseSync=function(e,t){var n=-1,r=null;if(this._useWasmForPose&&(r=this._poseModule.cwrap("xzimgEstimateRigidPose","number",["number","number","number","number","number","number","number","number","number","number","number","number"])),e==pb.Detection){var a=function(e,t){var n,r,a,s,o,i=e.length/2;s=(n=_b(e,t))[0],a=n[1],o=n[2];var u=null;if(6==i&&"RIGHT_FOOT"==t)u=[e[3],e[4],e[5],e[3+i],e[4+i],e[5+i]];else{if(6!=i||"LEFT_FOOT"!=t)return console.error("missing case"),null;u=[e[0],e[1],e[2],e[0+i],e[1+i],e[2+i]]}return r=yb(u,3),[s,a,Math.sqrt((r[1]-r[0])*(r[1]-r[0])+(r[3]-r[2])*(r[3]-r[2])),o]}(this._initShape,t),s=a[0],o=a[1],i=a[2],u=function(e,t,n,r,a,s,o){var i,u,l,c=new Float32Array([1,0,0,0,-1,0,0,0,-1]),h=Math.cos(e+Math.PI/2),p=Math.sin(e+Math.PI/2),f=(a+s)/2*2.4/t;return[(i=new Float32Array([h,-p,0,p,h,0,0,0,1]),u=c,(l=new Float32Array(9))[0]=i[0]*u[0]+i[1]*u[3]+i[2]*u[6],l[1]=i[0]*u[1]+i[1]*u[4]+i[2]*u[7],l[2]=i[0]*u[2]+i[1]*u[5]+i[2]*u[8],l[3]=i[3]*u[0]+i[4]*u[3]+i[5]*u[6],l[4]=i[3]*u[1]+i[4]*u[4]+i[5]*u[7],l[5]=i[3]*u[2]+i[4]*u[5]+i[5]*u[8],l[6]=i[6]*u[0]+i[7]*u[3]+i[8]*u[6],l[7]=i[6]*u[1]+i[7]*u[4]+i[8]*u[7],l[8]=i[6]*u[2]+i[7]*u[5]+i[8]*u[8],l),new Float32Array([f*n/a,f*r/s,f])]}(a[3],i,s-this._cx,o-this._cy,this._fx,this._fy),l=u[0],c=u[1];"LEFT_FOOT"==t?this._pose_L=new Mb(l,c):"RIGHT_FOOT"==t&&(this._pose_R=new Mb(l,c));var h=(d="LEFT_FOOT"==t?this._bufferInOutPose_L:this._bufferInOutPose_R)/4;return(m=this._poseModule.HEAPF32.subarray(h,h+9)).set(l),(m=this._poseModule.HEAPF32.subarray(h+9,h+12)).set(c),-1}if(e==pb.Detected||e==pb.Tracking){if(this._useWasmForPose){var p=1;e==pb.Detected&&(p=0);var f=3;"LEFT_FOOT"!=t||this._fastMovements_L||(f=1),"RIGHT_FOOT"!=t||this._fastMovements_R||(f=1);var d="LEFT_FOOT"==t?this._bufferInOutPose_L:this._bufferInOutPose_R,m=(h=this._bufferSimToImage/4,this._poseModule.HEAPF32.subarray(h,h+8)),g="LEFT_FOOT"==t?this._simToImage_L:this._simToImage_R,y=Float32Array.from(g);"LEFT_FOOT"==t&&(y[2]+=y[1]*(this._footFeaturesShape[1]-1),y[5]+=y[4]*(this._footFeaturesShape[1]-1),y[1]=-y[1],y[4]=-y[4]),m.set(y),-1==(n=r("LEFT_FOOT"==t?this._bufferHeatmaps_L:this._bufferHeatmaps_R,this._footFeaturesShape[1],this._footFeaturesShape[2],this._footFeaturesShape[3],0,this._bufferSimToImage,null,"LEFT_FOOT"==t?this._bufferKeyps3D_L:this._bufferKeyps3D_R,p,3,f,d))&&(n=1e4),"LEFT_FOOT"==t?this._pose_L=new Mb(new Float32Array(this._poseModule.HEAPF32.buffer,d,9),new Float32Array(this._poseModule.HEAPF32.buffer,d+9*this._float_size,3)):this._pose_R=new Mb(new Float32Array(this._poseModule.HEAPF32.buffer,d,9),new Float32Array(this._poseModule.HEAPF32.buffer,d+9*this._float_size,3))}return n}return-1},r.prototype.invertFoot=function(){var e,t,n,r,a,s,o;e=[this._rightFootRecShape,this._leftFootRecShape],this._rightFootRecShape=e[0],this._rightFootRecShape=e[1],t=[this._bufferInOutPose_R,this._bufferInOutPose_L],this._bufferInOutPose_L=t[0],this._bufferInOutPose_R=t[1],n=[this._pose_L,this._pose_R],this._pose_R=n[0],this._pose_L=n[1],r=[this._poseManager_L,this._poseManager_R],this._poseManager_R=r[0],this._poseManager_L=r[1],a=[this._simToImage_R,this._simToImage_L],this._simToImage_L=a[0],this._simToImage_R=a[1],s=[this._rightFootState,this._leftFootState],this._leftFootState=s[0],this._rightFootState=s[1],o=[this._bufferHeatmaps_L,this._bufferHeatmaps_R],this._bufferHeatmaps_R=o[0],this._bufferHeatmaps_L=o[1]},r.prototype.dst=function(e,t,n,r){return Math.sqrt((e-n)*(e-n)+(t-r)*(t-r))},r.prototype.bothFeetSamePlaceInit=function(){var e=this._initShape.length/2,t=0;return t+=this.dst(this._initShape[0],this._initShape[e],this._initShape[4],this._initShape[4+e]),t+=this.dst(this._initShape[1],this._initShape[1+e],this._initShape[3],this._initShape[3+e]),(t+=this.dst(this._initShape[2],this._initShape[2+e],this._initShape[5],this._initShape[5+e]))/3<this.dst(this._initShape[0],this._initShape[e],this._initShape[2],this._initShape[2+e])/5},r.prototype.bothFeetSamePlace=function(){var e=gb(this._leftFootRecShape,"LEFT_FOOT"),t=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],i=e[6],u=e[7],l=gb(this._rightFootRecShape,"RIGHT_FOOT"),c=l[0],h=l[1],p=l[2],f=l[3],d=l[4],m=l[5],g=l[6],y=l[7],b=this.dst(t,n,i,u)/4;return this.dst(t,n,c,h)<b&&this.dst(r,a,p,f)<b&&this.dst(s,o,d,m)<b&&this.dst(i,u,g,y)<b},r}(),Bb={fovY:50,detection_score_t:.2,tracking_score_t:.4,geometryToDetect:"LAMBORGHINI",filteringLevel:2,filteringShift:.5,keyps_score_t:.1};function Ub(e,t){void 0===t&&(t=.1);for(var n=0,r=e.length,a=0,s=new Int32Array(r),o=0;o<r;o++)e[o]>t?(a+=1,s[o]=1,n+=e[o]):s[o]=0;return a>3?n/=a:n=0,{globalScore:n,visibilty:s,totalVisible:a}}function zb(e,t,n,r){var a=Float32Array.from(e),s=e.length/2;if(n)for(var o=0;o<s;o++)a[o+s]=r-1-a[o+s];for(o=0;o<s;o++){var i=a[o],u=a[o+s];a[o]=t[0]*i+t[1]*u+t[2],a[o+s]=t[3]*i+t[4]*u+t[5]}return a}function Vb(e,t,n){var r=e.length/2,a=[e[t],e[t+r]],s=[e[n],e[n+r]],o=[(4*a[0]+s[0])/5,(4*a[1]+s[1])/5],i=-Math.atan2(a[1]-s[1],s[0]-a[0]);return[o[0],o[1],i]}var Wb,jb=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.Dist=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))},e}(),Gb=function(){function e(){this.x=0,this.y=0,this.w=0,this.h=0}return e.prototype.Centre=function(){return new jb(this.x+this.w/2,this.y+this.h/2)},e}(),Hb=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.Dist=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))},e}(),Kb=function(){};function qb(e){return e==Wb.UpperBody||e==Wb.FullBody}!function(e){e.Lamborghini="LAMBORGHINI",e.Horse="HORSE",e.WatsonCan="WATSON-CAN",e.MartellBottle="MARTELL-BOTTLE",e.Necklace="NECKLACE",e.Wrist="WRIST",e.UpperBody="UPPER-BODY",e.FullBody="FULL-BODY",e.CanKivisense="CAN-KIVISENSE",e.ToyTruck="TOY-TRUCK",e.Chivas="CHIVAS",e.ChivasLarge="CHIVAS-LARGE",e.Lion="LION",e.Bartender="BARTENDER",e.Wcbottle="WCBOTTLE",e.EQA="EQA",e.Face="FACE"}(Wb||(Wb={})),function(){function r(){this._initialized=!1,this._currentWidth=0,this._currentHeight=0,this._trackingState=pb.Detection,this._geometryToDetect=Wb.Lamborghini,this._float_size=4,this._int_size=4,this._bufferHeatmaps=null,this._bufferKeypsDet=null,this._bufferFeatureScores=null,this._bufferInOutPose=null,this._bufferSimToImage=null,this._bufferKeyps3D=null,this._bufferKeypsTrack=null,this._bufferPdmModel=null,this._bufKeyps3D=null,this._bufVertices3D=null,this._hptrImageBuffer=null,this._fastMvt=!1,this._debug=!1,this._debugInitialized=!1}r.prototype.getDebugImage=function(){return this._debugInitialized?this._debugImage:null},r.prototype.isDetected=function(){return this._trackingState===pb.Tracking},r.prototype.getPosition=function(){var e=this._poseManager.getInterpolatedPose();return e?e.getPosition():null},r.prototype.getRotation=function(){var e=this._poseManager.getInterpolatedPose();return e?e.getRotation():null},r.prototype.getPose=function(){return this._pose},r.prototype.getVisibility=function(){return this._recVisibility},r.prototype.getKeypoints=function(){return this._recShape},r.prototype.getKeypoints3D=function(){return this._recShape3D},r.prototype.getDenseKeypoints3D=function(){return this._recDenseShape3D},r.prototype.getInterpolatedPose=function(){return this._poseManager.getInterpolatedPose()},r.prototype.isInitialized=function(){return this._initialized},r.prototype.initialize=function(r,a,s){var o;return t(this,void 0,void 0,(function(){var t,i,u,l,c,h,p,f,d,m,g,y,b,v,x,w,T,E=this;return n(this,(function(n){switch(n.label){case 0:if(null==r)throw"Invalid parameter";return this.release(),this._videoManager=r,this._config=a?e(e({},Bb),a):Bb,this._poseManager=new Lb(this._videoManager.getNbFramesDelay()),this._poseManager.setInterpolation(this._config.filteringShift),this._poseManager.setFilteringLevel(this._config.filteringLevel),this._geometryToDetect=function(e){if(e){if("LAMBORGHINI"===e)return Wb.Lamborghini;if("HORSE"===e)return Wb.Horse;if("WATSON-CAN"===e)return Wb.WatsonCan;if("MARTELL-BOTTLE"===e)return Wb.MartellBottle;if("NECKLACE"===e)return Wb.Necklace;if("WRIST"===e)return Wb.Wrist;if("UPPER-BODY"===e)return Wb.UpperBody;if("FULL-BODY"===e)return Wb.FullBody;if("CAN-KIVISENSE"===e)return Wb.CanKivisense;if("TOY-TRUCK"===e)return Wb.ToyTruck;if("CHIVAS"===e)return Wb.Chivas;if("CHIVAS-LARGE"===e)return Wb.ChivasLarge;if("LION"===e)return Wb.Lion;if("BARTENDER"===e)return Wb.Bartender;if("WCBOTTLE"===e)return Wb.Wcbottle;if("EQA"===e)return Wb.EQA;if("FACE"===e)return Wb.Face}return Wb.Lamborghini}(this._config.geometryToDetect),t=new ie(0),i=G(db({locateFile:function(e,t){return E._config.poseEstimationWasmFilename||t+e}})).pipe(me((function(){return t.next(1)}))),u=ob(this._config.modelFilename,"config.json"),l=u.model$,c=u.progress$,h=ob(this._config.featuresFilename,"config.json"),p=h.model$,f=h.progress$,d=Fb(this._config.objFilename,!1),m=d.model$,g=d.progress$,y=new ie(0),v="",this._config.pdmContainer?(x=this._config.pdmContainer,"string"==typeof this._config.pdmContainer&&(w=null===(o=this._config.pdmContainer)||void 0===o?void 0:o.replace(/\\/g,"/"),v=null==w?void 0:w.substring(w.lastIndexOf("/")+1,w.lastIndexOf("."))),b=function(e,t,n){return"string"==typeof e?Ty({url:e,method:"GET",responseType:"arraybuffer",async:!0,progressSubscriber:new _((function(e){return n.next(.5*e.loaded/e.total)}),(function(e){}),(function(){return n.next(.5)}))}).pipe(ue(2),he((function(e){return H(rb(new Uint8Array(e.response)))})),he((function(r){return r[t]?(n.next(1),H(r[t])):Q("File ".concat(t," not found in ").concat(e))}))):H(rb(new Uint8Array(e))).pipe(he((function(e){return e[t]?(n.next(1),H(e[t])):Q("File ".concat(t," not found"))})))}(x,v+".bin",y)):(y.next(1),b=H(null)),T=V([t,c,y,f,g]).pipe(K((function(e){return e.reduce((function(t,n){return t+n/e.length}),0)})),K((function(e){return s&&s(e)}))).subscribe(),[4,sy({poseModule:i,model:l,pdmModel:b,features:p,geometryObjModel:m}).pipe(K((function(e){E._poseModule=e.poseModule,E._geometryObjModel=e.geometryObjModel,E._tfGeometryDetector=e.model.graphModel,E._geometryDetectorConfig=e.model.config,E._tfGeometryFeatures=e.features.graphModel,E._geometryFeaturesConfig=e.features.config;var t=Mi([1,E._geometryDetectorConfig.inHeight,E._geometryDetectorConfig.inWidth,3]),n=E._tfGeometryDetector.predict(t);E._geometryDetectorShape=n.shape,n.dispose(),E._geometryDetectorConfig.inHeight===E._geometryFeaturesConfig.inHeight&&E._geometryDetectorConfig.inWidth===E._geometryFeaturesConfig.inWidth||(t=Mi([1,E._geometryFeaturesConfig.inHeight,E._geometryFeaturesConfig.inWidth,3]));var r=E._tfGeometryFeatures.predict(t);E._geometryFeaturesShape=r.shape,r.dispose();var a=Math.max(E._geometryDetectorShape[1]*E._geometryDetectorShape[2]*E._geometryDetectorShape[3],E._geometryFeaturesShape[1]*E._geometryFeaturesShape[2]*E._geometryFeaturesShape[3]),s=Math.max(E._geometryDetectorShape[3],E._geometryFeaturesShape[3]),o=function(e,t){if("NECKLACE"==t)return[new Float32Array([-1.982586,1.762905,-1.256474,-1.4803,.73489,-.059477,-.863695,.091572,.505433,-179e-6,-.518833,.632376,.863894,.089272,.503284,1.479377,.729931,-.063135,1.981941,1.7644,-1.255762]),new Float32Array([-1.982586,1.762905,-1.256474,1.981941,1.7644,-1.255762])];if("CAN-KIVISENSE"==t)return[new Float32Array([.11749199777841568,.3616040050983429,-.5216580033302307,.3387719988822937,.1726129949092865,-.5216580033302307,.059477999806404114,-.37553098797798157,-.5216580033302307,-.1752689927816391,-.3439840078353882,.5761319994926453,.3802120089530945,-0,-.3024890124797821,.3387719988822937,-.1726129949092865,-.3024890124797821,-.1726129949092865,-.3387719988822937,-.3024890124797821,-.3616029918193817,-.11749199777841568,-.3024890124797821,-.11749199777841568,.3616040050983429,-.3024890124797821,.3802120089530945,-0,-.08331900089979172,.22348299622535706,-.3075979948043823,-.08331900089979172,-.3075979948043823,-.22348299622535706,-.08331900089979172,.37553098797798157,-.059477999806404114,.1358499974012375,-0,-.3802120089530945,.1358499974012375,-.37553098797798157,-.059477999806404114,.1358499974012375,.059477999806404114,.37553098797798157,.1358499974012375,.3616040050983429,.11749199777841568,.3550190031528473,-.3616029918193817,-.11749199777841568,.3550190031528473,-.3616029918193817,.11749199777841568,.3550190031528473,-.11749199777841568,.3616029918193817,.3550190031528473]),new Float32Array([0,0,-.5991089940071106,0,-0,.6023629903793335])];if("TOY-TRUCK"==t)return[new Float32Array([-.11474676430225372,.06819115579128265,.12616248428821564,-3.9706208099232754e-7,-.14720511436462402,.28020843863487244,5.515660461696825e-8,-.3098587989807129,.08606547862291336,-.18071073293685913,-.27267926931381226,-.012890318408608437,3.1216436013892235e-7,.39625027775764465,.03189631924033165,.23052667081356049,.24702677130699158,.002463694429025054,.1103515625,.2759860157966614,.15902937948703766,.18071091175079346,-.27267909049987793,-.012890467420220375,-.23046159744262695,-.11318685114383698,.0017448731232434511,.23046180605888367,-.1131867840886116,.0017446735873818398,-.1103513240814209,.275985985994339,.15902943909168243,.22978469729423523,.383583128452301,-.09141343832015991,-.22978472709655762,.38358309864997864,-.09141325950622559,-.23052656650543213,.247026726603508,.002463878598064184,.11429085582494736,.06870604306459427,.12790152430534363,.11895161867141724,-.05556913837790489,.37969091534614563,.11927806586027145,.1806230992078781,.373945027589798,-.1189512312412262,-.05556917190551758,.3796910345554352,-.11927773058414459,.18062305450439453,.3739452064037323]),new Float32Array([5.515660461696825e-8,-.3098587989807129,.08606547862291336,3.1216436013892235e-7,.39625027775764465,.03189631924033165])];if("CHIVAS"==t)return[new Float32Array([-3.1930644239785977e-10,-15140265077207005e-22,5.86190128326416,0,-.9621832966804504,1.9865937232971191,1.1873104572296143,-.9285097718238831,.9833493232727051,1.1932897567749023,-.9253148436546326,-1.3412771224975586,0,.9153332114219666,2.9489502906799316,-1.5160919427871704,.8744217157363892,.3604915142059326,-3.4059355336069075e-9,.9318456053733826,.3808324337005615,0,.9403911828994751,1.5472331047058105,.8038088083267212,-.9315917491912842,-.4920954704284668,1.5160919427871704,.8744216561317444,.3604915142059326,-2.058072090148926,-.06387438625097275,-2.1172304153442383,2.0580718517303467,-.06387437880039215,-2.1172304153442383,1.1926252841949463,.9239217042922974,-.5218658447265625,-4.4702903601034905e-9,-.9262475371360779,2.8632278442382812,-.02674211747944355,-1.5987444257348216e-8,-3.3316898345947266,-1.3472687005996704,-.9158325791358948,.9859023094177246,1.6359063386917114,-.8202042579650879,-2.4852395057678223,-1.6359063386917114,-.8202041983604431,-2.4852395057678223,-1.2821598052978516,-.9170172810554504,-1.34637451171875,-1.2809302806854248,-.9167184233665466,-.529242992401123,-2.0578272342681885,-.06386483460664749,1.5451469421386719,1.6359063386917114,.8202039003372192,-2.485239267349243,-1.5809047222137451,.8463804721832275,-2.4669992923736572,.7743757367134094,-.04055686667561531,3.7609105110168457,-1.099993348121643,.9303679466247559,-1.3362138271331787,1.0999937057495117,.9303681254386902,-1.3362138271331787,-1.2809303998947144,.9167175889015198,-.529242753982544,-.7743757367134094,-.040556877851486206,3.760910987854004,2.0578272342681885,-.06386483460664749,1.5451469421386719]),new Float32Array([-.02674211747944355,-1.5987444257348216e-8,-3.3316898345947266,-3.1930644239785977e-10,-15140265077207005e-22,5.86190128326416])];if("CHIVAS-LARGE"==t)return[new Float32Array([-.7353339195251465,-9.039938504429301e-7,2.8790359497070312,.7353339195251465,-9.039938504429301e-7,2.8790359497070312,-1.0241641998291016,-1.0241650342941284,2.1618540287017822,1.1196224689483643,-.9188478589057922,2.1618540287017822,.14197710156440735,-1.4414118528366089,2.1618540287017822,-.14197710156440735,1.4414103031158447,2.1618545055389404,-.5879112482070923,.057907234877347946,4.713740348815918,.5879112482070923,.057907234877347946,4.713740348815918,.06999345868825912,.0023226356133818626,-2.3130407333374023,0,-.07499408721923828,6.051614284515381,.0008376236073672771,1.707755446434021,-1.6613836288452148,-1.3236799240112305,1.0878145694732666,-.10835576057434082,-1.086346983909607,-1.323068618774414,-.10257232189178467,1.3245174884796143,1.0878145694732666,-.10835576057434082,1.2116090059280396,-1.2100292444229126,-.10835611820220947,.8094201683998108,1.5145108699798584,.6681584119796753,-.953505277633667,1.427893042564392,.6681584119796753,-1.0888724327087402,-1.3264672756195068,.6710498332977295,1.2140388488769531,-1.2132492065429688,.6681579351425171,.49678289890289307,-1.6338136196136475,-.8848701119422913,.00010470295092090964,1.7187724113464355,1.0564154386520386,1.0838285684585571,-1.3177416324615479,-1.2731270790100098,1.0838285684585571,1.3218059539794922,-1.2731266021728516,-1.0823626518249512,1.3218059539794922,-1.2731266021728516,-.9479852914810181,-1.4177916049957275,-1.2630056142807007,.3440423905849457,-.6436600685119629,3.901371479034424,-.46299880743026733,-.5641732215881348,3.901371479034424]),new Float32Array([.06999345868825912,.0023226356133818626,-2.3130407333374023,0,-.07499408721923828,6.051614284515381])];if("LION"==t)return[new Float32Array([-.0022359604481607676,-.951945424079895,2.026939868927002,-.448139488697052,-.6012729406356812,-1.6381982564926147,-.5041450262069702,.4640916585922241,-1.7428531646728516,.5572898387908936,.4562094509601593,-1.7489975690841675,.4558115005493164,-.6014943718910217,-1.639726161956787,-.5527711510658264,-.9193709492683411,3.0056838989257812,.5723921656608582,-.9076480865478516,3.0084033012390137,.5884838104248047,.0083160400390625,1.280758261680603,-.6188563108444214,-.009009452536702156,1.2967206239700317,.030467068776488304,.4174400866031647,-.521793007850647,-1.5193467140197754,.0034290971234440804,-.37409281730651855,1.5193467140197754,.0034290971234440804,-.37409281730651855,.012890640646219254,-.8310151696205139,2.4351325035095215,1.5662710666656494,.9279237985610962,3.319540500640869,-1.5894092321395874,.8687598705291748,3.289144515991211,.3409583568572998,-.5160142183303833,1.274591088294983,-.3600188195705414,-.5107225775718689,1.2790225744247437,-1.097593903541565,.11527538299560547,-1.0057109594345093,1.1363357305526733,-.5465875864028931,-.971623957157135,.8704371452331543,.5547775626182556,.3597971200942993,3.982757734721787e-10,.5748654007911682,.7409988641738892,1.0960721969604492,.12153985351324081,-.9948496222496033,-1.1377226114273071,-.5433639287948608,-.9926916360855103,-.8704371452331543,.5547775626182556,.3597968816757202,0,-.5633412003517151,-.9722840189933777,0,-.5655208826065063,.37440025806427]),new Float32Array([.012890640646219254,-.8310151696205139,2.4351325035095215,0,-.5633412003517151,-.9722840189933777])];if("BARTENDER"==t)return[new Float32Array([-.20026133954524994,-.9737697839736938,2.17860746383667,.19603070616722107,-.9857503771781921,2.1616086959838867,.3260974586009979,.7099164128303528,.10108458995819092,-.37390175461769104,-.42527586221694946,1.0039399862289429,.3709491193294525,-.42527586221694946,1.0039399862289429,8438758959528059e-20,-1.101210594177246,1.7955349683761597,2949934116831766e-31,-.04326578229665756,-.5318827629089355,.4412812888622284,-.2815903127193451,-1.3385579586029053,.45793405175209045,.37141913175582886,-1.6536355018615723,-.4412812888622284,-.2815903127193451,-1.3385579586029053,-.45793405175209045,.37141913175582886,-1.6536355018615723,6788047923913078e-31,-.8192819952964783,.4206336736679077,-.9793461561203003,-.015334106981754303,1.7865675687789917,.9793461561203003,-.015334106981754303,1.7865675687789917,1.4873708486557007,.04833114147186279,-.3768104314804077,.4768085777759552,.1994880586862564,.9495226144790649,.7653667330741882,-.3627835810184479,.15018165111541748,.308129221200943,-.6489158868789673,.557608962059021,-.0002116243413183838,.49473923444747925,1.0336977243423462,-.5404940247535706,.19043265283107758,.8128713369369507,-.7657899260520935,-.3627835810184479,.15018165111541748,1.4484371035905497e-7,.3663712441921234,3.387472629547119,-1.2087160348892212,-.6443189978599548,3.0043344497680664,1.2087161540985107,-.6443195343017578,3.0043344497680664,6141737432960813e-31,-.8464082479476929,.10243535041809082,-.3249528408050537,.7104986310005188,.10016584396362305,-.303207665681839,-.9462416172027588,.5075775384902954,-.37667226791381836,-1.0658020973205566,.9869986772537231]),new Float32Array([2949934116831766e-31,-.04326578229665756,-.5318827629089355,1.4484371035905497e-7,.3663712441921234,3.387472629547119])];if("WCBOTTLE"==t)return[new Float32Array([-.013366899453103542,-2.9939471346551727e-7,-2.511009931564331,.6493963599205017,-.7673797011375427,-2.4501447677612305,.7540126442909241,.6627629399299622,-2.4501450061798096,-.9611459970474243,-.36033540964126587,-2.4501450061798096,.1477278769016266,.9964179992675781,1.9307010173797607,-.9568377137184143,-.35869666934013367,1.9307011365890503,-.01336702425032854,3.722930728145002e-7,2.314748764038086,.9344120025634766,.3603347837924957,.22589847445487976,-.027811311185359955,1.0138630867004395,1.6714674234390259,-.9710267186164856,.3331884741783142,1.0331839323043823,.627266526222229,.7859488129615784,1.035000205039978,-.6761305332183838,.7673797011375427,.22936050593852997,-.02781102992594242,1.0138623714447021,-1.587138056755066,-.027811311185359955,1.0138630867004395,.45858100056648254,-.9372201561927795,-.4008185565471649,-.006537972949445248,.5878132581710815,-.8109326958656311,-.27440735697746277,-.3465554714202881,-.9576587677001953,1.3840690851211548,.34696754813194275,-.9477792978286743,-.5884990096092224,-.8841753602027893,-.519440233707428,-.5891181230545044,-.346555233001709,-.9576594829559326,.418072372674942]),new Float32Array([-.013366899453103542,-2.9939471346551727e-7,-2.511009931564331,-.01336702425032854,3.722930728145002e-7,2.314748764038086])];if("EQA"==t)return[new Float32Array([-3.7749502658843994,-.9271571040153503,.04594746232032776,-3.777569055557251,.92264324426651,.04048970341682434,-3.7703702449798584,-1.2227396965026855,-.9106809496879578,-3.7990496158599854,1.1855655908584595,-.9073726534843445,3.811656951904297,1.3718937635421753,-.7763562798500061,3.8001205921173096,-1.3779062032699585,-.7809855341911316,-.4568534791469574,-1.0891674757003784,1.2122516632080078,-.4568534791469574,1.08638596534729,1.2122514247894287,2.6531293392181396,-.925976037979126,1.2379950284957886,2.648271083831787,.9270637631416321,1.2376376390457153,3.459774971008301,-1.3973642587661743,.466232568025589,3.459774971008301,1.3945828676223755,.46623218059539795,-.9480692744255066,.0011375703616067767,1.0669147968292236,-4.019203186035156,-.0013908070977777243,-.24615326523780823,3.3231399059295654,-.0013906551757827401,1.151373267173767,3.907538652420044,-.0012724152766168118,.11990431696176529,.35528019070625305,-1.5870187282562256,.2603841722011566,.5474950671195984,-1.151407241821289,1.2155274152755737,-1.341339349746704,-1.5719798803329468,-.9050094485282898,-1.420742154121399,-1.4566854238510132,.4212491512298584,.35528019070625305,1.5842370986938477,.2603837251663208,.5482162833213806,1.1495895385742188,1.2244428396224976,-1.341339349746704,1.5691980123519897,-.9050098657608032,-1.420742154121399,1.4539037942886353,.42124876379966736,2.0402863025665283,-1.592824101448059,.3434940576553345,1.582544207572937,-1.5713834762573242,-.836898148059845,2.047945737838745,1.584236979484558,.3409099578857422,1.582544207572937,1.5686016082763672,-.8368985652923584]),new Float32Array([-4.019203186035156,-.0013908070977777243,-.24615326523780823,3.907538652420044,-.0012724152766168118,.11990431696176529])];if("WRIST"==t)return[new Float32Array([.07278710603713989,.9428520798683167,.27029818296432495,-.33911436796188354,.9428520798683167,.007900718599557877,.07221490144729614,.9428520798683167,-.2570449709892273,.48266297578811646,.9413872361183167,.0063786618411540985,-.35229796171188354,.6103325486183167,.008312702178955078,.5317351818084717,.6069145798683167,.007252223324030638,.0750916600227356,.32267382740974426,.28397005796432495,-.36548155546188354,.32419970631599426,.00831269659101963,.07011491060256958,.32224658131599426,-.2677871584892273,.5375945568084717,.32481005787849426,.006317619234323502,.6945769786834717,-.04042428359389305,.00379610201343894,-.46606749296188354,-.06276318430900574,.026432497426867485,-.5456573963165283,-.5776557326316833,.10245171189308167,-.29834288358688354,-.6382026076316833,-.002109056105837226,-.0042143831960856915,-.8891791701316833,.1559184491634369,.18328553438186646,-.9155463576316833,.15665088593959808,.43163758516311646,-.8882026076316833,.14688526093959808,.6691863536834717,-.7197455763816833,.12735401093959808,-.010867220349609852,-.8901557326316833,-.1222185343503952,.17535096406936646,-.9174994826316833,-.1223406046628952,.41723328828811646,-.8637885451316833,-.1203874871134758,.6486785411834717,-.6772651076316833,-.14950115978717804,-.41040343046188354,-.33156201243400574,-.14669355750083923]),new Float32Array([.07278710603713989,.9428520798683167,.27029818296432495,-.0042143831960856915,-.8891791701316833,.1559184491634369])];var n=[],r=[];"LAMBORGHINI"==t?n=[85,131,198,203,320,391,401,404,791,886,891,1008,1075,1085]:"HORSE"==t?n=[12,15,264,352,360,845,1119,1316,1498,1872,2065,3146,4269,4273,4590,4593,7671,8034,8756,9119]:"WATSON-CAN"==t?(n=[335,1290,1330,2591,2669,2700,2822,3488,3613,5569,5574,5613,5639,5679,5685],r=[871,482]):"MARTELL-BOTTLE"==t?(n=[11,24,38,83,85,151,182,200,207,222,893,1646,1971,2013,2221,2229,2271,2309,2376,2444,2459,2725,2787,2792],r=[24,893]):"NECKLACE"==t?(n=[670,42,48,551,160,155,762],r=[640,762]):"CAN-KIVISENSE"==t?(n=[38,53,89,981,1006,1009,1019,1024,1034,1046,1052,1062,1087,1096,1105,1117,1124,1144,1148,1154],r=[1914,2725]):("TOY-TRUCK"==t||"WRIST"==t)&&(n=[],r=[]);var a=n.length,s=new Float32Array(3*a);n.forEach((function(t,n){s[3*n]=e[3*t],s[3*n+1]=e[3*t+1],s[3*n+2]=e[3*t+2]}));var o=new Float32Array(3*r.length);return r.forEach((function(t,n){o[3*n]=e[3*t],o[3*n+1]=e[3*t+1],o[3*n+2]=e[3*t+2]})),[s,o]}(E._geometryObjModel.vertices,E._geometryToDetect),i=o[0],u=o[1];if(null==E._bufferKeyps3D&&(E._bufferKeyps3D=E._poseModule._malloc(i.length*E._float_size),E._poseModule.HEAPF32.set(i,E._bufferKeyps3D/4)),E._keypsVts=i,E._refKeypsVts=u,E._bufferHeatmaps=E._poseModule._malloc(a*E._float_size),E._bufferHeatmaps=E._poseModule._malloc(a*E._float_size),E._bufferKeypsDet=E._poseModule._malloc(2*E._geometryDetectorShape[3]*E._float_size),E._bufferKeypsTrack=E._poseModule._malloc(2*E._geometryFeaturesShape[3]*E._float_size),E._bufferFeatureScores=E._poseModule._malloc(s*E._float_size),E._bufferInOutPose=E._poseModule._malloc(21*E._float_size),E._bufferSimToImage=E._poseModule._malloc(8*E._float_size),e.pdmModel){var l=new Uint8Array(e.pdmModel);E._bufferPdmModel=E._poseModule._malloc(l.byteLength),E._poseModule.HEAPU8.set(l,E._bufferPdmModel);var c={rigid_pose:0,num_iterations:1,filter_strength:5,reg_w:10,fovy_d:50,width:640,height:480,num_features:E._geometryToDetect==Wb.Face?68:-1,modelContent:E._bufferPdmModel,modelContentSize:l.byteLength,modelEncoding:E._geometryToDetect==Wb.Face?2:1},h=E._poseModule._malloc(44);E._poseModule.setValue(h+0,c.rigid_pose,"i32"),E._poseModule.setValue(h+4,c.num_features,"i32"),E._poseModule.setValue(h+8,c.filter_strength,"i32"),E._poseModule.setValue(h+12,c.reg_w,"float"),E._poseModule.setValue(h+16,c.fovy_d,"float"),E._poseModule.setValue(h+20,c.width,"i32"),E._poseModule.setValue(h+24,c.height,"i32"),E._poseModule.setValue(h+28,c.num_features,"i32"),E._poseModule.setValue(h+32,c.modelContent,"*"),E._poseModule.setValue(h+36,c.modelContentSize,"i32"),E._poseModule.setValue(h+40,c.modelEncoding,"i32"),E._poseModule.cwrap("xzimgPoseEstimationInitialize","number",["number"])(h),E._poseModule._free(h),E._poseModule._free(E._bufferPdmModel)}E._initialized=!0})),Z((function(){return T.unsubscribe()}))).toPromise()];case 1:return n.sent(),[2]}}))}))},r.prototype.release=function(){this._initialized&&(this._tfGeometryDetector.dispose(),this._tfGeometryFeatures.dispose(),null!=this._bufferHeatmaps&&this._poseModule._free(this._bufferHeatmaps),this._bufferHeatmaps=null,null!=this._bufferKeypsDet&&this._poseModule._free(this._bufferKeypsDet),this._bufferKeypsDet=null,null!=this._bufferKeypsTrack&&this._poseModule._free(this._bufferKeypsTrack),this._bufferKeypsTrack=null,null!=this._bufferFeatureScores&&this._poseModule._free(this._bufferFeatureScores),this._bufferFeatureScores=null,null!=this._bufferInOutPose&&this._poseModule._free(this._bufferInOutPose),this._bufferInOutPose=null,null!=this._bufferSimToImage&&this._poseModule._free(this._bufferSimToImage),this._bufferSimToImage=null,null!=this._bufferKeyps3D&&this._poseModule._free(this._bufferKeyps3D),this._bufferKeyps3D=null,null!=this._hptrImageBuffer&&this._poseModule._free(this._hptrImageBuffer),this._hptrImageBuffer=null,this._bufKeyps3D&&this._poseModule._free(this._bufKeyps3D),this._bufKeyps3D=null,this._bufVertices3D&&this._poseModule._free(this._bufVertices3D),this._bufVertices3D=null,this._poseModule.cwrap("xzimgPoseEstimationRelease")(),this._currentWidth=0,this._currentHeight=0,this._initialized=!1,this._trackingState=pb.Detection)},r.prototype.trackSync=function(e){var t;if(this._initialized){var n=this._videoManager.getVideoCanvas();n.width===this._currentWidth&&n.height===this._currentHeight||(this._currentWidth=n.width,this._currentHeight=n.height,t=Mb.getCameraParams(this._config.fovY,this._currentWidth,this._currentHeight),this._fx=t[0],this._fy=t[1],this._cx=t[2],this._cy=t[3],this._poseModule.cwrap("xzimgInitializeCamera","number",["number","number","number"])(this._config.fovY,this._currentWidth,this._currentHeight)),this._poseManager.setNbFramesDelay(this._videoManager.getNbFramesDelay());var r=e;null==e&&(r=this._videoManager.getLastBuffer()),null!=r?this.trackGeometrySync(r):console.error("No video frame to process")}else console.error("Geometry must be initialized to track")},r.prototype.trackGeometrySync=function(e){var t=-1;if(this._trackingState===pb.Detection){var n=this._poseModule.cwrap("xzimgMatchRecKeypsInit","number",["number"]);null==this._hptrImageBuffer&&(this._hptrImageBuffer=this._poseModule._malloc(e.width*e.height*4)),Ib(this._poseModule,e,this._hptrImageBuffer);var r=kb(this._poseModule,this._hptrImageBuffer,e.width,e.height);n(r),this._poseModule._free(r);var a=this.detectGeometrySync(e),s=a.refinedFeatures,o=a.scores;this._initShape=s;var i=Ub(o,this._config.keyps_score_t);this._recVisibility=i.visibilty,this._trackingState=pb.Detection,i.totalVisible>=4&&i.globalScore>=this._config.detection_score_t&&(qb(this._geometryToDetect)||this._geometryToDetect==Wb.Wrist||this._geometryToDetect==Wb.Face||(t=this.computePoseSync(this._trackingState,this._geometryToDetect))>0&&t<100)&&(this._trackingState=pb.Detected)}else{var u=this.trackGeometryFeaturesSync(e,this._trackingState,this._trackingState==pb.Detected?this._initShape:this._recShape,this._recVisibility,this._geometryToDetect);this._recShape=u.refinedFeatures,i=Ub(u.scores,this._config.keyps_score_t),this._recVisibility=i.visibilty,i.globalScore>=this._config.tracking_score_t?(t=this.computePoseSync(this._trackingState,this._geometryToDetect),this._trackingState=t<=0||t>100?pb.Detection:pb.Tracking):this._trackingState=pb.Detection}var l=qb(this._geometryToDetect)||this._geometryToDetect==Wb.Wrist||this._geometryToDetect==Wb.Face;(this._trackingState===pb.Detection||this._trackingState===pb.Detected&&l)&&(this._pose=new Mb(new Float32Array([1,0,0,0,-1,0,0,0,-1]),new Float32Array([0,0,0])),this._pose.setTrackingState(pb.Detection)),this._pose.setTrackingState(this._trackingState),this._poseManager.setPose(this._pose)},r.prototype.detectGeometrySync=function(e){var t,n,r,a=function(e,t){var n,r;return{crop:e>t?[(r=0)/t,(n=(e-t)/2)/e,1,(e-n)/e]:[(r=(t-e)/2)/t,(n=0)/e,(t-r)/t,1],deltaY:r,deltaX:n}}(this._currentWidth,this._currentHeight),s=a.crop,o=a.deltaY,i=a.deltaX,u=ls(e),l=qa(u,"float32"),c=ro(l,[1,this._currentHeight,this._currentWidth,3]),h=Nl.cropAndResize(c,[s],[0],[this._geometryDetectorConfig.inHeight,this._geometryDetectorConfig.inWidth]),p=Yo(255),f=As(h,p),d=this._tfGeometryDetector.predict(f),m=d.dataSync(),g=this._poseModule.cwrap("xzimgGetHeatmapsLocations","number",["number","number","number","number","number","number","number","number"]),y=null!==(t=null==d?void 0:d.shape[3])&&void 0!==t?t:this._geometryDetectorConfig.outChannels,b=null!==(n=null==d?void 0:d.shape[1])&&void 0!==n?n:this._geometryDetectorConfig.outHeight,v=null!==(r=null==d?void 0:d.shape[2])&&void 0!==r?r:this._geometryDetectorConfig.outWidth,x=y*b*v,_=this._bufferHeatmaps/4;this._poseModule.HEAPF32.subarray(_,_+x).set(m),g(this._bufferHeatmaps,b,v,y,0,1,this._bufferKeypsDet,this._bufferFeatureScores);var w=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferKeypsDet,2*y),T=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferFeatureScores,y);u.dispose(),l.dispose(),p.dispose(),h.dispose(),f.dispose(),c.dispose(),d.dispose();var E=Math.min(this._currentWidth,this._currentHeight),S=E/this._geometryDetectorConfig.inWidth,I=E/this._geometryDetectorConfig.inHeight;return this._simToImage_Det=function(e,t,n,r){var a=new Float32Array(6);return a[0]=r,a[1]=0,a[2]=t,a[3]=0,a[4]=n,a[5]=e,a}(o,i,I,S),{refinedFeatures:zb(w,this._simToImage_Det,!1,d.shape[1]),scores:T}},r.prototype.trackGeometryFeaturesSync=function(e,t,n,r,a){var s,o,i,u,l,c,h,p,f=Int32Array.from(r);if(t!=pb.Detected?(l=(s=Cb(this._poseModule,e,this._hptrImageBuffer,n,f))[0],c=s[1],h=s[2],Math.sqrt(c[2]*c[2]+c[3]*c[3])>10?this._fastMvt=!0:this._fastMvt=!1,a==Wb.FullBody?(h[7]=0,h[8]=0,h[9]=0,h[10]=0,h[13]=0,h[14]=0,h[15]=0,h[16]=0):a==Wb.UpperBody&&(h[7]=0,h[8]=0,h[9]=0,h[10]=0),$b(this._poseModule,this._bufferInOutPose,n,l,h,this._fx,this._fy)):l=n,"WATSON-CAN"==a||"CAN-KIVISENSE"==a||"TOY-TRUCK"==a||"CHIVAS"==a||"CHIVAS-LARGE"==a||"LION"==a||"BARTENDER"==a||"WCBOTTLE"==a||"EQA"==a||"MARTELL-BOTTLE"==a){var d=this._pose.project(this._refKeypsVts,Mb.getCameraMat(this._config.fovY,this._currentWidth,this._currentHeight));p=-Math.atan2(d[1]-d[3],d[2]-d[0]),"EQA"==a&&(p=0);for(var m=this._pose.project(this._keypsVts,Mb.getCameraMat(this._config.fovY,this._currentWidth,this._currentHeight)),g=new Float32Array(m.length),y=0;y<g.length/2;y++)g[y]=m[2*y],g[y+g.length/2]=m[2*y+1]}qb(a)?this._simToImage_FTrack=function(e,t,n,r){var a,s,o,i=e.length/2,u=Array(5),l=new Array(5);if(7==i)u[0]=t[0]>0?1:0,l[0]=new Hb(e[0],e[i]),u[1]=t[3]>0&&t[4]>0?1:0,l[1]=new Hb((e[3]+e[4])/2,(e[3+i]+e[4+i])/2),u[2]=t[5]>0&&t[6]>0?1:0,l[2]=new Hb((e[5]+e[6])/2,(e[5+i]+e[6+i])/2),u[3]=t[1]>0?1:0,l[3]=new Hb(e[1],e[1+i]),u[4]=t[2]>0?1:0,l[4]=new Hb(e[2],e[2+i]);else{var c=15==i?13:17,h=15==i?14:18;u[0]=t[0]>0?1:0,l[0]=new Hb(e[0],e[i]),u[1]=t[c]>=0?1:0,l[1]=new Hb(e[c],e[c+i]),u[2]=t[h]>=0?1:0,l[2]=new Hb(e[h],e[h+i]),u[3]=t[1]>0?1:0,l[3]=new Hb(e[1],e[1+i]),u[4]=t[2]>0?1:0,l[4]=new Hb(e[2],e[2+i])}if(19==i)if(u[1]>0&&u[2]>0)a=l[2],s=-Math.atan2(l[2].y-l[1].y,l[1].x-l[2].x),s+=Math.PI/2,o=2*l[2].Dist(l[1])*2.35;else if(u[0]>0&&u[1]>0)(a=l[1]).y+=2.24*(l[1].y-l[0].y),s=-Math.atan2(l[1].y-l[0].y,l[0].x-l[1].x),s+=Math.PI/2,o=2*l[0].Dist(l[1])*5.3;else if(u[0]>0&&u[2]>0)a=l[2],s=-Math.atan2(l[2].y-l[0].y,l[0].x-l[2].x),s+=Math.PI/2,o=2*l[0].Dist(l[2])*1.64;else{if(!(u[0]>0&&u[3]>0&&u[4]>0))return 0;var p=l[3].Dist(l[4]);(a=l[0]).y+=3*p,s=-Math.atan2(l[4].y-l[3].y,l[3].x-l[4].x),o=2*p*14}else if(u[1]>0&&u[2]>0)a=l[1],s=-Math.atan2(l[2].y-l[1].y,l[1].x-l[2].x),s+=Math.PI/2,o=2*l[2].Dist(l[1])*1.2;else if(u[0]>0&&u[1]>0)a=l[1],s=-Math.atan2(l[1].y-l[0].y,l[0].x-l[1].x),s+=Math.PI/2,o=2*l[0].Dist(l[1])*2.6;else if(u[0]>0&&u[2]>0)a=new Hb(l[2].x+.75*(l[0].x-l[2].x),l[2].y+.75*(l[0].y-l[2].y)),s=-Math.atan2(l[2].y-l[0].y,l[0].x-l[2].x),s+=Math.PI/2,o=2*l[0].Dist(l[2])*.8;else{if(!(u[0]>0&&u[3]>0&&u[4]>0))return 0;p=l[3].Dist(l[4]),(a=l[0]).y+=5.5*p,s=-Math.atan2(l[4].y-l[3].y,l[3].x-l[4].x),o=2*p*11}for(var f=0,d=0;d<i;d++){var m=new Hb(e[d],e[d+i]).Dist(a);t[d]>0&&m>f&&(f=m)}var g=new Kb;g.w=Math.max(o,2*f),g.h=g.w,g.x=a.x-g.w/2,g.y=a.y-g.h/2;var y=Math.cos(s),b=Math.sin(s),v=(g.w+.1*g.w)/Math.max(n[0],n[1]),x=n[1]/2,_=n[0]/2,w=a.x-(y*v*x-b*v*_),T=a.y-(b*v*x+y*v*_);if(null!=r){var E=.8;v=(1-E)*v+E*r[7],w=(1-E)*w+E*r[2],T=(1-E)*T+E*r[5],s=(1-E)*s+E*r[6],y=Math.cos(s),b=Math.sin(s)}return[y*v,-b*v,w,b*v,y*v,T,s,v]}(l,r,[this._geometryFeaturesConfig.inWidth,this._geometryFeaturesConfig.inHeight],t==pb.Detected||this._fastMvt?null:this._simToImage_FTrack):a==Wb.Face?this._simToImage_FTrack=function(e,t,n,r){var a,s,o,i,u=e.length/2,l=function(e,t,n){for(var r=1e4,a=1e4,s=-1e4,o=-1e4,i=0;i<n;i++)if(t[i]>0){var u=e[i],l=e[n+i];u>s&&(s=u),l>o&&(o=l),u<r&&(r=u),l<a&&(a=l)}return[Math.floor(r),Math.floor(s+1),Math.floor(a),Math.floor(o+1)]}(e,t,u),c=new jb((l[0]+l[1])/2,(l[2]+l[3])/2);if(5==u)(a=Vb(e,0,1))[0],a[1],i=a[2],o=1.5*(l[1]-l[0]);else{(s=Vb(e,36,45))[0],s[1],i=s[2];var h=new jb(e[27],e[27+u]),p=new jb(.5*(e[62]+e[66]),.5*(e[62+u]+e[66+u]));i=1.57075-Math.atan2(p.y-h.y,h.x-p.x),o=l[1]-l[0]}var f=new Gb;f.w=o,f.h=f.w,f.x=c.x-f.w/2,f.y=c.y-f.h/2;var d=Math.cos(i),m=Math.sin(i),g=(f.w+.35*f.w)/Math.max(n[0],n[1]),y=n[1]/2,b=n[0]/2,v=c.x-(d*g*y-m*g*b),x=c.y-(m*g*y+d*g*b);if(null!=r){var _=.8;g=(1-_)*g+_*r[7],v=(1-_)*v+_*r[2],x=(1-_)*x+_*r[5],i=(1-_)*i+_*r[6],d=Math.cos(i),m=Math.sin(i)}return[d*g,-m*g,v,m*g,d*g,x,i,g]}(l,r,[this._geometryFeaturesConfig.inWidth,this._geometryFeaturesConfig.inHeight],t==pb.Detected||this._fastMvt?null:this._simToImage_FTrack):this._simToImage_FTrack=function(e,t,n,r,a,s,o,i){var u,l,c=e.length/2;void 0===i&&((u=function(e){var t,n=e.length/2,r=5==(t=n)?[1,2]:14==t?[1,7]:20==t?[2,12]:7==t?[0,6]:19==t?[10,15]:23==t?[0,14]:(console.time("==> Weird number of vertices"),[0,1]),a=r[0],s=r[1],o=[e[a],e[a+n]],i=[e[s],e[s+n]],u=[(4*o[0]+i[0])/5,(4*o[1]+i[1])/5],l=-Math.atan2(o[1]-i[1],i[0]-o[0]);return[u[0],u[1],l]}(e))[0],u[1],i=u[2]),l=function(e,t){for(var n=1e4,r=1e4,a=-1e4,s=-1e4,o=0;o<t;o++){var i=e[o],u=e[t+o];i>a&&(a=i),u>s&&(s=u),i<n&&(n=i),u<r&&(r=u)}return[Math.floor(n),Math.floor(a+1),Math.floor(r),Math.floor(s+1)]}(e,c),l[2],l[0],l[3],l[1];var h=Math.cos(i),p=Math.sin(i),f=Math.sqrt((l[1]-l[0])*(l[1]-l[0])+(l[3]-l[2])*(l[3]-l[2])),d=.3;"NECKLACE"==o&&(d=.5),"WRIST"==o&&(f=Math.max(l[1]-l[0],l[3]-l[2]),d=.7),"MARTEL-BOTTLE"==o&&(d=.2),"EQA"==o&&(d=.2),"BARTENDER"==o&&(d=.2);var m=(f+=d*f)/Math.max(n,t),g=t/2,y=n/2,b=(l[0]+l[1])/2-(h*m*g-p*m*y),v=(l[2]+l[3])/2-(p*m*g+h*m*y);if(null!=s){if("NECKLACE"==o||"WRIST"==o){var x=.8;m=(1-x)*m+x*s[7],b=(1-x)*b+x*s[2],v=(1-x)*v+x*s[5],i=(1-x)*i+x*s[6]}else{var _=Math.sqrt((b-s[2])*(b-s[2])+(v-s[5])*(v-s[5])),w=1;_>20&&(w=.1),_>=10&&_<=20&&(w=1-.09*(_-5)),b=(1-w)*b+w*s[2],v=(1-w)*v+w*s[5],i=Math.abs(i-s[6])>1?(1-w)*i-w*s[6]:(1-w)*i+w*s[6],m=(1-w)*m+w*s[7]}h=Math.cos(i),p=Math.sin(i)}return[h*m,-p*m,b,p*m,h*m,v,i,m]}(l,this._geometryFeaturesConfig.inWidth,this._geometryFeaturesConfig.inHeight,this._currentWidth,this._currentHeight,t==pb.Detected||this._fastMvt?null:this._simToImage_FTrack,a,p);var b=new ImageData(this._geometryFeaturesConfig.inWidth,this._geometryFeaturesConfig.inHeight);b=function(e,t,n){for(var r=n[0],a=n[1],s=n[2],o=n[3],i=n[4],u=n[5],l=e.width,c=e.height,h=4*e.width,p=t.width,f=t.height,d=4*t.width,m=0;m<f;m++)for(var g=a*m+s,y=i*m+u,b=m*d,v=0;v<p;v++){var x=4*v,_=Math.floor(g),w=Math.floor(y),T=g-_,E=y-w,S=void 0,I=void 0;if(_>0&&_<l-1&&w>0&&w<c-1){for(var k=w*h+4*_,C=0;C<3;C++,k++){var N=e.data[k];S=N+T*(e.data[k+4]-N),I=e.data[k+h]+T*(e.data[k+h+4]-e.data[k+h]),t.data[b+x+C]=S+E*(I-S)}t.data[b+x+3]=255}else{for(C=0;C<3;C++)t.data[b+x+C]=0;t.data[b+x+3]=255}g+=r,y+=o}return t}(e,b,this._simToImage_FTrack);var v=ls(b),x=qa(v,"float32"),_=ro(x,[1,this._geometryFeaturesConfig.inHeight,this._geometryFeaturesConfig.inWidth,3]),w=Yo(255),T=As(_,w),E=this._tfGeometryFeatures.predict(T),S=E.dataSync(),I=this._poseModule.cwrap("xzimgGetHeatmapsLocations","number",["number","number","number","number","number","number","number","number"]),k=null!==(o=null==E?void 0:E.shape[3])&&void 0!==o?o:this._geometryFeaturesConfig.outChannels,C=null!==(i=null==E?void 0:E.shape[1])&&void 0!==i?i:this._geometryFeaturesConfig.outHeight,N=null!==(u=null==E?void 0:E.shape[2])&&void 0!==u?u:this._geometryFeaturesConfig.outWidth,A=k*C*N,$=this._bufferHeatmaps/4;this._poseModule.HEAPF32.subarray($,$+A).set(S),I(this._bufferHeatmaps,C,N,k,0,1,this._bufferKeypsTrack,this._bufferFeatureScores);var R=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferKeypsTrack,2*k),F=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferFeatureScores,k);return v.dispose(),x.dispose(),w.dispose(),T.dispose(),_.dispose(),E.dispose(),{refinedFeatures:zb(R,this._simToImage_FTrack,!1,E.shape[1]),scores:F}},r.prototype.computePoseSync=function(e,t){if(qb(t)||t==Wb.Wrist||t==Wb.Face)return this.computeNonRigidPoseSync(e,t);var n=-1,r=this._poseModule.cwrap("xzimgEstimateRigidPose","number",["number","number","number","number","number","number","number","number","number","number","number","number"]);if(e==pb.Detection){var a=0,s=0,o=3,i=1,u=this._bufferSimToImage/4;return this._poseModule.HEAPF32.subarray(u,u+8).set(this._simToImage_Det),n=r(this._bufferHeatmaps,this._geometryDetectorShape[1],this._geometryDetectorShape[2],this._geometryDetectorShape[3],a,this._bufferSimToImage,this._bufferKeypsDet,this._bufferKeyps3D,s,o,i,this._bufferInOutPose),this._pose=new Mb(new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose,9),new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose+9*this._float_size,3)),n}return e==pb.Detected||e==pb.Tracking?(a=0,s=1,o=3,i=this._fastMvt?3:1,u=this._bufferSimToImage/4,this._poseModule.HEAPF32.subarray(u,u+8).set(this._simToImage_FTrack),n=r(this._bufferHeatmaps,this._geometryFeaturesShape[1],this._geometryFeaturesShape[2],this._geometryFeaturesShape[3],a,this._bufferSimToImage,this._bufferKeypsTrack,this._bufferKeyps3D,s,o,i,this._bufferInOutPose),this._pose=new Mb(new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose,9),new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose+9*this._float_size,3)),this._recShape3D=this._pose.transform(this._keypsVts),n):-1},r.prototype.computeNonRigidPoseSync=function(e,t){var n;n=qb(t)?this._poseModule.cwrap("xzimgEstimateBodyNonRigidPose","number",["number","number","number","number","number","number","number","number","number"]):this._poseModule.cwrap("xzimgEstimateNonRigidPoseBase","number",["number","number","number","number","number","number","number","number","number"]);var r=e==pb.Detected?1:0,a=this._geometryFeaturesShape[3],s=this._poseModule._malloc(a*this._float_size*2),o=s/4,i=this._poseModule.HEAPF32.subarray(o,o+2*a);i.set(this._recShape);var u=this._poseModule._malloc(a*this._int_size);o=u/4,(i=this._poseModule.HEAPF32.subarray(o,o+a)).set(this._recVisibility),null==this._bufKeyps3D&&(this._bufKeyps3D=this._poseModule._malloc(a*this._float_size*3));var l=n(r,s,a,u,1,t==Wb.Face?10:1e3,50,this._bufferInOutPose,this._bufKeyps3D);this._pose=new Mb(new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose,9),new Float32Array(this._poseModule.HEAPF32.buffer,this._bufferInOutPose+9*this._float_size,3)),this._recShape3D=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufKeyps3D,3*a),this._poseModule._free(s),this._poseModule._free(u);var c=this._poseModule.cwrap("xzimgEstimateGetNumVertices","number"),h=this._poseModule.cwrap("xzimgEstimateGetDenseVertices","number"),p=c();return p>0&&(null==this._bufVertices3D&&(this._bufVertices3D=this._poseModule._malloc(p*this._float_size*3)),h(this._bufVertices3D),this._recDenseShape3D=new Float32Array(this._poseModule.HEAPF32.buffer,this._bufVertices3D,3*p)),l}}();var Xb,Yb=(Xb="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,r;e=e||{},t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){n=e,r=t}));let a=null;var s=null,o=null,i=null,u=null,l=!1,c={},h=null,p=[];t.preinitializedWebGLContext=t.canvas.getContext("webgl",{alpha:!1}),t.process=function(){};let f=new class{get Qh(){switch(this.type){case"Timer":return this.Jh;case"RAF":return this.Ch;case"Oscillator":return this.xh}}constructor(){this.xh=this.Ch=this.Jh=!1,this.type="RAF",this.Uh=1e3/33}add(e){this.Kh=e}start(){switch(this.type){case"Timer":if(!this.Jh){this.Jh=!0;const e=()=>{setTimeout((()=>{this.Kh&&this.Kh(),this.Jh&&e()}),this.Uh)};e()}break;case"RAF":if(!this.Ch){this.Ch=!0;const e=t=>{requestAnimationFrame((n=>{n-t<=this.Uh?this.Ch&&e(t):this.Kh&&(this.Kh(),e(n))}))};e(performance.now())}break;case"Oscillator":if(!this.xh){a=a||new AudioContext,this.xh=!0;const e=a.createGain();let t;e.gain.value=0,e.connect(a.destination);const n=()=>{this.Kh&&this.Kh(),t&&t.disconnect(),this.$h=t=a.createOscillator(),t.connect(e),this.xh&&(t.onended=n,t.start(),t.stop(a.currentTime+this.Uh/1e3))};n()}}}stop(){switch(this.type){case"Timer":this.Jh=!1;break;case"RAF":this.Ch=!1;break;case"Oscillator":this.xh=!1,this.$h&&(this.$h.onended=null,this.$h=void 0)}}};t.setFps=function(e){f.Uh=1e3/e},f.add((function(){var e=t.video,n=t.context;const r=t.si;e&&n&&r&&e.readyState===e.HAVE_ENOUGH_DATA&&(e=t.canvas.width,n=t.canvas.height,t.canvasWidth===e&&t.canvasHeight===n||(t.canvasWidth=e,t.canvasHeight=n,Hr(e,n)),t._processFrameVideo(0,t.video.videoWidth,t.video.videoHeight,t.li),t._render())})),t.startLoop=function(){f.start()},t.endLoop=function(){f.stop()},t.takeScreenshot=function(){Gr(),f.Qh||t._render()},t.startVideoRecording=function(e){if(l)throw"Video recording already started!";if(l=!0,null==h||function(e){var t=c;return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every((n=>e.hasOwnProperty(n)&&t[n]===e[n]))}(e)){const n={};e.mimeType&&(n.mimeType=e.mimeType),h=new MediaRecorder(t.canvas.captureStream(),n),c=Object.assign({},e),h.ondataavailable=function(e){p.push(e.data)}}h.start()},t.finishVideoRecording=function(e){if(!l)throw"Video recording not started!";h.onstop=function(){e(new Blob(p,{type:c.mimeType||"video/webm"})),p=[],l=!1},h.stop()},t.processFrameRawPixels=function(e,n,r,a){var s=t._malloc(e.length);s&&(t.HEAPU8.set(e,s),t._processFrameRawPixels(s,n,r,a),f.Qh||t._render(),t._free(s))},t.setFaceTrackingModel=function(e){t.faceTrackingModelByteArray=e},t.switchEffectByteArray=function(e,n,r){if(o){var a=t._malloc(r.length);a&&(t.HEAPU8.set(r,a),o(n,a,r.length,e),f.Qh||t._render())}},t.switchEffect=function(e,n,r,a){var s=new XMLHttpRequest;s.open("GET",r,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var r=new Uint8Array(s.response);t.switchEffectByteArray(e,n,r),a&&a()}},s.send(null)},t.clearEffect=function(e){i&&(i(e),f.Qh||t._render())},t.moveGameObject=function(e,n){u&&(u(e,n),f.Qh||t._render())},t.setMirror=function(e){t.li=!!e},t.startVideo=function(e,n){if(t.video)console.log("video already running");else{t.vi=!1,t.Bj=n,t.li=!!e;var r=document.createElement("video");r.muted=!0,r.loop=!0,r.controls=!0,r.setAttribute("playsinline","playsinline"),r.style.width="100%",r.style.height="100%",(e=document.createElement("div")).appendChild(r),e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style["z-index"]="-1",document.body.appendChild(e),t.ii=e,hr=t.video=r,e=t.Bj||!0,t.Oi(),navigator.mediaDevices.getUserMedia({video:e}).then((function(e){try{r.srcObject=e}catch(t){r.src=URL.createObjectURL(e)}t.Qi(),setTimeout((function(){r.play()}),50)})).catch((function(){t.Pi()})),r.addEventListener("loadedmetadata",(function(){var e=document.createElement("canvas"),n=e.getContext("2d");t.si=e,t.context=n,n=320/r.videoWidth,e.width=Math.floor(r.videoWidth*n),e.height=Math.floor(r.videoHeight*n),t.bi=t._malloc(e.width*e.height*4),t.Yi()}))}},t.shutdown=function(){t.stopVideo(),jr(),t.Xi()},t.setVideoElement=function(e,n){function r(){var n=document.createElement("canvas"),a=n.getContext("2d");t.si=n,t.context=a,a=320/e.videoWidth,n.width=Math.floor(e.videoWidth*a),n.height=Math.floor(e.videoHeight*a),t.bi=t._malloc(n.width*n.height*4),e.removeEventListener("loadedmetadata",r)}t.li=!!n,t.vi=!0,hr=t.video=e,e.readyState===e.HAVE_ENOUGH_DATA?r():e.addEventListener("loadedmetadata",r)},t.stopVideo=function(){if(t.ii&&(t.ii.parentNode.removeChild(t.ii),t.ii=null),t.video){if(!t.vi){var e=t.video.srcObject.getVideoTracks();e&&0<e.length&&e[0].stop(),t.video.pause()}hr=t.video=null}t.si=null,t.bi&&t._free(t.bi),t.bi=0,t.context=null,gr||(null!=yr&&(yr.isInitialized()&&yr.release(),yr=null),br=null,console.log("DeepAR FootTracking released from stopVideo()."))},t.touchOccurred=function(e){Kr(e.x,e.y,e.type)},t.setOffscreenRenderingEnabled=function(e){!function(e){var t=f;if(t.type!==e){var n=t.Jh|t.xh|t.Ch;t.stop(),t.type=e,n&&t.start()}}(e?"Oscillator":"RAF")},t.Si=function(e,n,r,a){if(t.apiObject.onFaceTracked){for(var s=[],o=0;o<a;o++){var i={detected:!1,translation:[],rotation:[],poseMatrix:[],landmarks:[],landmarks2d:[],faceRect:[]},u=n+o*r,l=u+e.translationOffset,c=u+e.rotationOffset,h=u+e.poseMatrixOffset,p=u+e.landmarksOffset,f=u+e.landmarks2DOffset,d=u+e.faceRectOffset;for(i.detected=!!t.HEAP32[u/Float32Array.BYTES_PER_ELEMENT],u=0;3>u;u++)i.translation.push(t.HEAPF32[l/Float32Array.BYTES_PER_ELEMENT+u]),i.rotation.push(t.HEAPF32[c/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;16>u;u++)i.poseMatrix.push(t.HEAPF32[h/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;204>u;u++)i.landmarks.push(t.HEAPF32[p/Float32Array.BYTES_PER_ELEMENT+u]),136>u&&i.landmarks2d.push(t.HEAPF32[f/Float32Array.BYTES_PER_ELEMENT+u]);for(u=0;4>u;u++)i.faceRect.push(t.HEAPF32[d/Float32Array.BYTES_PER_ELEMENT+u]);s.push(i)}t.apiObject.onFaceTracked(s)}},t.Yi=function(){t.apiObject.onVideoStarted&&t.apiObject.onVideoStarted()},t.Qj=function(){t.apiObject.onInitialize&&t.apiObject.onInitialize()},t.Ti=function(e){t.apiObject.onFaceVisibilityChanged&&t.apiObject.onFaceVisibilityChanged(e)},t.Ui=function(e){t.apiObject.onImageVisibilityChanged&&t.apiObject.onImageVisibilityChanged(e)},t.Qi=function(){t.apiObject.onCameraPermissionGranted&&t.apiObject.onCameraPermissionGranted()},t.Pi=function(){t.apiObject.onCameraPermissionDenied&&t.apiObject.onCameraPermissionDenied()},t.Oi=function(){t.apiObject.onCameraPermissionAsked&&t.apiObject.onCameraPermissionAsked()},t.Wi=function(e,n,r){var a=document.createElement("canvas"),s=a.getContext("2d");a.width=n,a.height=r;for(var o=s.getImageData(0,0,a.width,a.height),i=o.data,u=0;u<r;u++)for(var l=0;l<n;l++){var c=4*((r-u-1)*n+l),h=4*(u*n+l);i[h]=t.HEAPU8[e+c+2],i[h+1]=t.HEAPU8[e+c+1],i[h+2]=t.HEAPU8[e+c+0],i[h+3]=t.HEAPU8[e+c+3]}s.putImageData(o,0,0),t.apiObject.onScreenshotTakenCanvas&&t.apiObject.onScreenshotTakenCanvas(a),t.apiObject.onScreenshotTaken&&t.apiObject.onScreenshotTaken(a.toDataURL("image/png"))},t.Ni=function(e){t.apiObject.onAnimationTransitionedToState&&t.apiObject.onAnimationTransitionedToState(e)},t.Ri=function(e,n){t.apiObject.onError&&t.apiObject.onError(e,n)},t.Vi=function(e){t.apiObject.onNumberOfFacesVisibleChanged&&t.apiObject.onNumberOfFacesVisibleChanged(e)},t.Xi=function(){t.apiObject.onShutdown&&t.apiObject.onShutdown()},t.noInitialRun=!0,t.onRuntimeInitialized=function(){o=Dr("switchEffect",null,["string","number","number","number"]),i=Dr("clearEffect",null,["string"]),u=Dr("moveGameObject",null,["string","string"]),t.pushConsoleLog=Dr("pushConsoleLog","boolean",["string","int"]),t.changeParameterFloat=Dr("changeParameterFloat",null,["string","string","string","number"]),t.changeParameterVector=Dr("changeParameterVector",null,"string string string number number number number".split(" ")),t.changeParameterBool=Dr("changeParameterBool",null,["string","string","string","boolean"]),t.changeParameterTexture=Dr("changeParameterTexture",null,"string string string number number number number".split(" ")),t.fireTrigger=Dr("fireTrigger",null,["string"]),t.setFaceDetectionSensitivity=Dr("setFaceDetectionSensitivity",null,["number"]),t.showStats=Dr("showStats",null,["number"]),t.simulatePhysics=Dr("simulatePhysics",null,["number"]),t.showColliders=Dr("showColliders",null,["number"]),t.setLicenseKey=Dr("setLicenseKey",null,["string"]),t.setLicenseKey(t.licenseKey),s=t.xzimg,Wr(t.canvasWidth,t.canvasHeight)};var d=Object.assign({},t),m="";"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),Xb&&(m=Xb),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var g=console.log.bind(console),y=console.warn.bind(console);Object.assign(t,d),d=null;var b=!1;"object"!=typeof WebAssembly&&X("no native wasm support detected");var v,x,_,w,T,E,S,I,k,C,N,A=!1,$="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&$)return $.decode(e.subarray(t,n));for(r="";t<n;){var a=e[t++];if(128&a){var s=63&e[t++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|s);else{var o=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|s<<6|o:(7&a)<<18|s<<12|o<<6|63&e[t++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function F(e,t){return e?R(T,e,t):""}function O(e,t,n,r){if(!(0<r))return 0;var a=n;r=n+r-1;for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(n+3>=r)break;t[n++]=240|o>>18,t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-a}function D(e,t,n){return O(e,T,t,n)}function M(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t}function L(){var e=v.buffer;_=e,t.HEAP8=w=new Int8Array(e),t.HEAP16=E=new Int16Array(e),t.HEAP32=I=new Int32Array(e),t.HEAPU8=T=new Uint8Array(e),t.HEAPU16=S=new Uint16Array(e),t.HEAPU32=k=new Uint32Array(e),t.HEAPF32=C=new Float32Array(e),t.HEAPF64=N=new Float64Array(e)}var P,B,U=[],z=[],V=[],W=[],j=!1,G=0,H=0,K=null,q=null;function X(e){throw y(e="Aborted("+e+")"),A=!0,x=1,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function Y(){return B.startsWith("data:application/octet-stream;base64,")}if(B="deepar.wasm",!Y()){var Q=B;B=t.locateFile?t.locateFile(Q,m):m+Q}function J(){try{throw"both async and sync fetching of the wasm failed"}catch(e){X(e)}}var Z={745272:(e,n,r,a,s,o)=>{var i=document.createElement("canvas"),u=i.getContext("2d");i.width=n,i.height=r,e=new Uint8ClampedArray(t.HEAPU8.subarray(e,e+i.width*i.height*4)),e=new ImageData(e,i.width,i.height),u.putImageData(e,0,0),e=(u=document.createElement("canvas")).getContext("2d"),u.width=s,u.height=o,e.drawImage(i,0,0,u.width,u.height),s=e.getImageData(0,0,u.width,u.height),s=new Uint8Array(s.data.buffer),t.HEAPU8.set(s,a)},746146:(e,n,r,a,s,o)=>{var i=document.createElement("canvas"),u=i.getContext("2d");i.width=n,i.height=r,e=new Uint8ClampedArray(t.HEAPU8.subarray(e,e+i.width*i.height*4)),e=new ImageData(e,i.width,i.height),u.putImageData(e,0,0),e=(u=document.createElement("canvas")).getContext("2d"),u.width=s,u.height=o,e.drawImage(i,0,0,u.width,u.height),s=e.getImageData(0,0,u.width,u.height),s=new Uint8Array(s.data.buffer),t.HEAPU8.set(s,a)},747020:()=>{console.log("License key not valid")},747057:(e,n,r)=>{t.Wi(e,n,r)},747100:e=>{t.Vi(e)},747147:(e,n,r,a,s,o,i,u,l)=>{t.Si({translationOffset:e,rotationOffset:n,poseMatrixOffset:r,landmarksOffset:a,landmarks2DOffset:s,faceRectOffset:o},i,u,l)},747331:(e,n)=>{t.Ri(F(e),F(n))},747388:e=>{t.Ti(!!e)},747429:e=>{t.Ui(!!e)},747473:(e,n)=>{e=F(e,n),t.Ni(e)},747554:()=>{alert("DeepAR license not valid")},747588:()=>{t.endLoop()},747609:()=>hr.videoWidth,747651:()=>hr.videoHeight,747694:()=>{var e=t.faceTrackingModelByteArray;if(!e)return 0;var n=t._malloc(e.length);return t.HEAPU8.set(e,n),n},747888:()=>{var e=nr,t=M(e)+1,n=qr(t);return D(e,n,t),n},748042:()=>{var e=rr,t=M(e)+1,n=qr(t);return D(e,n,t),n},748201:()=>{var e=ar,t=M(e)+1,n=qr(t);return D(e,n,t),n},748367:()=>{var e=or,t=M(e)+1,n=qr(t);return D(e,n,t),n},748530:()=>{var e=ir,t=M(e)+1,n=qr(t);return D(e,n,t),n},748698:()=>{var e=sr,t=M(e)+1,n=qr(t);return D(e,n,t),n},748863:()=>{var e=ur,t=M(e)+1,n=qr(t);return D(e,n,t),n},749025:()=>{var e=lr,t=M(e)+1,n=qr(t);return D(e,n,t),n},749186:()=>{var e=cr,t=M(e)+1,n=qr(t);return D(e,n,t),n}};function ee(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function te(e){for(;0<e.length;)e.shift()(t)}function ne(e){if(!(e instanceof ee||"unwind"==e))throw e}var re=[],ae=0,se=0;function oe(e){this.Xh=e,this.th=e-24,this.Ei=function(e){k[this.th+4>>2]=e},this.xh=function(){return k[this.th+4>>2]},this.Dj=function(e){k[this.th+8>>2]=e},this.gj=function(){return k[this.th+8>>2]},this.Di=function(){I[this.th>>2]=0},this.oi=function(e){w[this.th+12>>0]=e?1:0},this.Qh=function(){return 0!=w[this.th+12>>0]},this.pi=function(e){w[this.th+13>>0]=e?1:0},this.xi=function(){return 0!=w[this.th+13>>0]},this.$h=function(e,t){this.Ch(0),this.Ei(e),this.Dj(t),this.Di(),this.oi(!1),this.pi(!1)},this.Jh=function(){I[this.th>>2]+=1},this.rj=function(){var e=I[this.th>>2];return I[this.th>>2]=e-1,1===e},this.Ch=function(e){k[this.th+16>>2]=e},this.Kh=function(){return k[this.th+16>>2]},this.Uh=function(){if(sa(this.xh()))return k[this.Xh>>2];var e=this.Kh();return 0!==e?e:this.Xh}}function ie(e){return Xr(new oe(e).th)}function ue(e){return P.get(e)}var le={};function ce(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function he(e){return this.fromWireType(I[e>>2])}var pe={},fe={},de={};function me(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return 48<=t&&57>=t?"_"+e:e}function ge(e,t){return e=me(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ye(e){var t=Error,n=ge(e,(function(t){this.name=e,this.message=t,void 0!==(t=Error(t).stack)&&(this.stack=this.toString()+"\n"+t.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var be=void 0;function ve(e){throw new be(e)}function xe(e,t,n){function r(t){(t=n(t)).length!==e.length&&ve("Mismatched type converter count");for(var r=0;r<e.length;++r)Ie(e[r],t[r])}e.forEach((function(e){de[e]=t}));var a=Array(t.length),s=[],o=0;t.forEach(((e,t)=>{fe.hasOwnProperty(e)?a[t]=fe[e]:(s.push(e),pe.hasOwnProperty(e)||(pe[e]=[]),pe[e].push((()=>{a[t]=fe[e],++o===s.length&&r(a)})))})),0===s.length&&r(a)}function _e(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var we=void 0;function Te(e){for(var t="";T[e];)t+=we[T[e++]];return t}var Ee=void 0;function Se(e){throw new Ee(e)}function Ie(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||Se('type "'+r+'" must have a positive integer typeid pointer'),fe.hasOwnProperty(e)){if(n.lj)return;Se("Cannot register type '"+r+"' twice")}fe[e]=t,delete de[e],pe.hasOwnProperty(e)&&(t=pe[e],delete pe[e],t.forEach((e=>e())))}function ke(e){Se(e.sh.vh.uh.name+" instance already deleted")}var Ce=!1;function Ne(){}function Ae(e){--e.count.value,0===e.count.value&&(e.yh?e.Bh.Ih(e.yh):e.vh.uh.Ih(e.th))}function $e(e,t,n){return t===n?e:void 0===n.Dh||null===(e=$e(e,t,n.Dh))?null:n.bj(e)}var Re={},Fe=[];function Oe(){for(;Fe.length;){var e=Fe.pop();e.sh.Sh=!1,e.delete()}}var De=void 0,Me={};function Le(e,t){return t.vh&&t.th||ve("makeClassHandle requires ptr and ptrType"),!!t.Bh!=!!t.yh&&ve("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Pe(Object.create(e,{sh:{value:t}}))}function Pe(e){return"undefined"==typeof FinalizationRegistry?(Pe=e=>e,e):(Ce=new FinalizationRegistry((e=>{Ae(e.sh)})),Pe=e=>{var t=e.sh;return t.yh&&Ce.register(e,{sh:t},e),e},Ne=e=>{Ce.unregister(e)},Pe(e))}function Be(){}function Ue(e,t,n){if(void 0===e[t].wh){var r=e[t];e[t]=function(){return e[t].wh.hasOwnProperty(arguments.length)||Se("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].wh+")!"),e[t].wh[arguments.length].apply(this,arguments)},e[t].wh=[],e[t].wh[r.ai]=r}}function ze(e,n,r){t.hasOwnProperty(e)?((void 0===r||void 0!==t[e].wh&&void 0!==t[e].wh[r])&&Se("Cannot register public name '"+e+"' twice"),Ue(t,e,e),t.hasOwnProperty(r)&&Se("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),t[e].wh[r]=n):(t[e]=n,void 0!==r&&(t[e].ak=r))}function Ve(e,t,n,r,a,s,o,i){this.name=e,this.constructor=t,this.Th=n,this.Ih=r,this.Dh=a,this.ej=s,this.Zh=o,this.bj=i,this.oj=[]}function We(e,t,n){for(;t!==n;)t.Zh||Se("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.Zh(e),t=t.Dh;return e}function je(e,t){return null===t?(this.ji&&Se("null is not a valid "+this.name),0):(t.sh||Se('Cannot pass "'+it(t)+'" as a '+this.name),t.sh.th||Se("Cannot pass deleted object as a pointer of type "+this.name),We(t.sh.th,t.sh.vh.uh,this.uh))}function Ge(e,t){if(null===t){if(this.ji&&Se("null is not a valid "+this.name),this.di){var n=this.mi();return null!==e&&e.push(this.Ih,n),n}return 0}if(t.sh||Se('Cannot pass "'+it(t)+'" as a '+this.name),t.sh.th||Se("Cannot pass deleted object as a pointer of type "+this.name),!this.ci&&t.sh.vh.ci&&Se("Cannot convert argument of type "+(t.sh.Bh?t.sh.Bh.name:t.sh.vh.name)+" to parameter type "+this.name),n=We(t.sh.th,t.sh.vh.uh,this.uh),this.di)switch(void 0===t.sh.yh&&Se("Passing raw pointer to smart pointer is illegal"),this.vj){case 0:t.sh.Bh===this?n=t.sh.yh:Se("Cannot convert argument of type "+(t.sh.Bh?t.sh.Bh.name:t.sh.vh.name)+" to parameter type "+this.name);break;case 1:n=t.sh.yh;break;case 2:if(t.sh.Bh===this)n=t.sh.yh;else{var r=t.clone();n=this.qj(n,at((function(){r.delete()}))),null!==e&&e.push(this.Ih,n)}break;default:Se("Unsupporting sharing policy")}return n}function He(e,t){return null===t?(this.ji&&Se("null is not a valid "+this.name),0):(t.sh||Se('Cannot pass "'+it(t)+'" as a '+this.name),t.sh.th||Se("Cannot pass deleted object as a pointer of type "+this.name),t.sh.vh.ci&&Se("Cannot convert argument of type "+t.sh.vh.name+" to parameter type "+this.name),We(t.sh.th,t.sh.vh.uh,this.uh))}function Ke(e,t,n,r){this.name=e,this.uh=t,this.ji=n,this.ci=r,this.di=!1,this.Ih=this.qj=this.mi=this.Ai=this.vj=this.nj=void 0,void 0!==t.Dh?this.toWireType=Ge:(this.toWireType=r?je:He,this.zh=null)}function qe(e,n,r){t.hasOwnProperty(e)||ve("Replacing nonexistant public symbol"),void 0!==t[e].wh&&void 0!==r?t[e].wh[r]=n:(t[e]=n,t[e].ai=r)}function Xe(e,n){var r=(e=Te(e)).includes("j")?function(e,n){var r=[];return function(){if(r.length=0,Object.assign(r,arguments),e.includes("j")){var a=t["dynCall_"+e];a=r&&r.length?a.apply(null,[n].concat(r)):a.call(null,n)}else a=ue(n).apply(null,r);return a}}(e,n):ue(n);return"function"!=typeof r&&Se("unknown function pointer with signature "+e+": "+n),r}var Ye=void 0;function Qe(e){var t=Te(e=Jr(e));return Xr(e),t}function Je(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||fe[t]||(de[t]?de[t].forEach(e):(n.push(t),r[t]=!0))})),new Ye(e+": "+n.map(Qe).join([", "]))}function Ze(e,t){for(var n=[],r=0;r<e;r++)n.push(k[t+4*r>>2]);return n}function et(e,t,n,r,a){var s=t.length;2>s&&Se("argTypes array size mismatch! Must at least get return value and 'this' types!");var o=null!==t[1]&&null!==n,i=!1;for(n=1;n<t.length;++n)if(null!==t[n]&&void 0===t[n].zh){i=!0;break}var u="void"!==t[0].name,l="",c="";for(n=0;n<s-2;++n)l+=(0!==n?", ":"")+"arg"+n,c+=(0!==n?", ":"")+"arg"+n+"Wired";e="return function "+me(e)+"("+l+") {\nif (arguments.length !== "+(s-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(s-2)+" args!');\n}\n",i&&(e+="var destructors = [];\n");var h=i?"destructors":"null";for(l="throwBindingError invoker fn runDestructors retType classParam".split(" "),r=[Se,r,a,ce,t[0],t[1]],o&&(e+="var thisWired = classParam.toWireType("+h+", this);\n"),n=0;n<s-2;++n)e+="var arg"+n+"Wired = argType"+n+".toWireType("+h+", arg"+n+"); // "+t[n+2].name+"\n",l.push("argType"+n),r.push(t[n+2]);if(o&&(c="thisWired"+(0<c.length?", ":"")+c),e+=(u?"var rv = ":"")+"invoker(fn"+(0<c.length?", ":"")+c+");\n",i)e+="runDestructors(destructors);\n";else for(n=o?1:2;n<t.length;++n)s=1===n?"thisWired":"arg"+(n-2)+"Wired",null!==t[n].zh&&(e+=s+"_dtor("+s+"); // "+t[n].name+"\n",l.push(s+"_dtor"),r.push(t[n].zh));return u&&(e+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),l.push(e+"}\n"),function(e){var t=Function;if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var n=ge(t.name||"unknownFunctionName",(function(){}));return n.prototype=t.prototype,n=new n,(e=t.apply(n,e))instanceof Object?e:n}(l).apply(null,r)}var tt=[],nt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function rt(e){4<e&&0==--nt[e].ni&&(nt[e]=void 0,tt.push(e))}var at=e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=tt.length?tt.pop():nt.length;return nt[t]={ni:1,value:e},t}};function st(e,t,n){switch(t){case 0:return function(e){return this.fromWireType((n?w:T)[e])};case 1:return function(e){return this.fromWireType((n?E:S)[e>>1])};case 2:return function(e){return this.fromWireType((n?I:k)[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function ot(e,t){var n=fe[e];return void 0===n&&Se(t+" has unknown type "+Qe(e)),n}function it(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ut(e,t){switch(t){case 2:return function(e){return this.fromWireType(C[e>>2])};case 3:return function(e){return this.fromWireType(N[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function lt(e,t,n){switch(t){case 0:return n?function(e){return w[e]}:function(e){return T[e]};case 1:return n?function(e){return E[e>>1]}:function(e){return S[e>>1]};case 2:return n?function(e){return I[e>>2]}:function(e){return k[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var ct,ht="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function pt(e,t){for(var n=e>>1,r=n+t/2;!(n>=r)&&S[n];)++n;if(32<(n<<=1)-e&&ht)return ht.decode(T.subarray(e,n));for(n="",r=0;!(r>=t/2);++r){var a=E[e+2*r>>1];if(0==a)break;n+=String.fromCharCode(a)}return n}function ft(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var a=0;a<n;++a)E[t>>1]=e.charCodeAt(a),t+=2;return E[t>>1]=0,t-r}function dt(e){return 2*e.length}function mt(e,t){for(var n=0,r="";!(n>=t/4);){var a=I[e+4*n>>2];if(0==a)break;++n,65536<=a?(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a)):r+=String.fromCharCode(a)}return r}function gt(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var a=0;a<e.length;++a){var s=e.charCodeAt(a);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),I[t>>2]=s,(t+=4)+4>n)break}return I[t>>2]=0,t-r}function yt(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t}function bt(e){var t=M(e)+1,n=qr(t);return n&&O(e,w,n,t),n}function vt(e,t){if(Rt=e,Ft=t,$t)if(Ct||(G+=1,Ct=!0),0==e)Nt=function(){var e=0|Math.max(0,St+t-ct());setTimeout(It,e)};else if(1==e)Nt=function(){Gt(It)};else if(2==e){if("undefined"==typeof setImmediate){var n=[];addEventListener("message",(e=>{"setimmediate"!==e.data&&"setimmediate"!==e.data.target||(e.stopPropagation(),n.shift()())}),!0),setImmediate=function(e){n.push(e),postMessage("setimmediate","*")}}Nt=function(){setImmediate(It)}}}function xt(e){throw x=e,b||0<G||(Zr(),te(V),Qr(0),Zn[1].length&&er(1,10),Zn[2].length&&er(2,10),j=!0),x=e,b||0<G||(A=!0),new ee(e)}function _t(){if(!(b||0<G))try{xt(x)}catch(e){ne(e)}}function wt(e){if(!j&&!A)try{e(),_t()}catch(e){ne(e)}}function Tt(e){Et||(Et={}),Et[e]||(Et[e]=1,y(e))}ct=()=>performance.now();var Et,St,It,kt,Ct=!1,Nt=null,At=0,$t=null,Rt=0,Ft=0,Ot=0,Dt=[],Mt={},Lt=!1,Pt=!1,Bt=[],Ut=!1,zt=void 0,Vt=void 0;function Wt(){return!!Lt&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)}var jt=0;function Gt(e){if("function"==typeof requestAnimationFrame)requestAnimationFrame(e);else{var t=Date.now();if(0===jt)jt=t+1e3/60;else for(;t+2>=jt;)jt+=1e3/60;setTimeout(e,Math.max(jt-t,0))}}function Ht(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}var Kt=[];function qt(){var e=t.canvas;Kt.forEach((function(t){t(e.width,e.height)}))}function Xt(e,n,r){n&&r?(e.Cj=n,e.kj=r):(n=e.Cj,r=e.kj);var a=n,s=r;if(t.forcedAspectRatio&&0<t.forcedAspectRatio&&(a/s<t.forcedAspectRatio?a=Math.round(s*t.forcedAspectRatio):s=Math.round(a/t.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/a,screen.height/s);a=Math.round(a*o),s=Math.round(s*o)}Vt?(e.width!=a&&(e.width=a),e.height!=s&&(e.height=s),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=n&&(e.width=n),e.height!=r&&(e.height=r),void 0!==e.style&&(a!=n||s!=r?(e.style.setProperty("width",a+"px","important"),e.style.setProperty("height",s+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}var Yt,Qt,Jt,Zt,en,tn=!1,nn=0,rn=0,an=0,sn={alpha:!1,depth:!1,stencil:!1,antialias:!1},on={},un=1,ln=[],cn=[],hn=[],pn=[],fn=[],dn=[],mn=[],gn=[],yn=[],bn={},vn=4;function xn(e){Sn||(Sn=e)}function _n(e){for(var t=un++,n=e.length;n<t;n++)e[n]=null;return t}function wn(e,t,n){for(var r="",a=0;a<e;++a){var s=n?I[n+4*a>>2]:-1;r+=F(I[t+4*a>>2],0>s?void 0:s)}return r}function Tn(e,n){if(t.preinitializedWebGLContext){var r=t.preinitializedWebGLContext;n.ki=1}else e.xh||(e.xh=e.getContext,e.getContext=function(t,n){return"webgl"==t==(n=e.xh(t,n))instanceof WebGLRenderingContext?n:null}),r=e.getContext("webgl",n);return r?function(e,t){var n=_n(gn),r={Vj:n,attributes:t,version:t.ki,Lh:e};return e.canvas&&(e.canvas.Gi=r),gn[n]=r,(void 0===t.cj||t.cj)&&function(e){if(e||(e=In),!e.mj){e.mj=!0;var t=e.Lh;!function(e){var t=e.getExtension("ANGLE_instanced_arrays");t&&(e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,s){t.drawElementsInstancedANGLE(e,n,r,a,s)})}(t),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(t),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)})}(t),t.Ah=t.getExtension("EXT_disjoint_timer_query"),t.Zj=t.getExtension("WEBGL_multi_draw"),(t.getSupportedExtensions()||[]).forEach((function(e){e.includes("lose_context")||e.includes("debug")||t.getExtension(e)}))}}(r),n}(r,n):0}function En(e){In=gn[e],t.Wh=Pr=In&&In.Lh}var Sn,In,kn={},Cn=[],Nn={},An=0,$n=[];function Rn(e,t,n,r){for(var a=0;a<e;a++){var s=Pr[n](),o=s&&_n(r);s?(s.name=o,r[o]=s):xn(1282),I[t+4*a>>2]=o}}function Fn(e,t,n,r,a,s,o,i){t=cn[t],(e=Pr[e](t,n))&&(r=i&&D(e.name,i,r),a&&(I[a>>2]=r),s&&(I[s>>2]=e.size),o&&(I[o>>2]=e.type))}function On(e,t){k[e>>2]=t,k[e+4>>2]=(t-k[e>>2])/4294967296}function Dn(e,t,n){if(t){var r=void 0;switch(e){case 36346:r=1;break;case 36344:return void(0!=n&&1!=n&&xn(1280));case 36345:r=0;break;case 34466:var a=Pr.getParameter(34467);r=a?a.length:0}if(void 0===r)switch(a=Pr.getParameter(e),typeof a){case"number":r=a;break;case"boolean":r=a?1:0;break;case"string":return void xn(1280);case"object":if(null===a)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:r=0;break;default:return void xn(1280)}else{if(a instanceof Float32Array||a instanceof Uint32Array||a instanceof Int32Array||a instanceof Array){for(e=0;e<a.length;++e)switch(n){case 0:I[t+4*e>>2]=a[e];break;case 2:C[t+4*e>>2]=a[e];break;case 4:w[t+e>>0]=a[e]?1:0}return}try{r=0|a.name}catch(t){return xn(1280),void y("GL_INVALID_ENUM in glGet"+n+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+t+")")}}break;default:return xn(1280),void y("GL_INVALID_ENUM in glGet"+n+"v: Native code calling glGet"+n+"v("+e+") and it returns "+a+" of type "+typeof a+"!")}switch(n){case 1:On(t,r);break;case 0:I[t>>2]=r;break;case 2:C[t>>2]=r;break;case 4:w[t>>0]=r?1:0}}else xn(1281)}function Mn(e){var t=M(e)+1,n=qr(t);return D(e,n,t),n}function Ln(e){return"]"==e.slice(-1)&&e.lastIndexOf("[")}function Pn(e){var t,n=e.Ph,r=e.hi;if(!n)for(e.Ph=n={},e.Ci={},t=0;t<Pr.getProgramParameter(e,35718);++t){var a=Pr.getActiveUniform(e,t),s=a.name;a=a.size;var o=Ln(s);o=0<o?s.slice(0,o):s;var i=e.gi;for(e.gi+=a,r[o]=[a,i],s=0;s<a;++s)n[i]=s,e.Ci[i++]=o}}function Bn(e){var t=Pr.ti;if(t){var n=t.Ph[e];return"number"==typeof n&&(t.Ph[e]=n=Pr.getUniformLocation(t,t.Ci[e]+(0<n?"["+n+"]":""))),n}xn(1282)}function Un(e,t,n,r){if(n)if(Pn(e=cn[e]),"number"==typeof(e=Pr.getUniform(e,Bn(t)))||"boolean"==typeof e)switch(r){case 0:I[n>>2]=e;break;case 2:C[n>>2]=e}else for(t=0;t<e.length;t++)switch(r){case 0:I[n+4*t>>2]=e[t];break;case 2:C[n+4*t>>2]=e[t]}else xn(1281)}function zn(e,t,n,r){if(n)if(e=Pr.getVertexAttrib(e,t),34975==t)I[n>>2]=e&&e.name;else if("number"==typeof e||"boolean"==typeof e)switch(r){case 0:I[n>>2]=e;break;case 2:C[n>>2]=e;break;case 5:I[n>>2]=Math.fround(e)}else for(t=0;t<e.length;t++)switch(r){case 0:I[n+4*t>>2]=e[t];break;case 2:C[n+4*t>>2]=e[t];break;case 5:I[n+4*t>>2]=Math.fround(e[t])}else xn(1281)}function Vn(e,t,n,r,a){e=1==(e-=5120)?T:4==e?I:6==e?C:5==e||28922==e?k:S;var s=31-Math.clz32(e.BYTES_PER_ELEMENT),o=vn;return e.subarray(a>>s,a+r*(n*({5:3,6:4,8:2,29502:3,29504:4}[t-6402]||1)*(1<<s)+o-1&-o)>>s)}var Wn=[],jn=[];function Gn(e,t){if(0>=e)return e;var n=32>=t?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=n&&(32>=t||e>n)&&(e=-2*n+e),e}function Hn(e,t){return 0<=e?e:32>=t?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function Kn(e){for(var t=e;T[t];)++t;return t-e}function qn(e,t){var n=Array(M(e)+1);return e=O(e,n,0,n.length),t&&(n.length=e),n}function Xn(e){if(!e||!e.callee||!e.callee.name)return[null,"",""];var t,n=e.callee.name,r="(",a=!0;for(t in e){var s=e[t];a||(r+=", "),a=!1,r="number"==typeof s||"string"==typeof s?r+s:r+"("+typeof s+")"}return r+=")",a&&(r=""),[e=(e=e.callee.caller)?e.arguments:[],n,r]}var Yn={};function Qn(){if(!Jn){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Yn)void 0===Yn[e]?delete t[e]:t[e]=Yn[e];var n=[];for(e in t)n.push(e+"="+t[e]);Jn=n}return Jn}var Jn,Zn=[null,[],[]];function er(e,t){var n=Zn[e];0===t||10===t?((1===e?g:y)(R(n,0)),n.length=0):n.push(t)}var tr,nr=null,rr=null,ar=null,sr=null,or=null,ir=null,ur=null,lr=null,cr=null,hr=null,pr=null,fr=null,dr=null,mr=null,gr=!1,yr=null,br=null,vr=null,xr=null,_r=null,wr=null,Tr=null,Er=null,Sr=null,Ir=null,kr=null;function Cr(e){return 0==e%4&&(0!=e%100||0==e%400)}function Nr(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var Ar=[31,29,31,30,31,30,31,31,30,31,30,31],$r=[31,28,31,30,31,30,31,31,30,31,30,31];function Rr(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(Cr(e.getFullYear())?Ar:$r)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function Fr(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function s(e,t){return a(e,t,"0")}function o(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function i(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function u(e){e=Rr(new Date(e.Oh+1900,0,1),e.Nh);var t=new Date(e.getFullYear()+1,0,4),n=i(new Date(e.getFullYear(),0,4));return t=i(t),0>=o(n,e)?0>=o(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var l=I[r+40>>2];for(var c in r={yj:I[r>>2],xj:I[r+4>>2],ei:I[r+8>>2],ri:I[r+12>>2],fi:I[r+16>>2],Oh:I[r+20>>2],Eh:I[r+24>>2],Nh:I[r+28>>2],dk:I[r+32>>2],wj:I[r+36>>2],zj:l?F(l):""},n=F(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(c,"g"),l[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(c in l={"%a":function(e){return h[e.Eh].substring(0,3)},"%A":function(e){return h[e.Eh]},"%b":function(e){return p[e.fi].substring(0,3)},"%B":function(e){return p[e.fi]},"%C":function(e){return s((e.Oh+1900)/100|0,2)},"%d":function(e){return s(e.ri,2)},"%e":function(e){return a(e.ri,2," ")},"%g":function(e){return u(e).toString().substring(2)},"%G":function(e){return u(e)},"%H":function(e){return s(e.ei,2)},"%I":function(e){return 0==(e=e.ei)?e=12:12<e&&(e-=12),s(e,2)},"%j":function(e){return s(e.ri+Nr(Cr(e.Oh+1900)?Ar:$r,e.fi-1),3)},"%m":function(e){return s(e.fi+1,2)},"%M":function(e){return s(e.xj,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.ei&&12>e.ei?"AM":"PM"},"%S":function(e){return s(e.yj,2)},"%t":function(){return"\t"},"%u":function(e){return e.Eh||7},"%U":function(e){return s(Math.floor((e.Nh+7-e.Eh)/7),2)},"%V":function(e){var t=Math.floor((e.Nh+7-(e.Eh+6)%7)/7);if(2>=(e.Eh+371-e.Nh-2)%7&&t++,t)53==t&&(4==(n=(e.Eh+371-e.Nh)%7)||3==n&&Cr(e.Oh)||(t=1));else{t=52;var n=(e.Eh+7-e.Nh-1)%7;(4==n||5==n&&Cr(e.Oh%400-1))&&t++}return s(t,2)},"%w":function(e){return e.Eh},"%W":function(e){return s(Math.floor((e.Nh+7-(e.Eh+6)%7)/7),2)},"%y":function(e){return(e.Oh+1900).toString().substring(2)},"%Y":function(e){return e.Oh+1900},"%z":function(e){var t=0<=(e=e.wj);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.zj},"%%":function(){return"%"}},n=n.replace(/%%/g,"\0\0"),l)n.includes(c)&&(n=n.replace(new RegExp(c,"g"),l[c](r)));return(c=qn(n=n.replace(/\0\0/g,"%"),!1)).length>t?0:(w.set(c,e),c.length-1)}function Or(e,n,r,a){var s={string:e=>{var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);D(e,t=ra(n),n)}return t},array:e=>{var t=ra(e.length);return w.set(e,t),t}};e=t["_"+e];var o=[],i=0;if(a)for(var u=0;u<a.length;u++){var l=s[r[u]];l?(0===i&&(i=ta()),o[u]=l(a[u])):o[u]=a[u]}return function(e){return 0!==i&&na(i),"string"===n?F(e):"boolean"===n?!!e:e}(r=e.apply(null,o))}function Dr(e,n,r,a){var s=(r=r||[]).every((e=>"number"===e||"boolean"===e));return"string"!==n&&s&&!a?t["_"+e]:function(){return Or(e,n,r,arguments)}}be=t.InternalError=ye("InternalError");for(var Mr=Array(256),Lr=0;256>Lr;++Lr)Mr[Lr]=String.fromCharCode(Lr);we=Mr,Ee=t.BindingError=ye("BindingError"),Be.prototype.isAliasOf=function(e){if(!(this instanceof Be&&e instanceof Be))return!1;var t=this.sh.vh.uh,n=this.sh.th,r=e.sh.vh.uh;for(e=e.sh.th;t.Dh;)n=t.Zh(n),t=t.Dh;for(;r.Dh;)e=r.Zh(e),r=r.Dh;return t===r&&n===e},Be.prototype.clone=function(){if(this.sh.th||ke(this),this.sh.Yh)return this.sh.count.value+=1,this;var e=Pe,t=Object,n=t.create,r=Object.getPrototypeOf(this),a=this.sh;return(e=e(n.call(t,r,{sh:{value:{count:a.count,Sh:a.Sh,Yh:a.Yh,th:a.th,vh:a.vh,yh:a.yh,Bh:a.Bh}}}))).sh.count.value+=1,e.sh.Sh=!1,e},Be.prototype.delete=function(){this.sh.th||ke(this),this.sh.Sh&&!this.sh.Yh&&Se("Object already scheduled for deletion"),Ne(this),Ae(this.sh),this.sh.Yh||(this.sh.yh=void 0,this.sh.th=void 0)},Be.prototype.isDeleted=function(){return!this.sh.th},Be.prototype.deleteLater=function(){return this.sh.th||ke(this),this.sh.Sh&&!this.sh.Yh&&Se("Object already scheduled for deletion"),Fe.push(this),1===Fe.length&&De&&De(Oe),this.sh.Sh=!0,this},t.getInheritedInstanceCount=function(){return Object.keys(Me).length},t.getLiveInheritedInstances=function(){var e,t=[];for(e in Me)Me.hasOwnProperty(e)&&t.push(Me[e]);return t},t.flushPendingDeletes=Oe,t.setDelayFunction=function(e){De=e,Fe.length&&De&&De(Oe)},Ke.prototype.fj=function(e){return this.Ai&&(e=this.Ai(e)),e},Ke.prototype.ui=function(e){this.Ih&&this.Ih(e)},Ke.prototype.argPackAdvance=8,Ke.prototype.readValueFromPointer=he,Ke.prototype.deleteObject=function(e){null!==e&&e.delete()},Ke.prototype.fromWireType=function(e){function t(){return this.di?Le(this.uh.Th,{vh:this.nj,th:n,Bh:this,yh:e}):Le(this.uh.Th,{vh:this,th:e})}var n=this.fj(e);if(!n)return this.ui(e),null;var r=function(e,t){for(void 0===t&&Se("ptr should not be undefined");e.Dh;)t=e.Zh(t),e=e.Dh;return Me[t]}(this.uh,n);if(void 0!==r)return 0===r.sh.count.value?(r.sh.th=n,r.sh.yh=e,r.clone()):(r=r.clone(),this.ui(e),r);if(r=this.uh.ej(n),!(r=Re[r]))return t.call(this);r=this.ci?r.aj:r.pointerType;var a=$e(n,this.uh,r.uh);return null===a?t.call(this):this.di?Le(r.uh.Th,{vh:r,th:a,Bh:this,yh:e}):Le(r.uh.Th,{vh:r,th:a})},Ye=t.UnboundTypeError=ye("UnboundTypeError"),t.count_emval_handles=function(){for(var e=0,t=5;t<nt.length;++t)void 0!==nt[t]&&++e;return e},t.get_first_emval=function(){for(var e=5;e<nt.length;++e)if(void 0!==nt[e])return nt[e];return null},t.requestFullscreen=function(e,n){!function(e,n){function r(){Lt=!1;var e=a.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(a.exitFullscreen=Wt,zt&&a.requestPointerLock(),Lt=!0,Vt?("undefined"!=typeof SDL&&(I[SDL.screen>>2]=8388608|k[SDL.screen>>2]),Xt(t.canvas),qt()):Xt(a)):(e.parentNode.insertBefore(a,e),e.parentNode.removeChild(e),Vt?("undefined"!=typeof SDL&&(I[SDL.screen>>2]=-8388609&k[SDL.screen>>2]),Xt(t.canvas),qt()):Xt(a)),t.onFullScreen&&t.onFullScreen(Lt),t.onFullscreen&&t.onFullscreen(Lt)}void 0===(zt=e)&&(zt=!0),void 0===(Vt=n)&&(Vt=!1);var a=t.canvas;Ut||(Ut=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1),document.addEventListener("MSFullscreenChange",r,!1));var s=document.createElement("div");a.parentNode.insertBefore(s,a),s.appendChild(a),s.requestFullscreen=s.requestFullscreen||s.mozRequestFullScreen||s.msRequestFullscreen||(s.webkitRequestFullscreen?()=>s.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(s.webkitRequestFullScreen?()=>s.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),s.requestFullscreen()}(e,n)},t.requestAnimationFrame=function(e){Gt(e)},t.setCanvasSize=function(e,n,r){Xt(t.canvas,e,n),r||qt()},t.pauseMainLoop=function(){Nt=null,At++},t.resumeMainLoop=function(){At++;var e=Rt,n=Ft,r=$t;$t=null,function(e){function n(){return!(r<At&&(--G,_t(),1))}!$t||X("emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),$t=e;var r=At;Ct=!1,It=function(){if(!A)if(0<Dt.length){var r=Date.now(),a=Dt.shift();if(a.Uj(a.Rj),kt){var s=kt,o=0==s%1?s-1:Math.floor(s);kt=a.Sj?o:(8*s+(o+.5))/9}g('main loop blocker "'+a.name+'" took '+(Date.now()-r)+" ms"),t.setStatus&&(r=t.statusMessage||"Please wait...",s=Mt.Tj,(a=kt)?a<s?t.setStatus(r+" ("+(s-a)+"/"+s+")"):t.setStatus(r):t.setStatus("")),n()&&setTimeout(It,0)}else n()&&(Ot=Ot+1|0,1==Rt&&1<Ft&&0!=Ot%Ft?Nt():(0==Rt&&(St=ct()),A||t.preMainLoop&&!1===t.preMainLoop()||(wt(e),t.postMainLoop&&t.postMainLoop()),n()&&("object"==typeof SDL&&SDL.audio&&SDL.audio.pj&&SDL.audio.pj(),Nt())))}}(r),vt(e,n),Nt()},t.getUserMedia=function(){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(void 0)},t.createContext=function(e,n,r,a){return function(e,n,r,a){if(n&&t.Wh&&e==t.canvas)return t.Wh;var s;if(n){var o={antialias:!1,alpha:!1,ki:1};if(a)for(var i in a)o[i]=a[i];if(void 0!==kn&&(s=Tn(e,o)))var u=gn[s].Lh}else u=e.getContext("2d");return u?(r&&(n||void 0===Pr||X("cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),t.Wh=u,n&&En(s),t.Aj=n,Bt.forEach((function(e){e()})),function(){function e(){Pt=document.pointerLockElement===t.canvas||document.mozPointerLockElement===t.canvas||document.webkitPointerLockElement===t.canvas||document.msPointerLockElement===t.canvas}if(t.preloadPlugins||(t.preloadPlugins=[]),!Yt){Yt=!0;try{Qt=!0}catch(e){Qt=!1,y("warning: no blob constructor, cannot create blobs with mimetypes")}Jt="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Qt?null:y("warning: no BlobBuilder"),Zt="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,t.yi||void 0!==Zt||(y("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),t.yi=!0),t.preloadPlugins.push({canHandle:function(e){return!t.yi&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,r){var a=null;if(Qt)try{(a=new Blob([e],{type:Ht(t)})).size!==e.length&&(a=new Blob([new Uint8Array(e).buffer],{type:Ht(t)}))}catch(e){Tt("Blob constructor present but fails: "+e+"; falling back to blob builder")}a||((a=new Jt).append(new Uint8Array(e).buffer),a=a.getBlob());var s=Zt.createObjectURL(a),o=new Image;o.onload=()=>{o.complete||X("Image "+t+" could not be decoded");var r=document.createElement("canvas");r.width=o.width,r.height=o.height,r.getContext("2d").drawImage(o,0,0),Zt.revokeObjectURL(s),n&&n(e)},o.onerror=()=>{g("Image "+s+" could not be decoded"),r&&r()},o.src=s}}),t.preloadPlugins.push({canHandle:function(e){return!t.$j&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,r){function a(){o||(o=!0,n&&n(e))}function s(){o||(o=!0,new Audio,r&&r())}var o=!1;if(!Qt)return s();try{var i=new Blob([e],{type:Ht(t)})}catch(e){return s()}i=Zt.createObjectURL(i);var u=new Audio;u.addEventListener("canplaythrough",(()=>a()),!1),u.onerror=function(){if(!o){y("warning: browser could not fully decode audio "+t+", trying slower base64 approach");for(var n="",r=0,s=0,i=0;i<e.length;i++)for(r=r<<8|e[i],s+=8;6<=s;){var l=r>>s-6&63;s-=6,n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==s?(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],n+="=="):4==s&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],n+="="),u.src="data:audio/x-"+t.substr(-3)+";base64,"+n,a()}},u.src=i,function(e){G+=1,setTimeout((function(){--G,wt(e)}),1e4)}((function(){a()}))}});var n=t.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("mspointerlockchange",e,!1),t.elementPointerLock&&n.addEventListener("click",(e=>{!Pt&&t.canvas.requestPointerLock&&(t.canvas.requestPointerLock(),e.preventDefault())}),!1))}}()),u):null}(e,n,r,a)};for(var Pr,Br=0;32>Br;++Br)$n.push(Array(Br));var Ur=new Float32Array(288);for(Br=0;288>Br;++Br)Wn[Br]=Ur.subarray(0,Br+1);var zr=new Int32Array(288);for(Br=0;288>Br;++Br)jn[Br]=zr.subarray(0,Br+1);(pr=document.createElement("canvas")).style.display="none",fr=pr.getContext("2d",{willReadFrequently:!0}),tr=t.segmentationModel;var Vr={j:function(e,t,n,r){X("Assertion failed: "+F(e)+", at: "+[t?F(t):"unknown filename",n,r?F(r):"unknown function"])},p:function(e){return qr(e+24)+24},l:function(e){return(e=new oe(e)).Qh()||(e.oi(!0),ae--),e.pi(!1),re.push(e),e.Jh(),e.Uh()},z:function(){ea(0);var e=re.pop();if(e.rj()&&!e.xi()){var t=e.gj();t&&ue(t)(e.Xh),ie(e.Xh)}se=0},a:function(){var e=se;if(!e)return Yr(0),0;var t=new oe(e);t.Ch(e);var n=t.xh();if(!n)return Yr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(aa(a,n,t.th+16))return Yr(a),e}return Yr(n),e},c:function(){var e=se;if(!e)return Yr(0),0;var t=new oe(e);t.Ch(e);var n=t.xh();if(!n)return Yr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(aa(a,n,t.th+16))return Yr(a),e}return Yr(n),e},g:function(){var e=se;if(!e)return Yr(0),0;var t=new oe(e);t.Ch(e);var n=t.xh();if(!n)return Yr(0),e;for(var r=0;r<arguments.length;r++){var a=arguments[r];if(0===a||a===n)break;if(aa(a,n,t.th+16))return Yr(a),e}return Yr(n),e},q:ie,nb:function(){var e=re.pop();e||X("no exception to throw");var t=e.Xh;throw e.xi()||(re.push(e),e.pi(!0),e.oi(!1),ae++),se=t,t},I:function(e,t,n){throw new oe(e).$h(t,n),se=e,ae++,e},ec:function(){return ae},d:function(e){throw se||(se=e),e},Oa:function(){return 0},lc:function(){return 0},mc:function(){},Ef:function(e){var t=le[e];delete le[e];var n=t.mi,r=t.Ih,a=t.wi,s=a.map((e=>e.jj)).concat(a.map((e=>e.tj)));xe([e],s,(e=>{var s={};return a.forEach(((t,n)=>{var r=e[n],o=t.hj,i=t.ij,u=e[n+a.length],l=t.sj,c=t.uj;s[t.dj]={read:e=>r.fromWireType(o(i,e)),write:(e,t)=>{var n=[];l(c,e,u.toWireType(n,t)),ce(n)}}})),[{name:t.name,fromWireType:function(e){var t,n={};for(t in s)n[t]=s[t].read(e);return r(e),n},toWireType:function(e,t){for(var a in s)if(!(a in t))throw new TypeError('Missing field:  "'+a+'"');var o=n();for(a in s)s[a].write(o,t[a]);return null!==e&&e.push(r,o),o},argPackAdvance:8,readValueFromPointer:he,zh:r}]}))},Wb:function(){},Ff:function(e,t,n,r,a){var s=_e(n);Ie(e,{name:t=Te(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:a},argPackAdvance:8,readValueFromPointer:function(e){if(1===n)var r=w;else if(2===n)r=E;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=I}return this.fromWireType(r[e>>s])},zh:null})},af:function(e,t,n,r,a,s,o,i,u,l,c,h,p){c=Te(c),s=Xe(a,s),i&&(i=Xe(o,i)),l&&(l=Xe(u,l)),p=Xe(h,p);var f=me(c);ze(f,(function(){Je("Cannot construct "+c+" due to unbound types",[r])})),xe([e,t,n],r?[r]:[],(function(t){if(t=t[0],r)var n=t.uh,a=n.Th;else a=Be.prototype;t=ge(f,(function(){if(Object.getPrototypeOf(this)!==o)throw new Ee("Use 'new' to construct "+c);if(void 0===u.Mh)throw new Ee(c+" has no accessible constructor");var e=u.Mh[arguments.length];if(void 0===e)throw new Ee("Tried to invoke ctor of "+c+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.Mh).toString()+") parameters instead!");return e.apply(this,arguments)}));var o=Object.create(a,{constructor:{value:t}});t.prototype=o;var u=new Ve(c,t,o,p,n,s,i,l);n=new Ke(c,u,!0,!1),a=new Ke(c+"*",u,!1,!1);var h=new Ke(c+" const*",u,!1,!0);return Re[e]={pointerType:a,aj:h},qe(f,t),[n,a,h]}))},de:function(e,t,n,r,a,s){0<t||X();var o=Ze(t,n);a=Xe(r,a),xe([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.uh.Mh&&(e.uh.Mh=[]),void 0!==e.uh.Mh[t-1])throw new Ee("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.uh.Mh[t-1]=()=>{Je("Cannot construct "+e.name+" due to unbound types",o)},xe([],o,(function(r){return r.splice(1,0,null),e.uh.Mh[t-1]=et(n,r,null,a,s),[]})),[]}))},W:function(e,t,n,r,a,s,o,i){var u=Ze(n,r);t=Te(t),s=Xe(a,s),xe([],[e],(function(e){function r(){Je("Cannot call "+a+" due to unbound types",u)}var a=(e=e[0]).name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),i&&e.uh.oj.push(t);var l=e.uh.Th,c=l[t];return void 0===c||void 0===c.wh&&c.className!==e.name&&c.ai===n-2?(r.ai=n-2,r.className=e.name,l[t]=r):(Ue(l,t,a),l[t].wh[n-2]=r),xe([],u,(function(r){return r=et(a,r,e,s,o),void 0===l[t].wh?(r.ai=n-2,l[t]=r):l[t].wh[n-2]=r,[]})),[]}))},Df:function(e,t){Ie(e,{name:t=Te(t),fromWireType:function(e){e||Se("Cannot use deleted val. handle = "+e);var t=nt[e].value;return rt(e),t},toWireType:function(e,t){return at(t)},argPackAdvance:8,readValueFromPointer:he,zh:null})},eg:function(e,t,n,r){function a(){}n=_e(n),t=Te(t),a.values={},Ie(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:st(t,n,r),zh:null}),ze(t,a)},$f:function(e,t,n){var r=ot(e,"enum");t=Te(t),e=r.constructor,r=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:ge(r.name+"_"+t,(function(){}))}}),e.values[n]=r,e[t]=r},Qa:function(e,t,n){n=_e(n),Ie(e,{name:t=Te(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:ut(t,n),zh:null})},mf:function(e,t,n,r,a,s){var o=Ze(t,n);e=Te(e),a=Xe(r,a),ze(e,(function(){Je("Cannot call "+e+" due to unbound types",o)}),t-1),xe([],o,(function(n){return qe(e,et(e,[n[0],null].concat(n.slice(1)),null,a,s),t-1),[]}))},N:function(e,t,n,r,a){t=Te(t),-1===a&&(a=4294967295),a=_e(n);var s=e=>e;if(0===r){var o=32-8*n;s=e=>e<<o>>>o}n=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t},Ie(e,{name:t,fromWireType:s,toWireType:n,argPackAdvance:8,readValueFromPointer:lt(t,a,0!==r),zh:null})},F:function(e,t,n){function r(e){var t=k;return new a(_,t[1+(e>>=2)],t[e])}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];Ie(e,{name:n=Te(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{lj:!0})},Pa:function(e,t){var n="std::string"===(t=Te(t));Ie(e,{name:t,fromWireType:function(e){var t=k[e>>2],r=e+4;if(n)for(var a=r,s=0;s<=t;++s){var o=r+s;if(s==t||0==T[o]){if(a=F(a,o-a),void 0===i)var i=a;else i+=String.fromCharCode(0),i+=a;a=o+1}}else{for(i=Array(t),s=0;s<t;++s)i[s]=String.fromCharCode(T[r+s]);i=i.join("")}return Xr(e),i},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||Se("Cannot pass non-string to std::string");var a=n&&r?M(t):t.length,s=qr(4+a+1),o=s+4;if(k[s>>2]=a,n&&r)D(t,o,a+1);else if(r)for(r=0;r<a;++r){var i=t.charCodeAt(r);255<i&&(Xr(o),Se("String has UTF-16 code units that do not fit in 8 bits")),T[o+r]=i}else for(r=0;r<a;++r)T[o+r]=t[r];return null!==e&&e.push(Xr,s),s},argPackAdvance:8,readValueFromPointer:he,zh:function(e){Xr(e)}})},la:function(e,t,n){if(n=Te(n),2===t)var r=pt,a=ft,s=dt,o=()=>S,i=1;else 4===t&&(r=mt,a=gt,s=yt,o=()=>k,i=2);Ie(e,{name:n,fromWireType:function(e){for(var n,a=k[e>>2],s=o(),u=e+4,l=0;l<=a;++l){var c=e+4+l*t;l!=a&&0!=s[c>>i]||(u=r(u,c-u),void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),u=c+t)}return Xr(e),n},toWireType:function(e,r){"string"!=typeof r&&Se("Cannot pass non-string to C++ string type "+n);var o=s(r),u=qr(4+o+t);return k[u>>2]=o>>i,a(r,u+4,o+t),null!==e&&e.push(Xr,u),u},argPackAdvance:8,readValueFromPointer:he,zh:function(e){Xr(e)}})},Vf:function(e,t,n,r,a,s){le[e]={name:Te(t),mi:Xe(n,r),Ih:Xe(a,s),wi:[]}},Sa:function(e,t,n,r,a,s,o,i,u,l){le[e].wi.push({dj:Te(t),jj:n,hj:Xe(r,a),ij:s,tj:o,sj:Xe(i,u),uj:l})},Gf:function(e,t){Ie(e,{Wj:!0,name:t=Te(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},nc:function(){return!0},fc:function(){throw 1/0},zd:rt,Kd:function(e){4<e&&(nt[e].ni+=1)},od:function(e,t){return e=(e=ot(e,"_emval_take_value")).readValueFromPointer(t),at(e)},pc:function(e,t){e=new Date(1e3*(k[e>>2]+4294967296*I[e+4>>2])),I[t>>2]=e.getUTCSeconds(),I[t+4>>2]=e.getUTCMinutes(),I[t+8>>2]=e.getUTCHours(),I[t+12>>2]=e.getUTCDate(),I[t+16>>2]=e.getUTCMonth(),I[t+20>>2]=e.getUTCFullYear()-1900,I[t+24>>2]=e.getUTCDay(),I[t+28>>2]=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},qc:function(e,t){e=new Date(1e3*(k[e>>2]+4294967296*I[e+4>>2])),I[t>>2]=e.getSeconds(),I[t+4>>2]=e.getMinutes(),I[t+8>>2]=e.getHours(),I[t+12>>2]=e.getDate(),I[t+16>>2]=e.getMonth(),I[t+20>>2]=e.getFullYear()-1900,I[t+24>>2]=e.getDay();var n=new Date(e.getFullYear(),0,1);I[t+28>>2]=(e.getTime()-n.getTime())/864e5|0,I[t+36>>2]=-60*e.getTimezoneOffset();var r=new Date(e.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),I[t+32>>2]=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r))},rc:function(e){var t=new Date(I[e+20>>2]+1900,I[e+16>>2],I[e+12>>2],I[e+8>>2],I[e+4>>2],I[e>>2],0),n=I[e+32>>2],r=t.getTimezoneOffset(),a=new Date(t.getFullYear(),0,1),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),i=Math.min(o,s);return 0>n?I[e+32>>2]=Number(s!=o&&i==r):0<n!=(i==r)&&(s=Math.max(o,s),t.setTime(t.getTime()+6e4*((0<n?i:s)-r))),I[e+24>>2]=t.getDay(),I[e+28>>2]=(t.getTime()-a.getTime())/864e5|0,I[e>>2]=t.getSeconds(),I[e+4>>2]=t.getMinutes(),I[e+8>>2]=t.getHours(),I[e+12>>2]=t.getDate(),I[e+16>>2]=t.getMonth(),I[e+20>>2]=t.getYear(),t.getTime()/1e3|0},sc:function e(t,n,r){e.Zi||(e.Zi=!0,function(e,t,n){function r(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}var a=(new Date).getFullYear(),s=new Date(a,0,1),o=new Date(a,6,1);a=s.getTimezoneOffset();var i=o.getTimezoneOffset();I[e>>2]=60*Math.max(a,i),I[t>>2]=Number(a!=i),e=r(s),t=r(o),e=bt(e),t=bt(t),i<a?(k[n>>2]=e,k[n+4>>2]=t):(k[n>>2]=t,k[n+4>>2]=e)}(t,n,r))},L:function(){X("")},Kc:function(e,n,r){if(!t.Vh){if(!window.AudioContext){if(!window.webkitAudioContext)return;window.AudioContext=window.webkitAudioContext}t.Vh=new AudioContext}for(var a=new ArrayBuffer(n),s=new Uint8Array(a),o=0;o<n;o++)s[o]=T[o+e];t.Vh.decodeAudioData(a,(function(e){t.Rh&&(t.Rh.stop(),t.Rh=null);var n=t.Vh.createBufferSource();t.Rh=n,n.loop=r,n.buffer=e,n.connect(t.Vh.destination),n.start(0)}))},zc:function(){t.Vh&&t.Rh&&(t.Rh.stop(),t.Rh=null)},Qb:function(e){try{var t=Function('return (function() {}.constructor("return this")( ));')()}catch(e){t=window}var n;for(n in t)if(8==n.length&&116==n.charCodeAt(7)&&101==n.charCodeAt(5)&&117==n.charCodeAt(3)&&100==n.charCodeAt(0)){var r=n;break}for(var a in t[r])if(6==a.length&&110==a.charCodeAt(5)&&100==a.charCodeAt(0)){var s=a;break}return t[r][s].charCodeAt(e)},pg:function(e,t,n,r,a){if(62e3!=e)n=0;else{if(t)for(;;){if(12321==(e=I[t>>2]))sn.alpha=0<I[t+4>>2];else if(12325==e)sn.depth=0<I[t+4>>2];else if(12326==e)sn.stencil=0<I[t+4>>2];else if(12337==e)e=I[t+4>>2],sn.antialias=0<e;else if(12338==e)e=I[t+4>>2],sn.antialias=1==e;else if(12544==e)sn.Xj=12547!=I[t+4>>2];else if(12344==e)break;t+=8}n&&r||a?(a&&(I[a>>2]=1),n&&0<r&&(I[n>>2]=62002),n=1):n=0}return n},Aa:function(e,n,r,a){if(62e3!=e)return 0;for(e=1;;){if(12440!=(n=I[a>>2])){if(12344==n)break;return 0}e=I[a+4>>2],a+=8}return 2!=e?0:(sn.ki=e-1,sn.Yj=0,0!=(en=Tn(t.canvas,sn))?(En(en),t.Aj=!0,Bt.forEach((function(e){e()})),En(null),62004):0)},Ba:function(e,t){return 62e3!=e||62002!=t?0:62006},za:function(e,t){return 62e3!=e||62004!=t?0:(In===gn[e=en]&&(In=null),"object"==typeof JSEvents&&JSEvents.ck(gn[e].Lh.canvas),gn[e]&&gn[e].Lh.canvas&&(gn[e].Lh.canvas.Gi=void 0),gn[e]=null,nn==t&&(nn=0),1)},ya:function(e,t){return 62e3!=e?0:(62006!=t||(rn==t&&(rn=0),an==t&&(an=0)),1)},pb:function(){return 62e3},ob:function(e,t,n){return 62e3!=e?0:(t&&(I[t>>2]=1),n&&(I[n>>2]=4),tn=!0,1)},Q:function(e,t,n,r){return 62e3!=e||0!=r&&62004!=r||0!=n&&62006!=n||0!=t&&62006!=t?0:(En(r?en:null),nn=r,an=t,rn=n,1)},ia:function(e,t){if(62e3!=e)return 0;if(on[t])return on[t];switch(t){case 12371:e=bt("Emscripten");break;case 12372:e=bt("1.4 Emscripten EGL");break;case 12373:e=bt("");break;case 12429:e=bt("OpenGL_ES");break;default:return 0}return on[t]=e},xa:function(){return tn&&t.Wh&&!t.Wh.isContextLost()?1:0},mb:function(e,t){return 62e3!=e?0:(0==t?vt(0,0):vt(1,t),1)},og:function(e){return 62e3!=e?0:(an=rn=nn=0,tn=!1,1)},u:function(e,t,n){var r;for(Cn.length=0,n>>=2;r=T[t++];)n+=105!=r&n,Cn.push(105==r?I[n]:N[n++>>1]),++n;return Z[e].apply(null,Cn)},Ub:function(e,t,n,r,a,s,o,i){function u(){if(o){var e=0;if(c.statusText){var t=M(c.statusText)+1;e=ra(t),D(c.statusText,e,t)}ue(o)(h,r,c.status,e)}}var l=F(e);e=F(t),n=F(n);var c=new XMLHttpRequest;c.open(e,l,!0),c.responseType="arraybuffer";var h=function(){var e=An;return An++,e}();return c.onload=function(){if(200<=c.status&&300>c.status||0===c.status&&"http"!=l.substr(0,4).toLowerCase()){var e=new Uint8Array(c.response),t=qr(e.length);T.set(e,t),s&&ue(s)(h,r,t,e.length),a&&Xr(t)}else u();delete Nn[h]},c.onerror=function(){u(),delete Nn[h]},c.onprogress=function(e){i&&ue(i)(h,r,e.loaded,e.lengthComputable||void 0===e.lengthComputable?e.total:0)},c.onabort=function(){delete Nn[h]},"POST"==e?(c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(n)):c.send(null),Nn[h]=c,h},ka:function(){return Date.now()},Vc:function(e){b=!1,G=0,xt(e)},hc:function(){return 2147483648},Z:ct,hf:function(e){Pr.activeTexture(e)},gf:function(e,t){Pr.attachShader(cn[e],dn[t])},zf:function(e,t){Pr.Ah.beginQueryEXT(e,yn[t])},ff:function(e,t,n){Pr.bindAttribLocation(cn[e],t,F(n))},ef:function(e,t){Pr.bindBuffer(e,ln[t])},df:function(e,t){Pr.bindFramebuffer(e,hn[t])},cf:function(e,t){Pr.bindRenderbuffer(e,pn[t])},bf:function(e,t){Pr.bindTexture(e,fn[t])},rf:function(e){Pr.bindVertexArray(mn[e])},$e:function(e,t,n,r){Pr.blendColor(e,t,n,r)},_e:function(e){Pr.blendEquation(e)},Ze:function(e,t){Pr.blendEquationSeparate(e,t)},Ye:function(e,t){Pr.blendFunc(e,t)},Xe:function(e,t,n,r){Pr.blendFuncSeparate(e,t,n,r)},We:function(e,t,n,r){Pr.bufferData(e,n?T.subarray(n,n+t):t,r)},Ve:function(e,t,n,r){Pr.bufferSubData(e,t,T.subarray(r,r+n))},Ue:function(e){return Pr.checkFramebufferStatus(e)},Te:function(e){Pr.clear(e)},Se:function(e,t,n,r){Pr.clearColor(e,t,n,r)},Re:function(e){Pr.clearDepth(e)},Qe:function(e){Pr.clearStencil(e)},Pe:function(e,t,n,r){Pr.colorMask(!!e,!!t,!!n,!!r)},Oe:function(e){Pr.compileShader(dn[e])},Ne:function(e,t,n,r,a,s,o,i){Pr.compressedTexImage2D(e,t,n,r,a,s,i?T.subarray(i,i+o):null)},Me:function(e,t,n,r,a,s,o,i,u){Pr.compressedTexSubImage2D(e,t,n,r,a,s,o,u?T.subarray(u,u+i):null)},Le:function(e,t,n,r,a,s,o,i){Pr.copyTexImage2D(e,t,n,r,a,s,o,i)},Ke:function(e,t,n,r,a,s,o,i){Pr.copyTexSubImage2D(e,t,n,r,a,s,o,i)},Je:function(){var e=_n(cn),t=Pr.createProgram();return t.name=e,t.Hh=t.Fh=t.Gh=0,t.gi=1,cn[e]=t,e},Ie:function(e){var t=_n(dn);return dn[t]=Pr.createShader(e),t},He:function(e){Pr.cullFace(e)},Ge:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=ln[r];a&&(Pr.deleteBuffer(a),a.name=0,ln[r]=null)}},Fe:function(e,t){for(var n=0;n<e;++n){var r=I[t+4*n>>2],a=hn[r];a&&(Pr.deleteFramebuffer(a),a.name=0,hn[r]=null)}},Ee:function(e){if(e){var t=cn[e];t?(Pr.deleteProgram(t),t.name=0,cn[e]=null):xn(1281)}},Bf:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=yn[r];a&&(Pr.Ah.deleteQueryEXT(a),yn[r]=null)}},De:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=pn[r];a&&(Pr.deleteRenderbuffer(a),a.name=0,pn[r]=null)}},Ce:function(e){if(e){var t=dn[e];t?(Pr.deleteShader(t),dn[e]=null):xn(1281)}},Be:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=fn[r];a&&(Pr.deleteTexture(a),a.name=0,fn[r]=null)}},qf:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2];Pr.deleteVertexArray(mn[r]),mn[r]=null}},Ae:function(e){Pr.depthFunc(e)},ze:function(e){Pr.depthMask(!!e)},ye:function(e,t){Pr.depthRange(e,t)},xe:function(e,t){Pr.detachShader(cn[e],dn[t])},we:function(e){Pr.disable(e)},ve:function(e){Pr.disableVertexAttribArray(e)},ue:function(e,t,n){Pr.drawArrays(e,t,n)},lf:function(e,t,n,r){Pr.drawArraysInstanced(e,t,n,r)},nf:function(e,t){for(var n=$n[e],r=0;r<e;r++)n[r]=I[t+4*r>>2];Pr.drawBuffers(n)},te:function(e,t,n,r){Pr.drawElements(e,t,n,r)},kf:function(e,t,n,r,a){Pr.drawElementsInstanced(e,t,n,r,a)},se:function(e){Pr.enable(e)},re:function(e){Pr.enableVertexAttribArray(e)},yf:function(e){Pr.Ah.endQueryEXT(e)},qe:function(){Pr.finish()},pe:function(){Pr.flush()},oe:function(e,t,n,r){Pr.framebufferRenderbuffer(e,t,n,pn[r])},ne:function(e,t,n,r,a){Pr.framebufferTexture2D(e,t,n,fn[r],a)},me:function(e){Pr.frontFace(e)},le:function(e,t){Rn(e,t,"createBuffer",ln)},je:function(e,t){Rn(e,t,"createFramebuffer",hn)},Cf:function(e,t){for(var n=0;n<e;n++){var r=Pr.Ah.createQueryEXT();if(!r){for(xn(1282);n<e;)I[t+4*n++>>2]=0;break}var a=_n(yn);r.name=a,yn[a]=r,I[t+4*n>>2]=a}},ie:function(e,t){Rn(e,t,"createRenderbuffer",pn)},he:function(e,t){Rn(e,t,"createTexture",fn)},pf:function(e,t){Rn(e,t,"createVertexArray",mn)},ke:function(e){Pr.generateMipmap(e)},ge:function(e,t,n,r,a,s,o){Fn("getActiveAttrib",e,t,n,r,a,s,o)},fe:function(e,t,n,r,a,s,o){Fn("getActiveUniform",e,t,n,r,a,s,o)},ee:function(e,t,n,r){var a=(e=Pr.getAttachedShaders(cn[e])).length;for(a>t&&(a=t),I[n>>2]=a,t=0;t<a;++t)I[r+4*t>>2]=dn.indexOf(e[t])},ce:function(e,t){return Pr.getAttribLocation(cn[e],F(t))},be:function(e,t){Dn(e,t,4)},ae:function(e,t,n){n?I[n>>2]=Pr.getBufferParameter(e,t):xn(1281)},$d:function(){var e=Pr.getError()||Sn;return Sn=0,e},_d:function(e,t){Dn(e,t,2)},Zd:function(e,t,n,r){((e=Pr.getFramebufferAttachmentParameter(e,t,n))instanceof WebGLRenderbuffer||e instanceof WebGLTexture)&&(e=0|e.name),I[r>>2]=e},Yd:function(e,t){Dn(e,t,0)},Wd:function(e,t,n,r){null===(e=Pr.getProgramInfoLog(cn[e]))&&(e="(unknown error)"),t=0<t&&r?D(e,r,t):0,n&&(I[n>>2]=t)},Xd:function(e,t,n){if(n)if(e>=un)xn(1281);else if(e=cn[e],35716==t)null===(e=Pr.getProgramInfoLog(e))&&(e="(unknown error)"),I[n>>2]=e.length+1;else if(35719==t){if(!e.Hh)for(t=0;t<Pr.getProgramParameter(e,35718);++t)e.Hh=Math.max(e.Hh,Pr.getActiveUniform(e,t).name.length+1);I[n>>2]=e.Hh}else if(35722==t){if(!e.Fh)for(t=0;t<Pr.getProgramParameter(e,35721);++t)e.Fh=Math.max(e.Fh,Pr.getActiveAttrib(e,t).name.length+1);I[n>>2]=e.Fh}else if(35381==t){if(!e.Gh)for(t=0;t<Pr.getProgramParameter(e,35382);++t)e.Gh=Math.max(e.Gh,Pr.getActiveUniformBlockName(e,t).length+1);I[n>>2]=e.Gh}else I[n>>2]=Pr.getProgramParameter(e,t);else xn(1281)},tf:function(e,t,n){n?On(n,"boolean"==typeof(e=Pr.Ah.getQueryObjectEXT(yn[e],t))?e?1:0:e):xn(1281)},vf:function(e,t,n){var r;n?(r="boolean"==typeof(e=Pr.Ah.getQueryObjectEXT(yn[e],t))?e?1:0:e,I[n>>2]=r):xn(1281)},sf:function(e,t,n){n?On(n,"boolean"==typeof(e=Pr.Ah.getQueryObjectEXT(yn[e],t))?e?1:0:e):xn(1281)},uf:function(e,t,n){var r;n?(r="boolean"==typeof(e=Pr.Ah.getQueryObjectEXT(yn[e],t))?e?1:0:e,I[n>>2]=r):xn(1281)},wf:function(e,t,n){n?I[n>>2]=Pr.Ah.getQueryEXT(e,t):xn(1281)},Vd:function(e,t,n){n?I[n>>2]=Pr.getRenderbufferParameter(e,t):xn(1281)},Td:function(e,t,n,r){null===(e=Pr.getShaderInfoLog(dn[e]))&&(e="(unknown error)"),t=0<t&&r?D(e,r,t):0,n&&(I[n>>2]=t)},Sd:function(e,t,n,r){e=Pr.getShaderPrecisionFormat(e,t),I[n>>2]=e.rangeMin,I[n+4>>2]=e.rangeMax,I[r>>2]=e.precision},Rd:function(e,t,n,r){(e=Pr.getShaderSource(dn[e]))&&(t=0<t&&r?D(e,r,t):0,n&&(I[n>>2]=t))},Ud:function(e,t,n){n?35716==t?(null===(e=Pr.getShaderInfoLog(dn[e]))&&(e="(unknown error)"),I[n>>2]=e?e.length+1:0):35720==t?(e=Pr.getShaderSource(dn[e]),I[n>>2]=e?e.length+1:0):I[n>>2]=Pr.getShaderParameter(dn[e],t):xn(1281)},Qd:function(e){var t=bn[e];if(!t){switch(e){case 7939:t=(t=Pr.getSupportedExtensions()||[]).concat(t.map((function(e){return"GL_"+e}))),t=Mn(t.join(" "));break;case 7936:case 7937:case 37445:case 37446:(t=Pr.getParameter(e))||xn(1280),t=t&&Mn(t);break;case 7938:t=Mn("OpenGL ES 2.0 ("+Pr.getParameter(7938)+")");break;case 35724:var n=(t=Pr.getParameter(35724)).match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==n&&(3==n[1].length&&(n[1]+="0"),t="OpenGL ES GLSL ES "+n[1]+" ("+t+")"),t=Mn(t);break;default:xn(1280)}bn[e]=t}return t},Pd:function(e,t,n){n?C[n>>2]=Pr.getTexParameter(e,t):xn(1281)},Od:function(e,t,n){n?I[n>>2]=Pr.getTexParameter(e,t):xn(1281)},Ld:function(e,t){if(t=F(t),e=cn[e]){Pn(e);var n=e.Ph,r=0,a=t,s=Ln(t);if(0<s&&(r=parseInt(t.slice(s+1))>>>0,a=t.slice(0,s)),(a=e.hi[a])&&r<a[0]&&(n[r+=a[1]]=n[r]||Pr.getUniformLocation(e,t)))return r}else xn(1281);return-1},Nd:function(e,t,n){Un(e,t,n,2)},Md:function(e,t,n){Un(e,t,n,0)},Hd:function(e,t,n){n?I[n>>2]=Pr.getVertexAttribOffset(e,t):xn(1281)},Jd:function(e,t,n){zn(e,t,n,2)},Id:function(e,t,n){zn(e,t,n,5)},Gd:function(e,t){Pr.hint(e,t)},Fd:function(e){return(e=ln[e])?Pr.isBuffer(e):0},Ed:function(e){return Pr.isEnabled(e)},Dd:function(e){return(e=hn[e])?Pr.isFramebuffer(e):0},Cd:function(e){return(e=cn[e])?Pr.isProgram(e):0},Af:function(e){return(e=yn[e])?Pr.Ah.isQueryEXT(e):0},Bd:function(e){return(e=pn[e])?Pr.isRenderbuffer(e):0},Ad:function(e){return(e=dn[e])?Pr.isShader(e):0},yd:function(e){return(e=fn[e])?Pr.isTexture(e):0},of:function(e){return(e=mn[e])?Pr.isVertexArray(e):0},xd:function(e){Pr.lineWidth(e)},wd:function(e){e=cn[e],Pr.linkProgram(e),e.Ph=0,e.hi={}},vd:function(e,t){3317==e&&(vn=t),Pr.pixelStorei(e,t)},ud:function(e,t){Pr.polygonOffset(e,t)},xf:function(e,t){Pr.Ah.queryCounterEXT(yn[e],t)},td:function(e,t,n,r,a,s,o){(o=Vn(s,a,n,r,o))?Pr.readPixels(e,t,n,r,a,s,o):xn(1280)},sd:function(){},rd:function(e,t,n,r){Pr.renderbufferStorage(e,t,n,r)},qd:function(e,t){Pr.sampleCoverage(e,!!t)},pd:function(e,t,n,r){Pr.scissor(e,t,n,r)},nd:function(){xn(1280)},md:function(e,t,n,r){t=wn(t,n,r),Pr.shaderSource(dn[e],t)},ld:function(e,t,n){Pr.stencilFunc(e,t,n)},kd:function(e,t,n,r){Pr.stencilFuncSeparate(e,t,n,r)},jd:function(e){Pr.stencilMask(e)},id:function(e,t){Pr.stencilMaskSeparate(e,t)},hd:function(e,t,n){Pr.stencilOp(e,t,n)},gd:function(e,t,n,r){Pr.stencilOpSeparate(e,t,n,r)},fd:function(e,t,n,r,a,s,o,i,u){Pr.texImage2D(e,t,n,r,a,s,o,i,u?Vn(i,o,r,a,u):null)},ed:function(e,t,n){Pr.texParameterf(e,t,n)},dd:function(e,t,n){Pr.texParameterf(e,t,C[n>>2])},cd:function(e,t,n){Pr.texParameteri(e,t,n)},bd:function(e,t,n){Pr.texParameteri(e,t,I[n>>2])},ad:function(e,t,n,r,a,s,o,i,u){var l=null;u&&(l=Vn(i,o,a,s,u)),Pr.texSubImage2D(e,t,n,r,a,s,o,i,l)},$c:function(e,t){Pr.uniform1f(Bn(e),t)},_c:function(e,t,n){if(288>=t)for(var r=Wn[t-1],a=0;a<t;++a)r[a]=C[n+4*a>>2];else r=C.subarray(n>>2,n+4*t>>2);Pr.uniform1fv(Bn(e),r)},Zc:function(e,t){Pr.uniform1i(Bn(e),t)},Yc:function(e,t,n){if(288>=t)for(var r=jn[t-1],a=0;a<t;++a)r[a]=I[n+4*a>>2];else r=I.subarray(n>>2,n+4*t>>2);Pr.uniform1iv(Bn(e),r)},Xc:function(e,t,n){Pr.uniform2f(Bn(e),t,n)},Wc:function(e,t,n){if(144>=t)for(var r=Wn[2*t-1],a=0;a<2*t;a+=2)r[a]=C[n+4*a>>2],r[a+1]=C[n+(4*a+4)>>2];else r=C.subarray(n>>2,n+8*t>>2);Pr.uniform2fv(Bn(e),r)},Uc:function(e,t,n){Pr.uniform2i(Bn(e),t,n)},Tc:function(e,t,n){if(144>=t)for(var r=jn[2*t-1],a=0;a<2*t;a+=2)r[a]=I[n+4*a>>2],r[a+1]=I[n+(4*a+4)>>2];else r=I.subarray(n>>2,n+8*t>>2);Pr.uniform2iv(Bn(e),r)},Sc:function(e,t,n,r){Pr.uniform3f(Bn(e),t,n,r)},Rc:function(e,t,n){if(96>=t)for(var r=Wn[3*t-1],a=0;a<3*t;a+=3)r[a]=C[n+4*a>>2],r[a+1]=C[n+(4*a+4)>>2],r[a+2]=C[n+(4*a+8)>>2];else r=C.subarray(n>>2,n+12*t>>2);Pr.uniform3fv(Bn(e),r)},Qc:function(e,t,n,r){Pr.uniform3i(Bn(e),t,n,r)},Pc:function(e,t,n){if(96>=t)for(var r=jn[3*t-1],a=0;a<3*t;a+=3)r[a]=I[n+4*a>>2],r[a+1]=I[n+(4*a+4)>>2],r[a+2]=I[n+(4*a+8)>>2];else r=I.subarray(n>>2,n+12*t>>2);Pr.uniform3iv(Bn(e),r)},Oc:function(e,t,n,r,a){Pr.uniform4f(Bn(e),t,n,r,a)},Nc:function(e,t,n){if(72>=t){var r=Wn[4*t-1],a=C;n>>=2;for(var s=0;s<4*t;s+=4){var o=n+s;r[s]=a[o],r[s+1]=a[o+1],r[s+2]=a[o+2],r[s+3]=a[o+3]}}else r=C.subarray(n>>2,n+16*t>>2);Pr.uniform4fv(Bn(e),r)},Mc:function(e,t,n,r,a){Pr.uniform4i(Bn(e),t,n,r,a)},Lc:function(e,t,n){if(72>=t)for(var r=jn[4*t-1],a=0;a<4*t;a+=4)r[a]=I[n+4*a>>2],r[a+1]=I[n+(4*a+4)>>2],r[a+2]=I[n+(4*a+8)>>2],r[a+3]=I[n+(4*a+12)>>2];else r=I.subarray(n>>2,n+16*t>>2);Pr.uniform4iv(Bn(e),r)},Jc:function(e,t,n,r){if(72>=t)for(var a=Wn[4*t-1],s=0;s<4*t;s+=4)a[s]=C[r+4*s>>2],a[s+1]=C[r+(4*s+4)>>2],a[s+2]=C[r+(4*s+8)>>2],a[s+3]=C[r+(4*s+12)>>2];else a=C.subarray(r>>2,r+16*t>>2);Pr.uniformMatrix2fv(Bn(e),!!n,a)},Ic:function(e,t,n,r){if(32>=t)for(var a=Wn[9*t-1],s=0;s<9*t;s+=9)a[s]=C[r+4*s>>2],a[s+1]=C[r+(4*s+4)>>2],a[s+2]=C[r+(4*s+8)>>2],a[s+3]=C[r+(4*s+12)>>2],a[s+4]=C[r+(4*s+16)>>2],a[s+5]=C[r+(4*s+20)>>2],a[s+6]=C[r+(4*s+24)>>2],a[s+7]=C[r+(4*s+28)>>2],a[s+8]=C[r+(4*s+32)>>2];else a=C.subarray(r>>2,r+36*t>>2);Pr.uniformMatrix3fv(Bn(e),!!n,a)},Hc:function(e,t,n,r){if(18>=t){var a=Wn[16*t-1],s=C;r>>=2;for(var o=0;o<16*t;o+=16){var i=r+o;a[o]=s[i],a[o+1]=s[i+1],a[o+2]=s[i+2],a[o+3]=s[i+3],a[o+4]=s[i+4],a[o+5]=s[i+5],a[o+6]=s[i+6],a[o+7]=s[i+7],a[o+8]=s[i+8],a[o+9]=s[i+9],a[o+10]=s[i+10],a[o+11]=s[i+11],a[o+12]=s[i+12],a[o+13]=s[i+13],a[o+14]=s[i+14],a[o+15]=s[i+15]}}else a=C.subarray(r>>2,r+64*t>>2);Pr.uniformMatrix4fv(Bn(e),!!n,a)},Gc:function(e){e=cn[e],Pr.useProgram(e),Pr.ti=e},Fc:function(e){Pr.validateProgram(cn[e])},Ec:function(e,t){Pr.vertexAttrib1f(e,t)},Dc:function(e,t){Pr.vertexAttrib1f(e,C[t>>2])},Cc:function(e,t,n){Pr.vertexAttrib2f(e,t,n)},Bc:function(e,t){Pr.vertexAttrib2f(e,C[t>>2],C[t+4>>2])},Ac:function(e,t,n,r){Pr.vertexAttrib3f(e,t,n,r)},yc:function(e,t){Pr.vertexAttrib3f(e,C[t>>2],C[t+4>>2],C[t+8>>2])},xc:function(e,t,n,r,a){Pr.vertexAttrib4f(e,t,n,r,a)},wc:function(e,t){Pr.vertexAttrib4f(e,C[t>>2],C[t+4>>2],C[t+8>>2],C[t+12>>2])},jf:function(e,t){Pr.vertexAttribDivisor(e,t)},vc:function(e,t,n,r,a,s){Pr.vertexAttribPointer(e,t,n,!!r,a,s)},uc:function(e,t,n,r){Pr.viewport(e,t,n,r)},rb:function(e,t,n){t=function(e,t){function n(e){var t=s;return("double"===e||"i64"===e)&&7&t&&(t+=4),s=t,"double"===e?(e=N[s>>3],s+=8):"i64"==e?(e=[I[s>>2],I[s+4>>2]],s+=8):(e=I[s>>2],s+=4),e}for(var r,a,s=t,o=[];;){var i=e;if(0===(r=w[e>>0]))break;if(a=w[e+1>>0],37==r){var u=!1,l=t=!1,c=!1,h=!1;e:for(;;){switch(a){case 43:u=!0;break;case 45:t=!0;break;case 35:l=!0;break;case 48:if(c)break e;c=!0;break;case 32:h=!0;break;default:break e}e++,a=w[e+1>>0]}var p=0;if(42==a)p=n("i32"),e++,a=w[e+1>>0];else for(;48<=a&&57>=a;)p=10*p+(a-48),e++,a=w[e+1>>0];var f=!1,d=-1;if(46==a){if(d=0,f=!0,e++,42==(a=w[e+1>>0]))d=n("i32"),e++;else for(;!(48>(a=w[e+1>>0])||57<a);)d=10*d+(a-48),e++;a=w[e+1>>0]}switch(0>d&&(d=6,f=!1),String.fromCharCode(a)){case"h":if(104==(a=w[e+2>>0])){e++;var m=1}else m=2;break;case"l":108==(a=w[e+2>>0])?(e++,m=8):m=4;break;case"L":case"q":case"j":m=8;break;case"z":case"t":case"I":m=4;break;default:m=null}switch(m&&e++,a=w[e+1>>0],String.fromCharCode(a)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":i=100==a||105==a,r=n("i"+8*(m=m||4)),8==m&&(r=117==a?(r[0]>>>0)+4294967296*(r[1]>>>0):(r[0]>>>0)+4294967296*r[1]),4>=m&&(r=(i?Gn:Hn)(r&Math.pow(256,m)-1,8*m));var g=Math.abs(r);if(i="",100==a||105==a)var y=Gn(r,8*m).toString(10);else if(117==a)y=Hn(r,8*m).toString(10),r=Math.abs(r);else if(111==a)y=(l?"0":"")+g.toString(8);else if(120==a||88==a){if(i=l&&0!=r?"0x":"",0>r){for(r=-r,y=(g-1).toString(16),g=[],l=0;l<y.length;l++)g.push((15-parseInt(y[l],16)).toString(16));for(y=g.join("");y.length<2*m;)y="f"+y}else y=g.toString(16);88==a&&(i=i.toUpperCase(),y=y.toUpperCase())}else 112==a&&(0===g?y="(nil)":(i="0x",y=g.toString(16)));if(f)for(;y.length<d;)y="0"+y;for(0<=r&&(u?i="+"+i:h&&(i=" "+i)),"-"==y.charAt(0)&&(i="-"+i,y=y.substr(1));i.length+y.length<p;)t?y+=" ":c?y="0"+y:i=" "+i;(y=i+y).split("").forEach((function(e){o.push(e.charCodeAt(0))}));break;case"f":case"F":case"e":case"E":case"g":case"G":if(r=n("double"),isNaN(r))y="nan",c=!1;else if(isFinite(r)){if(f=!1,m=Math.min(d,20),103!=a&&71!=a||(f=!0,(d=d||1)>(m=parseInt(r.toExponential(m).split("e")[1],10))&&-4<=m?(a=(103==a?"f":"F").charCodeAt(0),d-=m+1):(a=(103==a?"e":"E").charCodeAt(0),d--),m=Math.min(d,20)),101==a||69==a?(y=r.toExponential(m),/[eE][-+]\d$/.test(y)&&(y=y.slice(0,-1)+"0"+y.slice(-1))):102!=a&&70!=a||(y=r.toFixed(m),0===r&&(0>r||0===r&&-1/0==1/r)&&(y="-"+y)),i=y.split("e"),f&&!l)for(;1<i[0].length&&i[0].includes(".")&&("0"==i[0].slice(-1)||"."==i[0].slice(-1));)i[0]=i[0].slice(0,-1);else for(l&&-1==y.indexOf(".")&&(i[0]+=".");d>m++;)i[0]+="0";y=i[0]+(1<i.length?"e"+i[1]:""),69==a&&(y=y.toUpperCase()),0<=r&&(u?y="+"+y:h&&(y=" "+y))}else y=(0>r?"-":"")+"inf",c=!1;for(;y.length<p;)y=t?y+" ":!c||"-"!=y[0]&&"+"!=y[0]?(c?"0":" ")+y:y[0]+"0"+y.slice(1);97>a&&(y=y.toUpperCase()),y.split("").forEach((function(e){o.push(e.charCodeAt(0))}));break;case"s":if(c=(u=n("i8*"))?Kn(u):6,f&&(c=Math.min(c,d)),!t)for(;c<p--;)o.push(32);if(u)for(l=0;l<c;l++)o.push(T[u++>>0]);else o=o.concat(qn("(null)".substr(0,c),!0));if(t)for(;c<p--;)o.push(32);break;case"c":for(t&&o.push(n("i8"));0<--p;)o.push(32);t||o.push(n("i8"));break;case"n":t=n("i32*"),I[t>>2]=o.length;break;case"%":o.push(r);break;default:for(l=i;l<e+2;l++)o.push(w[l>>0])}e+=2}else o.push(r),e+=1}return o}(t,n),t=R(t,0),24&e&&(t=t.replace(/\s+$/,""),t+=(0<t.length?"\n":"")+function(e){e:{var t=Error();if(!t.stack){try{throw Error()}catch(e){t=e}if(!t.stack){t="(no stack trace available)";break e}}t=t.stack.toString()}t=t.slice(t.indexOf("\n",Math.max(t.lastIndexOf("_emscripten_log"),t.lastIndexOf("_emscripten_get_callstack")))+1),32&e&&Tt("EM_LOG_DEMANGLE is deprecated; ignoring"),8&e&&"undefined"==typeof emscripten_source_map&&(Tt('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),e=8^e|16);var n=null;if(128&e)for(n=Xn(arguments);n[1].includes("_emscripten_");)n=Xn(n[0]);var r=t.split("\n");t="";var a,s=RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),o=RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),i=RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(a in r){var u,l=r[a];if((u=i.exec(l))&&5==u.length){l=u[1];var c=u[2],h=u[3];u=u[4]}else{if((u=s.exec(l))||(u=o.exec(l)),!(u&&4<=u.length)){t+=l+"\n";continue}l=u[1],c=u[2],h=u[3],u=0|u[4]}var p=!1;if(8&e){var f=emscripten_source_map.bk({line:h,$i:u});(p=f&&f.source)&&(64&e&&(f.source=f.source.substring(f.source.replace(/\\/g,"/").lastIndexOf("/")+1)),t+="    at "+l+" ("+f.source+":"+f.line+":"+f.$i+")\n")}(16&e||!p)&&(64&e&&(c=c.substring(c.replace(/\\/g,"/").lastIndexOf("/")+1)),t+=(p?"     = "+l:"    at "+l)+" ("+c+":"+h+":"+u+")\n"),128&e&&n[0]&&(n[1]==l&&0<n[2].length&&(t=t.replace(/\s+$/,""),t+=" with values: "+n[1]+n[2]+"\n"),n=Xn(n[0]))}return t.replace(/\s+$/,"")}(e)),1&e?4&e?console.error(t):2&e?console.warn(t):512&e?console.info(t):256&e?console.debug(t):console.log(t):6&e?y(t):g(t)},tc:function(e,t,n){T.copyWithin(e,t,t+n)},gc:function(e){var t=T.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math;r=Math.max(e,r),a=a.min.call(a,2147483648,r+(65536-r%65536)%65536);e:{try{v.grow(a-_.byteLength+65535>>>16),L();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1},ng:function(e,n){Xt(t.canvas,e,n),qt()},ic:function(e,t){var n=0;return Qn().forEach((function(r,a){var s=t+n;for(a=k[e+4*a>>2]=s,s=0;s<r.length;++s)w[a++>>0]=r.charCodeAt(s);w[a>>0]=0,n+=r.length+1})),0},jc:function(e,t){var n=Qn();k[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),k[t>>2]=r,0},Kf:xt,Ma:function(){return 52},kc:function(){return 52},Vb:function(){return 70},Na:function(e,t,n,r){for(var a=0,s=0;s<n;s++){var o=k[t>>2],i=k[t+4>>2];t+=8;for(var u=0;u<i;u++)er(e,T[o+u]);a+=i}return k[r>>2]=a,0},bc:function e(t,n){e.zi||(e.zi=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}return()=>X("randomDevice")}());for(var r=0;r<n;r++)w[t+r>>0]=e.zi();return 0},cb:function(e){Pr.activeTexture(e)},lb:function(e,t){Pr.attachShader(cn[e],dn[t])},B:function(e,t){Pr.bindBuffer(e,ln[t])},x:function(e,t){Pr.bindFramebuffer(e,hn[t])},T:function(e,t){Pr.bindRenderbuffer(e,pn[t])},G:function(e,t){Pr.bindTexture(e,fn[t])},Sf:function(e,t,n,r){Pr.blendColor(e,t,n,r)},Tf:function(e,t){Pr.blendEquationSeparate(e,t)},Uf:function(e,t,n,r){Pr.blendFuncSeparate(e,t,n,r)},Ra:function(e,t,n,r){Pr.bufferData(e,n?T.subarray(n,n+t):t,r)},Xa:function(e,t,n,r){Pr.bufferSubData(e,t,T.subarray(r,r+n))},sa:function(e){return Pr.checkFramebufferStatus(e)},Of:function(e){Pr.clear(e)},Wa:function(e,t,n,r){Pr.clearColor(e,t,n,r)},Qf:function(e){Pr.clearDepth(e)},Pf:function(e){Pr.clearStencil(e)},ca:function(e,t,n,r){Pr.colorMask(!!e,!!t,!!n,!!r)},Yf:function(e){Pr.compileShader(dn[e])},qb:function(e,t,n,r,a,s,o,i){Pr.compressedTexImage2D(e,t,n,r,a,s,i?T.subarray(i,i+o):null)},bg:function(e,t,n,r,a,s,o,i,u){Pr.compressedTexSubImage2D(e,t,n,r,a,s,o,u?T.subarray(u,u+i):null)},kg:function(){var e=_n(cn),t=Pr.createProgram();return t.name=e,t.Hh=t.Fh=t.Gh=0,t.gi=1,cn[e]=t,e},_f:function(e){var t=_n(dn);return dn[t]=Pr.createShader(e),t},Ya:function(e){Pr.cullFace(e)},eb:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=ln[r];a&&(Pr.deleteBuffer(a),a.name=0,ln[r]=null)}},ra:function(e,t){for(var n=0;n<e;++n){var r=I[t+4*n>>2],a=hn[r];a&&(Pr.deleteFramebuffer(a),a.name=0,hn[r]=null)}},kb:function(e){if(e){var t=cn[e];t?(Pr.deleteProgram(t),t.name=0,cn[e]=null):xn(1281)}},ua:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=pn[r];a&&(Pr.deleteRenderbuffer(a),a.name=0,pn[r]=null)}},ab:function(e){if(e){var t=dn[e];t?(Pr.deleteShader(t),dn[e]=null):xn(1281)}},fa:function(e,t){for(var n=0;n<e;n++){var r=I[t+4*n>>2],a=fn[r];a&&(Pr.deleteTexture(a),a.name=0,fn[r]=null)}},X:function(e){Pr.depthFunc(e)},pa:function(e){Pr.depthMask(!!e)},jb:function(e,t){Pr.detachShader(cn[e],dn[t])},y:function(e){Pr.disable(e)},hb:function(e){Pr.disableVertexAttribArray(e)},Va:function(e,t,n){Pr.drawArrays(e,t,n)},Ua:function(e,t,n,r){Pr.drawElements(e,t,n,r)},H:function(e){Pr.enable(e)},gb:function(e){Pr.enableVertexAttribArray(e)},Rf:function(){Pr.flush()},ta:function(e,t,n,r){Pr.framebufferRenderbuffer(e,t,n,pn[r])},da:function(e,t,n,r,a){Pr.framebufferTexture2D(e,t,n,fn[r],a)},Ta:function(e,t){Rn(e,t,"createBuffer",ln)},ea:function(e,t){Rn(e,t,"createFramebuffer",hn)},va:function(e,t){Rn(e,t,"createRenderbuffer",pn)},ha:function(e,t){Rn(e,t,"createTexture",fn)},bb:function(e){Pr.generateMipmap(e)},hg:function(e,t,n,r,a,s,o){Fn("getActiveAttrib",e,t,n,r,a,s,o)},gg:function(e,t,n,r,a,s,o){Fn("getActiveUniform",e,t,n,r,a,s,o)},ib:function(e,t){return Pr.getAttribLocation(cn[e],F(t))},A:function(){var e=Pr.getError()||Sn;return Sn=0,e},lg:function(e,t){Dn(e,t,2)},V:function(e,t){Dn(e,t,0)},ig:function(e,t,n,r){null===(e=Pr.getProgramInfoLog(cn[e]))&&(e="(unknown error)"),t=0<t&&r?D(e,r,t):0,n&&(I[n>>2]=t)},U:function(e,t,n){if(n)if(e>=un)xn(1281);else if(e=cn[e],35716==t)null===(e=Pr.getProgramInfoLog(e))&&(e="(unknown error)"),I[n>>2]=e.length+1;else if(35719==t){if(!e.Hh)for(t=0;t<Pr.getProgramParameter(e,35718);++t)e.Hh=Math.max(e.Hh,Pr.getActiveUniform(e,t).name.length+1);I[n>>2]=e.Hh}else if(35722==t){if(!e.Fh)for(t=0;t<Pr.getProgramParameter(e,35721);++t)e.Fh=Math.max(e.Fh,Pr.getActiveAttrib(e,t).name.length+1);I[n>>2]=e.Fh}else if(35381==t){if(!e.Gh)for(t=0;t<Pr.getProgramParameter(e,35382);++t)e.Gh=Math.max(e.Gh,Pr.getActiveUniformBlockName(e,t).length+1);I[n>>2]=e.Gh}else I[n>>2]=Pr.getProgramParameter(e,t);else xn(1281)},Wf:function(e,t,n,r){null===(e=Pr.getShaderInfoLog(dn[e]))&&(e="(unknown error)"),t=0<t&&r?D(e,r,t):0,n&&(I[n>>2]=t)},Xf:function(e,t,n){n?35716==t?(null===(e=Pr.getShaderInfoLog(dn[e]))&&(e="(unknown error)"),I[n>>2]=e?e.length+1:0):35720==t?(e=Pr.getShaderSource(dn[e]),I[n>>2]=e?e.length+1:0):I[n>>2]=Pr.getShaderParameter(dn[e],t):xn(1281)},wa:function(e){var t=bn[e];if(!t){switch(e){case 7939:t=(t=Pr.getSupportedExtensions()||[]).concat(t.map((function(e){return"GL_"+e}))),t=Mn(t.join(" "));break;case 7936:case 7937:case 37445:case 37446:(t=Pr.getParameter(e))||xn(1280),t=t&&Mn(t);break;case 7938:t=Mn("OpenGL ES 2.0 ("+Pr.getParameter(7938)+")");break;case 35724:var n=(t=Pr.getParameter(35724)).match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==n&&(3==n[1].length&&(n[1]+="0"),t="OpenGL ES GLSL ES "+n[1]+" ("+t+")"),t=Mn(t);break;default:xn(1280)}bn[e]=t}return t},fg:function(e,t){if(t=F(t),e=cn[e]){Pn(e);var n=e.Ph,r=0,a=t,s=Ln(t);if(0<s&&(r=parseInt(t.slice(s+1))>>>0,a=t.slice(0,s)),(a=e.hi[a])&&r<a[0]&&(n[r+=a[1]]=n[r]||Pr.getUniformLocation(e,t)))return r}else xn(1281);return-1},jg:function(e){e=cn[e],Pr.linkProgram(e),e.Ph=0,e.hi={}},ga:function(e,t){3317==e&&(vn=t),Pr.pixelStorei(e,t)},ma:function(e,t,n,r,a,s,o){(o=Vn(s,a,n,r,o))?Pr.readPixels(e,t,n,r,a,s,o):xn(1280)},db:function(e,t,n,r){Pr.renderbufferStorage(e,t,n,r)},qa:function(e,t,n,r){Pr.scissor(e,t,n,r)},Zf:function(e,t,n,r){t=wn(t,n,r),Pr.shaderSource(dn[e],t)},_a:function(e,t,n,r){Pr.stencilFuncSeparate(e,t,n,r)},Za:function(e,t,n,r){Pr.stencilOpSeparate(e,t,n,r)},mg:function(e,t,n,r,a,s,o,i,u){Pr.texImage2D(e,t,n,r,a,s,o,i,u?Vn(i,o,r,a,u):null)},dg:function(e,t,n){Pr.texParameterf(e,t,n)},cg:function(e,t,n){Pr.texParameterf(e,t,C[n>>2])},O:function(e,t,n){Pr.texParameteri(e,t,n)},ag:function(e,t,n,r,a,s,o,i,u){var l=null;u&&(l=Vn(i,o,a,s,u)),Pr.texSubImage2D(e,t,n,r,a,s,o,i,l)},Lf:function(e,t){Pr.uniform1i(Bn(e),t)},Nf:function(e,t,n){if(288>=t)for(var r=jn[t-1],a=0;a<t;++a)r[a]=I[n+4*a>>2];else r=I.subarray(n>>2,n+4*t>>2);Pr.uniform1iv(Bn(e),r)},oa:function(e,t,n){if(72>=t){var r=Wn[4*t-1],a=C;n>>=2;for(var s=0;s<4*t;s+=4){var o=n+s;r[s]=a[o],r[s+1]=a[o+1],r[s+2]=a[o+2],r[s+3]=a[o+3]}}else r=C.subarray(n>>2,n+16*t>>2);Pr.uniform4fv(Bn(e),r)},Mf:function(e,t,n,r){if(32>=t)for(var a=Wn[9*t-1],s=0;s<9*t;s+=9)a[s]=C[r+4*s>>2],a[s+1]=C[r+(4*s+4)>>2],a[s+2]=C[r+(4*s+8)>>2],a[s+3]=C[r+(4*s+12)>>2],a[s+4]=C[r+(4*s+16)>>2],a[s+5]=C[r+(4*s+20)>>2],a[s+6]=C[r+(4*s+24)>>2],a[s+7]=C[r+(4*s+28)>>2],a[s+8]=C[r+(4*s+32)>>2];else a=C.subarray(r>>2,r+36*t>>2);Pr.uniformMatrix3fv(Bn(e),!!n,a)},na:function(e,t,n,r){if(18>=t){var a=Wn[16*t-1],s=C;r>>=2;for(var o=0;o<16*t;o+=16){var i=r+o;a[o]=s[i],a[o+1]=s[i+1],a[o+2]=s[i+2],a[o+3]=s[i+3],a[o+4]=s[i+4],a[o+5]=s[i+5],a[o+6]=s[i+6],a[o+7]=s[i+7],a[o+8]=s[i+8],a[o+9]=s[i+9],a[o+10]=s[i+10],a[o+11]=s[i+11],a[o+12]=s[i+12],a[o+13]=s[i+13],a[o+14]=s[i+14],a[o+15]=s[i+15]}}else a=C.subarray(r>>2,r+64*t>>2);Pr.uniformMatrix4fv(Bn(e),!!n,a)},Y:function(e){e=cn[e],Pr.useProgram(e),Pr.ti=e},fb:function(e,t,n,r,a,s){Pr.vertexAttribPointer(e,t,n,!!r,a,s)},$a:function(e,t,n,r){Pr.viewport(e,t,n,r)},ja:function(e,t){var n=ta();try{return ue(e)(t)}catch(e){if(na(n),e!==e+0)throw e;ea(1,0)}},C:function(e,t,n){var r=ta();try{return ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},Ja:function(e,t,n,r){var a=ta();try{return ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},Ka:function(e,t,n,r){var a=ta();try{return ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},s:function(e){var t=ta();try{return ue(e)()}catch(e){if(na(t),e!==e+0)throw e;ea(1,0)}},f:function(e,t){var n=ta();try{return ue(e)(t)}catch(e){if(na(n),e!==e+0)throw e;ea(1,0)}},J:function(e,t,n){var r=ta();try{return ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},M:function(e,t,n){var r=ta();try{return ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},sb:function(e,t,n,r,a){var s=ta();try{return ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},Ca:function(e,t,n,r,a,s,o,i,u,l,c,h,p,f){var d=ta();try{return ue(e)(t,n,r,a,s,o,i,u,l,c,h,p,f)}catch(e){if(na(d),e!==e+0)throw e;ea(1,0)}},wb:function(e,t,n,r,a){var s=ta();try{return ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},b:function(e,t,n){var r=ta();try{return ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},m:function(e,t,n,r){var a=ta();try{return ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},tb:function(e,t,n,r,a,s,o,i,u){var l=ta();try{return ue(e)(t,n,r,a,s,o,i,u)}catch(e){if(na(l),e!==e+0)throw e;ea(1,0)}},r:function(e,t,n,r,a){var s=ta();try{return ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},La:function(e,t,n,r,a,s){var o=ta();try{return ue(e)(t,n,r,a,s)}catch(e){if(na(o),e!==e+0)throw e;ea(1,0)}},ub:function(e,t,n,r,a,s,o,i,u,l){var c=ta();try{return ue(e)(t,n,r,a,s,o,i,u,l)}catch(e){if(na(c),e!==e+0)throw e;ea(1,0)}},E:function(e,t,n,r,a,s){var o=ta();try{return ue(e)(t,n,r,a,s)}catch(e){if(na(o),e!==e+0)throw e;ea(1,0)}},w:function(e,t,n,r,a,s,o){var i=ta();try{return ue(e)(t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},K:function(e,t,n,r,a,s,o,i){var u=ta();try{return ue(e)(t,n,r,a,s,o,i)}catch(e){if(na(u),e!==e+0)throw e;ea(1,0)}},Ia:function(e,t,n,r,a,s,o,i,u){var l=ta();try{return ue(e)(t,n,r,a,s,o,i,u)}catch(e){if(na(l),e!==e+0)throw e;ea(1,0)}},Ha:function(e,t,n,r,a,s,o,i,u,l){var c=ta();try{return ue(e)(t,n,r,a,s,o,i,u,l)}catch(e){if(na(c),e!==e+0)throw e;ea(1,0)}},aa:function(e,t,n,r,a,s,o,i,u,l,c,h){var p=ta();try{return ue(e)(t,n,r,a,s,o,i,u,l,c,h)}catch(e){if(na(p),e!==e+0)throw e;ea(1,0)}},Sb:function(e,t,n,r,a,s,o){var i=ta();try{return da(e,t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},Yb:function(e,t,n,r){var a=ta();try{return la(e,t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},ac:function(e){var t=ta();try{return oa(e)}catch(e){if(na(t),e!==e+0)throw e;ea(1,0)}},$b:function(e,t){var n=ta();try{return ia(e,t)}catch(e){if(na(n),e!==e+0)throw e;ea(1,0)}},Xb:function(e,t,n){var r=ta();try{return ha(e,t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},Rb:function(e,t,n,r,a){var s=ta();try{return ma(e,t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},k:function(e){var t=ta();try{ue(e)()}catch(e){if(na(t),e!==e+0)throw e;ea(1,0)}},i:function(e,t){var n=ta();try{ue(e)(t)}catch(e){if(na(n),e!==e+0)throw e;ea(1,0)}},_:function(e,t,n){var r=ta();try{ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},P:function(e,t,n){var r=ta();try{ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},xb:function(e,t,n,r){var a=ta();try{ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},e:function(e,t,n){var r=ta();try{ue(e)(t,n)}catch(e){if(na(r),e!==e+0)throw e;ea(1,0)}},Fa:function(e,t,n,r){var a=ta();try{ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},Ea:function(e,t,n,r,a){var s=ta();try{ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},D:function(e,t,n,r,a,s,o){var i=ta();try{ue(e)(t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},R:function(e,t,n,r,a){var s=ta();try{ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},h:function(e,t,n,r){var a=ta();try{ue(e)(t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},o:function(e,t,n,r,a){var s=ta();try{ue(e)(t,n,r,a)}catch(e){if(na(s),e!==e+0)throw e;ea(1,0)}},t:function(e,t,n,r,a,s){var o=ta();try{ue(e)(t,n,r,a,s)}catch(e){if(na(o),e!==e+0)throw e;ea(1,0)}},vb:function(e,t,n,r,a,s,o){var i=ta();try{ue(e)(t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},ba:function(e,t,n,r,a,s,o){var i=ta();try{ue(e)(t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},v:function(e,t,n,r,a,s,o,i){var u=ta();try{ue(e)(t,n,r,a,s,o,i)}catch(e){if(na(u),e!==e+0)throw e;ea(1,0)}},Jf:function(e,t,n,r,a,s,o,i,u){var l=ta();try{ue(e)(t,n,r,a,s,o,i,u)}catch(e){if(na(l),e!==e+0)throw e;ea(1,0)}},S:function(e,t,n,r,a,s,o,i,u,l,c){var h=ta();try{ue(e)(t,n,r,a,s,o,i,u,l,c)}catch(e){if(na(h),e!==e+0)throw e;ea(1,0)}},Da:function(e,t,n,r,a,s,o,i,u,l,c,h,p){var f=ta();try{ue(e)(t,n,r,a,s,o,i,u,l,c,h,p)}catch(e){if(na(f),e!==e+0)throw e;ea(1,0)}},$:function(e,t,n,r,a,s,o,i,u,l,c,h,p,f,d,m){var g=ta();try{ue(e)(t,n,r,a,s,o,i,u,l,c,h,p,f,d,m)}catch(e){if(na(g),e!==e+0)throw e;ea(1,0)}},Tb:function(e,t,n,r,a,s,o){var i=ta();try{fa(e,t,n,r,a,s,o)}catch(e){if(na(i),e!==e+0)throw e;ea(1,0)}},_b:function(e,t,n,r){var a=ta();try{ua(e,t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},Zb:function(e,t,n,r){var a=ta();try{ca(e,t,n,r)}catch(e){if(na(a),e!==e+0)throw e;ea(1,0)}},cc:function(){let e=window.localStorage.getItem("k39d");e||(e=function(){let e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){let r=16*Math.random();return 0<e?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:3&r|8).toString(16)}))}(),window.localStorage.setItem("k39d",e));let t=document.title;t&&0!==t.length||(t="No title");let n=navigator.vendor;n&&0!==n.length||(n="N/A");let r=navigator.platform;r&&0!==r.length||(r="N/A"),nr=e,rr=navigator.userAgent,ar=window.screen.width+"x"+window.screen.height,sr=t,or=document.domain,ir="1.0.0",ur=n,cr=lr=r},oc:function(){if(console.assert(null!=In),console.assert(null!=hr),!In||!hr)return-1;if(null!=mr){var e=fn[mr.name];e&&(Pr.deleteTexture(e),fn[mr.name]=null,e.name=0,mr=null)}const t=(e=In.Lh).createTexture(),n=_n(fn);return t.name=n,fn[n]=t,e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,hr),mr=t,n},yb:function(e){if(null==dr)throw"Vision image has not been processed! Call processVisionImage() first.";T.set(dr.data,e)},zb:function(){if(null==hr)throw"Cannot process video frame if source video is not set";pr.width===hr.videoWidth&&pr.height===hr.videoHeight||(pr.width=hr.videoWidth,pr.height=hr.videoHeight,dr=null),fr.drawImage(hr,0,0,pr.width,pr.height),dr=fr.getImageData(0,0,pr.width,pr.height)},Ab:function(){Pr.bindTexture(Pr.TEXTURE_2D,mr),Pr.texImage2D(Pr.TEXTURE_2D,0,Pr.RGBA,Pr.RGBA,Pr.UNSIGNED_BYTE,hr)},Fb:function(e){C.set(vr,e>>2)},Eb:function(e){C.set(xr,e>>2)},Cb:function(e){C.set(wr,e>>2)},Bb:function(e){C.set(Tr,e>>2)},Ib:async function(){gr||(gr=!0,console.log(`DeepAR FootTracking initialize started for resolution ${hr.videoWidth}x${hr.videoHeight}.`),null==yr&&(yr=new s.Foot),null==br&&(br=new s.VideoManager(null,hr.videoWidth,hr.videoHeight)),yr.isInitialized()||(await yr.initialize(br,{poseEstimationWasmFilename:t.footTrackingConfig.poseEstimationWasmPath,modelFilename:t.footTrackingConfig.detectorPath,featuresFilename:t.footTrackingConfig.trackerPath,objFilename:t.footTrackingConfig.objPath,fovY:50,detection_score_t:.25,tracking_score_t:.35,footToDetect:"BOTH_FEET",filteringLevel:0,filteringShift:.5}),gr=!1,console.log("DeepAR FootTracking initialized!")))},Ga:function(){return null!=yr&&yr.isInitialized()},Jb:function(){return gr},Gb:function(){return _r},Db:function(){return Er},Hb:function(){if(!gr&&null!=yr&&yr.isInitialized()){br.preProcessWithBuffer(dr),yr.trackSync();var e=yr.getInterpolatedPose("LEFT_FOOT"),t=yr.getInterpolatedPose("RIGHT_FOOT");null!=e&&e.isDetected()?(vr=e.t(),xr=e.R(),_r=!0):_r=!1,null!=t&&t.isDetected()?(wr=t.t(),Tr=t.R(),Er=!0):Er=!1}},Mb:function(){return Sr.getHeight()},Nb:function(){return Sr.getWidth()},Kb:function(e){C.set(kr,e>>2)},Pb:async function(){console.log("DeepAR segmentation initialize started"),null==Sr&&(Sr=new s.Segmentation),null==Ir&&(Ir=new s.VideoManager(null)),Sr.isInitialized()||(await Sr.initialize(Ir,{filename:tr}),console.log("DeepAR segmentation initialized"))},Ob:function(){return null!=Sr&&Sr.isInitialized()},Lb:function(){Sr.isInitialized()&&(Ir.preProcessWithBuffer(dr),Sr.processSync(),kr=Sr.getOutput(),Ir.postProcess())},n:function(e){return e},Hf:Fr,dc:function(e,t,n,r){return Fr(e,t,n,r)},If:function(e,t,n){for(var r=F(t),a=0;25>a;++a)r=r.replace(new RegExp("\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[a],"g"),"\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[a]);for(var s in t={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"})r=r.replace(s,t[s]);a={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"};var o={Ij:0,Hj:1,Lj:2,Ej:3,Mj:4,Kj:5,Jj:6,Fj:7,Pj:8,Oj:9,Nj:10,Gj:11};for(var i in s={Ji:0,Hi:1,Li:2,Mi:3,Ki:4,Fi:5,Ii:6},t={Hi:0,Li:1,Mi:2,Ki:3,Fi:4,Ii:5,Ji:6},a)r=r.replace(i,"("+i+a[i]+")");var u=[];for(a=r.indexOf("%");0<=a;a=r.indexOf("%"))u.push(r[a+1]),r=r.replace(new RegExp("\\%"+r[a+1],"g"),"");var l=new RegExp("^"+r,"i").exec(F(e));if(l){if(i=function(){function e(e,t,n){return"number"!=typeof e||isNaN(e)?t:e>=t?e<=n?e:n:t}return{year:e(I[n+20>>2]+1900,1970,9999),month:e(I[n+16>>2],0,11),day:e(I[n+12>>2],1,31),hour:e(I[n+8>>2],0,23),min:e(I[n+4>>2],0,59),Bi:e(I[n>>2],0,59)}}(),a=e=>{if(0<=(e=u.indexOf(e)))return l[e+1]},(r=a("S"))&&(i.Bi=parseInt(r)),(r=a("M"))&&(i.min=parseInt(r)),r=a("H"))i.hour=parseInt(r);else if(r=a("I")){var c=parseInt(r);(r=a("p"))&&(c+="P"===r.toUpperCase()[0]?12:0),i.hour=c}if((r=a("Y"))?i.year=parseInt(r):(r=a("y"))&&(c=parseInt(r),c=(r=a("C"))?c+100*parseInt(r):c+(69>c?2e3:1900),i.year=c),(r=a("m"))?i.month=parseInt(r)-1:(r=a("b"))&&(i.month=o[r.substring(0,3).toUpperCase()]||0),r=a("d"))i.day=parseInt(r);else if(r=a("j"))for(s=parseInt(r),t=Cr(i.year),o=0;12>o;++o)s<=(r=Nr(t?Ar:$r,o-1))+(t?Ar:$r)[o]&&(i.day=s-r);else(r=a("a"))&&(o=r.substring(0,3).toUpperCase(),(r=a("U"))?(s=s[o],t=parseInt(r),s=0===(o=new Date(i.year,0,1)).getDay()?Rr(o,s+7*(t-1)):Rr(o,7-o.getDay()+s+7*(t-1)),i.day=s.getDate(),i.month=s.getMonth()):(r=a("W"))&&(s=t[o],t=parseInt(r),s=1===(o=new Date(i.year,0,1)).getDay()?Rr(o,s+7*(t-1)):Rr(o,7-o.getDay()+1+s+7*(t-1)),i.day=s.getDate(),i.month=s.getMonth()));return i=new Date(i.year,i.month,i.day,i.hour,i.min,i.Bi,0),I[n>>2]=i.getSeconds(),I[n+4>>2]=i.getMinutes(),I[n+8>>2]=i.getHours(),I[n+12>>2]=i.getDate(),I[n+16>>2]=i.getMonth(),I[n+20>>2]=i.getFullYear()-1900,I[n+24>>2]=i.getDay(),I[n+28>>2]=Nr(Cr(i.getFullYear())?Ar:$r,i.getMonth()-1)+i.getDate()-1,I[n+32>>2]=0,e+qn(l[0]).length-1}return 0}};!function(){function e(e){t.asm=e.exports,v=t.asm.qg,L(),P=t.asm.Qg,z.unshift(t.asm.rg),0==--H&&(null!==K&&(clearInterval(K),K=null),q&&(e=q,q=null,e()))}function n(t){e(t.instance)}function a(e){return("function"==typeof fetch?fetch(B,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+B+"'";return e.arrayBuffer()})).catch((function(){return J()})):Promise.resolve().then((function(){return J()}))).then((function(e){return WebAssembly.instantiate(e,s)})).then((function(e){return e})).then(e,(function(e){y("failed to asynchronously prepare wasm: "+e),X(e)}))}var s={a:Vr};if(H++,t.instantiateWasm)try{return t.instantiateWasm(s,e)}catch(e){y("Module.instantiateWasm callback failed with error: "+e),r(e)}("function"!=typeof WebAssembly.instantiateStreaming||Y()||"function"!=typeof fetch?a(n):fetch(B,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,s).then(n,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.rg).apply(null,arguments)};var Wr=t._initialize=function(){return(Wr=t._initialize=t.asm.sg).apply(null,arguments)};t._setLicenseKey=function(){return(t._setLicenseKey=t.asm.tg).apply(null,arguments)};var jr=t._shutdownEngine=function(){return(jr=t._shutdownEngine=t.asm.ug).apply(null,arguments)};t._processFrameVideo=function(){return(t._processFrameVideo=t.asm.vg).apply(null,arguments)},t._processFrameRawPixels=function(){return(t._processFrameRawPixels=t.asm.wg).apply(null,arguments)};var Gr=t._takeScreenshot=function(){return(Gr=t._takeScreenshot=t.asm.xg).apply(null,arguments)};t._switchEffect=function(){return(t._switchEffect=t.asm.yg).apply(null,arguments)},t._clearEffect=function(){return(t._clearEffect=t.asm.zg).apply(null,arguments)},t._showStats=function(){return(t._showStats=t.asm.Ag).apply(null,arguments)},t._simulatePhysics=function(){return(t._simulatePhysics=t.asm.Bg).apply(null,arguments)},t._showColliders=function(){return(t._showColliders=t.asm.Cg).apply(null,arguments)},t._render=function(){return(t._render=t.asm.Dg).apply(null,arguments)},t._fireTrigger=function(){return(t._fireTrigger=t.asm.Eg).apply(null,arguments)},t._setFaceDetectionSensitivity=function(){return(t._setFaceDetectionSensitivity=t.asm.Fg).apply(null,arguments)},t._changeParameterFloat=function(){return(t._changeParameterFloat=t.asm.Gg).apply(null,arguments)},t._changeParameterBool=function(){return(t._changeParameterBool=t.asm.Hg).apply(null,arguments)},t._changeParameterVector=function(){return(t._changeParameterVector=t.asm.Ig).apply(null,arguments)},t._changeParameterTexture=function(){return(t._changeParameterTexture=t.asm.Jg).apply(null,arguments)};var Hr=t._reset=function(){return(Hr=t._reset=t.asm.Kg).apply(null,arguments)};t._moveGameObject=function(){return(t._moveGameObject=t.asm.Lg).apply(null,arguments)};var Kr=t._touchOccurred=function(){return(Kr=t._touchOccurred=t.asm.Mg).apply(null,arguments)};t._pushConsoleLog=function(){return(t._pushConsoleLog=t.asm.Ng).apply(null,arguments)},t._enableAutoframing=function(){return(t._enableAutoframing=t.asm.Og).apply(null,arguments)};var qr=t._malloc=function(){return(qr=t._malloc=t.asm.Pg).apply(null,arguments)},Xr=t._free=function(){return(Xr=t._free=t.asm.Rg).apply(null,arguments)},Yr=t.setTempRet0=function(){return(Yr=t.setTempRet0=t.asm.Sg).apply(null,arguments)},Qr=t._fflush=function(){return(Qr=t._fflush=t.asm.Tg).apply(null,arguments)},Jr=t.___getTypeName=function(){return(Jr=t.___getTypeName=t.asm.Ug).apply(null,arguments)};t.__embind_initialize_bindings=function(){return(t.__embind_initialize_bindings=t.asm.Vg).apply(null,arguments)};var Zr=t.___funcs_on_exit=function(){return(Zr=t.___funcs_on_exit=t.asm.Wg).apply(null,arguments)},ea=t._setThrew=function(){return(ea=t._setThrew=t.asm.Xg).apply(null,arguments)},ta=t.stackSave=function(){return(ta=t.stackSave=t.asm.Yg).apply(null,arguments)},na=t.stackRestore=function(){return(na=t.stackRestore=t.asm.Zg).apply(null,arguments)},ra=t.stackAlloc=function(){return(ra=t.stackAlloc=t.asm._g).apply(null,arguments)},aa=t.___cxa_can_catch=function(){return(aa=t.___cxa_can_catch=t.asm.$g).apply(null,arguments)},sa=t.___cxa_is_pointer_type=function(){return(sa=t.___cxa_is_pointer_type=t.asm.ah).apply(null,arguments)};t.dynCall_viiiij=function(){return(t.dynCall_viiiij=t.asm.bh).apply(null,arguments)},t.dynCall_vijiiii=function(){return(t.dynCall_vijiiii=t.asm.ch).apply(null,arguments)};var oa=t.dynCall_j=function(){return(oa=t.dynCall_j=t.asm.dh).apply(null,arguments)},ia=t.dynCall_ji=function(){return(ia=t.dynCall_ji=t.asm.eh).apply(null,arguments)},ua=t.dynCall_vij=function(){return(ua=t.dynCall_vij=t.asm.fh).apply(null,arguments)},la=t.dynCall_iij=function(){return(la=t.dynCall_iij=t.asm.gh).apply(null,arguments)};t.dynCall_iijii=function(){return(t.dynCall_iijii=t.asm.hh).apply(null,arguments)},t.dynCall_vijii=function(){return(t.dynCall_vijii=t.asm.ih).apply(null,arguments)};var ca=t.dynCall_vji=function(){return(ca=t.dynCall_vji=t.asm.jh).apply(null,arguments)},ha=t.dynCall_jii=function(){return(ha=t.dynCall_jii=t.asm.kh).apply(null,arguments)};t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.lh).apply(null,arguments)},t.dynCall_viij=function(){return(t.dynCall_viij=t.asm.mh).apply(null,arguments)};var pa,fa=t.dynCall_viijii=function(){return(fa=t.dynCall_viijii=t.asm.nh).apply(null,arguments)},da=t.dynCall_iiiiij=function(){return(da=t.dynCall_iiiiij=t.asm.oh).apply(null,arguments)},ma=t.dynCall_jiiii=function(){return(ma=t.dynCall_jiiii=t.asm.ph).apply(null,arguments)};function ga(){0<H||(te(U),0<H||pa||(pa=!0,t.calledRun=!0,A))||(te(z),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),te(W))}return t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.qh).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.rh).apply(null,arguments)},t.cwrap=Dr,q=function e(){pa||ga(),pa||(q=e)},ga(),e.ready});const Qb=Yb;var Jb,Zb;!function(e){e[e.Start=0]="Start",e[e.Move=1]="Move",e[e.End=2]="End"}(Jb||(Jb={})),function(e){e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(Zb||(Zb={}));var ev="DeepAR not yet initialized.",tv=function(){function e(e){var t=this;this.module=null,this.functionsToCallOnInitialize=[],this.callbacks=e.callbacks;var n={licenseKey:e.licenseKey,canvasWidth:e.canvas.width,canvasHeight:e.canvas.height,canvas:e.canvas,segmentationModel:e.segmentationConfig&&e.segmentationConfig.modelPath||null,footTrackingConfig:Object.assign({},e.footTrackingConfig),apiObject:this.callbacks,xzimg:{Segmentation:fb,VideoManager:o,Foot:Pb},locateFile:function(t,n){return e.deeparWasmPath||n+t}};Qb(n).then((function(n){t.module=n,e.callbacks.onInitialize&&e.callbacks.onInitialize(),t.functionsToCallOnInitialize.forEach((function(e){return e()}))}))}return e.prototype.switchEffect=function(e,t,n,r){this.module?this.module.switchEffect(e,t,n,r):console.log(ev)},e.prototype.clearEffect=function(e){this.module?this.module.clearEffect(e):console.log(ev)},e.prototype.startVideo=function(e,t){this.module?(this.module.startVideo(e,t),this.module.startLoop()):console.log(ev)},e.prototype.stopVideo=function(){this.module?this.module.stopVideo():console.log(ev)},e.prototype.setVideoElement=function(e,t){this.module?(this.module.setVideoElement(e,t),this.module.startLoop()):console.log(ev)},e.prototype.shutdown=function(){this.module?this.module.shutdown():console.log(ev)},e.prototype.downloadFaceTrackingModel=function(e,t){var n=this,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=new Uint8Array(r.response);n.module?(n.module.setFaceTrackingModel(e),t&&t()):n.functionsToCallOnInitialize.push((function(){n.module.setFaceTrackingModel(e),t&&t()}))}},r.send(null)},e.prototype.setFaceTrackingModel=function(e){var t=this;this.module?this.module.setFaceTrackingModel(e):this.functionsToCallOnInitialize.push((function(){t.module.setFaceTrackingModel(e)}))},e.prototype.showStats=function(e){this.module?this.module.showStats(e):console.log(ev)},e.prototype.simulatePhysics=function(e){this.module?this.module.simulatePhysics(e):console.log(ev)},e.prototype.showColliders=function(e){this.module?this.module.showColliders(e):console.log(ev)},e.prototype.processFrame=function(e,t,n,r){this.module?this.module.processFrameRawPixels(e,t,n,r):console.log(ev)},e.prototype.processImage=function(e){if(this.module){var t=document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});t.width=e.width,t.height=e.height,n.drawImage(e,0,0);var r=n.getImageData(0,0,t.width,t.height),a=new Uint8Array(r.data.buffer);this.processFrame(a,e.width,e.height,!1)}else console.log(ev)},e.prototype.resume=function(){this.module?this.module.startLoop():console.log(ev)},e.prototype.pause=function(){this.module?this.module.endLoop():console.log(ev)},e.prototype.changeParameterFloat=function(e,t,n,r){this.module?this.module.changeParameterFloat(e,t,n,r):console.log(ev)},e.prototype.changeParameterBool=function(e,t,n,r){this.module?this.module.changeParameterBool(e,t,n,r):console.log(ev)},e.prototype.changeParameterVector=function(e,t,n,r,a,s,o){this.module?this.module.changeParameterVector(e,t,n,r,a,s,o):console.log(ev)},e.prototype.changeParameterTexture=function(e,t,n,r){var a=this;if(this.module){var s=new Image;s.onload=function(){var r=document.createElement("canvas"),o=r.getContext("2d",{willReadFrequently:!0});r.width=s.width,r.height=s.height,o.drawImage(s,0,0);var i=o.getImageData(0,0,r.width,r.height),u=new Uint8Array(i.data.buffer),l=a.module._malloc(u.length);a.module.HEAPU8.set(u,l),a.module.changeParameterTexture(e,t,n,l,u.length,r.width,r.height)},s.src=r}else console.log(ev)},e.prototype.takeScreenshot=function(){this.module?this.module.takeScreenshot():console.log(ev)},e.prototype.setFps=function(e){this.module?this.module.setFps(e):console.log(ev)},e.prototype.moveGameObject=function(e,t){this.module?this.module.moveGameObject(e,t):console.log(ev)},e.prototype.fireTrigger=function(e){this.module?this.module.fireTrigger(e):console.log(ev)},e.prototype.touchOccurred=function(e){this.module?(e.x/=this.module.canvasWidth,e.y/=this.module.canvasHeight,this.module.touchOccurred(e)):console.log(ev)},e.prototype.startVideoRecording=function(e){this.module?this.module.startVideoRecording(e||{}):console.log(ev)},e.prototype.finishVideoRecording=function(e){this.module?this.module.finishVideoRecording(e):console.log(ev)},e.prototype.pushConsoleLog=function(e,t){return this.module?this.module.pushConsoleLog(e,t):(console.log(ev),!1)},e.prototype.getConsoleLogs=function(){if(this.module)return this.module.getConsoleLogs();console.log(ev)},e.prototype.setFaceDetectionSensitivity=function(e){this.module?this.module.setFaceDetectionSensitivity(e):console.log(ev)},e.prototype.setOffscreenRenderingEnabled=function(e){this.module.setOffscreenRenderingEnabled(e)},e.prototype.enableAutoframing=function(e){this.module?this.module._enableAutoframing(e):console.log(ev)},e}()})();var s=a.G;const o=e.p+"2b441ba4a40d2190cce1.wasm",i=e.p+"a7965ae4891554079e7c.bin",u=e.p+"9eaadaeb638047c7e764.bin",l=new s({licenseKey:"ac6d4949a74f0f2f8f98110c46a21182dd290181693ee73ef7362acfd6c2f1e3b437f9d866c8220e",canvas:document.getElementById("deepar-canvas"),deeparWasmPath:o,callbacks:{onInitialize:()=>{l.startVideo(!0)},segmentationConfig:{modelPath:u}}});l.downloadFaceTrackingModel(i);const c=["./effects/Neon_Devil_horns.deepar","./effects/Hope.deepar","./effects/MakeupLook.deepar","./effects/Ping_Pong.deepar","./effects/galaxy_background.deepar"];let h=-1;document.getElementById("button").addEventListener("click",(()=>{h=(h+1)%c.length;const e=c[h];l.switchEffect(0,"slot",e)}))})();